"use strict";(self["webpackChunkCustomsPedia"]=self["webpackChunkCustomsPedia"]||[]).push([[379],{52379:function(e,a,l){function r(e){return new Promise(((a,l)=>{try{const l=document.createElement("textarea");l.setAttribute("readonly","readonly"),l.value=e,document.body.appendChild(l),l.select(),document.execCommand("copy")&&document.execCommand("copy"),document.body.removeChild(l),a(e)}catch(r){l(r)}}))}l.d(a,{L:function(){return r}})},89379:function(e,a,l){l.r(a),l.d(a,{default:function(){return B}});l(14898);var r=l(28694),o=l(38118),s=l(83487),t=l(74560),n=l(19477),i=l(95293),p=l(2324);const d="/api/v1";async function u(e){return(0,p.A)({url:d+"/system/user",method:"PUT",data:e})}async function c(e){return(0,p.A)({url:d+"/system/user/resetPwd",method:"PUT",data:e})}async function m(){return(0,p.A)({url:d+"/system/user/resetAk",method:"POST"})}async function g(e){return(0,p.A)({url:d+"/system/user/avatar",method:"POST",headers:{"Content-Type":"multipart/form-data"},data:e})}var f=l(52379),k=l(32228),v=l(74913),b=l(98836);const h=e=>((0,r.Qi)("data-v-4f4b3182"),e=e(),(0,r.jt)(),e),y={class:"main"},w={class:"main-info"},_=h((()=>(0,r.Lk)("div",{class:"main-info-title"},null,-1))),z={class:"main-info-avatar"},R={class:"avatar"},F=["src"],V={class:"form"},x={class:"text-align"},C={class:"main-info-content"},L={class:"form"},P={key:0,class:"hint"},W={key:0,class:"hint"},N={class:"text-align"},E={class:"dialog-body"},T={class:"ak-sk-container"},U={class:"ak-sk-container"},q={class:"dialog-footer"},K="/images/default-avatar.png",A="At least one uppercase letter, one lowercase letter, one number, and one special character, and be at least 8 characters long";var S=(0,r.pM)({__name:"index",setup(e){const a="/api/v1",{t:l}=(0,k.s9)(),p=(0,v.Pj)(),d=((0,b.lq)(),(0,b.rd)()),h=(0,r.EW)((()=>p.state.user.currentUser)),S=(0,o.KR)(!1),X=(0,o.KR)("info"),$=(0,o.KR)(""),B=(0,o.KR)(null),j=(0,o.Kh)({loginName:h.value.name,realName:h.value.realName,phone:h.value.phone,email:h.value.email,createTime:h.value.createTime,ak:h.value.ak,sk:""}),Q=(0,o.KR)(null),D=(0,o.Kh)({realName:[{required:!0,trigger:"blur"},{max:100,trigger:"blur"}]}),H=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@#$!%*?&(){}])[A-Za-z\d@#$!%*?&(){}]{8,}$/,I=(e,a,l)=>{a?H.test(a)?l():l(new Error(A)):l(new Error("Please input the password"))},M=(e,a,l)=>{a!==O.password?l(new Error("Password and confirm password do not match")):l()},O=(0,o.Kh)({oldPassword:"",password:"",repassword:""}),Z=(0,o.KR)(null),G=(0,o.KR)(!1),J=(0,r.EW)((()=>!H.test(O.password)||O.password!==O.repassword)),Y=(0,o.Kh)({oldPassword:[{required:!0,trigger:"blur"},{min:6,trigger:"blur"}],password:[{validator:I,trigger:"blur"},{required:!0,trigger:"blur"}],repassword:[{validator:M,trigger:"blur"},{required:!0,trigger:"blur"}]}),ee=(0,o.KR)(!1),ae=e=>{const a=e.size/1024/1024<2;return!!a||(t.nk.error("exceed 2MB"),!1)},le=async e=>{const l=new FormData;l.append("avatarfile",e.file);const r=await g(l);200===r.code?($.value=`${a}${r.imgUrl}`,O.avatar=r.imgUrl):t.nk.error(r.msg),B.value?.clearFiles()},re=()=>{d.push({path:"/home"})},oe=(e,a,l)=>{console.log(e,"-",a,"-",l,"+",G.value),G.value=e},se=async()=>{try{const e=await m();200===e.code?(j.ak=e.data.ak,j.sk=e.data.sk,t.nk.success(l("page.organizes.profile.applySuccess")),S.value=!0):t.nk.error(l("page.organizes.profile.applyError"))}catch(e){console.error(e)}},te=async()=>{try{const e=l("page.organizes.profile.resetHint",{ak:j.ak});n.s.confirm(e,l("page.qa.main.deleteHint"),{confirmButtonText:l("page.qa.main.confirmButton"),cancelButtonText:l("page.qa.main.cancelButton"),type:"warning"}).then((async()=>{const e=await m();200===e.code?(j.ak=e.data.ak,j.sk=e.data.sk,t.nk.success(l("page.organizes.profile.resetSuccess")),S.value=!0):t.nk.error(l("page.organizes.profile.resetError"))})).catch((()=>{}))}catch(e){console.error(e)}},ne=async()=>{try{await(0,f.L)(j.ak||""),t.nk.success(l("page.qa.main.copySuccess"))}catch(e){console.log(e),t.nk.error(l("page.qa.main.copyError"))}},ie=async()=>{try{await(0,f.L)(j.ak+" "+j.sk),t.nk.success(l("page.qa.main.copySuccess"))}catch(e){console.log(e),t.nk.error(l("page.qa.main.copyError"))}},pe=async()=>{try{const e=await Q.value.validate();if(!e)return}catch(a){return}ee.value=!0;const e={...j};e.userId=h.value.id,h.value.phone===j.phone&&delete e.phone,h.value.email===j.email&&delete e.email;try{const a=await u(e);200===~~a.code?(t.nk.success(l("page.organizes.profile.update-success")),await p.commit("user/saveUser",j)):t.nk.error(l("page.organizes.profile.update-error"))}catch(a){t.nk.error(l("page.organizes.profile.update-error"))}ee.value=!1},de=async()=>{try{const e=await(Z.value?.validate());if(!e)return}catch(e){return}if(O.password===O.repassword){ee.value=!0;try{const e=await c({oldPassword:(0,i.w)(O.oldPassword),password:(0,i.w)(O.password)});200===e.code?(t.nk.success(l("page.organizes.profile.update-success")),await p.dispatch("user/logout"),d.push({path:"/login"})):t.nk.error(e.message)}catch(e){t.nk.error(l("page.organizes.profile.update-error"))}finally{ee.value=!1}}else t.nk.error(l("page.organizes.profile.repasswordError"))},ue=(0,r.EW)((()=>d.currentRoute.value));return ue.value.path.includes("profile")?X.value="info":X.value="pwd",(0,r.nT)((()=>{d.currentRoute.value.path.includes("profile")?X.value="info":X.value="pwd"})),(0,r.sV)((()=>{j.loginName=h.value.name,j.realName=h.value.realName,j.phone=h.value.phone,j.email=h.value.email,j.createTime=h.value.createTime,$.value=h.value.avatar?`${a}${h.value.avatar}`:K})),(e,a)=>{const t=(0,r.g2)("el-button"),n=(0,r.g2)("el-upload"),i=(0,r.g2)("el-form-item"),p=(0,r.g2)("el-input"),d=(0,r.g2)("el-form"),u=(0,r.g2)("el-tab-pane"),c=(0,r.g2)("el-tabs"),m=(0,r.g2)("el-alert"),g=(0,r.g2)("el-dialog"),f=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",y,[(0,r.Lk)("div",w,[_,(0,r.bF)(c,{modelValue:X.value,"onUpdate:modelValue":a[6]||(a[6]=e=>X.value=e),class:"main-info-tabs",type:"border-card"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{label:(0,o.R1)(l)("page.organizes.profile.infoNav"),name:"info"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",z,[(0,r.Lk)("div",R,[(0,r.Lk)("img",{src:$.value,alt:"avatar",width:"74",height:"74"},null,8,F)]),(0,r.bF)(n,{ref_key:"uploadRef",ref:B,"show-file-list":!1,accept:".png,.jpg,.jpeg","before-upload":ae,"http-request":le,limit:1},{default:(0,r.k6)((()=>[(0,r.bF)(t,{type:"primary",text:""},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)((0,o.R1)(l)("page.organizes.profile.avatar")),1)])),_:1})])),_:1},8,["accept"])]),(0,r.bF)(d,{ref_key:"infoFormRef",ref:Q,class:"main-info-login",model:j,rules:D,"label-width":"100"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",V,[(0,r.bF)(i,{label:(0,o.R1)(l)("page.organizes.profile.form-login-name"),prop:"loginName"},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)(h.value.name),1)])),_:1},8,["label"]),(0,r.bF)(i,{label:(0,o.R1)(l)("page.organizes.profile.form-roleName"),prop:"roleName"},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)(h.value.roleName),1)])),_:1},8,["label"]),(0,r.bF)(i,{label:(0,o.R1)(l)("page.organizes.profile.form-real-name"),prop:"realName"},{default:(0,r.k6)((()=>[(0,r.bF)(p,{max:100,maxlength:"100",modelValue:j.realName,"onUpdate:modelValue":a[0]||(a[0]=e=>j.realName=e),placeholder:(0,o.R1)(l)("page.organizes.profile.form-real-name-holder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,r.bF)(i,{label:(0,o.R1)(l)("page.organizes.profile.form-phone"),prop:"phone"},{default:(0,r.k6)((()=>[(0,r.bF)(p,{max:11,maxlength:"11",modelValue:j.phone,"onUpdate:modelValue":a[1]||(a[1]=e=>j.phone=e),placeholder:(0,o.R1)(l)("page.organizes.profile.form-phone-holder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,r.bF)(i,{label:(0,o.R1)(l)("page.organizes.profile.form-email"),prop:"email"},{default:(0,r.k6)((()=>[(0,r.bF)(p,{max:255,maxlength:"255",modelValue:j.email,"onUpdate:modelValue":a[2]||(a[2]=e=>j.email=e),placeholder:(0,o.R1)(l)("page.organizes.profile.form-email-holder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,r.bF)(i,{label:(0,o.R1)(l)("page.organizes.profile.form-create-time"),prop:"createTime"},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)(j.createTime),1)])),_:1},8,["label"]),(0,r.bF)(i,{label:(0,o.R1)(l)("page.organizes.profile.form-ak-sk"),prop:"akSk"},{default:(0,r.k6)((()=>[(0,r.Lk)("span",null,(0,s.v_)(j.ak),1),void 0==j.ak?((0,r.uX)(),(0,r.Wv)(t,{key:0,type:"primary",text:"",onClick:se},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)((0,o.R1)(l)("page.organizes.profile.applyAkSk")),1)])),_:1})):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.bF)(t,{type:"primary",text:"",onClick:ne},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)((0,o.R1)(l)("page.organizes.profile.copy")),1)])),_:1}),(0,r.bF)(t,{type:"primary",text:"",onClick:te},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)((0,o.R1)(l)("page.organizes.profile.resetAkSk")),1)])),_:1})],64))])),_:1},8,["label"]),(0,r.bF)(i,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",x,[(0,r.bF)(t,{type:"info",onClick:re},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)((0,o.R1)(l)("page.organizes.profile.cancel")),1)])),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(t,{type:"primary",onClick:pe},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)((0,o.R1)(l)("page.organizes.profile.save")),1)])),_:1})),[[f,ee.value]])])])),_:1})])])),_:1},8,["model","rules"])])),_:1},8,["label"]),(0,r.bF)(u,{label:(0,o.R1)(l)("page.organizes.profile.modifyNav"),name:"pwd"},{default:(0,r.k6)((()=>[(0,r.Lk)("div",C,[(0,r.bF)(d,{model:O,rules:Y,ref_key:"formRef",ref:Z,"label-width":"100px",onValidate:oe},{default:(0,r.k6)((()=>[(0,r.Lk)("div",L,[(0,r.bF)(i,{label:(0,o.R1)(l)("page.organizes.profile.oldPassword"),prop:"oldPassword"},{default:(0,r.k6)((()=>[(0,r.bF)(p,{min:6,type:"password",modelValue:O.oldPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>O.oldPassword=e),placeholder:(0,o.R1)(l)("page.organizes.profile.oldPassword-holder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,r.bF)(i,{label:(0,o.R1)(l)("page.organizes.profile.password"),prop:"password"},{default:(0,r.k6)((()=>[(0,r.bF)(p,{min:6,maxlength:"20",type:"password",modelValue:O.password,"onUpdate:modelValue":a[4]||(a[4]=e=>O.password=e),placeholder:(0,o.R1)(l)("page.organizes.profile.password-holder")},null,8,["modelValue","placeholder"]),O.password?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",P,(0,s.v_)(A)))])),_:1},8,["label"]),(0,r.bF)(i,{label:(0,o.R1)(l)("page.organizes.profile.repassword"),prop:"repassword"},{default:(0,r.k6)((()=>[(0,r.bF)(p,{min:6,maxlength:"20",type:"password",modelValue:O.repassword,"onUpdate:modelValue":a[5]||(a[5]=e=>O.repassword=e),placeholder:(0,o.R1)(l)("page.organizes.profile.repassword-holder")},null,8,["modelValue","placeholder"]),O.repassword?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",W,(0,s.v_)(A)))])),_:1},8,["label"]),(0,r.bF)(i,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",N,[(0,r.bF)(t,{type:"info",onClick:re},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)((0,o.R1)(l)("page.organizes.profile.cancel")),1)])),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(t,{type:"primary",disabled:J.value,onClick:de},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)((0,o.R1)(l)("page.organizes.profile.save")),1)])),_:1},8,["disabled"])),[[f,ee.value]])])])),_:1})])])),_:1},8,["model","rules"])])])),_:1},8,["label"])])),_:1},8,["modelValue"])]),(0,r.bF)(g,{modelValue:S.value,"onUpdate:modelValue":a[8]||(a[8]=e=>S.value=e)},{title:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)((0,o.R1)(l)("page.organizes.profile.akDialogTitle")),1)])),footer:(0,r.k6)((()=>[(0,r.Lk)("div",q,[(0,r.bF)(t,{onClick:ie},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)((0,o.R1)(l)("page.organizes.profile.copy")),1)])),_:1}),(0,r.bF)(t,{type:"primary",onClick:a[7]||(a[7]=e=>S.value=!1)},{default:(0,r.k6)((()=>[(0,r.eW)((0,s.v_)((0,o.R1)(l)("page.organizes.profile.close")),1)])),_:1})])])),default:(0,r.k6)((()=>[(0,r.Lk)("div",E,[(0,r.bF)(m,{type:"warning",title:(0,o.R1)(l)("page.organizes.profile.hint"),"show-icon":""},null,8,["title"]),(0,r.Lk)("div",T,[(0,r.Lk)("span",null,(0,s.v_)((0,o.R1)(l)("page.organizes.profile.ak"))+":",1),(0,r.Lk)("span",null,(0,s.v_)(j.ak),1)]),(0,r.Lk)("div",U,[(0,r.Lk)("span",null,(0,s.v_)((0,o.R1)(l)("page.organizes.profile.sk"))+":",1),(0,r.Lk)("span",null,(0,s.v_)(j.sk),1)])])])),_:1},8,["modelValue"])])}}}),X=l(83940);const $=(0,X.A)(S,[["__scopeId","data-v-4f4b3182"]]);var B=$}}]);