(self["webpackChunkSensepedia"]=self["webpackChunkSensepedia"]||[]).push([[815],{26497:function(e,t,n){"use strict";function i(e){return e.replace(/(^,*)|(,*$)/g,"")}n.d(t,{QV:function(){return i}})},82167:function(e){
/*!
 * Viewer.js v1.11.6
 * https://fengyuanchen.github.io/viewerjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-09-17T03:16:38.052Z
 */
(function(t,n){e.exports=n()})(0,(function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){l(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e,t,n){return t=r(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function r(e){var t=s(e,"string");return"symbol"===typeof t?t:String(t)}var c={backdrop:!0,button:!0,navbar:!0,title:!0,toolbar:!0,className:"",container:"body",filter:null,fullscreen:!0,inheritedAttributes:["crossOrigin","decoding","isMap","loading","referrerPolicy","sizes","srcset","useMap"],initialCoverage:.9,initialViewIndex:0,inline:!1,interval:5e3,keyboard:!0,focus:!0,loading:!0,loop:!0,minWidth:200,minHeight:100,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,slideOnTouch:!0,toggleOnDblclick:!0,tooltip:!0,transition:!0,zIndex:2015,zIndexInline:0,zoomRatio:.1,minZoomRatio:.01,maxZoomRatio:100,url:"src",ready:null,show:null,shown:null,hide:null,hidden:null,view:null,viewed:null,move:null,moved:null,rotate:null,rotated:null,scale:null,scaled:null,zoom:null,zoomed:null,play:null,stop:null},d='<div class="viewer-container" tabindex="-1" touch-action="none"><div class="viewer-canvas"></div><div class="viewer-footer"><div class="viewer-title"></div><div class="viewer-toolbar"></div><div class="viewer-navbar"><ul class="viewer-list" role="navigation"></ul></div></div><div class="viewer-tooltip" role="alert" aria-hidden="true"></div><div class="viewer-button" data-viewer-action="mix" role="button"></div><div class="viewer-player"></div></div>',u="undefined"!==typeof window&&"undefined"!==typeof window.document,h=u?window:{},p=!(!u||!h.document.documentElement)&&"ontouchstart"in h.document.documentElement,m=!!u&&"PointerEvent"in h,v="viewer",g="move",f="switch",k="zoom",w="".concat(v,"-active"),b="".concat(v,"-close"),y="".concat(v,"-fade"),x="".concat(v,"-fixed"),C="".concat(v,"-fullscreen"),I="".concat(v,"-fullscreen-exit"),_="".concat(v,"-hide"),E="".concat(v,"-hide-md-down"),R="".concat(v,"-hide-sm-down"),A="".concat(v,"-hide-xs-down"),L="".concat(v,"-in"),F="".concat(v,"-invisible"),T="".concat(v,"-loading"),S="".concat(v,"-move"),X="".concat(v,"-open"),q="".concat(v,"-show"),D="".concat(v,"-transition"),N="click",O="dblclick",W="dragstart",j="focusin",K="keydown",z="load",B="error",P=p?"touchend touchcancel":"mouseup",M=p?"touchmove":"mousemove",V=p?"touchstart":"mousedown",H=m?"pointerdown":V,Y=m?"pointermove":M,U=m?"pointerup pointercancel":P,Q="resize",$="transitionend",G="wheel",J="ready",Z="show",ee="shown",te="hide",ne="hidden",ie="view",ae="viewed",oe="move",le="moved",se="rotate",re="rotated",ce="scale",de="scaled",ue="zoom",he="zoomed",pe="play",me="stop",ve="".concat(v,"Action"),ge=/\s\s*/,fe=["zoom-in","zoom-out","one-to-one","reset","prev","play","next","rotate-left","rotate-right","flip-horizontal","flip-vertical"];function ke(e){return"string"===typeof e}var we=Number.isNaN||h.isNaN;function be(e){return"number"===typeof e&&!we(e)}function ye(e){return"undefined"===typeof e}function xe(e){return"object"===n(e)&&null!==e}var Ce=Object.prototype.hasOwnProperty;function Ie(e){if(!xe(e))return!1;try{var t=e.constructor,n=t.prototype;return t&&n&&Ce.call(n,"isPrototypeOf")}catch(i){return!1}}function _e(e){return"function"===typeof e}function Ee(e,t){if(e&&_e(t))if(Array.isArray(e)||be(e.length)){var n,i=e.length;for(n=0;n<i;n+=1)if(!1===t.call(e,e[n],n,e))break}else xe(e)&&Object.keys(e).forEach((function(n){t.call(e,e[n],n,e)}));return e}var Re=Object.assign||function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe(e)&&n.length>0&&n.forEach((function(t){xe(t)&&Object.keys(t).forEach((function(n){e[n]=t[n]}))})),e},Ae=/^(?:width|height|left|top|marginLeft|marginTop)$/;function Le(e,t){var n=e.style;Ee(t,(function(e,t){Ae.test(t)&&be(e)&&(e+="px"),n[t]=e}))}function Fe(e){return ke(e)?e.replace(/&(?!amp;|quot;|#39;|lt;|gt;)/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function Te(e,t){return!(!e||!t)&&(e.classList?e.classList.contains(t):e.className.indexOf(t)>-1)}function Se(e,t){if(e&&t)if(be(e.length))Ee(e,(function(e){Se(e,t)}));else if(e.classList)e.classList.add(t);else{var n=e.className.trim();n?n.indexOf(t)<0&&(e.className="".concat(n," ").concat(t)):e.className=t}}function Xe(e,t){e&&t&&(be(e.length)?Ee(e,(function(e){Xe(e,t)})):e.classList?e.classList.remove(t):e.className.indexOf(t)>=0&&(e.className=e.className.replace(t,"")))}function qe(e,t,n){t&&(be(e.length)?Ee(e,(function(e){qe(e,t,n)})):n?Se(e,t):Xe(e,t))}var De=/([a-z\d])([A-Z])/g;function Ne(e){return e.replace(De,"$1-$2").toLowerCase()}function Oe(e,t){return xe(e[t])?e[t]:e.dataset?e.dataset[t]:e.getAttribute("data-".concat(Ne(t)))}function We(e,t,n){xe(n)?e[t]=n:e.dataset?e.dataset[t]=n:e.setAttribute("data-".concat(Ne(t)),n)}var je=function(){var e=!1;if(u){var t=!1,n=function(){},i=Object.defineProperty({},"once",{get:function(){return e=!0,t},set:function(e){t=e}});h.addEventListener("test",n,i),h.removeEventListener("test",n,i)}return e}();function Ke(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=n;t.trim().split(ge).forEach((function(t){if(!je){var o=e.listeners;o&&o[t]&&o[t][n]&&(a=o[t][n],delete o[t][n],0===Object.keys(o[t]).length&&delete o[t],0===Object.keys(o).length&&delete e.listeners)}e.removeEventListener(t,a,i)}))}function ze(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=n;t.trim().split(ge).forEach((function(t){if(i.once&&!je){var o=e.listeners,l=void 0===o?{}:o;a=function(){delete l[t][n],e.removeEventListener(t,a,i);for(var o=arguments.length,s=new Array(o),r=0;r<o;r++)s[r]=arguments[r];n.apply(e,s)},l[t]||(l[t]={}),l[t][n]&&e.removeEventListener(t,l[t][n],i),l[t][n]=a,e.listeners=l}e.addEventListener(t,a,i)}))}function Be(e,n,i,a){var o;return _e(Event)&&_e(CustomEvent)?o=new CustomEvent(n,t({bubbles:!0,cancelable:!0,detail:i},a)):(o=document.createEvent("CustomEvent"),o.initCustomEvent(n,!0,!0,i)),e.dispatchEvent(o)}function Pe(e){var t=e.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}function Me(e){var t=e.rotate,n=e.scaleX,i=e.scaleY,a=e.translateX,o=e.translateY,l=[];be(a)&&0!==a&&l.push("translateX(".concat(a,"px)")),be(o)&&0!==o&&l.push("translateY(".concat(o,"px)")),be(t)&&0!==t&&l.push("rotate(".concat(t,"deg)")),be(n)&&1!==n&&l.push("scaleX(".concat(n,")")),be(i)&&1!==i&&l.push("scaleY(".concat(i,")"));var s=l.length?l.join(" "):"none";return{WebkitTransform:s,msTransform:s,transform:s}}function Ve(e){return ke(e)?decodeURIComponent(e.replace(/^.*\//,"").replace(/[?&#].*$/,"")):""}var He=h.navigator&&/Version\/\d+(\.\d+)+?\s+Safari/i.test(h.navigator.userAgent);function Ye(e,t,n){var i=document.createElement("img");if(e.naturalWidth&&!He)return n(e.naturalWidth,e.naturalHeight),i;var a=document.body||document.documentElement;return i.onload=function(){n(i.width,i.height),He||a.removeChild(i)},Ee(t.inheritedAttributes,(function(t){var n=e.getAttribute(t);null!==n&&i.setAttribute(t,n)})),i.src=e.src,He||(i.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",a.appendChild(i)),i}function Ue(e){switch(e){case 2:return A;case 3:return R;case 4:return E;default:return""}}function Qe(e){var n=t({},e),i=[];return Ee(e,(function(e,t){delete n[t],Ee(n,(function(t){var n=Math.abs(e.startX-t.startX),a=Math.abs(e.startY-t.startY),o=Math.abs(e.endX-t.endX),l=Math.abs(e.endY-t.endY),s=Math.sqrt(n*n+a*a),r=Math.sqrt(o*o+l*l),c=(r-s)/s;i.push(c)}))})),i.sort((function(e,t){return Math.abs(e)<Math.abs(t)})),i[0]}function $e(e,n){var i=e.pageX,a=e.pageY,o={endX:i,endY:a};return n?o:t({timeStamp:Date.now(),startX:i,startY:a},o)}function Ge(e){var t=0,n=0,i=0;return Ee(e,(function(e){var a=e.startX,o=e.startY;t+=a,n+=o,i+=1})),t/=i,n/=i,{pageX:t,pageY:n}}var Je={render:function(){this.initContainer(),this.initViewer(),this.initList(),this.renderViewer()},initBody:function(){var e=this.element.ownerDocument,t=e.body||e.documentElement;this.body=t,this.scrollbarWidth=window.innerWidth-e.documentElement.clientWidth,this.initialBodyPaddingRight=t.style.paddingRight,this.initialBodyComputedPaddingRight=window.getComputedStyle(t).paddingRight},initContainer:function(){this.containerData={width:window.innerWidth,height:window.innerHeight}},initViewer:function(){var e,t=this.options,n=this.parent;t.inline&&(e={width:Math.max(n.offsetWidth,t.minWidth),height:Math.max(n.offsetHeight,t.minHeight)},this.parentData=e),!this.fulled&&e||(e=this.containerData),this.viewerData=Re({},e)},renderViewer:function(){this.options.inline&&!this.fulled&&Le(this.viewer,this.viewerData)},initList:function(){var e=this,t=this.element,n=this.options,i=this.list,a=[];i.innerHTML="",Ee(this.images,(function(t,o){var l=t.src,s=t.alt||Ve(l),r=e.getImageURL(t);if(l||r){var c=document.createElement("li"),d=document.createElement("img");Ee(n.inheritedAttributes,(function(e){var n=t.getAttribute(e);null!==n&&d.setAttribute(e,n)})),n.navbar&&(d.src=l||r),d.alt=s,d.setAttribute("data-original-url",r||l),c.setAttribute("data-index",o),c.setAttribute("data-viewer-action","view"),c.setAttribute("role","button"),n.keyboard&&c.setAttribute("tabindex",0),c.appendChild(d),i.appendChild(c),a.push(c)}})),this.items=a,Ee(a,(function(t){var i,a,o=t.firstElementChild;We(o,"filled",!0),n.loading&&Se(t,T),ze(o,z,i=function(i){Ke(o,B,a),n.loading&&Xe(t,T),e.loadImage(i)},{once:!0}),ze(o,B,a=function(){Ke(o,z,i),n.loading&&Xe(t,T)},{once:!0})})),n.transition&&ze(t,ae,(function(){Se(i,D)}),{once:!0})},renderList:function(){var e=this.index,t=this.items[e];if(t){var n=t.nextElementSibling,i=parseInt(window.getComputedStyle(n||t).marginLeft,10),a=t.offsetWidth,o=a+i;Le(this.list,Re({width:o*this.length-i},Me({translateX:(this.viewerData.width-a)/2-o*e})))}},resetList:function(){var e=this.list;e.innerHTML="",Xe(e,D),Le(e,Me({translateX:0}))},initImage:function(e){var t,n=this,i=this.options,a=this.image,o=this.viewerData,l=this.footer.offsetHeight,s=o.width,r=Math.max(o.height-l,l),c=this.imageData||{};this.imageInitializing={abort:function(){t.onload=null}},t=Ye(a,i,(function(t,a){var o=t/a,l=Math.max(0,Math.min(1,i.initialCoverage)),d=s,u=r;n.imageInitializing=!1,r*o>s?u=s/o:d=r*o,l=be(l)?l:.9,d=Math.min(d*l,t),u=Math.min(u*l,a);var h=(s-d)/2,p=(r-u)/2,m={left:h,top:p,x:h,y:p,width:d,height:u,oldRatio:1,ratio:d/t,aspectRatio:o,naturalWidth:t,naturalHeight:a},v=Re({},m);i.rotatable&&(m.rotate=c.rotate||0,v.rotate=0),i.scalable&&(m.scaleX=c.scaleX||1,m.scaleY=c.scaleY||1,v.scaleX=1,v.scaleY=1),n.imageData=m,n.initialImageData=v,e&&e()}))},renderImage:function(e){var t=this,n=this.image,i=this.imageData;if(Le(n,Re({width:i.width,height:i.height,marginLeft:i.x,marginTop:i.y},Me(i))),e)if((this.viewing||this.moving||this.rotating||this.scaling||this.zooming)&&this.options.transition&&Te(n,D)){var a=function(){t.imageRendering=!1,e()};this.imageRendering={abort:function(){Ke(n,$,a)}},ze(n,$,a,{once:!0})}else e()},resetImage:function(){var e=this.image;e&&(this.viewing&&this.viewing.abort(),e.parentNode.removeChild(e),this.image=null,this.title.innerHTML="")}},Ze={bind:function(){var e=this.options,t=this.viewer,n=this.canvas,i=this.element.ownerDocument;ze(t,N,this.onClick=this.click.bind(this)),ze(t,W,this.onDragStart=this.dragstart.bind(this)),ze(n,H,this.onPointerDown=this.pointerdown.bind(this)),ze(i,Y,this.onPointerMove=this.pointermove.bind(this)),ze(i,U,this.onPointerUp=this.pointerup.bind(this)),ze(i,K,this.onKeyDown=this.keydown.bind(this)),ze(window,Q,this.onResize=this.resize.bind(this)),e.zoomable&&e.zoomOnWheel&&ze(t,G,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),e.toggleOnDblclick&&ze(n,O,this.onDblclick=this.dblclick.bind(this))},unbind:function(){var e=this.options,t=this.viewer,n=this.canvas,i=this.element.ownerDocument;Ke(t,N,this.onClick),Ke(t,W,this.onDragStart),Ke(n,H,this.onPointerDown),Ke(i,Y,this.onPointerMove),Ke(i,U,this.onPointerUp),Ke(i,K,this.onKeyDown),Ke(window,Q,this.onResize),e.zoomable&&e.zoomOnWheel&&Ke(t,G,this.onWheel,{passive:!1,capture:!0}),e.toggleOnDblclick&&Ke(n,O,this.onDblclick)}},et={click:function(e){var t=this.options,n=this.imageData,i=e.target,a=Oe(i,ve);switch(a||"img"!==i.localName||"li"!==i.parentElement.localName||(i=i.parentElement,a=Oe(i,ve)),p&&e.isTrusted&&i===this.canvas&&clearTimeout(this.clickCanvasTimeout),a){case"mix":this.played?this.stop():t.inline?this.fulled?this.exit():this.full():this.hide();break;case"hide":this.pointerMoved||this.hide();break;case"view":this.view(Oe(i,"index"));break;case"zoom-in":this.zoom(.1,!0);break;case"zoom-out":this.zoom(-.1,!0);break;case"one-to-one":this.toggle();break;case"reset":this.reset();break;case"prev":this.prev(t.loop);break;case"play":this.play(t.fullscreen);break;case"next":this.next(t.loop);break;case"rotate-left":this.rotate(-90);break;case"rotate-right":this.rotate(90);break;case"flip-horizontal":this.scaleX(-n.scaleX||-1);break;case"flip-vertical":this.scaleY(-n.scaleY||-1);break;default:this.played&&this.stop()}},dblclick:function(e){e.preventDefault(),this.viewed&&e.target===this.image&&(p&&e.isTrusted&&clearTimeout(this.doubleClickImageTimeout),this.toggle(e.isTrusted?e:e.detail&&e.detail.originalEvent))},load:function(){var e=this;this.timeout&&(clearTimeout(this.timeout),this.timeout=!1);var t=this.element,n=this.options,i=this.image,a=this.index,o=this.viewerData;Xe(i,F),n.loading&&Xe(this.canvas,T),i.style.cssText="height:0;"+"margin-left:".concat(o.width/2,"px;")+"margin-top:".concat(o.height/2,"px;")+"max-width:none!important;position:relative;width:0;",this.initImage((function(){qe(i,S,n.movable),qe(i,D,n.transition),e.renderImage((function(){e.viewed=!0,e.viewing=!1,_e(n.viewed)&&ze(t,ae,n.viewed,{once:!0}),Be(t,ae,{originalImage:e.images[a],index:a,image:i},{cancelable:!1})}))}))},loadImage:function(e){var t=e.target,n=t.parentNode,i=n.offsetWidth||30,a=n.offsetHeight||50,o=!!Oe(t,"filled");Ye(t,this.options,(function(e,n){var l=e/n,s=i,r=a;a*l>i?o?s=a*l:r=i/l:o?r=i/l:s=a*l,Le(t,Re({width:s,height:r},Me({translateX:(i-s)/2,translateY:(a-r)/2})))}))},keydown:function(e){var t=this.options;if(t.keyboard){var n=e.keyCode||e.which||e.charCode;switch(n){case 13:this.viewer.contains(e.target)&&this.click(e);break}if(this.fulled)switch(n){case 27:this.played?this.stop():t.inline?this.fulled&&this.exit():this.hide();break;case 32:this.played&&this.stop();break;case 37:this.played&&this.playing?this.playing.prev():this.prev(t.loop);break;case 38:e.preventDefault(),this.zoom(t.zoomRatio,!0);break;case 39:this.played&&this.playing?this.playing.next():this.next(t.loop);break;case 40:e.preventDefault(),this.zoom(-t.zoomRatio,!0);break;case 48:case 49:e.ctrlKey&&(e.preventDefault(),this.toggle());break}}},dragstart:function(e){"img"===e.target.localName&&e.preventDefault()},pointerdown:function(e){var t=this.options,n=this.pointers,i=e.buttons,a=e.button;if(this.pointerMoved=!1,!(!this.viewed||this.showing||this.viewing||this.hiding||("mousedown"===e.type||"pointerdown"===e.type&&"mouse"===e.pointerType)&&(be(i)&&1!==i||be(a)&&0!==a||e.ctrlKey))){e.preventDefault(),e.changedTouches?Ee(e.changedTouches,(function(e){n[e.identifier]=$e(e)})):n[e.pointerId||0]=$e(e);var o=!!t.movable&&g;t.zoomOnTouch&&t.zoomable&&Object.keys(n).length>1?o=k:t.slideOnTouch&&("touch"===e.pointerType||"touchstart"===e.type)&&this.isSwitchable()&&(o=f),!t.transition||o!==g&&o!==k||Xe(this.image,D),this.action=o}},pointermove:function(e){var t=this.pointers,n=this.action;this.viewed&&n&&(e.preventDefault(),e.changedTouches?Ee(e.changedTouches,(function(e){Re(t[e.identifier]||{},$e(e,!0))})):Re(t[e.pointerId||0]||{},$e(e,!0)),this.change(e))},pointerup:function(e){var t,n=this,i=this.options,a=this.action,o=this.pointers;e.changedTouches?Ee(e.changedTouches,(function(e){t=o[e.identifier],delete o[e.identifier]})):(t=o[e.pointerId||0],delete o[e.pointerId||0]),a&&(e.preventDefault(),!i.transition||a!==g&&a!==k||Se(this.image,D),this.action=!1,p&&a!==k&&t&&Date.now()-t.timeStamp<500&&(clearTimeout(this.clickCanvasTimeout),clearTimeout(this.doubleClickImageTimeout),i.toggleOnDblclick&&this.viewed&&e.target===this.image?this.imageClicked?(this.imageClicked=!1,this.doubleClickImageTimeout=setTimeout((function(){Be(n.image,O,{originalEvent:e})}),50)):(this.imageClicked=!0,this.doubleClickImageTimeout=setTimeout((function(){n.imageClicked=!1}),500)):(this.imageClicked=!1,i.backdrop&&"static"!==i.backdrop&&e.target===this.canvas&&(this.clickCanvasTimeout=setTimeout((function(){Be(n.canvas,N,{originalEvent:e})}),50)))))},resize:function(){var e=this;if(this.isShown&&!this.hiding&&(this.fulled&&(this.close(),this.initBody(),this.open()),this.initContainer(),this.initViewer(),this.renderViewer(),this.renderList(),this.viewed&&this.initImage((function(){e.renderImage()})),this.played)){if(this.options.fullscreen&&this.fulled&&!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement))return void this.stop();Ee(this.player.getElementsByTagName("img"),(function(t){ze(t,z,e.loadImage.bind(e),{once:!0}),Be(t,z)}))}},wheel:function(e){var t=this;if(this.viewed&&(e.preventDefault(),!this.wheeling)){this.wheeling=!0,setTimeout((function(){t.wheeling=!1}),50);var n=Number(this.options.zoomRatio)||.1,i=1;e.deltaY?i=e.deltaY>0?1:-1:e.wheelDelta?i=-e.wheelDelta/120:e.detail&&(i=e.detail>0?1:-1),this.zoom(-i*n,!0,null,e)}}},tt={show:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.element,n=this.options;if(n.inline||this.showing||this.isShown||this.showing)return this;if(!this.ready)return this.build(),this.ready&&this.show(e),this;if(_e(n.show)&&ze(t,Z,n.show,{once:!0}),!1===Be(t,Z)||!this.ready)return this;this.hiding&&this.transitioning.abort(),this.showing=!0,this.open();var i=this.viewer;if(Xe(i,_),i.setAttribute("role","dialog"),i.setAttribute("aria-labelledby",this.title.id),i.setAttribute("aria-modal",!0),i.removeAttribute("aria-hidden"),n.transition&&!e){var a=this.shown.bind(this);this.transitioning={abort:function(){Ke(i,$,a),Xe(i,L)}},Se(i,D),i.initialOffsetWidth=i.offsetWidth,ze(i,$,a,{once:!0}),Se(i,L)}else Se(i,L),this.shown();return this},hide:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.element,i=this.options;if(i.inline||this.hiding||!this.isShown&&!this.showing)return this;if(_e(i.hide)&&ze(n,te,i.hide,{once:!0}),!1===Be(n,te))return this;this.showing&&this.transitioning.abort(),this.hiding=!0,this.played?this.stop():this.viewing&&this.viewing.abort();var a=this.viewer,o=this.image,l=function(){Xe(a,L),e.hidden()};if(i.transition&&!t){var s=function t(n){n&&n.target===a&&(Ke(a,$,t),e.hidden())},r=function(){Te(a,D)?(ze(a,$,s),Xe(a,L)):l()};this.transitioning={abort:function(){e.viewed&&Te(o,D)?Ke(o,$,r):Te(a,D)&&Ke(a,$,s)}},this.viewed&&Te(o,D)?(ze(o,$,r,{once:!0}),this.zoomTo(0,!1,null,null,!0)):r()}else l();return this},view:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.initialViewIndex;if(t=Number(t)||0,this.hiding||this.played||t<0||t>=this.length||this.viewed&&t===this.index)return this;if(!this.isShown)return this.index=t,this.show();this.viewing&&this.viewing.abort();var n=this.element,i=this.options,a=this.title,o=this.canvas,l=this.items[t],s=l.querySelector("img"),r=Oe(s,"originalUrl"),c=s.getAttribute("alt"),d=document.createElement("img");if(Ee(i.inheritedAttributes,(function(e){var t=s.getAttribute(e);null!==t&&d.setAttribute(e,t)})),d.src=r,d.alt=c,_e(i.view)&&ze(n,ie,i.view,{once:!0}),!1===Be(n,ie,{originalImage:this.images[t],index:t,image:d})||!this.isShown||this.hiding||this.played)return this;var u=this.items[this.index];u&&(Xe(u,w),u.removeAttribute("aria-selected")),Se(l,w),l.setAttribute("aria-selected",!0),i.focus&&l.focus(),this.image=d,this.viewed=!1,this.index=t,this.imageData={},Se(d,F),i.loading&&Se(o,T),o.innerHTML="",o.appendChild(d),this.renderList(),a.innerHTML="";var h,p,m=function(){var t=e.imageData,n=Array.isArray(i.title)?i.title[1]:i.title;a.innerHTML=Fe(_e(n)?n.call(e,d,t):"".concat(c," (").concat(t.naturalWidth," × ").concat(t.naturalHeight,")"))};return ze(n,ae,m,{once:!0}),this.viewing={abort:function(){Ke(n,ae,m),d.complete?e.imageRendering?e.imageRendering.abort():e.imageInitializing&&e.imageInitializing.abort():(d.src="",Ke(d,z,h),e.timeout&&clearTimeout(e.timeout))}},d.complete?this.load():(ze(d,z,h=function(){Ke(d,B,p),e.load()},{once:!0}),ze(d,B,p=function(){Ke(d,z,h),e.timeout&&(clearTimeout(e.timeout),e.timeout=!1),Xe(d,F),i.loading&&Xe(e.canvas,T)},{once:!0}),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){Xe(d,F),e.timeout=!1}),1e3)),this},prev:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.index-1;return t<0&&(t=e?this.length-1:0),this.view(t),this},next:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.length-1,n=this.index+1;return n>t&&(n=e?0:t),this.view(n),this},move:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=this.imageData;return this.moveTo(ye(e)?e:n.x+Number(e),ye(t)?t:n.y+Number(t)),this},moveTo:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=this.element,o=this.options,l=this.imageData;if(e=Number(e),n=Number(n),this.viewed&&!this.played&&o.movable){var s=l.x,r=l.y,c=!1;if(be(e)?c=!0:e=s,be(n)?c=!0:n=r,c){if(_e(o.move)&&ze(a,oe,o.move,{once:!0}),!1===Be(a,oe,{x:e,y:n,oldX:s,oldY:r,originalEvent:i}))return this;l.x=e,l.y=n,l.left=e,l.top=n,this.moving=!0,this.renderImage((function(){t.moving=!1,_e(o.moved)&&ze(a,le,o.moved,{once:!0}),Be(a,le,{x:e,y:n,oldX:s,oldY:r,originalEvent:i},{cancelable:!1})}))}}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e)),this},rotateTo:function(e){var t=this,n=this.element,i=this.options,a=this.imageData;if(e=Number(e),be(e)&&this.viewed&&!this.played&&i.rotatable){var o=a.rotate;if(_e(i.rotate)&&ze(n,se,i.rotate,{once:!0}),!1===Be(n,se,{degree:e,oldDegree:o}))return this;a.rotate=e,this.rotating=!0,this.renderImage((function(){t.rotating=!1,_e(i.rotated)&&ze(n,re,i.rotated,{once:!0}),Be(n,re,{degree:e,oldDegree:o},{cancelable:!1})}))}return this},scaleX:function(e){return this.scale(e,this.imageData.scaleY),this},scaleY:function(e){return this.scale(this.imageData.scaleX,e),this},scale:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.element,a=this.options,o=this.imageData;if(e=Number(e),n=Number(n),this.viewed&&!this.played&&a.scalable){var l=o.scaleX,s=o.scaleY,r=!1;if(be(e)?r=!0:e=l,be(n)?r=!0:n=s,r){if(_e(a.scale)&&ze(i,ce,a.scale,{once:!0}),!1===Be(i,ce,{scaleX:e,scaleY:n,oldScaleX:l,oldScaleY:s}))return this;o.scaleX=e,o.scaleY=n,this.scaling=!0,this.renderImage((function(){t.scaling=!1,_e(a.scaled)&&ze(i,de,a.scaled,{once:!0}),Be(i,de,{scaleX:e,scaleY:n,oldScaleX:l,oldScaleY:s},{cancelable:!1})}))}}return this},zoom:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=this.imageData;return e=Number(e),e=e<0?1/(1-e):1+e,this.zoomTo(a.width*e/a.naturalWidth,t,n,i),this},zoomTo:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=this.element,s=this.options,r=this.pointers,c=this.imageData,d=c.x,u=c.y,h=c.width,p=c.height,m=c.naturalWidth,v=c.naturalHeight;if(e=Math.max(0,e),be(e)&&this.viewed&&!this.played&&(o||s.zoomable)){if(!o){var g=Math.max(.01,s.minZoomRatio),f=Math.min(100,s.maxZoomRatio);e=Math.min(Math.max(e,g),f)}if(a)switch(a.type){case"wheel":s.zoomRatio>=.055&&e>.95&&e<1.05&&(e=1);break;case"pointermove":case"touchmove":case"mousemove":e>.99&&e<1.01&&(e=1);break}var k=m*e,w=v*e,b=k-h,y=w-p,x=c.ratio;if(_e(s.zoom)&&ze(l,ue,s.zoom,{once:!0}),!1===Be(l,ue,{ratio:e,oldRatio:x,originalEvent:a}))return this;if(this.zooming=!0,a){var C=Pe(this.viewer),I=r&&Object.keys(r).length>0?Ge(r):{pageX:a.pageX,pageY:a.pageY};c.x-=b*((I.pageX-C.left-d)/h),c.y-=y*((I.pageY-C.top-u)/p)}else Ie(i)&&be(i.x)&&be(i.y)?(c.x-=b*((i.x-d)/h),c.y-=y*((i.y-u)/p)):(c.x-=b/2,c.y-=y/2);c.left=c.x,c.top=c.y,c.width=k,c.height=w,c.oldRatio=x,c.ratio=e,this.renderImage((function(){t.zooming=!1,_e(s.zoomed)&&ze(l,he,s.zoomed,{once:!0}),Be(l,he,{ratio:e,oldRatio:x,originalEvent:a},{cancelable:!1})})),n&&this.tooltip()}return this},play:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isShown||this.played)return this;var n=this.element,i=this.options;if(_e(i.play)&&ze(n,pe,i.play,{once:!0}),!1===Be(n,pe))return this;var a=this.player,o=this.loadImage.bind(this),l=[],s=0,r=0;if(this.played=!0,this.onLoadWhenPlay=o,t&&this.requestFullscreen(t),Se(a,q),Ee(this.items,(function(e,t){var n=e.querySelector("img"),c=document.createElement("img");c.src=Oe(n,"originalUrl"),c.alt=n.getAttribute("alt"),c.referrerPolicy=n.referrerPolicy,s+=1,Se(c,y),qe(c,D,i.transition),Te(e,w)&&(Se(c,L),r=t),l.push(c),ze(c,z,o,{once:!0}),a.appendChild(c)})),be(i.interval)&&i.interval>0){var c=function t(){clearTimeout(e.playing.timeout),Xe(l[r],L),r-=1,r=r>=0?r:s-1,Se(l[r],L),e.playing.timeout=setTimeout(t,i.interval)},d=function t(){clearTimeout(e.playing.timeout),Xe(l[r],L),r+=1,r=r<s?r:0,Se(l[r],L),e.playing.timeout=setTimeout(t,i.interval)};s>1&&(this.playing={prev:c,next:d,timeout:setTimeout(d,i.interval)})}return this},stop:function(){var e=this;if(!this.played)return this;var t=this.element,n=this.options;if(_e(n.stop)&&ze(t,me,n.stop,{once:!0}),!1===Be(t,me))return this;var i=this.player;return clearTimeout(this.playing.timeout),this.playing=!1,this.played=!1,Ee(i.getElementsByTagName("img"),(function(t){Ke(t,z,e.onLoadWhenPlay)})),Xe(i,q),i.innerHTML="",this.exitFullscreen(),this},full:function(){var e=this,t=this.options,n=this.viewer,i=this.image,a=this.list;return!this.isShown||this.played||this.fulled||!t.inline||(this.fulled=!0,this.open(),Se(this.button,I),t.transition&&(Xe(a,D),this.viewed&&Xe(i,D)),Se(n,x),n.setAttribute("role","dialog"),n.setAttribute("aria-labelledby",this.title.id),n.setAttribute("aria-modal",!0),n.removeAttribute("style"),Le(n,{zIndex:t.zIndex}),t.focus&&this.enforceFocus(),this.initContainer(),this.viewerData=Re({},this.containerData),this.renderList(),this.viewed&&this.initImage((function(){e.renderImage((function(){t.transition&&setTimeout((function(){Se(i,D),Se(a,D)}),0)}))}))),this},exit:function(){var e=this,t=this.options,n=this.viewer,i=this.image,a=this.list;return this.isShown&&!this.played&&this.fulled&&t.inline?(this.fulled=!1,this.close(),Xe(this.button,I),t.transition&&(Xe(a,D),this.viewed&&Xe(i,D)),t.focus&&this.clearEnforceFocus(),n.removeAttribute("role"),n.removeAttribute("aria-labelledby"),n.removeAttribute("aria-modal"),Xe(n,x),Le(n,{zIndex:t.zIndexInline}),this.viewerData=Re({},this.parentData),this.renderViewer(),this.renderList(),this.viewed&&this.initImage((function(){e.renderImage((function(){t.transition&&setTimeout((function(){Se(i,D),Se(a,D)}),0)}))})),this):this},tooltip:function(){var e=this,t=this.options,n=this.tooltipBox,i=this.imageData;return this.viewed&&!this.played&&t.tooltip?(n.textContent="".concat(Math.round(100*i.ratio),"%"),this.tooltipping?clearTimeout(this.tooltipping):t.transition?(this.fading&&Be(n,$),Se(n,q),Se(n,y),Se(n,D),n.removeAttribute("aria-hidden"),n.initialOffsetWidth=n.offsetWidth,Se(n,L)):(Se(n,q),n.removeAttribute("aria-hidden")),this.tooltipping=setTimeout((function(){t.transition?(ze(n,$,(function(){Xe(n,q),Xe(n,y),Xe(n,D),n.setAttribute("aria-hidden",!0),e.fading=!1}),{once:!0}),Xe(n,L),e.fading=!0):(Xe(n,q),n.setAttribute("aria-hidden",!0)),e.tooltipping=!1}),1e3),this):this},toggle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return 1===this.imageData.ratio?this.zoomTo(this.imageData.oldRatio,!0,null,e):this.zoomTo(1,!0,null,e),this},reset:function(){return this.viewed&&!this.played&&(this.imageData=Re({},this.initialImageData),this.renderImage()),this},update:function(){var e=this,t=this.element,n=this.options,i=this.isImg;if(i&&!t.parentNode)return this.destroy();var a=[];if(Ee(i?[t]:t.querySelectorAll("img"),(function(t){_e(n.filter)?n.filter.call(e,t)&&a.push(t):e.getImageURL(t)&&a.push(t)})),!a.length)return this;if(this.images=a,this.length=a.length,this.ready){var o=[];if(Ee(this.items,(function(e,t){var n=e.querySelector("img"),i=a[t];i&&n&&i.src===n.src&&i.alt===n.alt||o.push(t)})),Le(this.list,{width:"auto"}),this.initList(),this.isShown)if(this.length){if(this.viewed){var l=o.indexOf(this.index);if(l>=0)this.viewed=!1,this.view(Math.max(Math.min(this.index-l,this.length-1),0));else{var s=this.items[this.index];Se(s,w),s.setAttribute("aria-selected",!0)}}}else this.image=null,this.viewed=!1,this.index=0,this.imageData={},this.canvas.innerHTML="",this.title.innerHTML=""}else this.build();return this},destroy:function(){var e=this.element,t=this.options;return e[v]?(this.destroyed=!0,this.ready?(this.played&&this.stop(),t.inline?(this.fulled&&this.exit(),this.unbind()):this.isShown?(this.viewing&&(this.imageRendering?this.imageRendering.abort():this.imageInitializing&&this.imageInitializing.abort()),this.hiding&&this.transitioning.abort(),this.hidden()):this.showing&&(this.transitioning.abort(),this.hidden()),this.ready=!1,this.viewer.parentNode.removeChild(this.viewer)):t.inline&&(this.delaying?this.delaying.abort():this.initializing&&this.initializing.abort()),t.inline||Ke(e,N,this.onStart),e[v]=void 0,this):this}},nt={getImageURL:function(e){var t=this.options.url;return t=ke(t)?e.getAttribute(t):_e(t)?t.call(this,e):"",t},enforceFocus:function(){var e=this;this.clearEnforceFocus(),ze(document,j,this.onFocusin=function(t){var n=e.viewer,i=t.target;if(i!==document&&i!==n&&!n.contains(i)){while(i){if(null!==i.getAttribute("tabindex")||"true"===i.getAttribute("aria-modal"))return;i=i.parentElement}n.focus()}})},clearEnforceFocus:function(){this.onFocusin&&(Ke(document,j,this.onFocusin),this.onFocusin=null)},open:function(){var e=this.body;Se(e,X),this.scrollbarWidth>0&&(e.style.paddingRight="".concat(this.scrollbarWidth+(parseFloat(this.initialBodyComputedPaddingRight)||0),"px"))},close:function(){var e=this.body;Xe(e,X),this.scrollbarWidth>0&&(e.style.paddingRight=this.initialBodyPaddingRight)},shown:function(){var e=this.element,t=this.options,n=this.viewer;this.fulled=!0,this.isShown=!0,this.render(),this.bind(),this.showing=!1,t.focus&&(n.focus(),this.enforceFocus()),_e(t.shown)&&ze(e,ee,t.shown,{once:!0}),!1!==Be(e,ee)&&this.ready&&this.isShown&&!this.hiding&&this.view(this.index)},hidden:function(){var e=this.element,t=this.options,n=this.viewer;t.fucus&&this.clearEnforceFocus(),this.close(),this.unbind(),Se(n,_),n.removeAttribute("role"),n.removeAttribute("aria-labelledby"),n.removeAttribute("aria-modal"),n.setAttribute("aria-hidden",!0),this.resetList(),this.resetImage(),this.fulled=!1,this.viewed=!1,this.isShown=!1,this.hiding=!1,this.destroyed||(_e(t.hidden)&&ze(e,ne,t.hidden,{once:!0}),Be(e,ne,null,{cancelable:!1}))},requestFullscreen:function(e){var t=this.element.ownerDocument;if(this.fulled&&!(t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement||t.msFullscreenElement)){var n=t.documentElement;n.requestFullscreen?Ie(e)?n.requestFullscreen(e):n.requestFullscreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):n.mozRequestFullScreen?n.mozRequestFullScreen():n.msRequestFullscreen&&n.msRequestFullscreen()}},exitFullscreen:function(){var e=this.element.ownerDocument;this.fulled&&(e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement)&&(e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.msExitFullscreen&&e.msExitFullscreen())},change:function(e){var t=this.options,n=this.pointers,i=n[Object.keys(n)[0]];if(i){var a=i.endX-i.startX,o=i.endY-i.startY;switch(this.action){case g:0===a&&0===o||(this.pointerMoved=!0,this.move(a,o,e));break;case k:this.zoom(Qe(n),!1,null,e);break;case f:this.action="switched";var l=Math.abs(a);l>1&&l>Math.abs(o)&&(this.pointers={},a>1?this.prev(t.loop):a<-1&&this.next(t.loop));break}Ee(n,(function(e){e.startX=e.endX,e.startY=e.endY}))}},isSwitchable:function(){var e=this.imageData,t=this.viewerData;return this.length>1&&e.x>=0&&e.y>=0&&e.width<=t.width&&e.height<=t.height}},it=h.Viewer,at=function(e){return function(){return e+=1,e}}(-1),ot=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i(this,e),!t||1!==t.nodeType)throw new Error("The first argument is required and must be an element.");this.element=t,this.options=Re({},c,Ie(n)&&n),this.action=!1,this.fading=!1,this.fulled=!1,this.hiding=!1,this.imageClicked=!1,this.imageData={},this.index=this.options.initialViewIndex,this.isImg=!1,this.isShown=!1,this.length=0,this.moving=!1,this.played=!1,this.playing=!1,this.pointers={},this.ready=!1,this.rotating=!1,this.scaling=!1,this.showing=!1,this.timeout=!1,this.tooltipping=!1,this.viewed=!1,this.viewing=!1,this.wheeling=!1,this.zooming=!1,this.pointerMoved=!1,this.id=at(),this.init()}return o(e,[{key:"init",value:function(){var e=this,t=this.element,n=this.options;if(!t[v]){t[v]=this,n.focus&&!n.keyboard&&(n.focus=!1);var i="img"===t.localName,a=[];if(Ee(i?[t]:t.querySelectorAll("img"),(function(t){_e(n.filter)?n.filter.call(e,t)&&a.push(t):e.getImageURL(t)&&a.push(t)})),this.isImg=i,this.length=a.length,this.images=a,this.initBody(),ye(document.createElement(v).style.transition)&&(n.transition=!1),n.inline){var o=0,l=function(){var t;(o+=1,o===e.length)&&(e.initializing=!1,e.delaying={abort:function(){clearTimeout(t)}},t=setTimeout((function(){e.delaying=!1,e.build()}),0))};this.initializing={abort:function(){Ee(a,(function(e){e.complete||(Ke(e,z,l),Ke(e,B,l))}))}},Ee(a,(function(e){var t,n;e.complete?l():(ze(e,z,t=function(){Ke(e,B,n),l()},{once:!0}),ze(e,B,n=function(){Ke(e,z,t),l()},{once:!0}))}))}else ze(t,N,this.onStart=function(t){var i=t.target;"img"!==i.localName||_e(n.filter)&&!n.filter.call(e,i)||e.view(e.images.indexOf(i))})}}},{key:"build",value:function(){if(!this.ready){var e=this.element,t=this.options,n=e.parentNode,i=document.createElement("div");i.innerHTML=d;var a=i.querySelector(".".concat(v,"-container")),o=a.querySelector(".".concat(v,"-title")),l=a.querySelector(".".concat(v,"-toolbar")),s=a.querySelector(".".concat(v,"-navbar")),r=a.querySelector(".".concat(v,"-button")),c=a.querySelector(".".concat(v,"-canvas"));if(this.parent=n,this.viewer=a,this.title=o,this.toolbar=l,this.navbar=s,this.button=r,this.canvas=c,this.footer=a.querySelector(".".concat(v,"-footer")),this.tooltipBox=a.querySelector(".".concat(v,"-tooltip")),this.player=a.querySelector(".".concat(v,"-player")),this.list=a.querySelector(".".concat(v,"-list")),a.id="".concat(v).concat(this.id),o.id="".concat(v,"Title").concat(this.id),Se(o,t.title?Ue(Array.isArray(t.title)?t.title[0]:t.title):_),Se(s,t.navbar?Ue(t.navbar):_),qe(r,_,!t.button),t.keyboard&&r.setAttribute("tabindex",0),t.backdrop&&(Se(a,"".concat(v,"-backdrop")),t.inline||"static"===t.backdrop||We(c,ve,"hide")),ke(t.className)&&t.className&&t.className.split(ge).forEach((function(e){Se(a,e)})),t.toolbar){var u=document.createElement("ul"),h=Ie(t.toolbar),p=fe.slice(0,3),m=fe.slice(7,9),g=fe.slice(9);h||Se(l,Ue(t.toolbar)),Ee(h?t.toolbar:fe,(function(e,n){var i=h&&Ie(e),a=h?Ne(n):e,o=i&&!ye(e.show)?e.show:e;if(o&&(t.zoomable||-1===p.indexOf(a))&&(t.rotatable||-1===m.indexOf(a))&&(t.scalable||-1===g.indexOf(a))){var l=i&&!ye(e.size)?e.size:e,s=i&&!ye(e.click)?e.click:e,r=document.createElement("li");t.keyboard&&r.setAttribute("tabindex",0),r.setAttribute("role","button"),Se(r,"".concat(v,"-").concat(a)),_e(s)||We(r,ve,a),be(o)&&Se(r,Ue(o)),-1!==["small","large"].indexOf(l)?Se(r,"".concat(v,"-").concat(l)):"play"===a&&Se(r,"".concat(v,"-large")),_e(s)&&ze(r,N,s),u.appendChild(r)}})),l.appendChild(u)}else Se(l,_);if(!t.rotatable){var f=l.querySelectorAll('li[class*="rotate"]');Se(f,F),Ee(f,(function(e){l.appendChild(e)}))}if(t.inline)Se(r,C),Le(a,{zIndex:t.zIndexInline}),"static"===window.getComputedStyle(n).position&&Le(n,{position:"relative"}),n.insertBefore(a,e.nextSibling);else{Se(r,b),Se(a,x),Se(a,y),Se(a,_),Le(a,{zIndex:t.zIndex});var k=t.container;ke(k)&&(k=e.ownerDocument.querySelector(k)),k||(k=this.body),k.appendChild(a)}t.inline&&(this.render(),this.bind(),this.isShown=!0),this.ready=!0,_e(t.ready)&&ze(e,J,t.ready,{once:!0}),!1!==Be(e,J)?this.ready&&t.inline&&this.view(this.index):this.ready=!1}}}],[{key:"noConflict",value:function(){return window.Viewer=it,e}},{key:"setDefaults",value:function(e){Re(c,Ie(e)&&e)}}]),e}();return Re(ot.prototype,Je,Ze,et,tt,nt),ot}))},93478:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Xa}});n(14898),n(63307),n(43854),n(34817);var i=n(28694),a=n(83487),o=n(38118),l=n(97913),s=n(98836),r=n(74913),c=n(32228),d=n(19477),u=n(74560),h=n(87591),p=n(47531),m=n(35153),v=n.n(m),g=n(18232),f=n(12567),k=n(69989),w=n(97053),b=n(49284),y=n(57668),x=n(29890),C=n(18684),I=n(17299);const _={class:"list-chat"},E={key:0,class:"list-chat-nodata"},R=["src"],A=["onClick"],L={key:0,class:"list-chat-item-online"},F={class:"list-chat-item-onlineT"},T={class:"list-chat-item-onlineD"},S={key:1,class:"list-chat-item-title"},X={class:"list-chat-item-onlineT"},q={class:"list-chat-item-onlineD"},D={key:2,class:"list-chat-item-op"};var N=(0,i.pM)({__name:"KnowledgeList",props:{filter:{}},emits:["closeDocu","loadData","stopLLM"],setup(e,{emit:t}){const{t:n}=(0,c.s9)(),s=(0,r.Pj)(),h=e,p=t,m=(0,i.EW)((()=>"/")),v=(0,i.EW)((()=>{const e=s.state.pk_knowledge.history;if(h.filter){const t=e.filter((e=>e.title.includes(h.filter)));return t.filter((e=>e.uuid))}return e.filter((e=>e.uuid))})),g=(0,i.EW)((()=>s.state.pk_knowledge.active)),N=async({uuid:e})=>{V(e)||(g.value&&s.commit("pk_knowledge/updateHistory",{uuid:g.value,type:"update",isEdit:!1}),p("loadData",{uuid:e}))},O=async({uuid:e,title:t},i,a)=>{if(a?.stopPropagation(),e){await(0,x.aQ)({id:e,name:t});s.commit("pk_knowledge/updateHistory",{uuid:e,type:"update",title:t,isEdit:i})}else{const e=await(0,x.xU)({name:t,scope:2}),n=e.data.id;s.commit("pk_knowledge/updateHistory",{uuid:n,type:"add",title:t,isEdit:i,createdAt:e.data.createTime}),s.commit("pk_knowledge/saveActive",{uuid:n})}u.nk.success(n("page.qa.main.submitSuccess"))},W=({uuid:e},t,n)=>{e&&s.commit("pk_knowledge/updateHistory",{uuid:e,type:"update",isEdit:t})},j=async({uuid:e},t)=>{t?.stopPropagation(),d.s.confirm(n("page.qa.main.deleteHintDetail"),n("page.qa.main.deleteHint"),{confirmButtonText:n("page.qa.main.confirmButton"),cancelButtonText:n("page.qa.main.cancelButton"),type:n("page.qa.main.deleteType")}).then((async()=>{await(0,x.O8)({ids:""+e,scope:2}),p("stopLLM",{uuid:e}),s.commit("pk_knowledge/deleteHistory",{uuid:e}),p("closeDocu"),u.nk.success(n("page.qa.main.deleteSuccess"))})).catch((()=>{}))},K=(0,y.s)(j,600);let z=!1,B=!1;const P=async(e,t,n)=>{z?z=!1:B||(B=!0,await O(e,t,n),B=!1)},M=async({uuid:e},t,n)=>{z=!0,e&&s.commit("pk_knowledge/updateHistory",{uuid:e,type:"update",isEdit:t})},V=e=>e===g.value;return(0,i.sV)((()=>{(0,I.eo)(),(0,I.Ru)()})),(0,i.hi)((()=>{(0,I.zg)()})),(e,t)=>((0,i.uX)(),(0,i.Wv)((0,o.R1)(k.kA),null,{default:(0,i.k6)((()=>[(0,i.Lk)("div",_,[0===v.value.length?((0,i.uX)(),(0,i.CE)("div",E,[(0,i.Lk)("img",{src:m.value+"images/nodata.svg",width:"176px",height:"115px"},null,8,R),(0,i.eW)(" "+(0,a.v_)((0,o.R1)(n)("page.knowledge.list.nodata")),1)])):((0,i.uX)(!0),(0,i.CE)(i.FK,{key:1},(0,i.pI)(v.value,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t},[(0,i.Lk)("a",{class:(0,a.C4)(["list-chat-item",V(e.uuid)&&"active"]),onClick:t=>N(e)},[e.isEdit?((0,i.uX)(),(0,i.CE)("div",S,[(0,i.Lk)("div",X,[(0,i.bF)((0,o.R1)(w.WK),{class:"input",modelValue:e.title,"onUpdate:modelValue":t=>e.title=t,onBlur:t=>P(e,!1,t),onKeydown:[(0,l.jR)((t=>P(e,!1,t)),["enter"]),(0,l.jR)((t=>M(e,!1)),["esc"])],placeholder:(0,o.R1)(n)("page.knowledge.list.inputPlaceholder")},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeydown","placeholder"])]),(0,i.Lk)("div",q,(0,a.v_)(e.createdAt),1)])):((0,i.uX)(),(0,i.CE)("div",L,[(0,i.Lk)("div",F,[(0,i.bF)(C.A,{content:e.title.substring(0,99),placement:"bottom-start","show-arrow":!1},null,8,["content"])]),(0,i.Lk)("div",T,(0,a.v_)(e.createdAt),1)])),V(e.uuid)&&e.uuid?((0,i.uX)(),(0,i.CE)("div",D,[e.isEdit?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.bF)((0,o.R1)(b.S2),{class:"list-chat-item-opU",onClick:t=>W(e,!0,t)},{default:(0,i.k6)((()=>[(0,i.bF)((0,o.R1)(f.A),{type:"pk-edit",class:"wh20"})])),_:2},1032,["onClick"]),(0,i.bF)((0,o.R1)(b.S2),{class:"list-chat-item-opD",onClick:t=>(0,o.R1)(K)(e,t)},{default:(0,i.k6)((()=>[(0,i.bF)((0,o.R1)(f.A),{type:"pk-delete",class:"wh20"})])),_:2},1032,["onClick"])],64))])):(0,i.Q3)("",!0)],10,A)])))),128))])])),_:1}))}}),O=n(83940);const W=(0,O.A)(N,[["__scopeId","data-v-7724b011"]]);var j=W,K=n(82167),z="object"==typeof global&&global&&global.Object===Object&&global;const B=z;var P="object"==typeof self&&self&&self.Object===Object&&self,M=B||P||Function("return this")();const V=M;var H=V.Symbol;const Y=H;var U=Object.prototype,Q=U.hasOwnProperty,$=U.toString,G=Y?Y.toStringTag:void 0;function J(e){var t=Q.call(e,G),n=e[G];try{e[G]=void 0;var i=!0}catch{}var a=$.call(e);return i&&(t?e[G]=n:delete e[G]),a}var Z=Object.prototype,ee=Z.toString;function te(e){return ee.call(e)}var ne="[object Null]",ie="[object Undefined]",ae=Y?Y.toStringTag:void 0;function oe(e){return null==e?void 0===e?ie:ne:ae&&ae in Object(e)?J(e):te(e)}function le(e){return null!=e&&"object"==typeof e}var se=Array.isArray;const re=se;function ce(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}parseInt;function de(e){return e}var ue="[object AsyncFunction]",he="[object Function]",pe="[object GeneratorFunction]",me="[object Proxy]";function ve(e){if(!ce(e))return!1;var t=oe(e);return t==he||t==pe||t==ue||t==me}var ge=V["__core-js_shared__"];const fe=ge;var ke=function(){var e=/[^.]+$/.exec(fe&&fe.keys&&fe.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function we(e){return!!ke&&ke in e}var be=Function.prototype,ye=be.toString;function xe(e){if(null!=e){try{return ye.call(e)}catch{}try{return e+""}catch{}}return""}var Ce=/[\\^$.*+?()[\]{}|]/g,Ie=/^\[object .+?Constructor\]$/,_e=Function.prototype,Ee=Object.prototype,Re=_e.toString,Ae=Ee.hasOwnProperty,Le=RegExp("^"+Re.call(Ae).replace(Ce,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Fe(e){if(!ce(e)||we(e))return!1;var t=ve(e)?Le:Ie;return t.test(xe(e))}function Te(e,t){return null==e?void 0:e[t]}function Se(e,t){var n=Te(e,t);return Fe(n)?n:void 0}function Xe(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var qe=800,De=16,Ne=Date.now;function Oe(e){var t=0,n=0;return function(){var i=Ne(),a=De-(i-n);if(n=i,a>0){if(++t>=qe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function We(e){return function(){return e}}var je=function(){try{var e=Se(Object,"defineProperty");return e({},"",{}),e}catch{}}();const Ke=je;var ze=Ke?function(e,t){return Ke(e,"toString",{configurable:!0,enumerable:!1,value:We(t),writable:!0})}:de;const Be=ze;var Pe=Oe(Be);const Me=Pe;var Ve=9007199254740991,He=/^(?:0|[1-9]\d*)$/;function Ye(e,t){var n=typeof e;return t=null==t?Ve:t,!!t&&("number"==n||"symbol"!=n&&He.test(e))&&e>-1&&e%1==0&&e<t}function Ue(e,t,n){"__proto__"==t&&Ke?Ke(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Qe(e,t){return e===t||e!==e&&t!==t}var $e=Object.prototype,Ge=$e.hasOwnProperty;function Je(e,t,n){var i=e[t];(!Ge.call(e,t)||!Qe(i,n)||void 0===n&&!(t in e))&&Ue(e,t,n)}function Ze(e,t,n,i){var a=!n;n||(n={});for(var o=-1,l=t.length;++o<l;){var s=t[o],r=i?i(n[s],e[s],s,n,e):void 0;void 0===r&&(r=e[s]),a?Ue(n,s,r):Je(n,s,r)}return n}var et=Math.max;function tt(e,t,n){return t=et(void 0===t?e.length-1:t,0),function(){for(var i=arguments,a=-1,o=et(i.length-t,0),l=Array(o);++a<o;)l[a]=i[t+a];a=-1;for(var s=Array(t+1);++a<t;)s[a]=i[a];return s[t]=n(l),Xe(e,this,s)}}function nt(e,t){return Me(tt(e,t,de),e+"")}var it=9007199254740991;function at(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=it}function ot(e){return null!=e&&at(e.length)&&!ve(e)}function lt(e,t,n){if(!ce(n))return!1;var i=typeof t;return!!("number"==i?ot(n)&&Ye(t,n.length):"string"==i&&t in n)&&Qe(n[t],e)}function st(e){return nt((function(t,n){var i=-1,a=n.length,o=a>1?n[a-1]:void 0,l=a>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(a--,o):void 0,l&&lt(n[0],n[1],l)&&(o=a<3?void 0:o,a=1),t=Object(t);++i<a;){var s=n[i];s&&e(t,s,i,o)}return t}))}var rt=Object.prototype;function ct(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||rt;return e===n}function dt(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}var ut="[object Arguments]";function ht(e){return le(e)&&oe(e)==ut}var pt=Object.prototype,mt=pt.hasOwnProperty,vt=pt.propertyIsEnumerable,gt=ht(function(){return arguments}())?ht:function(e){return le(e)&&mt.call(e,"callee")&&!vt.call(e,"callee")};const ft=gt;function kt(){return!1}var wt="object"==typeof exports&&exports&&!exports.nodeType&&exports,bt=wt&&"object"==typeof module&&module&&!module.nodeType&&module,yt=bt&&bt.exports===wt,xt=yt?V.Buffer:void 0,Ct=xt?xt.isBuffer:void 0,It=Ct||kt;const _t=It;var Et="[object Arguments]",Rt="[object Array]",At="[object Boolean]",Lt="[object Date]",Ft="[object Error]",Tt="[object Function]",St="[object Map]",Xt="[object Number]",qt="[object Object]",Dt="[object RegExp]",Nt="[object Set]",Ot="[object String]",Wt="[object WeakMap]",jt="[object ArrayBuffer]",Kt="[object DataView]",zt="[object Float32Array]",Bt="[object Float64Array]",Pt="[object Int8Array]",Mt="[object Int16Array]",Vt="[object Int32Array]",Ht="[object Uint8Array]",Yt="[object Uint8ClampedArray]",Ut="[object Uint16Array]",Qt="[object Uint32Array]",$t={};function Gt(e){return le(e)&&at(e.length)&&!!$t[oe(e)]}function Jt(e){return function(t){return e(t)}}$t[zt]=$t[Bt]=$t[Pt]=$t[Mt]=$t[Vt]=$t[Ht]=$t[Yt]=$t[Ut]=$t[Qt]=!0,$t[Et]=$t[Rt]=$t[jt]=$t[At]=$t[Kt]=$t[Lt]=$t[Ft]=$t[Tt]=$t[St]=$t[Xt]=$t[qt]=$t[Dt]=$t[Nt]=$t[Ot]=$t[Wt]=!1;var Zt="object"==typeof exports&&exports&&!exports.nodeType&&exports,en=Zt&&"object"==typeof module&&module&&!module.nodeType&&module,tn=en&&en.exports===Zt,nn=tn&&B.process,an=function(){try{var e=en&&en.require&&en.require("util").types;return e||nn&&nn.binding&&nn.binding("util")}catch{}}();const on=an;var ln=on&&on.isTypedArray,sn=ln?Jt(ln):Gt;const rn=sn;var cn=Object.prototype,dn=cn.hasOwnProperty;function un(e,t){var n=re(e),i=!n&&ft(e),a=!n&&!i&&_t(e),o=!n&&!i&&!a&&rn(e),l=n||i||a||o,s=l?dt(e.length,String):[],r=s.length;for(var c in e)(t||dn.call(e,c))&&(!l||!("length"==c||a&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ye(c,r)))&&s.push(c);return s}function hn(e,t){return function(n){return e(t(n))}}var pn=hn(Object.keys,Object);const mn=pn;var vn=Object.prototype,gn=vn.hasOwnProperty;function fn(e){if(!ct(e))return mn(e);var t=[];for(var n in Object(e))gn.call(e,n)&&"constructor"!=n&&t.push(n);return t}function kn(e){return ot(e)?un(e):fn(e)}var wn=Object.prototype,bn=wn.hasOwnProperty;st((function(e,t){if(ct(t)||ot(t))Ze(t,kn(t),e);else for(var n in t)bn.call(t,n)&&Je(e,n,t[n])}));function yn(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}var xn=Object.prototype,Cn=xn.hasOwnProperty;function In(e){if(!ce(e))return yn(e);var t=ct(e),n=[];for(var i in e)"constructor"==i&&(t||!Cn.call(e,i))||n.push(i);return n}function _n(e){return ot(e)?un(e,!0):In(e)}Math.max,Math.min;var En=Object.prototype,Rn=En.hasOwnProperty;nt((function(e,t){e=Object(e);var n=-1,i=t.length,a=i>2?t[2]:void 0;for(a&&lt(t[0],t[1],a)&&(i=1);++n<i;)for(var o=t[n],l=_n(o),s=-1,r=l.length;++s<r;){var c=l[s],d=e[c];(void 0===d||Qe(d,En[c])&&!Rn.call(e,c))&&(e[c]=o[c])}return e}));const An=(0,i.pM)({name:"Viewer",props:{images:{type:Array,default:()=>[]},rebuild:{type:Boolean,default:!1},trigger:{type:Object,default:null},options:{type:Object,default:()=>null}},emits:["inited"],setup(e,{emit:t}){let n;const a=(0,o.KR)();function l(){n=new K(a.value,e.options),t("inited",n)}function s(){n&&n.destroy()}function r(){s(),l()}function c(){n?(n.update(),t("inited",n)):l()}function d(){e.rebuild?r():c()}const u={deep:!0};return(0,i.wB)((()=>e.images),(()=>{(0,i.dY)((()=>{d()}))}),u),(0,i.wB)((()=>e.trigger),(()=>{(0,i.dY)((()=>{d()}))}),u),(0,i.wB)((()=>e.options),(()=>{(0,i.dY)((()=>{r()}))}),u),(0,i.sV)((()=>l())),(0,i.hi)((()=>s())),{root:a,createViewer:l,rebuildViewer:r,updateViewer:c,destroyViewer:s}}}),Ln=(e,t)=>{const n=e.__vccOpts||e;for(const[i,a]of t)n[i]=a;return n},Fn={ref:"root"};function Tn(e,t,n,a,o,l){return(0,i.uX)(),(0,i.CE)("div",Fn,[(0,i.RG)(e.$slots,"default",{images:e.images,options:e.options})],512)}const Sn=Ln(An,[["render",Tn]]);var Xn=n(13722),qn=n(52379);const Dn={key:0,class:"chat-message-divider"},Nn={class:"chat-message-header"},On=["src"],Wn={class:"chat-message-body"},jn={key:0,class:"this-knowledge this-qaknowledge"},Kn={key:0,class:"this-doc"},zn={key:1,class:"this-knowledge"},Bn={key:2,class:"images"},Pn=["src"],Mn={key:3,class:"this-docs"},Vn={key:0,class:"doc-knowledge"},Hn=["onClick"],Yn={key:2,class:"q-text"},Un={key:1,class:"q-text"},Qn={key:0,class:"chat-message-knowledge"},$n={key:0,class:"chat-message-footer"},Gn={class:"chat-message-footer-right"},Jn={class:"chat-message-footer-rightr"},Zn=["onClick"],ei={class:"dialog-footer"},ti="The document has been unpublished or deleted";var ni=(0,i.pM)({__name:"KnowledgeMessage",props:{id:{},createdAt:{},text:{},owner:{},error:{type:Boolean},loading:{type:Boolean},like:{type:Boolean},unlike:{type:Boolean},feedback:{type:Boolean},usedQA:{type:Boolean},topk:{},docId:{},docName:{},knowledgeId:{},knowledgeName:{},items:{},knowledges:{},know:{},knowList:{},status:{},continueNumber:{},preConversationId:{}},emits:["handleChun","knowledgeThis","regenerate","delete","like","unlike","feedback","continue"],setup(e,{emit:t}){const{t:n}=(0,c.s9)(),l=(0,r.Pj)(),s=e,d=t,h=(0,o.KR)("me"===s.owner),m=(0,o.KR)(null),v=(0,o.KR)(!1),g=(0,o.KR)(n("page.qa.message.feedback")),k=(0,o.KR)(n("page.qa.message.feedbackList").split(",")),w=(0,o.KR)(null),y=(0,o.Kh)({value:""}),I=(0,o.KR)(-1),_=(0,o.KR)(-1),E=(0,i.EW)((()=>l.state.global.canFeedback)),R={knowledgeId:"",knowledgeName:"uncertain",disabled:!1},A=(0,o.Kh)({value:[{required:!0,message:n("page.qa.message.feedbackPlaceholder"),trigger:"blur"}]}),L=(0,i.EW)((()=>{let e=[];const t=T.value.map((e=>X.value[e-1]||null));for(let n=0;n<t.length;n++){if(!t[n])continue;const i=t[n].text?.match(/(!\[.*?\]\(.*\))/g);if(i){const a=[...new Set(i)],o=parseInt(t[n].doc_id,10)||0,l=t[n].doc_id;if(o){const t=a.map((e=>"/api/v1/profile/upload/docs/"+o+"/"+l+"/"+e.replaceAll(/!|\[.*?\]|\(|\)/g,"")));e.push(...t)}if(e.length>=4)break}}return e.slice(0,4)})),F=(0,i.EW)((()=>{const e=s.text?.match(/(\[)ref_\d+(\])/g);if(e)return[...new Set(e)];const t=s.text?.match(/chunk id \d+/g);return t?[...new Set(t)]:[]})),T=(0,i.EW)((()=>{const e=F.value.map((e=>Number(e.replaceAll(/[^0-9]/gi,""))));return!s.usedQA||e.length?e:[1]})),S=(0,i.EW)((()=>s.usedQA&&X.value.length>0?X.value[0]:{})),X=(0,i.EW)((()=>{try{if(s.topk)return Object.values(JSON.parse(s.topk))}catch(e){console.error(e)}return[]})),q=((0,i.EW)((()=>{try{if(s.items)return JSON.parse(s.items)}catch(e){console.error(e)}return[]})),(0,i.EW)((()=>{if(0===X.value.length)return[];const e=T.value.map((e=>X.value[e-1]||null)),t={};let n=1;for(let i=0;i<T.value.length;i++){if(!e[i])continue;e[i].doc_id=e[i].doc_id||e[i].id?.split("_")[0];const a=e[i].doc_id,o=e[i].knowledge_base,l=!!e[i].text;t[a]?(t[a].knowledge_base=t[a].knowledge_base.includes(o)?t[a].knowledge_base:t[a].knowledge_base+"/"+o,t[a].ref=t[a].ref+T.value[i]+"|",t[a].chunks.push({index:n,chunk_id:e[i].chunk_id,text:e[i].text}),t[a].enable=l):(t[a]={...e[i],chunks:[{index:n,chunk_id:e[i].chunk_id,text:e[i].text}],ref:T.value[i]+"|"},t[a].knowledge_base=o||"",t[a].enable=l),n++}return Object.values(t)}))),D=(0,i.EW)((()=>{let e=s.text?.replace(/<br\/>|<br>/g,"\n")||"";e=e.replaceAll("\\boxed","");for(let t=0;t<q.value.length;t++){const n=q.value[t].chunks,i=q.value[t].ref.split("|"),a=(q.value[t].knowledge_base||"")+": "+(q.value[t].doc_name||"");for(let o=0;o<n.length;o++){const l=n[o].index,s=q.value[t].enable;e=s?e.replaceAll(`[ref_${i[o]}]`,`<span class="el-index" data-title="${a}" data-id="${t}" data-index-id="${o}">[ ${l} ]</span>`):e.replaceAll(`[ref_${i[o]}]`,`<span class="ql-text">[ ${l} ]</span>`)}}return 2===s.status?e+=`<span class="stop">${n("page.qa.main.stopText")}</span>`:5===s.status&&Number(s.continueNumber||0)<3?e+=`<a class="limit">${n("page.qa.main.limitText")}</a>`:6===s.status&&(e=n("page.qa.message.error")),e.replace(/\[ref_\d+\]/g,"")||n("page.qa.answer.error")})),N=(0,i.EW)((()=>{let e=s.text?.replace(/<br\/>|<br>/g,"\n");return e.replace(/\[ref_\d+\]/g,"")||n("page.qa.answer.error")})),O=(0,i.EW)((()=>s.like)),W=(0,i.EW)((()=>s.unlike)),j=(0,i.EW)((()=>s.feedback)),K=(0,i.EW)((()=>!1)),z=(0,i.EW)((()=>{if(s?.knowledgeName&&s?.knowledgeName.length>0){const e=s.knowledgeName.split(",").filter((e=>e));return e}return[]})),B=(0,i.EW)((()=>{if(s?.knowledges&&s.knowledges.length>0){let t=[];try{t=JSON.parse(s.knowledges)}catch(e){console.error(e)}if(t.length>0)return t.map((e=>""===e.knowledge_id?R:{knowledgeId:e.knowledge_id,knowledgeName:e.knowledge_name,disabled:!s.knowList?.find((t=>t.knowledgeId===e.knowledge_id))})).filter((e=>""!==e.knowledgeId))}return q.value.length>0||P.value||z.value.length?[]:[R]})),P=(0,i.EW)((()=>s.docName)),M=async(e,t)=>{if(e.doc_id)try{if(s.knowledgeId){const t=Y(e);if(!t)return void u.nk.error("This document is not available in the knowledge base.");const n=await(0,x.fb)({id:t});if(n&&200===~~n.code){const t=n.data?.knowledgeDocuments;let i=!1;if(t&&t.length>0&&t.forEach((t=>{t.documentId===e.doc_id&&(i=!0)})),!i)return void u.nk.error("This document is not available in the knowledge base.")}}const t=await(0,x.P)(e.doc_id);t&&200!==~~t.code?u.nk.error(ti):t&&t.data&&l.commit("pk_knowledge/changeUrlState",{docId:e.doc_id,docName:e.doc_name,knowledgeId:Y(e),openPreview:!0,url:t.data.sourceFile,sourceFile:t.data.sourceFile,chunkFile:t.data.chunkFile})}catch(n){console.log(n)}I.value=~~t},V=async(e,t)=>{const n=q.value[e],i=n.chunks[t];if(n.doc_id){if(s.knowledgeId){const e=Y(n);if(!e)return void u.nk.error("This document is not available in the knowledge base.");const t=await(0,x.fb)({id:e});if(t&&200===~~t.code){const e=t.data?.knowledgeDocuments;let i=!1;if(e&&e.length>0&&e.forEach((e=>{e.documentId===n.doc_id&&(i=!0)})),!i)return void u.nk.error("This document is not available in the knowledge base.")}}const e=await(0,x.P)(n.doc_id);e&&200!==~~e.code?u.nk.error(ti):e&&e.data&&(l.commit("pk_knowledge/changeUrlState",{docId:n.doc_id,docName:n.doc_name,chunkId:i.chunk_id,knowledgeId:Y(n),openPreview:!0,url:e.data.sourceFile,sourceFile:e.data.sourceFile,chunkFile:e.data.chunkFile}),n.chunk_id=i.chunk_id,n.text=i.text,d("handleChun",n))}I.value=~~e,_.value=~~t},H=async()=>{d("continue")},Y=e=>{const t=s.knowledgeName?.split(","),n=s.knowledgeId?.split(","),i=e.knowledge_base.split("/")[0],a=t?.findIndex((e=>e===i));if(void 0!==a&&-1!==a)return n&&n[a]},U=async()=>{s.id&&!s.like&&(await(0,x.HL)({id:s.id,score:1}),d("like",s.id),u.nk.success(n("page.qa.main.likeSuccess")))},Q=async()=>{s.id&&!s.unlike&&(await(0,x.Sn)({id:s.id,score:2}),d("unlike",s.id),u.nk.success(n("page.qa.main.globalSuccess")))},$=async()=>{s.id&&!s.feedback&&(v.value=!0),y.value=""},G=async()=>{try{const e=w.value?.validate();if(!e)return;await(0,x.H9)({id:s.id,comment:y.value}),d("feedback",s.id||0,y.value),u.nk.success(n("page.qa.main.submitSuccess")),v.value=!1}catch(e){v.value=!1,console.log(e)}},J=e=>{y.value=e},Z=e=>{switch(e){case"clipboard":ne();break;case"delete":d("delete");break;case"asText":h.value=!h.value;break}},ee=e=>{console.log(e),d("knowledgeThis",e,s.id)},te=()=>{m.value?.scrollIntoView(),d("regenerate")},ne=async()=>{try{await(0,qn.L)(N.value||""),u.nk.success(n("page.qa.main.copySuccess"))}catch(e){u.nk.error(n("page.qa.main.copyError"))}};return(0,i.sV)((async()=>{})),(0,i.wB)((()=>s.docId),(async()=>{})),(e,t)=>{const l=(0,i.g2)("el-divider"),r=(0,i.g2)("el-tag"),c=(0,i.g2)("el-form-item"),d=(0,i.g2)("el-input"),u=(0,i.g2)("el-dialog");return(0,i.uX)(),(0,i.CE)(i.FK,null,["me"===s.owner&&-1===e.preConversationId?((0,i.uX)(),(0,i.CE)("div",Dn,[(0,i.bF)(l,{"content-position":"center"},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)((0,o.R1)(n)("page.qa.main.divider")),1)])),_:1})])):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:(0,a.C4)(["chat-message","me"===e.owner?"reverse":""])},[(0,i.Lk)("div",Nn,[(0,i.Lk)("img",{src:"me"===s.owner?"/images/GroupQ.png":"/images/GroupA.png",width:"40",height:"40"},null,8,On)]),(0,i.Lk)("div",Wn,[(0,i.Lk)("div",{class:(0,a.C4)(["chat-message-body-text","me"!==e.owner?"chat-message-body-pytext":""])},[0===z.value.length&&S.value.knowledge_base&&s.usedQA?((0,i.uX)(),(0,i.CE)("div",jn,[(0,i.bF)(r,{type:"primary"},{default:(0,i.k6)((()=>[(0,i.bF)((0,o.R1)(f.A),{type:"pk-knowQA",class:"qa-icon"}),(0,i.eW)((0,a.v_)(S.value.knowledge_base),1)])),_:1})])):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[P.value&&e.docId&&"me"!==e.owner?((0,i.uX)(),(0,i.CE)("div",Kn,[(0,i.bF)(r,{type:"primary"},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(e.docName),1)])),_:1})])):z.value.length&&e.id&&"me"!==e.owner?((0,i.uX)(),(0,i.CE)("div",zn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(z.value,(e=>((0,i.uX)(),(0,i.Wv)(r,{type:"primary",key:e},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(e),1)])),_:2},1024)))),128))])):(0,i.Q3)("",!0)],64)),(0,i.bF)(Xn.A,{ref:"textRef",owner:e.owner,error:e.error,text:D.value,loading:e.loading,"as-raw-text":h.value,UUID:e.id,activeIndex:I.value,activeId:_.value,onHandleChunk:V,onHandleLimit:H},null,8,["owner","error","text","loading","as-raw-text","UUID","activeIndex","activeId"]),"me"!==e.owner&&L.value.length?((0,i.uX)(),(0,i.CE)("div",Bn,[(0,i.bF)((0,o.R1)(Sn),{images:L.value},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(L.value,(e=>((0,i.uX)(),(0,i.CE)("img",{key:e,src:e},null,8,Pn)))),128))])),_:1},8,["images"])])):(0,i.Q3)("",!0),(B.value&&0===B.value.length||P.value)&&q.value.length>0?((0,i.uX)(),(0,i.CE)("div",Mn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(q.value,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{class:"docs-list",key:t},[!P.value||P.value&&s.usedQA?((0,i.uX)(),(0,i.CE)("div",{key:0,class:(0,a.C4)(["doc-refer",{active:I.value===t}])},[e.knowledge_base?((0,i.uX)(),(0,i.CE)("div",Vn,(0,a.v_)(e.knowledge_base),1)):(0,i.Q3)("",!0),e.enable?((0,i.uX)(),(0,i.CE)("a",{key:1,href:"javascript:;",onClick:n=>M(e,t),class:"name"},[(0,i.bF)((0,o.R1)(C.A),{content:e.doc_name,placement:"top-start"},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(e.doc_name),1)])),_:2},1032,["content"])],8,Hn)):((0,i.uX)(),(0,i.CE)("span",Yn,[(0,i.bF)((0,o.R1)(C.A),{content:e.doc_name,placement:"top-start"},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(e.doc_name),1)])),_:2},1032,["content"])]))],2)):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(e.chunks,((n,o)=>((0,i.uX)(),(0,i.CE)(i.FK,{key:n.chunk_id},[e.enable?((0,i.uX)(),(0,i.Wv)(r,{key:0,class:(0,a.C4)(["chunk-index",{active:_.value===o&&I.value===t}]),type:"primary",onClick:e=>V(t,o)},{default:(0,i.k6)((()=>[(0,i.eW)("[ "+(0,a.v_)(n.index)+" ]",1)])),_:2},1032,["class","onClick"])):((0,i.uX)(),(0,i.CE)("span",Un,"[ "+(0,a.v_)(n.index)+" ]",1))],64)))),128))])))),128))])):(0,i.Q3)("",!0),s.usedQA?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)(i.FK,{key:4},[z.value.length||"me"===e.owner?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",Qn,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(B.value,((t,n)=>((0,i.uX)(),(0,i.CE)("div",{class:"knowledge-list",key:n},[""!==t.knowledgeId?((0,i.uX)(),(0,i.Wv)((0,o.R1)(b.S2),{key:0,type:t.knowledgeId===e.know?.id?"primary":"default",disabled:t.disabled,onClick:e=>ee(t)},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(t.knowledgeName),1)])),_:2},1032,["type","disabled","onClick"])):(0,i.Q3)("",!0)])))),128))]))],64))],2),e.id?((0,i.uX)(),(0,i.CE)("div",$n,["me"===s.owner||""===B.value[0]?.knowledgeId||"All"===e.knowledgeId?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[],64)):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[E.value?((0,i.uX)(),(0,i.Wv)((0,o.R1)(b.S2),{key:0,type:"text",onClick:U},{default:(0,i.k6)((()=>[O.value?((0,i.uX)(),(0,i.Wv)((0,o.R1)(f.A),{key:1,type:"pk-liked",class:"wh18 hover"})):((0,i.uX)(),(0,i.Wv)((0,o.R1)(f.A),{key:0,type:"pk-like",class:"wh18 hover"}))])),_:1})):(0,i.Q3)("",!0),E.value?((0,i.uX)(),(0,i.Wv)((0,o.R1)(b.S2),{key:1,type:"text",onClick:Q},{default:(0,i.k6)((()=>[W.value?((0,i.uX)(),(0,i.Wv)((0,o.R1)(f.A),{key:1,type:"pk-unliked",class:"wh18 hover"})):((0,i.uX)(),(0,i.Wv)((0,o.R1)(f.A),{key:0,type:"pk-unlike",class:"wh18 hover"}))])),_:1})):(0,i.Q3)("",!0),E.value&&!j.value?((0,i.uX)(),(0,i.Wv)((0,o.R1)(b.S2),{key:2,type:"text",onClick:$},{default:(0,i.k6)((()=>[(0,i.bF)((0,o.R1)(f.A),{type:"pk-feedback",class:"wh18 hover"})])),_:1})):(0,i.Q3)("",!0),(0,i.bF)((0,o.R1)(b.S2),{type:"text",onClick:t[0]||(t[0]=e=>Z("clipboard"))},{default:(0,i.k6)((()=>[K.value?((0,i.uX)(),(0,i.Wv)((0,o.R1)(f.A),{key:1,type:"pk-copied",class:"wh18 hover"})):((0,i.uX)(),(0,i.Wv)((0,o.R1)(f.A),{key:0,type:"pk-copy",class:"wh18 hover"}))])),_:1}),(0,i.Lk)("div",Gn,[(0,i.Lk)("div",Jn,[(0,i.bF)((0,o.R1)(b.S2),{type:"text",onClick:te},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)((0,o.R1)(n)("page.qa.message.regenerate")),1)])),_:1})])])],64))])):(0,i.Q3)("",!0)]),(0,i.bF)(u,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=e=>v.value=e),title:g.value,width:"25rem"},{footer:(0,i.k6)((()=>[(0,i.Lk)("div",ei,[(0,i.bF)((0,o.R1)(b.S2),{onClick:t[2]||(t[2]=e=>v.value=!1)},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)((0,o.R1)(n)("page.qa.main.cancelButton")),1)])),_:1}),(0,i.bF)((0,o.R1)(b.S2),{type:"primary",onClick:G},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)((0,o.R1)(n)("page.qa.main.submitButton")),1)])),_:1})])])),default:(0,i.k6)((()=>[(0,i.bF)((0,o.R1)(p.US),{model:y,rules:A,ref_key:"feedbackRef",ref:w},{default:(0,i.k6)((()=>[(0,i.bF)(c,null,{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(k.value,(e=>((0,i.uX)(),(0,i.CE)("span",{class:"span",key:e,onClick:t=>J(e)},(0,a.v_)(e),9,Zn)))),128))])),_:1}),(0,i.bF)(c,{label:"",props:"value"},{default:(0,i.k6)((()=>[(0,i.bF)(d,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value=e),type:"textarea",autosize:{minRows:4,maxRows:4}},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])],2)],64)}}});const ii=(0,O.A)(ni,[["__scopeId","data-v-503cfe52"]]);var ai=ii,oi=n(50239),li=n(52582),si=n(70579),ri=n(76412),ci=n(51832),di=n(85158),ui=n(81329),hi=n(26497),pi=n(49302);const mi=e=>((0,i.Qi)("data-v-9463d72a"),e=e(),(0,i.jt)(),e),vi={class:"main"},gi={class:"left-chat"},fi={class:"qa"},ki={class:"qa-header"},wi={class:"qa-header-title"},bi={class:"qa-main"},yi={class:"qa-main-create"},xi={class:"qa-main-list"},Ci={key:0,class:"main-chat-preview"},Ii={class:"know-docs-header-title"},_i={class:"know-docs-header-button"},Ei={class:"know-docs-header-close"},Ri={id:"scrollRef",ref:"scrollRef",class:"main-chat"},Ai={class:"main-chat-no-knowledge"},Li={class:"main-chat-no-knowledgeLeft"},Fi={class:"main-chat-no-knowledgeRight",style:{gap:"16px"}},Ti={key:0,class:"main-chat-content"},Si={class:"main-chat-no-knowledge"},Xi=mi((()=>(0,i.Lk)("div",{class:"main-chat-no-knowledgeLeft"},[(0,i.Lk)("img",{src:"/images/GroupA.png",width:"40",height:"40"})],-1))),qi={class:"main-chat-no-knowledgeRight"},Di={class:"main-chat-no-knowledgeTitle"},Ni=["innerHTML"],Oi={class:"main-chat-no-knowledgeHint"},Wi={class:"main-chat-no-knowledgeButton"},ji=mi((()=>(0,i.Lk)("img",{src:"/images/pk-noknowledge.png",width:"36",height:"36",class:"icon-svg"},null,-1))),Ki={key:1,class:"main-chat-content"},zi={class:"main-chat-grow"},Bi={key:0,class:"main-chat-home-knowledge"},Pi=mi((()=>(0,i.Lk)("div",{class:"main-chat-home-knowledgeLeft"},[(0,i.Lk)("img",{src:"/images/GroupA.png",width:"40",height:"40"})],-1))),Mi={class:"main-chat-home-knowledgeRight"},Vi={class:"main-chat-home-knowledgeTitle"},Hi=["innerHTML"],Yi={class:"main-chat-home-knowledgeHint"},Ui={class:"main-chat-home-knowledgeButton"},Qi=["onClick"],$i={class:"flex"},Gi=mi((()=>(0,i.Lk)("img",{src:"/images/pk-knowledgeen.png",width:"20",height:"20"},null,-1))),Ji=mi((()=>(0,i.Lk)("div",{class:"split"},null,-1))),Zi={key:0,class:"main-chat-home-knowledgeUncertain"},ea=mi((()=>(0,i.Lk)("img",{src:"/images/pk-knowledgeno.png",width:"20",height:"20"},null,-1))),ta={key:1,id:"chatMessage",class:"main-chat-message"},na={key:0},ia={class:"main-chat-footer mt-24"},aa={class:"main-chat-footer-op"},oa={class:"main-chat-footer-opNormal"},la={class:"normal-datah1"},sa=["onClick"],ra={class:"normal-data-item-operation"},ca=["onClick"],da=["onClick"],ua={class:"normal-data-item addplus"},ha={class:"main-chat-footer-operation"},pa={class:"el-dropdown-link"},ma={class:"main-chat-footer-operation shrink-rudius"},va={class:"main-chat-footer-operation knowledge"},ga={key:0,class:"docu"},fa={class:"docu-name"},ka={key:1,class:"know"},wa={class:"paddle"},ba={class:"card"},ya={class:"title"},xa={class:"know-list"},Ca={class:"flex"},Ia={class:"main-chat-footer-input"},_a={class:"main-chat-footer-button"},Ea={class:"dialog-footer"},Ra={class:"chunk-content"},Aa="pk_knowledge",La=2,Fa=5;var Ta=(0,i.pM)({__name:"index",setup(e){const{addChat:t,updateChat:n,updateChatSome:m,getChatByUuidAndIndex:k}=(0,si.Y)(Aa),{scrollbarRef:w,scrollToBottom:b,scrollToBottomIfAtBottom:y}=(0,ri.A)(),{getLocaleOutputLang:_}=(0,ci.A)();let E=new AbortController,R="",A=0;const L={conversationType:1,knowledgeId:void 0,docId:void 0,preConversationId:null,regenerate:{isRegenerate:!1},knowledgeScope:{basicAbility:1,privateDatabase:1},config:{maxTokens:2048,temperature:.3,topP:.95,stopSequence:"",repetitionPenalty:0,frequencyPenalty:0}},F=(0,s.rd)(),{currentRoute:T}=F,S=(0,r.Pj)(),{locale:X,t:q}=(0,c.s9)();S.commit("global/setMenuEnable",!0);const D=(0,i.EW)((()=>S.state.user.currentUser.roleId<=2)),N=(0,o.KR)({title:q("page.knowledge.main.noKnowledgeTitle"),subtitle:q("page.knowledge.main.noKnowledgeDetail"),hint:q("page.knowledge.main.noKnowledgeHint")}),O=(0,i.EW)((()=>S.state.global.openUncertain)),W=(0,o.KR)(4e3),K=(0,o.KR)(!0),z=((0,o.KR)(!1),(0,o.KR)("")),B=((0,o.KR)(!1),(0,o.KR)([])),P=(0,o.KR)(!1),M=(0,o.Kh)({id:0,content:"",scope:La}),V=(0,o.KR)(),H=(0,o.KR)(!1),Y=(0,o.KR)(!1),U=(0,o.KR)(14),Q=(0,o.KR)(0),$=(0,o.KR)(""),G=((0,o.KR)(!1),(0,i.EW)((()=>S.state.pk_knowledge.urlState.openPreview))),J=((0,i.EW)((()=>S.state.pk_knowledge.pdfState.pdfUrl)),(0,i.EW)((()=>S.state.pk_knowledge.urlState.url||""))),Z=(0,o.KR)(""),ee=(0,o.KR)(""),te=((0,o.KR)(""),(0,o.KR)("")),ne=(0,o.KR)(!1),ie=(0,o.KR)(!1),ae=(0,o.KR)(null),oe=(0,o.Kh)({}),le={knowledgeId:"",knowledgeName:"Uncertain"},se=(0,o.Kh)({id:"",name:le.knowledgeName}),re=(0,o.KR)([]),ce=(0,i.EW)((()=>S.state.global.multipleOption)),de=(0,o.KR)([]),ue=(0,o.KR)(le),he=(0,o.KR)(!1),pe=(0,o.KR)("default"),me=(0,o.KR)(_()),ve=(0,o.KR)(""),ge=(0,o.KR)(null),fe=(0,o.KR)("prompt"),ke=(0,i.EW)((()=>"prompting"===fe.value||!ve.value||0===ve.value.length||Ge(ve.value)>W.value)),we=(0,i.EW)((()=>{const e=S.state.pk_knowledge.active;return e})),be=(0,i.EW)((()=>S.state.pk_knowledge.history)),ye=(0,i.EW)((()=>{const e=S.state.pk_knowledge.history.find((e=>e.uuid===we.value));return e?e.chats:S.state.pk_knowledge.chats})),xe=(0,i.EW)((()=>S.state.pk_knowledge.urlState)),Ce=((0,i.EW)((()=>`/preview/pdfjs/web/viewer.html?file=${encodeURIComponent($.value)}&pagemode=none`)),(0,o.Kh)({content:[{required:!0,message:q("page.qa.normalData.placeholder"),trigger:"blur"}]})),Ie=e=>{e.stopPropagation();const t=e.key;t&&"Enter"===t&&console.log("enter")},_e=async()=>{await at(),S.commit("pk_knowledge/addHistory",{uuid:null,title:"New Chat",isEdit:!1,createdAt:(0,ui.pr)(new Date)}),S.commit("pk_knowledge/saveActive",{uuid:null}),S.commit("pk_knowledge/saveHistory",{uuid:null}),ft(),Q.value=-1},Ee=async()=>{try{const e=await(V.value?.validate());if(!e)return;M.id?await(0,x.v8)(M):(M.id=0,await(0,x.p1)(M)),await yt()}catch(e){console.log(e)}finally{P.value=!1}},Re=e=>{ve.value=e.content||"",ae.value&&ae.value.hide(),Ze()},Ae=async e=>{M.id=e.id,M.content=e.content||"",P.value=!0},Le=async e=>{d.s.confirm(q("page.qa.main.deleteHintDetail"),q("page.qa.main.deleteHint"),{confirmButtonText:q("page.qa.main.confirmButton"),cancelButtonText:q("page.qa.main.cancelButton"),type:q("page.qa.main.deleteType")}).then((async()=>{await(0,x.Tf)(e),await yt()})).catch((()=>{}))},Fe=()=>{M.id=0,M.content="",P.value=!0},Te=e=>{const t=e.event.target,{responseText:n}=t,i=n.trimEnd().split("\n");let a={},o="",l=!1;try{const e=i.length;if(e<=2&&null===we.value){try{const e=JSON.parse(i[0]);e.scope&&We(e)}catch(s){console.error(s)}return}if(e>0){o="";for(let t=0;t<e;t++){const e=i[t];if(a=JSON.parse(e),a.stopId)R=a.stopId;else{if("conversationId"in a){A=a.conversationId,l=!1;break}a.answer&&(o+=a.answer),"sensitive"===a.finish_reason&&(o+=q("page.qa.message.error"))}}o&&(m(we.value,ye.value.length-1,{createdAt:(0,ui.pr)(new Date),text:o,owner:"llm",error:!1,loading:l}),Se=o),y()}}catch(r){console.log(r)}};let Se="",Xe=0;const qe=e=>{const t=e.event.target,{responseText:n}=t,i=n.trimEnd().split("\n");let a={},o=Se,l=!1;try{const e=i.length;if(e>0){for(let t=0;t<e;t++){const e=i[t];if(a=JSON.parse(e),a.stopId)R=a.stopId;else{if("conversationId"in a){A=a.conversationId,l=!1;break}a.answer&&(o+=a.answer),"sensitive"===a.finish_reason&&(o+=q("page.qa.message.error"))}}o&&m(we.value,Xe,{text:o,owner:"llm",error:!1,loading:l})}}catch(s){console.log(s)}},De=async e=>{const t=ye.value.findIndex((t=>t.id===e));-1!==t&&m(we.value,t,{like:!0,unlike:!1})},Ne=async e=>{const t=ye.value.findIndex((t=>t.id===e));-1!==t&&m(we.value,t,{like:!1,unlike:!0})},Oe=async(e,t)=>{const n=ye.value.findIndex((t=>t.id===e));-1!==n&&m(we.value,n,{feedback:t})},We=e=>{S.commit("pk_knowledge/updateHistory",{type:"updateId",uuid:we.value,id:e.id,name:e.name}),S.commit("pk_knowledge/saveActive",{uuid:e.id}),Ke=e.id},je=(e,t,n)=>{const i=JSON.parse(e.pop()),{id:a,docId:o,docName:l,knowledgeId:s,knowledgeName:r,items:c,knowledges:d,conversationId:u,usedQA:h,topk:p,chatStatus:v,continueNumber:g}=i;if(Ke!==we.value)return;S.commit("pk_knowledge/saveHistory",{uuid:we.value});const f=u;Q.value=u,m(we.value,n,{id:a,prompt:t,conversation:f,usedQA:h,docId:o,docName:l,knowledgeId:s,knowledgeName:r,items:c,knowledges:d,topk:p,status:v,continueNumber:g,loading:!1})};let Ke=null;const ze=async(e,t,n,i)=>{Ke=we.value;const a={knowledgeId:e.knowledgeId};e.docId?(a.conversationType=1,a.docId=e.docId,a.knowledgeId=(0,hi.QV)(e.knowledgeId)):a.conversationType=e?.knowledgeId?.length>10?2:3,Se=e.text,Xe=n;const o=await(0,x.C$)({...L,...a,sessionId:we.value,lang:pe.value||"zh-cn",query:t,...i,prompt:""},E.signal,qe);if(o&&"string"===typeof o){const t=o.trimEnd().split("\n");je(t,e.prompt,Xe),ge.value?.focus()}},Be=async(e,t,n,i)=>{Ke=we.value;const a={knowledgeId:se.id};oe.id?(a.conversationType=1,a.docId=oe.id,a.knowledgeId=(0,hi.QV)(oe.knowledgeId)):""===se.id?a.conversationType=3:a.conversationType=2;const o=await(0,x.C$)({...L,...a,sessionId:we.value,lang:pe.value||"zh-cn",query:t,...i,prompt:""},E.signal,Te);if(o&&"string"===typeof o){const e=o.trimEnd().split("\n");if(null===we.value&&e.length>0){const t=JSON.parse(e[0]);t.scope&&We(t)}const n=i.prompt||t;return je(e,n,ye.value.length-1),we.value&&(0,x.aQ)({id:we.value}),y(),void setTimeout((()=>{b(),ge.value?.focus()}),400)}m(we.value,n,{loading:!1})},Pe=async(e=!1,i=null)=>{let a=ve.value;e&&(a=i?.prompt??"",a=a||i?.options?.prompt);if(!a||0===a.length)return;if("prompting"===fe.value)return;let o={preConversationId:null},l=i||ye.value[ye.value.length-1];l&&(o.preConversationId=-1===Q.value||l.knowledgeId===se.id&&Q.value>=0?Q.value:null),t(we.value,{id:0,createdAt:(0,ui.pr)(new Date),text:a,owner:"me",error:!1,conversation:null,conversationId:0,preConversationId:Q.value,options:{prompt:a,options:null}}),b(),fe.value="prompting",ve.value="";t(we.value,{id:0,createdAt:(0,ui.pr)(new Date),text:q("page.qa.main.llm.hint"),loading:!0,owner:"llm",error:!1,conversation:null,conversationId:0,preConversationId:Q.value,options:{prompt:a,options:o}}),Q.value=0,b(),o.onContinue=!1,E=new AbortController,e&&(o={...o,regenerate:{isRegenerate:!0}});try{Se="",A=0,await Be(Se,a,ye.value.length-1,o)}catch(s){const e=s?.message;if("canceled"===e)return m(we.value,ye.value.length-1,{loading:!1}),void y();const t=k(we.value,ye.value.length-1);if(t?.text&&t.text.length>0)return void m(we.value,ye.value.length-1,{text:t.text+"\n\n"+e,error:!0,loading:!1});n(we.value,ye.value.length-1,{createdAt:(0,ui.pr)(new Date),text:e,owner:"llm",error:!0,loading:!1,conversation:null,options:{prompt:a,options:o}}),y()}finally{fe.value="prompt"}},Me=async e=>{if("prompting"===fe.value)return;const t=ye.value[e],i=t?.prompt??"",a=!0;if(a)return void Pe(!0,t);let o={};t.options&&(o={...t.options}),fe.value="prompting",n(we.value,e,{createdAt:(0,ui.pr)(new Date),text:"",owner:"llm",error:!1,loading:!0,conversation:null,options:{prompt:i,options:o}});try{Se="",await Be(Se,i,e,o)}catch(l){if("canceled"===l.message)return void m(we.value,e,{loading:!1});const t=l?.message??q("page.qa.error");n(we.value,e,{createdAt:(0,ui.pr)(new Date),text:t,owner:"llm",error:!0,loading:!1,conversation:null,options:{prompt:i,options:o}})}finally{fe.value="prompt"}},Ve=async e=>{if("prompting"===fe.value)return;const t=ye.value[e];let i=t?.prompt??"";if(i=i||t?.options?.prompt,!i||0===i.length)return;let a=[];a.preConversationId=t.preConversationId,fe.value="prompting",ve.value="",n(we.value,e,{text:t.text,error:!1,loading:!0,options:{prompt:i,options:t.options}}),E=new AbortController,a.onContinue=!0,a.id=t.id;try{await ze(t,i,e,a)}catch(o){n(we.value,e,{loading:!1})}finally{fe.value="prompt"}},He=()=>{D.value?F.push({path:"/organize/knowledge"}):u.nk.warning("Please contact the administrator to create the  knowledge base")},Ye=()=>{Ze(),Pe()},Ue=()=>{(0,I.OV)()},Qe=()=>{(0,I.Zr)()},$e=e=>{S.commit("pk_knowledge/deleteChat",e)},Ge=e=>{const t=/[\u4e00-\u9fff\u0e00-\u0e7f\u1000-\u109f\u1780-\u17ff\u1e00-\u1eff\u3040-\u30ff\uac00-\ud7af]|[a-zA-Z]+|\d+|[^\s\w]/g,n=e.match(t);return n?n.length:0},Je=()=>{const e=Ge(ve.value);e>W.value&&u.nk.error(q("page.qa.main.footer.inputplaceholder",{limit:W.value})),Ze()},Ze=()=>{setTimeout((()=>tt()))},et=e=>{if(e.shiftKey&&"Enter"===e.key){e.preventDefault();const t=e.target,n=t.selectionStart,i=t.selectionEnd;ve.value=ve.value.substring(0,n)+"\n"+ve.value.substring(i),setTimeout((()=>{t.selectionStart=t.selectionEnd=n+1,tt()}))}},tt=()=>{(0,I.cY)(60),(0,I.bj)(60)},nt=()=>{Ye()},it=async e=>{const{uuid:t}=e;"prompting"===fe.value&&(fe.value="prompt",await(0,x.iO)({sessionId:t,stopId:R}),setTimeout(Ct,100))},at=async()=>{"prompting"===fe.value&&(fe.value="prompt",await(0,x.iO)({sessionId:we.value,stopId:R}),setTimeout(Ct,100),ge.value?.focus())},ot=async()=>{const e=be.value?.map((e=>e.uuid));e&&0===e.length?u.nk.error(q("page.qa.main.operation.notEmpty")):d.s.confirm(q("page.qa.main.operation.clearHintDetail"),q("page.qa.main.operation.clearHint"),{confirmButtonText:q("page.qa.main.confirmButton"),cancelButtonText:q("page.qa.main.cancelButton"),type:"warning"}).then((async()=>{await it({uuid:we.value}),await(0,x.O8)({ids:e.join(","),scope:2}),Q.value=-1,S.commit("pk_knowledge/clearAll"),u.nk.success(q("page.qa.main.operation.successMessageLogs")),await(0,i.dY)(),(0,I.cY)()})).catch((()=>{}))},lt=async()=>{null!==we.value?d.s.confirm(q("page.qa.main.operation.deleteLogs"),q("page.qa.main.operation.hint"),{confirmButtonText:q("page.qa.main.confirmButton"),cancelButtonText:q("page.qa.main.cancelButton"),type:q("page.qa.main.deleteType")}).then((async()=>{await(0,x.b5)({id:we.value}),Q.value=-1,S.commit("pk_knowledge/clearChatByUuid",{uuid:we.value}),u.nk.success(q("page.qa.main.operation.successMessageLogs")),await(0,i.dY)(),(0,I.cY)(60)})).catch((()=>{})):u.nk.error(q("page.qa.main.operation.notEmpty"))},st=async e=>{if(U.value=e,"number"===typeof e){document.documentElement.style.getPropertyValue("--text-preview");document.documentElement.style.setProperty("--text-preview",e+"px"),u.nk.success(q("page.qa.main.operation.successMessageFont"))}},rt=async()=>{ie.value||d.s.confirm(q("page.knowledge.download.hintDetail"),q("page.knowledge.download.hint"),{confirmButtonText:q("page.qa.main.confirmButton"),cancelButtonText:q("page.qa.main.cancelButton"),type:q("page.qa.main.deleteType")}).then((async()=>{try{ie.value=!0;const e=document.getElementById("chatMessage"),t=await v()(e,{useCORS:!0,scrollX:0,scrollY:0,width:716,height:1e3}),n=t.toDataURL("image/png"),i=document.createElement("a");i.style.display="none",i.href=n,i.setAttribute("download","chat.png"),"undefined"===typeof i.download&&i.setAttribute("target","_blank"),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(i.href),ie.value=!1,u.nk.success(q("page.qa.main.exportSuccess"))}catch(e){ie.value=!1,u.nk.error(q("page.qa.main.exportError"))}})).catch((()=>{ie.value=!1}))},ct=()=>{},dt=()=>{Q.value=-1,b()},ut=()=>{he.value=!he.value},ht=e=>{if(ce.value){if(e.knowledgeId===le.knowledgeId)re.value=[],se.id=e.knowledgeId,se.name=e.knowledgeName;else{const t=re.value.find((t=>t.id===e.knowledgeId));if(t)re.value=re.value.filter((t=>t.id!==e.knowledgeId));else{if(re.value.length>=Fa)return void u.nk.warning(q("page.knowledge.multiple.knowLimit",{count:Fa}));re.value.push({id:e.knowledgeId,name:e.knowledgeName})}se.id=re.value.map((e=>e.id)).join(","),se.name=re.value.map((e=>e.name)).join("、")}S.commit("pk_knowledge/storeSelectKnowledges",re.value)}else se.id=e.knowledgeId,se.name=e.knowledgeName,he.value=!1,S.commit("pk_knowledge/storeSelectKnowledges",[{id:e.knowledgeId,name:e.knowledgeName,enable:!0}])},pt=(0,i.EW)((()=>ce.value?0===re.value.length?O.value?[{id:le.knowledgeId,name:le.knowledgeName}]:[]:re.value:[{...se}])),mt=e=>{if(ce.value){if(e.knowledgeId===le.knowledgeId)return 0===re.value.length;{const t=re.value.find((t=>t.id===e.knowledgeId));return!!t}}return se.id===e.knowledgeId},vt=(e,t)=>{ce.value&&(re.value=[{id:e.knowledgeId,name:e.knowledgeName}]),se.id=e.knowledgeId,se.name=e.knowledgeName,S.commit("pk_knowledge/storeSelectKnowledges",[{id:e.knowledgeId,name:e.knowledgeName,enable:!0}]);const n=ye.value.find((e=>e.id===t));n&&Pe(!0,n)},gt=async e=>{Z.value=e.doc_id,te.value=e.text,ee.value=e.text,ne.value=!0},ft=()=>{oe.id="",oe.name="",S.commit("pk_knowledge/changeUrlState",{openPreview:!1,url:"",docId:""})},kt=()=>{oe.id=S.state.pk_knowledge.urlState.docId,oe.name=S.state.pk_knowledge.urlState.docName,oe.knowledgeId=S.state.pk_knowledge.urlState.knowledgeId},wt=()=>{oe.id=0,oe.name="",oe.knowledgeId=""},bt=async()=>{const e=await(0,x.rL)({scope:2});if(e&&e.data&&e.data.length>0){const t=e.data.map((e=>({uuid:e.id,docId:e.docId,docName:e.docName,title:e.name,isEdit:!1,createdAt:e.updateTime,chats:[]})));S.commit("pk_knowledge/loadHistory",t)}},yt=async()=>{const e=await(0,x.WK)({scope:La});e&&e.data&&e.data.length>=0&&(B.value=e.data)},xt=async e=>{H.value=!1,K.value=!0,await at(),S.commit("pk_knowledge/saveActive",e),H.value=!1,await Ct("add"),K.value=!1,Ft(),Lt(),S.commit("pk_knowledge/changeUrlState",{openPreview:!1,url:"",docId:""}),wt(),await(0,i.dY)(),(0,I.cY)(60),b(),ge.value?.focus()},Ct=async(e="add")=>{if(null===we.value)return;if(Y.value)return;Y.value=!0;const t="update"===e&&ye.value.length>0?ye.value[0].createdAt:"",n=await(0,x.O7)({sessionId:we.value,page:5,createTime:t});if(n&&n.data.length>0){const t=[];for(const e of n.data){const n=e.knowledges;t.push({createdAt:e.createTime,id:0,text:e.query,owner:"me",error:!1,loading:!1,like:1===e.score,unlike:2===e.score,feedback:e.comment,prompt:"",usedQA:e.usedQA,preConversationId:e.preConversationId}),t.push({createdAt:e.createTime,id:e.id,text:e.answer,owner:"llm",error:!1,loading:!1,like:1===e.score,unlike:2===e.score,feedback:e.comment,prompt:e.query,conversation:e.conversationId,preConversationId:e.preConversationId,usedQA:e.usedQA,topk:e.topk,docId:e.docId,docName:e.docName,knowledgeId:e.knowledgeId,knowledgeName:e.knowledgeName,items:e.items,knowledges:n,status:e.chatStatus,continueNumber:e.continueNumber})}"update"===e?S.commit("pk_knowledge/updateChatsByUuid",{uuid:we.value,data:t}):(S.commit("pk_knowledge/addChatsByUuid",{uuid:we.value,data:t}),Q.value=n.data.length>0?n.data[n.data.length-1].conversationId:0)}n&&n.data.length<5&&(H.value=!0),Y.value=!1,b()},It=async e=>{const t=await(0,pi.Ju)({scope:4,language:e});t&&t.data&&t.data.length>0?(N.value=t.data[0],N.value.hint=N.value.hint||q("page.knowledge.main.noKnowledgeHint")):N.value={title:q("page.knowledge.main.noKnowledgeTitle"),subtitle:q("page.knowledge.main.noKnowledgeDetail"),hint:q("page.knowledge.main.noKnowledgeHint")}},_t=async()=>{const e=F.currentRoute.value.query,t=await(0,x.YG)();t&&t.data&&t.data.map((t=>{if(de.value.push({knowledgeId:t.knowledgeId,knowledgeName:t.knowledgeName,enable:t.documentCount>0}),S.commit("pk_knowledge/saveKnowledge",de.value),!se.id&&!O.value&&t.documentCount>0&&(se.id=t.knowledgeId,se.name=t.knowledgeName,se.enable=t.documentCount>0,ce.value&&(re.value=[],re.value.push({id:t.knowledgeId,name:t.knowledgeName,enable:t.documentCount>0})),S.commit("pk_knowledge/storeSelectKnowledgs",re.value)),e&&e.knowledgeId===t.knowledgeId)se.id=t.knowledgeId,se.name=t.knowledgeName,se.enable=t.documentCount>0,ce.value&&(re.value=[],re.value.push({id:t.knowledgeId,name:t.knowledgeName,enable:t.documentCount>0}));else if(S.state.pk_knowledge.activeKnowledges.length>0){const e=S.state.pk_knowledge.activeKnowledges.filter((e=>de.value.find((t=>t.knowledgeId===e.id))&&de.value.find((t=>t.knowledgeId===e.id)).enable)).map((e=>(e.name=de.value.find((t=>t.knowledgeId===e.id))?.knowledgeName,e)));e.length>0&&(se.id=e[0].id,se.name=e[0].name,ce.value&&(re.value=e,se.id=e.map((e=>e.id)).join(","),se.name=e.map((e=>e.name)).join(",")))}})),console.error(se)},Et=async()=>{const e=await(0,x.G6)();e&&e.data&&e.data.length>0&&(me.value=e.data.map((e=>({label:e.dictLabel,value:e.dictValue}))))},Rt=e=>{const t=e.target.scrollTop||e.target.scrollingElement.scrollTop||e.target.documentElement.scrollTop;t<=40&&!H.value&&(Ct("update"),window.document.removeEventListener("scroll",Rt))},At=async e=>{const t=e.target.scrollTop;e.target.scrollHeight,e.target.clientHeight;t<20&&t<20&&!H.value&&await Ct("update")},Lt=()=>{window.document.addEventListener("scroll",Rt),setTimeout((()=>w.value?.wrapRef.addEventListener("scroll",At)),1e3)},Ft=()=>{window.document.addEventListener("scroll",Rt),w.value?.wrapRef.addEventListener("scroll",At)},{defaultLang:Tt}=(0,di.W4)(It);(0,i.sV)((async()=>{await bt(),await yt(),we.value&&await Ct("add"),await It(Tt.value),await _t(),await Et(),K.value=!1,Lt(),b(),(0,I.cY)(60),(0,I.bj)(60),ge.value?.focus();const e=document.createElement("script");e.src="/preview/editormd/lib/marked.min.js",document.body.appendChild(e);const t=document.createElement("script");t.src="/preview/editormd/lib/prettify.min.js",document.body.appendChild(t);const n=document.createElement("script");n.src="/preview/editormd/lib/flowchart.min.js",document.body.appendChild(n)})),(0,i.hi)((()=>{(0,I.fO)(60),Ft(),"prompting"===fe.value&&E.abort(),ft()})),(0,i.wB)((()=>S.state.pk_knowledge.pdfState.openPreview),(async(e,t)=>{e&&console.log(e)}));return(0,i.wB)((()=>J.value),(async(e,t)=>{G.value&&(0,I.cY)(60)})),(e,t)=>{const n=(0,i.g2)("el-input"),s=(0,i.g2)("el-button"),r=(0,i.g2)("el-skeleton-item"),c=(0,i.g2)("el-skeleton"),d=(0,i.g2)("el-divider"),u=(0,i.g2)("ElScrollbar"),m=(0,i.g2)("el-dropdown-item"),v=(0,i.g2)("el-dropdown-menu"),k=(0,i.g2)("el-dropdown"),b=((0,i.g2)("el-option"),(0,i.g2)("el-select"),(0,i.g2)("el-tag")),y=(0,i.g2)("el-form-item"),x=(0,i.g2)("el-dialog"),I=(0,i.g2)("el-scrollbar");return(0,i.uX)(),(0,i.CE)("div",vi,[(0,i.Lk)("div",gi,[(0,i.Lk)("div",fi,[(0,i.Lk)("div",ki,[(0,i.Lk)("h1",wi,(0,a.v_)((0,o.R1)(q)("page.knowledge.header.title")),1),(0,i.bF)(n,{modelValue:z.value,"onUpdate:modelValue":t[0]||(t[0]=e=>z.value=e),class:"qa-header-input",placeholder:(0,o.R1)(q)("page.knowledge.header.input"),onKeydown:(0,l.jR)(Ie,["enter"]),"suffix-icon":(0,o.R1)(g.vji)},null,8,["modelValue","placeholder","suffix-icon"])])]),(0,i.Lk)("div",bi,[(0,i.Lk)("div",yi,[(0,i.bF)(s,{type:"primary",class:"qa-main-create-button",onClick:_e},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)((0,o.R1)(q)("page.knowledge.main.create")),1)])),_:1})]),(0,i.Lk)("div",xi,[(0,i.bF)(j,{filter:z.value,onCloseDocu:ft,onLoadData:xt,onStopLLM:it},null,8,["filter"])]),(0,i.Lk)("div",{class:"qa-main-clear",onClick:ot},[(0,i.bF)((0,o.R1)(f.A),{type:"pk-delete"})])])]),G.value?((0,i.uX)(),(0,i.CE)("div",Ci,[(0,i.Lk)("div",{class:(0,a.C4)(["know-docs-header",oe.id?"ing":""])},[(0,i.Lk)("div",Ii,(0,a.v_)(xe.value?.docName),1),(0,i.Lk)("div",_i,[oe.id?((0,i.uX)(),(0,i.Wv)(s,{key:1,type:"primary",onClick:wt},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)((0,o.R1)(q)("page.knowledge.pdfViewerExitButton")),1)])),_:1})):((0,i.uX)(),(0,i.Wv)(s,{key:0,type:"primary",onClick:kt},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)((0,o.R1)(q)("page.knowledge.pdfViewerQAButton")),1)])),_:1}))]),(0,i.Lk)("div",Ei,[(0,i.bF)(s,{type:"primary",text:"",title:(0,o.R1)(q)("page.knowledge.pdfViewerCloseButton"),onClick:ft},{icon:(0,i.k6)((()=>[(0,i.bF)((0,o.R1)(f.A),{type:"pk-knowclose",class:"wh20"})])),_:1},8,["title"])])],2),(0,i.bF)(li.A,{uuid:we.value,history:be.value,sourceUrl:J.value},null,8,["uuid","history","sourceUrl"])])):(0,i.Q3)("",!0),(0,i.Lk)("div",Ri,[K.value?((0,i.uX)(),(0,i.Wv)(c,{key:0,class:"main-chat-content",animated:""},{template:(0,i.k6)((()=>[(0,i.Lk)("div",Ai,[(0,i.Lk)("div",Li,[(0,i.bF)(r,{variant:"image",style:{width:"72px",height:"72px"}})]),(0,i.Lk)("div",Fi,[(0,i.bF)(r,{variant:"text"}),(0,i.bF)(r,{variant:"text"}),(0,i.bF)(r,{variant:"text"}),(0,i.bF)(r,{variant:"text"})])])])),_:1})):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[!de.value||0===de.value.length&&0===ye.value.length?((0,i.uX)(),(0,i.CE)("div",Ti,[(0,i.Lk)("div",Si,[Xi,(0,i.Lk)("div",qi,[(0,i.Lk)("div",Di,(0,a.v_)(N.value.title),1),(0,i.Lk)("div",{class:"main-chat-no-knowledgeDetail",innerHTML:N.value.subtitle},null,8,Ni),(0,i.Lk)("div",Oi,(0,a.v_)(N.value.hint),1),(0,i.Lk)("div",Wi,[ji,(0,i.Lk)("a",{class:"font",onClick:He},[(0,i.Lk)("p",null,(0,a.v_)((0,o.R1)(q)("page.knowledge.main.noKnowledgeHintDetail")),1)])])])])])):((0,i.uX)(),(0,i.CE)("div",Ki,[(0,i.Lk)("div",zi,[0===ye.value.length?((0,i.uX)(),(0,i.CE)("div",Bi,[Pi,(0,i.Lk)("div",Mi,[(0,i.Lk)("div",Vi,(0,a.v_)(N.value.title),1),(0,i.Lk)("div",{class:"main-chat-home-knowledgeDetail",innerHTML:N.value.subtitle},null,8,Hi),(0,i.Lk)("div",Yi,(0,a.v_)((0,o.R1)(q)("page.knowledge.main.knowledgeSelect")),1),(0,i.Lk)("div",Ui,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(de.value,(e=>((0,i.uX)(),(0,i.CE)("div",{class:(0,a.C4)(["knowledge-list",{active:mt(e),enable:e.enable}]),key:e,onClick:t=>!!e.enable&&ht(e)},[(0,i.Lk)("div",$i,[Gi,(0,i.Lk)("span",null,[(0,i.bF)(C.A,{content:e.enable?e.knowledgeName:(0,o.R1)(q)("page.knowledge.nodocs.hint"),placement:"top-start","show-arrow":!1},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(e.knowledgeName),1)])),_:2},1032,["content"])])])],10,Qi)))),128))]),Ji,O.value?((0,i.uX)(),(0,i.CE)("div",Zi,(0,a.v_)((0,o.R1)(q)("page.knowledge.main.noknowledge")),1)):(0,i.Q3)("",!0),O.value?((0,i.uX)(),(0,i.CE)("div",{key:1,class:(0,a.C4)(["main-chat-home-knowledgeUncertainButton",{active:mt(le)}]),onClick:t[1]||(t[1]=e=>ht(le))},[ea,(0,i.Lk)("span",null,[(0,i.bF)(C.A,{content:le.knowledgeName,placement:"top-start","show-arrow":!1},null,8,["content"])])],2)):(0,i.Q3)("",!0)])])):((0,i.uX)(),(0,i.CE)("div",ta,[(0,i.bF)(u,{ref_key:"scrollbarRef",ref:w},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ye.value,((e,t)=>((0,i.uX)(),(0,i.Wv)(ai,{key:t,text:e.text,"created-at":e.createdAt,id:e.id,like:e.like,unlike:e.unlike,feedback:e.feedback,prompt:e.prompt,docId:e.docId,docName:e.docName,topk:e.topk,items:e.items,knowledgeId:e.knowledgeId,knowledgeName:e.knowledgeName,knowledges:e.knowledges,know:se,usedQA:e.usedQA,knowList:de.value,owner:e.owner,error:e.error,status:e.status,"pre-conversation-id":0===t?void 0:e.preConversationId,"continue-number":e.continueNumber,loading:e.loading,onHandleChun:gt,onKnowledgeThis:vt,onRegenerate:e=>Me(t),onDelete:e=>$e(t),onLike:De,onUnlike:Ne,onFeedback:Oe,onContinue:e=>Ve(t)},null,8,["text","created-at","id","like","unlike","feedback","prompt","docId","docName","topk","items","knowledgeId","knowledgeName","knowledges","know","usedQA","knowList","owner","error","status","pre-conversation-id","continue-number","loading","onRegenerate","onDelete","onContinue"])))),128)),ye.value.length>0&&-1===Q.value?((0,i.uX)(),(0,i.CE)("div",na,[(0,i.bF)(d,{"content-position":"center"},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)((0,o.R1)(q)("page.qa.main.divider")),1)])),_:1})])):(0,i.Q3)("",!0)])),_:1},512)]))]),(0,i.Lk)("div",ia,[(0,i.Lk)("div",aa,[(0,i.Lk)("div",oa,[(0,i.bF)((0,o.R1)(h.Vc),{placement:"top",width:790,trigger:"hover",ref_key:"popRef",ref:ae,modelValue:e.popnor,"onUpdate:modelValue":t[2]||(t[2]=t=>e.popnor=t)},{reference:(0,i.k6)((()=>[(0,i.bF)((0,o.R1)(f.A),{type:"pk-normaldata",class:"w20 h20"})])),default:(0,i.k6)((()=>[(0,i.Lk)("h1",la,(0,a.v_)((0,o.R1)(q)("page.qa.main.footer.normalData")),1),(0,i.bF)(u,{class:"normal-data"},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(B.value,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{class:"normal-data-item",key:"normal"+t},[(0,i.Lk)("div",{class:"normal-data-item-title",onClick:t=>Re(e)},[(0,i.bF)(C.A,{content:e.content,placement:"top-start","show-arrow":!1},null,8,["content"])],8,sa),(0,i.Lk)("div",ra,[(0,i.Lk)("div",{class:"normal-data-operation-edit",onClick:t=>Ae(e)},[(0,i.bF)((0,o.R1)(f.A),{type:"pk-editnormal",class:"w20 h20"})],8,ca),(0,i.Lk)("div",{class:"normal-data-operation-delete",onClick:t=>Le(e)},[(0,i.bF)((0,o.R1)(f.A),{type:"pk-deletenormal",class:"w20 h20"})],8,da)])])))),128))])),_:1}),(0,i.Lk)("div",ua,[(0,i.Lk)("a",{class:"normal-data-item-add",onClick:Fe},[(0,i.bF)((0,o.R1)(f.A),{type:"pk-addplus"}),(0,i.Lk)("span",null,(0,a.v_)((0,o.R1)(q)("page.qa.main.footer.createNormalData")),1)])])])),_:1},8,["modelValue"])]),(0,i.Lk)("div",{class:"main-chat-footer-operation",onClick:lt},[(0,i.bF)((0,o.R1)(f.A),{type:"pk-deletelogs",class:"iconsvg wh20"})]),(0,i.Lk)("div",ha,[(0,i.bF)(k,{class:"footer-font",trigger:"click",placement:"top"},{dropdown:(0,i.k6)((()=>[(0,i.bF)(v,null,{default:(0,i.k6)((()=>[(0,i.bF)(m,{class:(0,a.C4)({"is-active":18===U.value}),onClick:t[3]||(t[3]=e=>st(18))},{default:(0,i.k6)((()=>[(0,i.eW)(" Maximum 18 ")])),_:1},8,["class"]),(0,i.bF)(m,{class:(0,a.C4)({"is-active":16===U.value}),onClick:t[4]||(t[4]=e=>st(16))},{default:(0,i.k6)((()=>[(0,i.eW)(" Large 16 ")])),_:1},8,["class"]),(0,i.bF)(m,{class:(0,a.C4)({"is-active":14===U.value}),onClick:t[5]||(t[5]=e=>st(14))},{default:(0,i.k6)((()=>[(0,i.eW)(" Default 14 ")])),_:1},8,["class"]),(0,i.bF)(m,{class:(0,a.C4)({"is-active":12===U.value}),onClick:t[6]||(t[6]=e=>st(12))},{default:(0,i.k6)((()=>[(0,i.eW)(" Minimum 12 ")])),_:1},8,["class"])])),_:1})])),default:(0,i.k6)((()=>[(0,i.Lk)("span",pa,[(0,i.bF)((0,o.R1)(f.A),{type:"pk-fontselect",class:"iconsvg wh20"})])])),_:1})]),(0,i.Lk)("div",{class:"main-chat-footer-operation hide",onClick:rt},[(0,i.bF)((0,o.R1)(f.A),{type:"pk-downloadlogs",class:"iconsvg wh20"})]),(0,i.Lk)("div",{class:"main-chat-footer-operation hide",onClick:ct},[(0,i.bF)((0,o.R1)(f.A),{type:"pk-sharelogs",class:"iconsvg wh20"})]),(0,i.Q3)("",!0),(0,i.Lk)("div",ma,[(0,i.bF)(s,{class:"flex-text",disabled:-1===Q.value||0===ye.value.length,onClick:dt},{default:(0,i.k6)((()=>[(0,i.bF)((0,o.R1)(f.A),{class:"mr6",type:"pk-documentupload"}),(0,i.eW)(" "+(0,a.v_)((0,o.R1)(q)("page.qa.main.operation.newText")),1)])),_:1},8,["disabled"])]),(0,i.Lk)("div",va,[oe.id?((0,i.uX)(),(0,i.CE)("div",ga,[(0,i.Lk)("div",fa,[(0,i.bF)(C.A,{content:oe.name,placement:"top-start"},null,8,["content"])]),(0,i.Lk)("div",{class:"docu-close",onClick:wt},[(0,i.bF)((0,o.R1)(f.A),{type:"pk-knowclose",class:"wh20"})])])):((0,i.uX)(),(0,i.CE)("div",ka,[(0,i.bF)((0,o.R1)(h.Vc),{width:"400","popper-class":"know-flag",placement:"top-end",trigger:"click",ref:"cardPopRef",onBlur:t[9]||(t[9]=e=>he.value=!1),onHide:t[10]||(t[10]=e=>he.value=!1)},{reference:(0,i.k6)((()=>[(0,i.Lk)("div",Ca,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(pt.value,(e=>((0,i.uX)(),(0,i.Wv)(b,{class:"active-know",type:"primary",key:e.id,onClick:ut},{default:(0,i.k6)((()=>[(0,i.bF)((0,o.R1)(f.A),{type:"pk-knowth"}),(0,i.bF)(C.A,{content:e.name,placement:"top-start"},null,8,["content"])])),_:2},1024)))),128)),(0,i.Lk)("div",{class:"know-card",onClick:ut},[(0,i.bo)((0,i.bF)((0,o.R1)(f.A),{type:"pk-knowcard",class:"wh20"},null,512),[[l.aG,!he.value]]),(0,i.bo)((0,i.bF)((0,o.R1)(f.A),{type:"pk-knowup",class:"wh20"},null,512),[[l.aG,he.value]])])])])),default:(0,i.k6)((()=>[(0,i.Lk)("div",wa,[(0,i.Lk)("div",ba,[(0,i.Lk)("div",ya,(0,a.v_)((0,o.R1)(q)("page.knowledge.knowcard.title")),1),O.value?((0,i.uX)(),(0,i.Wv)(b,{key:0,type:mt(ue.value)?"primary":"success",onClick:t[8]||(t[8]=e=>ht(ue.value))},{default:(0,i.k6)((()=>[mt(ue.value)?((0,i.uX)(),(0,i.Wv)((0,o.R1)(f.A),{key:0,type:"pk-knowth"})):(0,i.Q3)("",!0),(0,i.bF)(C.A,{content:ue.value.knowledgeName,placement:"top-start"},null,8,["content"])])),_:1},8,["type"])):(0,i.Q3)("",!0),O.value?((0,i.uX)(),(0,i.Wv)(d,{key:1,style:{margin:"0"}})):(0,i.Q3)("",!0),(0,i.Lk)("div",xa,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(de.value,(e=>((0,i.uX)(),(0,i.Wv)(b,{type:mt(e)?"primary":e.enable?"success":"info",onClick:t=>!!e.enable&&ht(e),key:e.knowledgeId},{default:(0,i.k6)((()=>[mt(e)?((0,i.uX)(),(0,i.Wv)((0,o.R1)(f.A),{key:0,type:"pk-knowth"})):(0,i.Q3)("",!0),(0,i.bF)(C.A,{content:e.enable?e.knowledgeName:(0,o.R1)(q)("page.knowledge.nodocs.hint"),placement:"top-start"},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(e.knowledgeName),1)])),_:2},1032,["content"])])),_:2},1032,["type","onClick"])))),128))])])])])),_:1},512)]))])]),(0,i.Lk)("div",Ia,[(0,i.bF)(n,{ref_key:"inputRef",ref:ge,modelValue:ve.value,"onUpdate:modelValue":t[11]||(t[11]=e=>ve.value=e),type:"textarea","input-style":"height: 3.375rem",disabled:"prompting"===fe.value,placeholder:(0,o.R1)(q)("page.qa.main.footer.inputplaceholder",{limit:W.value}),autosize:{minRows:1,maxRows:10},onInput:Je,onPaste:Ze,onKeydown:et,onKeypress:(0,l.jR)(nt,["enter"]),onFocus:Ue,onBlur:Qe},null,8,["modelValue","disabled","placeholder"]),(0,i.Lk)("div",_a,["prompt"===fe.value?((0,i.uX)(),(0,i.Wv)(s,{key:0,type:"primary",disabled:ke.value,onClick:Ye},{icon:(0,i.k6)((()=>[ke.value?((0,i.uX)(),(0,i.Wv)((0,o.R1)(f.A),{key:0,type:"pk-prompt",class:"main-chat-footer-promptwh"})):((0,i.uX)(),(0,i.Wv)((0,o.R1)(f.A),{key:1,type:"pk-prompting",class:"main-chat-footer-promptwh"}))])),_:1},8,["disabled"])):"prompting"===fe.value?((0,i.uX)(),(0,i.Wv)(s,{key:1,type:"primary",onClick:at},{icon:(0,i.k6)((()=>[(0,i.bF)((0,o.R1)(f.A),{type:"pk-stopre",class:"main-chat-footer-promptwh"})])),_:1})):(0,i.Q3)("",!0)])])])]))],64))],512),(0,i.bF)(x,{modelValue:P.value,"onUpdate:modelValue":t[14]||(t[14]=e=>P.value=e),title:M.id?(0,o.R1)(q)("page.qa.main.footer.modifyNormalDataHint"):(0,o.R1)(q)("page.qa.main.footer.createNormalDataHint"),width:"600"},{footer:(0,i.k6)((()=>[(0,i.Lk)("div",Ea,[(0,i.bF)(s,{onClick:t[13]||(t[13]=e=>P.value=!1)},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)((0,o.R1)(q)("page.qa.main.cancelButton")),1)])),_:1}),(0,i.bF)(s,{type:"primary",onClick:Ee},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)((0,o.R1)(q)("page.qa.main.confirmButton")),1)])),_:1})])])),default:(0,i.k6)((()=>[(0,i.bF)((0,o.R1)(p.US),{model:M,rules:Ce,ref_key:"normalForm",ref:V,class:"normalForm","label-width":"10"},{default:(0,i.k6)((()=>[(0,i.bF)(y,{label:"",prop:"content"},{default:(0,i.k6)((()=>[(0,i.bF)(n,{class:"normal",maxlength:"500",type:"textarea",modelValue:M.content,"onUpdate:modelValue":t[12]||(t[12]=e=>M.content=e),placeholder:(0,o.R1)(q)("page.qa.normalData.placeholder")},null,8,["modelValue","placeholder"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,i.bF)(x,{modelValue:ne.value,"onUpdate:modelValue":t[15]||(t[15]=e=>ne.value=e),title:xe.value.docName},{default:(0,i.k6)((()=>[(0,i.bF)(I,{style:{height:"60vh"}},{default:(0,i.k6)((()=>[(0,i.Lk)("div",Ra,[(0,i.bF)(oi.A,{docId:Z.value,text:ee.value},null,8,["docId","text"])])])),_:1})])),_:1},8,["modelValue","title"])])}}});const Sa=(0,O.A)(Ta,[["__scopeId","data-v-9463d72a"]]);var Xa=Sa}}]);