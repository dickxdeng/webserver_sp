(self["webpackChunkSensepedia"]=self["webpackChunkSensepedia"]||[]).push([[917],{82167:function(e){
/*!
 * Viewer.js v1.11.6
 * https://fengyuanchen.github.io/viewerjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-09-17T03:16:38.052Z
 */
(function(t,n){e.exports=n()})(0,(function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){o(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,u(i.key),i)}}function r(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,n){return t=u(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function u(e){var t=l(e,"string");return"symbol"===typeof t?t:String(t)}var s={backdrop:!0,button:!0,navbar:!0,title:!0,toolbar:!0,className:"",container:"body",filter:null,fullscreen:!0,inheritedAttributes:["crossOrigin","decoding","isMap","loading","referrerPolicy","sizes","srcset","useMap"],initialCoverage:.9,initialViewIndex:0,inline:!1,interval:5e3,keyboard:!0,focus:!0,loading:!0,loop:!0,minWidth:200,minHeight:100,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,slideOnTouch:!0,toggleOnDblclick:!0,tooltip:!0,transition:!0,zIndex:2015,zIndexInline:0,zoomRatio:.1,minZoomRatio:.01,maxZoomRatio:100,url:"src",ready:null,show:null,shown:null,hide:null,hidden:null,view:null,viewed:null,move:null,moved:null,rotate:null,rotated:null,scale:null,scaled:null,zoom:null,zoomed:null,play:null,stop:null},c='<div class="viewer-container" tabindex="-1" touch-action="none"><div class="viewer-canvas"></div><div class="viewer-footer"><div class="viewer-title"></div><div class="viewer-toolbar"></div><div class="viewer-navbar"><ul class="viewer-list" role="navigation"></ul></div></div><div class="viewer-tooltip" role="alert" aria-hidden="true"></div><div class="viewer-button" data-viewer-action="mix" role="button"></div><div class="viewer-player"></div></div>',d="undefined"!==typeof window&&"undefined"!==typeof window.document,h=d?window:{},p=!(!d||!h.document.documentElement)&&"ontouchstart"in h.document.documentElement,v=!!d&&"PointerEvent"in h,f="viewer",m="move",g="switch",k="zoom",w="".concat(f,"-active"),b="".concat(f,"-close"),y="".concat(f,"-fade"),x="".concat(f,"-fixed"),A="".concat(f,"-fullscreen"),C="".concat(f,"-fullscreen-exit"),I="".concat(f,"-hide"),_="".concat(f,"-hide-md-down"),E="".concat(f,"-hide-sm-down"),R="".concat(f,"-hide-xs-down"),L="".concat(f,"-in"),F="".concat(f,"-invisible"),T="".concat(f,"-loading"),S="".concat(f,"-move"),X="".concat(f,"-open"),q="".concat(f,"-show"),D="".concat(f,"-transition"),N="click",O="dblclick",W="dragstart",j="focusin",K="keydown",z="load",B="error",P=p?"touchend touchcancel":"mouseup",M=p?"touchmove":"mousemove",V=p?"touchstart":"mousedown",H=v?"pointerdown":V,Y=v?"pointermove":M,U=v?"pointerup pointercancel":P,Q="resize",$="transitionend",G="wheel",J="ready",Z="show",ee="shown",te="hide",ne="hidden",ie="view",ae="viewed",re="move",oe="moved",le="rotate",ue="rotated",se="scale",ce="scaled",de="zoom",he="zoomed",pe="play",ve="stop",fe="".concat(f,"Action"),me=/\s\s*/,ge=["zoom-in","zoom-out","one-to-one","reset","prev","play","next","rotate-left","rotate-right","flip-horizontal","flip-vertical"];function ke(e){return"string"===typeof e}var we=Number.isNaN||h.isNaN;function be(e){return"number"===typeof e&&!we(e)}function ye(e){return"undefined"===typeof e}function xe(e){return"object"===n(e)&&null!==e}var Ae=Object.prototype.hasOwnProperty;function Ce(e){if(!xe(e))return!1;try{var t=e.constructor,n=t.prototype;return t&&n&&Ae.call(n,"isPrototypeOf")}catch(i){return!1}}function Ie(e){return"function"===typeof e}function _e(e,t){if(e&&Ie(t))if(Array.isArray(e)||be(e.length)){var n,i=e.length;for(n=0;n<i;n+=1)if(!1===t.call(e,e[n],n,e))break}else xe(e)&&Object.keys(e).forEach((function(n){t.call(e,e[n],n,e)}));return e}var Ee=Object.assign||function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return xe(e)&&n.length>0&&n.forEach((function(t){xe(t)&&Object.keys(t).forEach((function(n){e[n]=t[n]}))})),e},Re=/^(?:width|height|left|top|marginLeft|marginTop)$/;function Le(e,t){var n=e.style;_e(t,(function(e,t){Re.test(t)&&be(e)&&(e+="px"),n[t]=e}))}function Fe(e){return ke(e)?e.replace(/&(?!amp;|quot;|#39;|lt;|gt;)/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function Te(e,t){return!(!e||!t)&&(e.classList?e.classList.contains(t):e.className.indexOf(t)>-1)}function Se(e,t){if(e&&t)if(be(e.length))_e(e,(function(e){Se(e,t)}));else if(e.classList)e.classList.add(t);else{var n=e.className.trim();n?n.indexOf(t)<0&&(e.className="".concat(n," ").concat(t)):e.className=t}}function Xe(e,t){e&&t&&(be(e.length)?_e(e,(function(e){Xe(e,t)})):e.classList?e.classList.remove(t):e.className.indexOf(t)>=0&&(e.className=e.className.replace(t,"")))}function qe(e,t,n){t&&(be(e.length)?_e(e,(function(e){qe(e,t,n)})):n?Se(e,t):Xe(e,t))}var De=/([a-z\d])([A-Z])/g;function Ne(e){return e.replace(De,"$1-$2").toLowerCase()}function Oe(e,t){return xe(e[t])?e[t]:e.dataset?e.dataset[t]:e.getAttribute("data-".concat(Ne(t)))}function We(e,t,n){xe(n)?e[t]=n:e.dataset?e.dataset[t]=n:e.setAttribute("data-".concat(Ne(t)),n)}var je=function(){var e=!1;if(d){var t=!1,n=function(){},i=Object.defineProperty({},"once",{get:function(){return e=!0,t},set:function(e){t=e}});h.addEventListener("test",n,i),h.removeEventListener("test",n,i)}return e}();function Ke(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=n;t.trim().split(me).forEach((function(t){if(!je){var r=e.listeners;r&&r[t]&&r[t][n]&&(a=r[t][n],delete r[t][n],0===Object.keys(r[t]).length&&delete r[t],0===Object.keys(r).length&&delete e.listeners)}e.removeEventListener(t,a,i)}))}function ze(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=n;t.trim().split(me).forEach((function(t){if(i.once&&!je){var r=e.listeners,o=void 0===r?{}:r;a=function(){delete o[t][n],e.removeEventListener(t,a,i);for(var r=arguments.length,l=new Array(r),u=0;u<r;u++)l[u]=arguments[u];n.apply(e,l)},o[t]||(o[t]={}),o[t][n]&&e.removeEventListener(t,o[t][n],i),o[t][n]=a,e.listeners=o}e.addEventListener(t,a,i)}))}function Be(e,n,i,a){var r;return Ie(Event)&&Ie(CustomEvent)?r=new CustomEvent(n,t({bubbles:!0,cancelable:!0,detail:i},a)):(r=document.createEvent("CustomEvent"),r.initCustomEvent(n,!0,!0,i)),e.dispatchEvent(r)}function Pe(e){var t=e.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}function Me(e){var t=e.rotate,n=e.scaleX,i=e.scaleY,a=e.translateX,r=e.translateY,o=[];be(a)&&0!==a&&o.push("translateX(".concat(a,"px)")),be(r)&&0!==r&&o.push("translateY(".concat(r,"px)")),be(t)&&0!==t&&o.push("rotate(".concat(t,"deg)")),be(n)&&1!==n&&o.push("scaleX(".concat(n,")")),be(i)&&1!==i&&o.push("scaleY(".concat(i,")"));var l=o.length?o.join(" "):"none";return{WebkitTransform:l,msTransform:l,transform:l}}function Ve(e){return ke(e)?decodeURIComponent(e.replace(/^.*\//,"").replace(/[?&#].*$/,"")):""}var He=h.navigator&&/Version\/\d+(\.\d+)+?\s+Safari/i.test(h.navigator.userAgent);function Ye(e,t,n){var i=document.createElement("img");if(e.naturalWidth&&!He)return n(e.naturalWidth,e.naturalHeight),i;var a=document.body||document.documentElement;return i.onload=function(){n(i.width,i.height),He||a.removeChild(i)},_e(t.inheritedAttributes,(function(t){var n=e.getAttribute(t);null!==n&&i.setAttribute(t,n)})),i.src=e.src,He||(i.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",a.appendChild(i)),i}function Ue(e){switch(e){case 2:return R;case 3:return E;case 4:return _;default:return""}}function Qe(e){var n=t({},e),i=[];return _e(e,(function(e,t){delete n[t],_e(n,(function(t){var n=Math.abs(e.startX-t.startX),a=Math.abs(e.startY-t.startY),r=Math.abs(e.endX-t.endX),o=Math.abs(e.endY-t.endY),l=Math.sqrt(n*n+a*a),u=Math.sqrt(r*r+o*o),s=(u-l)/l;i.push(s)}))})),i.sort((function(e,t){return Math.abs(e)<Math.abs(t)})),i[0]}function $e(e,n){var i=e.pageX,a=e.pageY,r={endX:i,endY:a};return n?r:t({timeStamp:Date.now(),startX:i,startY:a},r)}function Ge(e){var t=0,n=0,i=0;return _e(e,(function(e){var a=e.startX,r=e.startY;t+=a,n+=r,i+=1})),t/=i,n/=i,{pageX:t,pageY:n}}var Je={render:function(){this.initContainer(),this.initViewer(),this.initList(),this.renderViewer()},initBody:function(){var e=this.element.ownerDocument,t=e.body||e.documentElement;this.body=t,this.scrollbarWidth=window.innerWidth-e.documentElement.clientWidth,this.initialBodyPaddingRight=t.style.paddingRight,this.initialBodyComputedPaddingRight=window.getComputedStyle(t).paddingRight},initContainer:function(){this.containerData={width:window.innerWidth,height:window.innerHeight}},initViewer:function(){var e,t=this.options,n=this.parent;t.inline&&(e={width:Math.max(n.offsetWidth,t.minWidth),height:Math.max(n.offsetHeight,t.minHeight)},this.parentData=e),!this.fulled&&e||(e=this.containerData),this.viewerData=Ee({},e)},renderViewer:function(){this.options.inline&&!this.fulled&&Le(this.viewer,this.viewerData)},initList:function(){var e=this,t=this.element,n=this.options,i=this.list,a=[];i.innerHTML="",_e(this.images,(function(t,r){var o=t.src,l=t.alt||Ve(o),u=e.getImageURL(t);if(o||u){var s=document.createElement("li"),c=document.createElement("img");_e(n.inheritedAttributes,(function(e){var n=t.getAttribute(e);null!==n&&c.setAttribute(e,n)})),n.navbar&&(c.src=o||u),c.alt=l,c.setAttribute("data-original-url",u||o),s.setAttribute("data-index",r),s.setAttribute("data-viewer-action","view"),s.setAttribute("role","button"),n.keyboard&&s.setAttribute("tabindex",0),s.appendChild(c),i.appendChild(s),a.push(s)}})),this.items=a,_e(a,(function(t){var i,a,r=t.firstElementChild;We(r,"filled",!0),n.loading&&Se(t,T),ze(r,z,i=function(i){Ke(r,B,a),n.loading&&Xe(t,T),e.loadImage(i)},{once:!0}),ze(r,B,a=function(){Ke(r,z,i),n.loading&&Xe(t,T)},{once:!0})})),n.transition&&ze(t,ae,(function(){Se(i,D)}),{once:!0})},renderList:function(){var e=this.index,t=this.items[e];if(t){var n=t.nextElementSibling,i=parseInt(window.getComputedStyle(n||t).marginLeft,10),a=t.offsetWidth,r=a+i;Le(this.list,Ee({width:r*this.length-i},Me({translateX:(this.viewerData.width-a)/2-r*e})))}},resetList:function(){var e=this.list;e.innerHTML="",Xe(e,D),Le(e,Me({translateX:0}))},initImage:function(e){var t,n=this,i=this.options,a=this.image,r=this.viewerData,o=this.footer.offsetHeight,l=r.width,u=Math.max(r.height-o,o),s=this.imageData||{};this.imageInitializing={abort:function(){t.onload=null}},t=Ye(a,i,(function(t,a){var r=t/a,o=Math.max(0,Math.min(1,i.initialCoverage)),c=l,d=u;n.imageInitializing=!1,u*r>l?d=l/r:c=u*r,o=be(o)?o:.9,c=Math.min(c*o,t),d=Math.min(d*o,a);var h=(l-c)/2,p=(u-d)/2,v={left:h,top:p,x:h,y:p,width:c,height:d,oldRatio:1,ratio:c/t,aspectRatio:r,naturalWidth:t,naturalHeight:a},f=Ee({},v);i.rotatable&&(v.rotate=s.rotate||0,f.rotate=0),i.scalable&&(v.scaleX=s.scaleX||1,v.scaleY=s.scaleY||1,f.scaleX=1,f.scaleY=1),n.imageData=v,n.initialImageData=f,e&&e()}))},renderImage:function(e){var t=this,n=this.image,i=this.imageData;if(Le(n,Ee({width:i.width,height:i.height,marginLeft:i.x,marginTop:i.y},Me(i))),e)if((this.viewing||this.moving||this.rotating||this.scaling||this.zooming)&&this.options.transition&&Te(n,D)){var a=function(){t.imageRendering=!1,e()};this.imageRendering={abort:function(){Ke(n,$,a)}},ze(n,$,a,{once:!0})}else e()},resetImage:function(){var e=this.image;e&&(this.viewing&&this.viewing.abort(),e.parentNode.removeChild(e),this.image=null,this.title.innerHTML="")}},Ze={bind:function(){var e=this.options,t=this.viewer,n=this.canvas,i=this.element.ownerDocument;ze(t,N,this.onClick=this.click.bind(this)),ze(t,W,this.onDragStart=this.dragstart.bind(this)),ze(n,H,this.onPointerDown=this.pointerdown.bind(this)),ze(i,Y,this.onPointerMove=this.pointermove.bind(this)),ze(i,U,this.onPointerUp=this.pointerup.bind(this)),ze(i,K,this.onKeyDown=this.keydown.bind(this)),ze(window,Q,this.onResize=this.resize.bind(this)),e.zoomable&&e.zoomOnWheel&&ze(t,G,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),e.toggleOnDblclick&&ze(n,O,this.onDblclick=this.dblclick.bind(this))},unbind:function(){var e=this.options,t=this.viewer,n=this.canvas,i=this.element.ownerDocument;Ke(t,N,this.onClick),Ke(t,W,this.onDragStart),Ke(n,H,this.onPointerDown),Ke(i,Y,this.onPointerMove),Ke(i,U,this.onPointerUp),Ke(i,K,this.onKeyDown),Ke(window,Q,this.onResize),e.zoomable&&e.zoomOnWheel&&Ke(t,G,this.onWheel,{passive:!1,capture:!0}),e.toggleOnDblclick&&Ke(n,O,this.onDblclick)}},et={click:function(e){var t=this.options,n=this.imageData,i=e.target,a=Oe(i,fe);switch(a||"img"!==i.localName||"li"!==i.parentElement.localName||(i=i.parentElement,a=Oe(i,fe)),p&&e.isTrusted&&i===this.canvas&&clearTimeout(this.clickCanvasTimeout),a){case"mix":this.played?this.stop():t.inline?this.fulled?this.exit():this.full():this.hide();break;case"hide":this.pointerMoved||this.hide();break;case"view":this.view(Oe(i,"index"));break;case"zoom-in":this.zoom(.1,!0);break;case"zoom-out":this.zoom(-.1,!0);break;case"one-to-one":this.toggle();break;case"reset":this.reset();break;case"prev":this.prev(t.loop);break;case"play":this.play(t.fullscreen);break;case"next":this.next(t.loop);break;case"rotate-left":this.rotate(-90);break;case"rotate-right":this.rotate(90);break;case"flip-horizontal":this.scaleX(-n.scaleX||-1);break;case"flip-vertical":this.scaleY(-n.scaleY||-1);break;default:this.played&&this.stop()}},dblclick:function(e){e.preventDefault(),this.viewed&&e.target===this.image&&(p&&e.isTrusted&&clearTimeout(this.doubleClickImageTimeout),this.toggle(e.isTrusted?e:e.detail&&e.detail.originalEvent))},load:function(){var e=this;this.timeout&&(clearTimeout(this.timeout),this.timeout=!1);var t=this.element,n=this.options,i=this.image,a=this.index,r=this.viewerData;Xe(i,F),n.loading&&Xe(this.canvas,T),i.style.cssText="height:0;"+"margin-left:".concat(r.width/2,"px;")+"margin-top:".concat(r.height/2,"px;")+"max-width:none!important;position:relative;width:0;",this.initImage((function(){qe(i,S,n.movable),qe(i,D,n.transition),e.renderImage((function(){e.viewed=!0,e.viewing=!1,Ie(n.viewed)&&ze(t,ae,n.viewed,{once:!0}),Be(t,ae,{originalImage:e.images[a],index:a,image:i},{cancelable:!1})}))}))},loadImage:function(e){var t=e.target,n=t.parentNode,i=n.offsetWidth||30,a=n.offsetHeight||50,r=!!Oe(t,"filled");Ye(t,this.options,(function(e,n){var o=e/n,l=i,u=a;a*o>i?r?l=a*o:u=i/o:r?u=i/o:l=a*o,Le(t,Ee({width:l,height:u},Me({translateX:(i-l)/2,translateY:(a-u)/2})))}))},keydown:function(e){var t=this.options;if(t.keyboard){var n=e.keyCode||e.which||e.charCode;switch(n){case 13:this.viewer.contains(e.target)&&this.click(e);break}if(this.fulled)switch(n){case 27:this.played?this.stop():t.inline?this.fulled&&this.exit():this.hide();break;case 32:this.played&&this.stop();break;case 37:this.played&&this.playing?this.playing.prev():this.prev(t.loop);break;case 38:e.preventDefault(),this.zoom(t.zoomRatio,!0);break;case 39:this.played&&this.playing?this.playing.next():this.next(t.loop);break;case 40:e.preventDefault(),this.zoom(-t.zoomRatio,!0);break;case 48:case 49:e.ctrlKey&&(e.preventDefault(),this.toggle());break}}},dragstart:function(e){"img"===e.target.localName&&e.preventDefault()},pointerdown:function(e){var t=this.options,n=this.pointers,i=e.buttons,a=e.button;if(this.pointerMoved=!1,!(!this.viewed||this.showing||this.viewing||this.hiding||("mousedown"===e.type||"pointerdown"===e.type&&"mouse"===e.pointerType)&&(be(i)&&1!==i||be(a)&&0!==a||e.ctrlKey))){e.preventDefault(),e.changedTouches?_e(e.changedTouches,(function(e){n[e.identifier]=$e(e)})):n[e.pointerId||0]=$e(e);var r=!!t.movable&&m;t.zoomOnTouch&&t.zoomable&&Object.keys(n).length>1?r=k:t.slideOnTouch&&("touch"===e.pointerType||"touchstart"===e.type)&&this.isSwitchable()&&(r=g),!t.transition||r!==m&&r!==k||Xe(this.image,D),this.action=r}},pointermove:function(e){var t=this.pointers,n=this.action;this.viewed&&n&&(e.preventDefault(),e.changedTouches?_e(e.changedTouches,(function(e){Ee(t[e.identifier]||{},$e(e,!0))})):Ee(t[e.pointerId||0]||{},$e(e,!0)),this.change(e))},pointerup:function(e){var t,n=this,i=this.options,a=this.action,r=this.pointers;e.changedTouches?_e(e.changedTouches,(function(e){t=r[e.identifier],delete r[e.identifier]})):(t=r[e.pointerId||0],delete r[e.pointerId||0]),a&&(e.preventDefault(),!i.transition||a!==m&&a!==k||Se(this.image,D),this.action=!1,p&&a!==k&&t&&Date.now()-t.timeStamp<500&&(clearTimeout(this.clickCanvasTimeout),clearTimeout(this.doubleClickImageTimeout),i.toggleOnDblclick&&this.viewed&&e.target===this.image?this.imageClicked?(this.imageClicked=!1,this.doubleClickImageTimeout=setTimeout((function(){Be(n.image,O,{originalEvent:e})}),50)):(this.imageClicked=!0,this.doubleClickImageTimeout=setTimeout((function(){n.imageClicked=!1}),500)):(this.imageClicked=!1,i.backdrop&&"static"!==i.backdrop&&e.target===this.canvas&&(this.clickCanvasTimeout=setTimeout((function(){Be(n.canvas,N,{originalEvent:e})}),50)))))},resize:function(){var e=this;if(this.isShown&&!this.hiding&&(this.fulled&&(this.close(),this.initBody(),this.open()),this.initContainer(),this.initViewer(),this.renderViewer(),this.renderList(),this.viewed&&this.initImage((function(){e.renderImage()})),this.played)){if(this.options.fullscreen&&this.fulled&&!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement))return void this.stop();_e(this.player.getElementsByTagName("img"),(function(t){ze(t,z,e.loadImage.bind(e),{once:!0}),Be(t,z)}))}},wheel:function(e){var t=this;if(this.viewed&&(e.preventDefault(),!this.wheeling)){this.wheeling=!0,setTimeout((function(){t.wheeling=!1}),50);var n=Number(this.options.zoomRatio)||.1,i=1;e.deltaY?i=e.deltaY>0?1:-1:e.wheelDelta?i=-e.wheelDelta/120:e.detail&&(i=e.detail>0?1:-1),this.zoom(-i*n,!0,null,e)}}},tt={show:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.element,n=this.options;if(n.inline||this.showing||this.isShown||this.showing)return this;if(!this.ready)return this.build(),this.ready&&this.show(e),this;if(Ie(n.show)&&ze(t,Z,n.show,{once:!0}),!1===Be(t,Z)||!this.ready)return this;this.hiding&&this.transitioning.abort(),this.showing=!0,this.open();var i=this.viewer;if(Xe(i,I),i.setAttribute("role","dialog"),i.setAttribute("aria-labelledby",this.title.id),i.setAttribute("aria-modal",!0),i.removeAttribute("aria-hidden"),n.transition&&!e){var a=this.shown.bind(this);this.transitioning={abort:function(){Ke(i,$,a),Xe(i,L)}},Se(i,D),i.initialOffsetWidth=i.offsetWidth,ze(i,$,a,{once:!0}),Se(i,L)}else Se(i,L),this.shown();return this},hide:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.element,i=this.options;if(i.inline||this.hiding||!this.isShown&&!this.showing)return this;if(Ie(i.hide)&&ze(n,te,i.hide,{once:!0}),!1===Be(n,te))return this;this.showing&&this.transitioning.abort(),this.hiding=!0,this.played?this.stop():this.viewing&&this.viewing.abort();var a=this.viewer,r=this.image,o=function(){Xe(a,L),e.hidden()};if(i.transition&&!t){var l=function t(n){n&&n.target===a&&(Ke(a,$,t),e.hidden())},u=function(){Te(a,D)?(ze(a,$,l),Xe(a,L)):o()};this.transitioning={abort:function(){e.viewed&&Te(r,D)?Ke(r,$,u):Te(a,D)&&Ke(a,$,l)}},this.viewed&&Te(r,D)?(ze(r,$,u,{once:!0}),this.zoomTo(0,!1,null,null,!0)):u()}else o();return this},view:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.initialViewIndex;if(t=Number(t)||0,this.hiding||this.played||t<0||t>=this.length||this.viewed&&t===this.index)return this;if(!this.isShown)return this.index=t,this.show();this.viewing&&this.viewing.abort();var n=this.element,i=this.options,a=this.title,r=this.canvas,o=this.items[t],l=o.querySelector("img"),u=Oe(l,"originalUrl"),s=l.getAttribute("alt"),c=document.createElement("img");if(_e(i.inheritedAttributes,(function(e){var t=l.getAttribute(e);null!==t&&c.setAttribute(e,t)})),c.src=u,c.alt=s,Ie(i.view)&&ze(n,ie,i.view,{once:!0}),!1===Be(n,ie,{originalImage:this.images[t],index:t,image:c})||!this.isShown||this.hiding||this.played)return this;var d=this.items[this.index];d&&(Xe(d,w),d.removeAttribute("aria-selected")),Se(o,w),o.setAttribute("aria-selected",!0),i.focus&&o.focus(),this.image=c,this.viewed=!1,this.index=t,this.imageData={},Se(c,F),i.loading&&Se(r,T),r.innerHTML="",r.appendChild(c),this.renderList(),a.innerHTML="";var h,p,v=function(){var t=e.imageData,n=Array.isArray(i.title)?i.title[1]:i.title;a.innerHTML=Fe(Ie(n)?n.call(e,c,t):"".concat(s," (").concat(t.naturalWidth," × ").concat(t.naturalHeight,")"))};return ze(n,ae,v,{once:!0}),this.viewing={abort:function(){Ke(n,ae,v),c.complete?e.imageRendering?e.imageRendering.abort():e.imageInitializing&&e.imageInitializing.abort():(c.src="",Ke(c,z,h),e.timeout&&clearTimeout(e.timeout))}},c.complete?this.load():(ze(c,z,h=function(){Ke(c,B,p),e.load()},{once:!0}),ze(c,B,p=function(){Ke(c,z,h),e.timeout&&(clearTimeout(e.timeout),e.timeout=!1),Xe(c,F),i.loading&&Xe(e.canvas,T)},{once:!0}),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){Xe(c,F),e.timeout=!1}),1e3)),this},prev:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.index-1;return t<0&&(t=e?this.length-1:0),this.view(t),this},next:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.length-1,n=this.index+1;return n>t&&(n=e?0:t),this.view(n),this},move:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=this.imageData;return this.moveTo(ye(e)?e:n.x+Number(e),ye(t)?t:n.y+Number(t)),this},moveTo:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=this.element,r=this.options,o=this.imageData;if(e=Number(e),n=Number(n),this.viewed&&!this.played&&r.movable){var l=o.x,u=o.y,s=!1;if(be(e)?s=!0:e=l,be(n)?s=!0:n=u,s){if(Ie(r.move)&&ze(a,re,r.move,{once:!0}),!1===Be(a,re,{x:e,y:n,oldX:l,oldY:u,originalEvent:i}))return this;o.x=e,o.y=n,o.left=e,o.top=n,this.moving=!0,this.renderImage((function(){t.moving=!1,Ie(r.moved)&&ze(a,oe,r.moved,{once:!0}),Be(a,oe,{x:e,y:n,oldX:l,oldY:u,originalEvent:i},{cancelable:!1})}))}}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e)),this},rotateTo:function(e){var t=this,n=this.element,i=this.options,a=this.imageData;if(e=Number(e),be(e)&&this.viewed&&!this.played&&i.rotatable){var r=a.rotate;if(Ie(i.rotate)&&ze(n,le,i.rotate,{once:!0}),!1===Be(n,le,{degree:e,oldDegree:r}))return this;a.rotate=e,this.rotating=!0,this.renderImage((function(){t.rotating=!1,Ie(i.rotated)&&ze(n,ue,i.rotated,{once:!0}),Be(n,ue,{degree:e,oldDegree:r},{cancelable:!1})}))}return this},scaleX:function(e){return this.scale(e,this.imageData.scaleY),this},scaleY:function(e){return this.scale(this.imageData.scaleX,e),this},scale:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=this.element,a=this.options,r=this.imageData;if(e=Number(e),n=Number(n),this.viewed&&!this.played&&a.scalable){var o=r.scaleX,l=r.scaleY,u=!1;if(be(e)?u=!0:e=o,be(n)?u=!0:n=l,u){if(Ie(a.scale)&&ze(i,se,a.scale,{once:!0}),!1===Be(i,se,{scaleX:e,scaleY:n,oldScaleX:o,oldScaleY:l}))return this;r.scaleX=e,r.scaleY=n,this.scaling=!0,this.renderImage((function(){t.scaling=!1,Ie(a.scaled)&&ze(i,ce,a.scaled,{once:!0}),Be(i,ce,{scaleX:e,scaleY:n,oldScaleX:o,oldScaleY:l},{cancelable:!1})}))}}return this},zoom:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=this.imageData;return e=Number(e),e=e<0?1/(1-e):1+e,this.zoomTo(a.width*e/a.naturalWidth,t,n,i),this},zoomTo:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.element,l=this.options,u=this.pointers,s=this.imageData,c=s.x,d=s.y,h=s.width,p=s.height,v=s.naturalWidth,f=s.naturalHeight;if(e=Math.max(0,e),be(e)&&this.viewed&&!this.played&&(r||l.zoomable)){if(!r){var m=Math.max(.01,l.minZoomRatio),g=Math.min(100,l.maxZoomRatio);e=Math.min(Math.max(e,m),g)}if(a)switch(a.type){case"wheel":l.zoomRatio>=.055&&e>.95&&e<1.05&&(e=1);break;case"pointermove":case"touchmove":case"mousemove":e>.99&&e<1.01&&(e=1);break}var k=v*e,w=f*e,b=k-h,y=w-p,x=s.ratio;if(Ie(l.zoom)&&ze(o,de,l.zoom,{once:!0}),!1===Be(o,de,{ratio:e,oldRatio:x,originalEvent:a}))return this;if(this.zooming=!0,a){var A=Pe(this.viewer),C=u&&Object.keys(u).length>0?Ge(u):{pageX:a.pageX,pageY:a.pageY};s.x-=b*((C.pageX-A.left-c)/h),s.y-=y*((C.pageY-A.top-d)/p)}else Ce(i)&&be(i.x)&&be(i.y)?(s.x-=b*((i.x-c)/h),s.y-=y*((i.y-d)/p)):(s.x-=b/2,s.y-=y/2);s.left=s.x,s.top=s.y,s.width=k,s.height=w,s.oldRatio=x,s.ratio=e,this.renderImage((function(){t.zooming=!1,Ie(l.zoomed)&&ze(o,he,l.zoomed,{once:!0}),Be(o,he,{ratio:e,oldRatio:x,originalEvent:a},{cancelable:!1})})),n&&this.tooltip()}return this},play:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isShown||this.played)return this;var n=this.element,i=this.options;if(Ie(i.play)&&ze(n,pe,i.play,{once:!0}),!1===Be(n,pe))return this;var a=this.player,r=this.loadImage.bind(this),o=[],l=0,u=0;if(this.played=!0,this.onLoadWhenPlay=r,t&&this.requestFullscreen(t),Se(a,q),_e(this.items,(function(e,t){var n=e.querySelector("img"),s=document.createElement("img");s.src=Oe(n,"originalUrl"),s.alt=n.getAttribute("alt"),s.referrerPolicy=n.referrerPolicy,l+=1,Se(s,y),qe(s,D,i.transition),Te(e,w)&&(Se(s,L),u=t),o.push(s),ze(s,z,r,{once:!0}),a.appendChild(s)})),be(i.interval)&&i.interval>0){var s=function t(){clearTimeout(e.playing.timeout),Xe(o[u],L),u-=1,u=u>=0?u:l-1,Se(o[u],L),e.playing.timeout=setTimeout(t,i.interval)},c=function t(){clearTimeout(e.playing.timeout),Xe(o[u],L),u+=1,u=u<l?u:0,Se(o[u],L),e.playing.timeout=setTimeout(t,i.interval)};l>1&&(this.playing={prev:s,next:c,timeout:setTimeout(c,i.interval)})}return this},stop:function(){var e=this;if(!this.played)return this;var t=this.element,n=this.options;if(Ie(n.stop)&&ze(t,ve,n.stop,{once:!0}),!1===Be(t,ve))return this;var i=this.player;return clearTimeout(this.playing.timeout),this.playing=!1,this.played=!1,_e(i.getElementsByTagName("img"),(function(t){Ke(t,z,e.onLoadWhenPlay)})),Xe(i,q),i.innerHTML="",this.exitFullscreen(),this},full:function(){var e=this,t=this.options,n=this.viewer,i=this.image,a=this.list;return!this.isShown||this.played||this.fulled||!t.inline||(this.fulled=!0,this.open(),Se(this.button,C),t.transition&&(Xe(a,D),this.viewed&&Xe(i,D)),Se(n,x),n.setAttribute("role","dialog"),n.setAttribute("aria-labelledby",this.title.id),n.setAttribute("aria-modal",!0),n.removeAttribute("style"),Le(n,{zIndex:t.zIndex}),t.focus&&this.enforceFocus(),this.initContainer(),this.viewerData=Ee({},this.containerData),this.renderList(),this.viewed&&this.initImage((function(){e.renderImage((function(){t.transition&&setTimeout((function(){Se(i,D),Se(a,D)}),0)}))}))),this},exit:function(){var e=this,t=this.options,n=this.viewer,i=this.image,a=this.list;return this.isShown&&!this.played&&this.fulled&&t.inline?(this.fulled=!1,this.close(),Xe(this.button,C),t.transition&&(Xe(a,D),this.viewed&&Xe(i,D)),t.focus&&this.clearEnforceFocus(),n.removeAttribute("role"),n.removeAttribute("aria-labelledby"),n.removeAttribute("aria-modal"),Xe(n,x),Le(n,{zIndex:t.zIndexInline}),this.viewerData=Ee({},this.parentData),this.renderViewer(),this.renderList(),this.viewed&&this.initImage((function(){e.renderImage((function(){t.transition&&setTimeout((function(){Se(i,D),Se(a,D)}),0)}))})),this):this},tooltip:function(){var e=this,t=this.options,n=this.tooltipBox,i=this.imageData;return this.viewed&&!this.played&&t.tooltip?(n.textContent="".concat(Math.round(100*i.ratio),"%"),this.tooltipping?clearTimeout(this.tooltipping):t.transition?(this.fading&&Be(n,$),Se(n,q),Se(n,y),Se(n,D),n.removeAttribute("aria-hidden"),n.initialOffsetWidth=n.offsetWidth,Se(n,L)):(Se(n,q),n.removeAttribute("aria-hidden")),this.tooltipping=setTimeout((function(){t.transition?(ze(n,$,(function(){Xe(n,q),Xe(n,y),Xe(n,D),n.setAttribute("aria-hidden",!0),e.fading=!1}),{once:!0}),Xe(n,L),e.fading=!0):(Xe(n,q),n.setAttribute("aria-hidden",!0)),e.tooltipping=!1}),1e3),this):this},toggle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return 1===this.imageData.ratio?this.zoomTo(this.imageData.oldRatio,!0,null,e):this.zoomTo(1,!0,null,e),this},reset:function(){return this.viewed&&!this.played&&(this.imageData=Ee({},this.initialImageData),this.renderImage()),this},update:function(){var e=this,t=this.element,n=this.options,i=this.isImg;if(i&&!t.parentNode)return this.destroy();var a=[];if(_e(i?[t]:t.querySelectorAll("img"),(function(t){Ie(n.filter)?n.filter.call(e,t)&&a.push(t):e.getImageURL(t)&&a.push(t)})),!a.length)return this;if(this.images=a,this.length=a.length,this.ready){var r=[];if(_e(this.items,(function(e,t){var n=e.querySelector("img"),i=a[t];i&&n&&i.src===n.src&&i.alt===n.alt||r.push(t)})),Le(this.list,{width:"auto"}),this.initList(),this.isShown)if(this.length){if(this.viewed){var o=r.indexOf(this.index);if(o>=0)this.viewed=!1,this.view(Math.max(Math.min(this.index-o,this.length-1),0));else{var l=this.items[this.index];Se(l,w),l.setAttribute("aria-selected",!0)}}}else this.image=null,this.viewed=!1,this.index=0,this.imageData={},this.canvas.innerHTML="",this.title.innerHTML=""}else this.build();return this},destroy:function(){var e=this.element,t=this.options;return e[f]?(this.destroyed=!0,this.ready?(this.played&&this.stop(),t.inline?(this.fulled&&this.exit(),this.unbind()):this.isShown?(this.viewing&&(this.imageRendering?this.imageRendering.abort():this.imageInitializing&&this.imageInitializing.abort()),this.hiding&&this.transitioning.abort(),this.hidden()):this.showing&&(this.transitioning.abort(),this.hidden()),this.ready=!1,this.viewer.parentNode.removeChild(this.viewer)):t.inline&&(this.delaying?this.delaying.abort():this.initializing&&this.initializing.abort()),t.inline||Ke(e,N,this.onStart),e[f]=void 0,this):this}},nt={getImageURL:function(e){var t=this.options.url;return t=ke(t)?e.getAttribute(t):Ie(t)?t.call(this,e):"",t},enforceFocus:function(){var e=this;this.clearEnforceFocus(),ze(document,j,this.onFocusin=function(t){var n=e.viewer,i=t.target;if(i!==document&&i!==n&&!n.contains(i)){while(i){if(null!==i.getAttribute("tabindex")||"true"===i.getAttribute("aria-modal"))return;i=i.parentElement}n.focus()}})},clearEnforceFocus:function(){this.onFocusin&&(Ke(document,j,this.onFocusin),this.onFocusin=null)},open:function(){var e=this.body;Se(e,X),this.scrollbarWidth>0&&(e.style.paddingRight="".concat(this.scrollbarWidth+(parseFloat(this.initialBodyComputedPaddingRight)||0),"px"))},close:function(){var e=this.body;Xe(e,X),this.scrollbarWidth>0&&(e.style.paddingRight=this.initialBodyPaddingRight)},shown:function(){var e=this.element,t=this.options,n=this.viewer;this.fulled=!0,this.isShown=!0,this.render(),this.bind(),this.showing=!1,t.focus&&(n.focus(),this.enforceFocus()),Ie(t.shown)&&ze(e,ee,t.shown,{once:!0}),!1!==Be(e,ee)&&this.ready&&this.isShown&&!this.hiding&&this.view(this.index)},hidden:function(){var e=this.element,t=this.options,n=this.viewer;t.fucus&&this.clearEnforceFocus(),this.close(),this.unbind(),Se(n,I),n.removeAttribute("role"),n.removeAttribute("aria-labelledby"),n.removeAttribute("aria-modal"),n.setAttribute("aria-hidden",!0),this.resetList(),this.resetImage(),this.fulled=!1,this.viewed=!1,this.isShown=!1,this.hiding=!1,this.destroyed||(Ie(t.hidden)&&ze(e,ne,t.hidden,{once:!0}),Be(e,ne,null,{cancelable:!1}))},requestFullscreen:function(e){var t=this.element.ownerDocument;if(this.fulled&&!(t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement||t.msFullscreenElement)){var n=t.documentElement;n.requestFullscreen?Ce(e)?n.requestFullscreen(e):n.requestFullscreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):n.mozRequestFullScreen?n.mozRequestFullScreen():n.msRequestFullscreen&&n.msRequestFullscreen()}},exitFullscreen:function(){var e=this.element.ownerDocument;this.fulled&&(e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement)&&(e.exitFullscreen?e.exitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.msExitFullscreen&&e.msExitFullscreen())},change:function(e){var t=this.options,n=this.pointers,i=n[Object.keys(n)[0]];if(i){var a=i.endX-i.startX,r=i.endY-i.startY;switch(this.action){case m:0===a&&0===r||(this.pointerMoved=!0,this.move(a,r,e));break;case k:this.zoom(Qe(n),!1,null,e);break;case g:this.action="switched";var o=Math.abs(a);o>1&&o>Math.abs(r)&&(this.pointers={},a>1?this.prev(t.loop):a<-1&&this.next(t.loop));break}_e(n,(function(e){e.startX=e.endX,e.startY=e.endY}))}},isSwitchable:function(){var e=this.imageData,t=this.viewerData;return this.length>1&&e.x>=0&&e.y>=0&&e.width<=t.width&&e.height<=t.height}},it=h.Viewer,at=function(e){return function(){return e+=1,e}}(-1),rt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i(this,e),!t||1!==t.nodeType)throw new Error("The first argument is required and must be an element.");this.element=t,this.options=Ee({},s,Ce(n)&&n),this.action=!1,this.fading=!1,this.fulled=!1,this.hiding=!1,this.imageClicked=!1,this.imageData={},this.index=this.options.initialViewIndex,this.isImg=!1,this.isShown=!1,this.length=0,this.moving=!1,this.played=!1,this.playing=!1,this.pointers={},this.ready=!1,this.rotating=!1,this.scaling=!1,this.showing=!1,this.timeout=!1,this.tooltipping=!1,this.viewed=!1,this.viewing=!1,this.wheeling=!1,this.zooming=!1,this.pointerMoved=!1,this.id=at(),this.init()}return r(e,[{key:"init",value:function(){var e=this,t=this.element,n=this.options;if(!t[f]){t[f]=this,n.focus&&!n.keyboard&&(n.focus=!1);var i="img"===t.localName,a=[];if(_e(i?[t]:t.querySelectorAll("img"),(function(t){Ie(n.filter)?n.filter.call(e,t)&&a.push(t):e.getImageURL(t)&&a.push(t)})),this.isImg=i,this.length=a.length,this.images=a,this.initBody(),ye(document.createElement(f).style.transition)&&(n.transition=!1),n.inline){var r=0,o=function(){var t;(r+=1,r===e.length)&&(e.initializing=!1,e.delaying={abort:function(){clearTimeout(t)}},t=setTimeout((function(){e.delaying=!1,e.build()}),0))};this.initializing={abort:function(){_e(a,(function(e){e.complete||(Ke(e,z,o),Ke(e,B,o))}))}},_e(a,(function(e){var t,n;e.complete?o():(ze(e,z,t=function(){Ke(e,B,n),o()},{once:!0}),ze(e,B,n=function(){Ke(e,z,t),o()},{once:!0}))}))}else ze(t,N,this.onStart=function(t){var i=t.target;"img"!==i.localName||Ie(n.filter)&&!n.filter.call(e,i)||e.view(e.images.indexOf(i))})}}},{key:"build",value:function(){if(!this.ready){var e=this.element,t=this.options,n=e.parentNode,i=document.createElement("div");i.innerHTML=c;var a=i.querySelector(".".concat(f,"-container")),r=a.querySelector(".".concat(f,"-title")),o=a.querySelector(".".concat(f,"-toolbar")),l=a.querySelector(".".concat(f,"-navbar")),u=a.querySelector(".".concat(f,"-button")),s=a.querySelector(".".concat(f,"-canvas"));if(this.parent=n,this.viewer=a,this.title=r,this.toolbar=o,this.navbar=l,this.button=u,this.canvas=s,this.footer=a.querySelector(".".concat(f,"-footer")),this.tooltipBox=a.querySelector(".".concat(f,"-tooltip")),this.player=a.querySelector(".".concat(f,"-player")),this.list=a.querySelector(".".concat(f,"-list")),a.id="".concat(f).concat(this.id),r.id="".concat(f,"Title").concat(this.id),Se(r,t.title?Ue(Array.isArray(t.title)?t.title[0]:t.title):I),Se(l,t.navbar?Ue(t.navbar):I),qe(u,I,!t.button),t.keyboard&&u.setAttribute("tabindex",0),t.backdrop&&(Se(a,"".concat(f,"-backdrop")),t.inline||"static"===t.backdrop||We(s,fe,"hide")),ke(t.className)&&t.className&&t.className.split(me).forEach((function(e){Se(a,e)})),t.toolbar){var d=document.createElement("ul"),h=Ce(t.toolbar),p=ge.slice(0,3),v=ge.slice(7,9),m=ge.slice(9);h||Se(o,Ue(t.toolbar)),_e(h?t.toolbar:ge,(function(e,n){var i=h&&Ce(e),a=h?Ne(n):e,r=i&&!ye(e.show)?e.show:e;if(r&&(t.zoomable||-1===p.indexOf(a))&&(t.rotatable||-1===v.indexOf(a))&&(t.scalable||-1===m.indexOf(a))){var o=i&&!ye(e.size)?e.size:e,l=i&&!ye(e.click)?e.click:e,u=document.createElement("li");t.keyboard&&u.setAttribute("tabindex",0),u.setAttribute("role","button"),Se(u,"".concat(f,"-").concat(a)),Ie(l)||We(u,fe,a),be(r)&&Se(u,Ue(r)),-1!==["small","large"].indexOf(o)?Se(u,"".concat(f,"-").concat(o)):"play"===a&&Se(u,"".concat(f,"-large")),Ie(l)&&ze(u,N,l),d.appendChild(u)}})),o.appendChild(d)}else Se(o,I);if(!t.rotatable){var g=o.querySelectorAll('li[class*="rotate"]');Se(g,F),_e(g,(function(e){o.appendChild(e)}))}if(t.inline)Se(u,A),Le(a,{zIndex:t.zIndexInline}),"static"===window.getComputedStyle(n).position&&Le(n,{position:"relative"}),n.insertBefore(a,e.nextSibling);else{Se(u,b),Se(a,x),Se(a,y),Se(a,I),Le(a,{zIndex:t.zIndex});var k=t.container;ke(k)&&(k=e.ownerDocument.querySelector(k)),k||(k=this.body),k.appendChild(a)}t.inline&&(this.render(),this.bind(),this.isShown=!0),this.ready=!0,Ie(t.ready)&&ze(e,J,t.ready,{once:!0}),!1!==Be(e,J)?this.ready&&t.inline&&this.view(this.index):this.ready=!1}}}],[{key:"noConflict",value:function(){return window.Viewer=it,e}},{key:"setDefaults",value:function(e){Ee(s,Ce(e)&&e)}}]),e}();return Ee(rt.prototype,Je,Ze,et,tt,nt),rt}))},47547:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Wa}});var i=n(94470),a=n(28724),r=n(30882),o=n(79266),l=(n(91234),n(64536),n(20897),n(4500),n(19382),n(58926),n(14898),n(29306),n(78952),n(81619),n(27015),n(73780),n(44480),n(65218),n(11657),n(94848),n(89736),n(55864),n(63307),n(43854),n(34817),n(28694)),u=n(83487),s=n(38118),c=n(97913),d=n(98836),h=n(74913),p=n(32228),v=n(19477),f=n(74560),m=n(87591),g=n(47531),k=n(35153),w=n.n(k),b=n(18232),y=n(12567),x=(n(77111),n(47715),n(69989)),A=n(97053),C=n(49284),I=n(57668),_=n(29890),E=n(18684),R=n(17299),L={class:"list-chat"},F={key:0,class:"list-chat-nodata"},T=["src"],S=["onClick"],X={key:0,class:"list-chat-item-online"},q={class:"list-chat-item-onlineT"},D={class:"list-chat-item-onlineD"},N={key:1,class:"list-chat-item-title"},O={class:"list-chat-item-onlineT"},W={class:"list-chat-item-onlineD"},j={key:2,class:"list-chat-item-op"},K=(0,l.pM)({__name:"KnowledgeList",props:{filter:{}},emits:["closeDocu","loadData","stopLLM"],setup:function(e,t){var n=t.emit,i=(0,p.s9)(),a=i.t,d=(0,h.Pj)(),m=e,g=n,k=(0,l.EW)((function(){return"/"})),w=(0,l.EW)((function(){var e=d.state.pk_knowledge.history;if(m.filter){var t=e.filter((function(e){return e.title.includes(m.filter)}));return t.filter((function(e){return e.uuid}))}return e.filter((function(e){return e.uuid}))})),b=(0,l.EW)((function(){return d.state.pk_knowledge.active})),K=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){var n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.uuid,!Q(n)){e.next=3;break}return e.abrupt("return");case 3:b.value&&d.commit("pk_knowledge/updateHistory",{uuid:b.value,type:"update",isEdit:!1}),g("loadData",{uuid:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=(0,o.A)((0,r.A)().mark((function e(t,n,i){var o,l,u,s;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=t.uuid,l=t.title,null===i||void 0===i||i.stopPropagation(),!o){e.next=9;break}return e.next=5,(0,_.aQ)({id:o,name:l});case 5:e.sent,d.commit("pk_knowledge/updateHistory",{uuid:o,type:"update",title:l,isEdit:n}),e.next=15;break;case 9:return e.next=11,(0,_.xU)({name:l,scope:2});case 11:u=e.sent,s=u.data.id,d.commit("pk_knowledge/updateHistory",{uuid:s,type:"add",title:l,isEdit:n,createdAt:u.data.createTime}),d.commit("pk_knowledge/saveActive",{uuid:s});case 15:f.nk.success(a("page.qa.main.submitSuccess"));case 16:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),B=function(e,t,n){var i=e.uuid;i&&d.commit("pk_knowledge/updateHistory",{uuid:i,type:"update",isEdit:t})},P=function(){var e=(0,o.A)((0,r.A)().mark((function e(t,n){var i;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=t.uuid,null===n||void 0===n||n.stopPropagation(),v.s.confirm(a("page.qa.main.deleteHintDetail"),a("page.qa.main.deleteHint"),{confirmButtonText:a("page.qa.main.confirmButton"),cancelButtonText:a("page.qa.main.cancelButton"),type:a("page.qa.main.deleteType")}).then((0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,_.O8)({ids:""+i,scope:2});case 2:g("stopLLM",{uuid:i}),d.commit("pk_knowledge/deleteHistory",{uuid:i}),g("closeDocu"),f.nk.success(a("page.qa.main.deleteSuccess"));case 6:case"end":return e.stop()}}),e)})))).catch((function(){}));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),M=(0,I.s)(P,600),V=!1,H=!1,Y=function(){var e=(0,o.A)((0,r.A)().mark((function e(t,n,i){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!V){e.next=3;break}return V=!1,e.abrupt("return");case 3:if(!H){e.next=5;break}return e.abrupt("return");case 5:return H=!0,e.next=8,z(t,n,i);case 8:H=!1;case 9:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),U=function(){var e=(0,o.A)((0,r.A)().mark((function e(t,n,i){var a;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=t.uuid,V=!0,a&&d.commit("pk_knowledge/updateHistory",{uuid:a,type:"update",isEdit:n});case 3:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),Q=function(e){return e===b.value};return(0,l.sV)((function(){(0,R.eo)(),(0,R.Ru)()})),(0,l.hi)((function(){(0,R.zg)()})),function(e,t){return(0,l.uX)(),(0,l.Wv)((0,s.R1)(x.kA),null,{default:(0,l.k6)((function(){return[(0,l.Lk)("div",L,[0===w.value.length?((0,l.uX)(),(0,l.CE)("div",F,[(0,l.Lk)("img",{src:k.value+"images/nodata.svg",width:"176px",height:"115px"},null,8,T),(0,l.eW)(" "+(0,u.v_)((0,s.R1)(a)("page.knowledge.list.nodata")),1)])):((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(w.value,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{key:t},[(0,l.Lk)("a",{class:(0,u.C4)(["list-chat-item",Q(e.uuid)&&"active"]),onClick:function(t){return K(e)}},[e.isEdit?((0,l.uX)(),(0,l.CE)("div",N,[(0,l.Lk)("div",O,[(0,l.bF)((0,s.R1)(A.WK),{class:"input",modelValue:e.title,"onUpdate:modelValue":function(t){return e.title=t},onBlur:function(t){return Y(e,!1,t)},onKeydown:[(0,c.jR)((function(t){return Y(e,!1,t)}),["enter"]),(0,c.jR)((function(t){return U(e,!1)}),["esc"])],placeholder:(0,s.R1)(a)("page.knowledge.list.inputPlaceholder")},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeydown","placeholder"])]),(0,l.Lk)("div",W,(0,u.v_)(e.createdAt),1)])):((0,l.uX)(),(0,l.CE)("div",X,[(0,l.Lk)("div",q,[(0,l.bF)(E.A,{content:e.title.substring(0,99),placement:"bottom-start","show-arrow":!1},null,8,["content"])]),(0,l.Lk)("div",D,(0,u.v_)(e.createdAt),1)])),Q(e.uuid)&&e.uuid?((0,l.uX)(),(0,l.CE)("div",j,[e.isEdit?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.bF)((0,s.R1)(C.S2),{class:"list-chat-item-opU",onClick:function(t){return B(e,!0,t)}},{default:(0,l.k6)((function(){return[(0,l.bF)((0,s.R1)(y.A),{type:"pk-edit",class:"wh20"})]})),_:2},1032,["onClick"]),(0,l.bF)((0,s.R1)(C.S2),{class:"list-chat-item-opD",onClick:function(t){return(0,s.R1)(M)(e,t)}},{default:(0,l.k6)((function(){return[(0,l.bF)((0,s.R1)(y.A),{type:"pk-delete",class:"wh20"})]})),_:2},1032,["onClick"])],64))])):(0,l.Q3)("",!0)],10,S)])})),128))])]})),_:1})}}}),z=n(83940);const B=(0,z.A)(K,[["__scopeId","data-v-7724b011"]]);var P=B,M=n(15400),V=(n(34302),n(10348),n(83330),n(28215),n(50641),n(87434),n(88556),n(82167)),H="object"==typeof global&&global&&global.Object===Object&&global;const Y=H;var U="object"==typeof self&&self&&self.Object===Object&&self,Q=Y||U||Function("return this")();const $=Q;var G=$.Symbol;const J=G;var Z=Object.prototype,ee=Z.hasOwnProperty,te=Z.toString,ne=J?J.toStringTag:void 0;function ie(e){var t=ee.call(e,ne),n=e[ne];try{e[ne]=void 0;var i=!0}catch{}var a=te.call(e);return i&&(t?e[ne]=n:delete e[ne]),a}var ae=Object.prototype,re=ae.toString;function oe(e){return re.call(e)}var le="[object Null]",ue="[object Undefined]",se=J?J.toStringTag:void 0;function ce(e){return null==e?void 0===e?ue:le:se&&se in Object(e)?ie(e):oe(e)}function de(e){return null!=e&&"object"==typeof e}var he=Array.isArray;const pe=he;function ve(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}parseInt;function fe(e){return e}var me="[object AsyncFunction]",ge="[object Function]",ke="[object GeneratorFunction]",we="[object Proxy]";function be(e){if(!ve(e))return!1;var t=ce(e);return t==ge||t==ke||t==me||t==we}var ye=$["__core-js_shared__"];const xe=ye;var Ae=function(){var e=/[^.]+$/.exec(xe&&xe.keys&&xe.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Ce(e){return!!Ae&&Ae in e}var Ie=Function.prototype,_e=Ie.toString;function Ee(e){if(null!=e){try{return _e.call(e)}catch{}try{return e+""}catch{}}return""}var Re=/[\\^$.*+?()[\]{}|]/g,Le=/^\[object .+?Constructor\]$/,Fe=Function.prototype,Te=Object.prototype,Se=Fe.toString,Xe=Te.hasOwnProperty,qe=RegExp("^"+Se.call(Xe).replace(Re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function De(e){if(!ve(e)||Ce(e))return!1;var t=be(e)?qe:Le;return t.test(Ee(e))}function Ne(e,t){return null==e?void 0:e[t]}function Oe(e,t){var n=Ne(e,t);return De(n)?n:void 0}function We(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var je=800,Ke=16,ze=Date.now;function Be(e){var t=0,n=0;return function(){var i=ze(),a=Ke-(i-n);if(n=i,a>0){if(++t>=je)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function Pe(e){return function(){return e}}var Me=function(){try{var e=Oe(Object,"defineProperty");return e({},"",{}),e}catch{}}();const Ve=Me;var He=Ve?function(e,t){return Ve(e,"toString",{configurable:!0,enumerable:!1,value:Pe(t),writable:!0})}:fe;const Ye=He;var Ue=Be(Ye);const Qe=Ue;var $e=9007199254740991,Ge=/^(?:0|[1-9]\d*)$/;function Je(e,t){var n=typeof e;return t=null==t?$e:t,!!t&&("number"==n||"symbol"!=n&&Ge.test(e))&&e>-1&&e%1==0&&e<t}function Ze(e,t,n){"__proto__"==t&&Ve?Ve(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function et(e,t){return e===t||e!==e&&t!==t}var tt=Object.prototype,nt=tt.hasOwnProperty;function it(e,t,n){var i=e[t];(!nt.call(e,t)||!et(i,n)||void 0===n&&!(t in e))&&Ze(e,t,n)}function at(e,t,n,i){var a=!n;n||(n={});for(var r=-1,o=t.length;++r<o;){var l=t[r],u=i?i(n[l],e[l],l,n,e):void 0;void 0===u&&(u=e[l]),a?Ze(n,l,u):it(n,l,u)}return n}var rt=Math.max;function ot(e,t,n){return t=rt(void 0===t?e.length-1:t,0),function(){for(var i=arguments,a=-1,r=rt(i.length-t,0),o=Array(r);++a<r;)o[a]=i[t+a];a=-1;for(var l=Array(t+1);++a<t;)l[a]=i[a];return l[t]=n(o),We(e,this,l)}}function lt(e,t){return Qe(ot(e,t,fe),e+"")}var ut=9007199254740991;function st(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=ut}function ct(e){return null!=e&&st(e.length)&&!be(e)}function dt(e,t,n){if(!ve(n))return!1;var i=typeof t;return!!("number"==i?ct(n)&&Je(t,n.length):"string"==i&&t in n)&&et(n[t],e)}function ht(e){return lt((function(t,n){var i=-1,a=n.length,r=a>1?n[a-1]:void 0,o=a>2?n[2]:void 0;for(r=e.length>3&&"function"==typeof r?(a--,r):void 0,o&&dt(n[0],n[1],o)&&(r=a<3?void 0:r,a=1),t=Object(t);++i<a;){var l=n[i];l&&e(t,l,i,r)}return t}))}var pt=Object.prototype;function vt(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||pt;return e===n}function ft(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}var mt="[object Arguments]";function gt(e){return de(e)&&ce(e)==mt}var kt=Object.prototype,wt=kt.hasOwnProperty,bt=kt.propertyIsEnumerable,yt=gt(function(){return arguments}())?gt:function(e){return de(e)&&wt.call(e,"callee")&&!bt.call(e,"callee")};const xt=yt;function At(){return!1}var Ct="object"==typeof exports&&exports&&!exports.nodeType&&exports,It=Ct&&"object"==typeof module&&module&&!module.nodeType&&module,_t=It&&It.exports===Ct,Et=_t?$.Buffer:void 0,Rt=Et?Et.isBuffer:void 0,Lt=Rt||At;const Ft=Lt;var Tt="[object Arguments]",St="[object Array]",Xt="[object Boolean]",qt="[object Date]",Dt="[object Error]",Nt="[object Function]",Ot="[object Map]",Wt="[object Number]",jt="[object Object]",Kt="[object RegExp]",zt="[object Set]",Bt="[object String]",Pt="[object WeakMap]",Mt="[object ArrayBuffer]",Vt="[object DataView]",Ht="[object Float32Array]",Yt="[object Float64Array]",Ut="[object Int8Array]",Qt="[object Int16Array]",$t="[object Int32Array]",Gt="[object Uint8Array]",Jt="[object Uint8ClampedArray]",Zt="[object Uint16Array]",en="[object Uint32Array]",tn={};function nn(e){return de(e)&&st(e.length)&&!!tn[ce(e)]}function an(e){return function(t){return e(t)}}tn[Ht]=tn[Yt]=tn[Ut]=tn[Qt]=tn[$t]=tn[Gt]=tn[Jt]=tn[Zt]=tn[en]=!0,tn[Tt]=tn[St]=tn[Mt]=tn[Xt]=tn[Vt]=tn[qt]=tn[Dt]=tn[Nt]=tn[Ot]=tn[Wt]=tn[jt]=tn[Kt]=tn[zt]=tn[Bt]=tn[Pt]=!1;var rn="object"==typeof exports&&exports&&!exports.nodeType&&exports,on=rn&&"object"==typeof module&&module&&!module.nodeType&&module,ln=on&&on.exports===rn,un=ln&&Y.process,sn=function(){try{var e=on&&on.require&&on.require("util").types;return e||un&&un.binding&&un.binding("util")}catch{}}();const cn=sn;var dn=cn&&cn.isTypedArray,hn=dn?an(dn):nn;const pn=hn;var vn=Object.prototype,fn=vn.hasOwnProperty;function mn(e,t){var n=pe(e),i=!n&&xt(e),a=!n&&!i&&Ft(e),r=!n&&!i&&!a&&pn(e),o=n||i||a||r,l=o?ft(e.length,String):[],u=l.length;for(var s in e)(t||fn.call(e,s))&&(!o||!("length"==s||a&&("offset"==s||"parent"==s)||r&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Je(s,u)))&&l.push(s);return l}function gn(e,t){return function(n){return e(t(n))}}var kn=gn(Object.keys,Object);const wn=kn;var bn=Object.prototype,yn=bn.hasOwnProperty;function xn(e){if(!vt(e))return wn(e);var t=[];for(var n in Object(e))yn.call(e,n)&&"constructor"!=n&&t.push(n);return t}function An(e){return ct(e)?mn(e):xn(e)}var Cn=Object.prototype,In=Cn.hasOwnProperty;ht((function(e,t){if(vt(t)||ct(t))at(t,An(t),e);else for(var n in t)In.call(t,n)&&it(e,n,t[n])}));function _n(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}var En=Object.prototype,Rn=En.hasOwnProperty;function Ln(e){if(!ve(e))return _n(e);var t=vt(e),n=[];for(var i in e)"constructor"==i&&(t||!Rn.call(e,i))||n.push(i);return n}function Fn(e){return ct(e)?mn(e,!0):Ln(e)}Math.max,Math.min;var Tn=Object.prototype,Sn=Tn.hasOwnProperty;lt((function(e,t){e=Object(e);var n=-1,i=t.length,a=i>2?t[2]:void 0;for(a&&dt(t[0],t[1],a)&&(i=1);++n<i;)for(var r=t[n],o=Fn(r),l=-1,u=o.length;++l<u;){var s=o[l],c=e[s];(void 0===c||et(c,Tn[s])&&!Sn.call(e,s))&&(e[s]=r[s])}return e}));const Xn=(0,l.pM)({name:"Viewer",props:{images:{type:Array,default:()=>[]},rebuild:{type:Boolean,default:!1},trigger:{type:Object,default:null},options:{type:Object,default:()=>null}},emits:["inited"],setup(e,{emit:t}){let n;const i=(0,s.KR)();function a(){n=new V(i.value,e.options),t("inited",n)}function r(){n&&n.destroy()}function o(){r(),a()}function u(){n?(n.update(),t("inited",n)):a()}function c(){e.rebuild?o():u()}const d={deep:!0};return(0,l.wB)((()=>e.images),(()=>{(0,l.dY)((()=>{c()}))}),d),(0,l.wB)((()=>e.trigger),(()=>{(0,l.dY)((()=>{c()}))}),d),(0,l.wB)((()=>e.options),(()=>{(0,l.dY)((()=>{o()}))}),d),(0,l.sV)((()=>a())),(0,l.hi)((()=>r())),{root:i,createViewer:a,rebuildViewer:o,updateViewer:u,destroyViewer:r}}}),qn=(e,t)=>{const n=e.__vccOpts||e;for(const[i,a]of t)n[i]=a;return n},Dn={ref:"root"};function Nn(e,t,n,i,a,r){return(0,l.uX)(),(0,l.CE)("div",Dn,[(0,l.RG)(e.$slots,"default",{images:e.images,options:e.options})],512)}const On=qn(Xn,[["render",Nn]]);var Wn=n(91563),jn=n(52379),Kn={key:0,class:"chat-message-divider"},zn={class:"chat-message-header"},Bn=["src"],Pn={class:"chat-message-body"},Mn={key:0,class:"this-knowledge this-qaknowledge"},Vn={key:0,class:"this-doc"},Hn={key:1,class:"this-knowledge"},Yn={key:2,class:"images"},Un=["src"],Qn={key:3,class:"this-docs"},$n={key:0,class:"doc-knowledge"},Gn=["onClick"],Jn={key:2,class:"q-text"},Zn={key:1,class:"q-text"},ei={key:0,class:"chat-message-knowledge"},ti={key:0,class:"chat-message-footer"},ni={class:"chat-message-footer-right"},ii={class:"chat-message-footer-rightr"},ai=["onClick"],ri={class:"dialog-footer"},oi="The document has been unpublished or deleted",li=(0,l.pM)({__name:"KnowledgeMessage",props:{id:{},createdAt:{},text:{},owner:{},error:{type:Boolean},loading:{type:Boolean},like:{type:Boolean},unlike:{type:Boolean},feedback:{type:Boolean},usedQA:{type:Boolean},topk:{},docId:{},docName:{},knowledgeId:{},knowledgeName:{},items:{},knowledges:{},know:{},knowList:{},status:{},continueNumber:{},preConversationId:{}},emits:["handleChun","knowledgeThis","regenerate","delete","like","unlike","feedback","continue"],setup:function(e,t){var n=t.emit,i=(0,p.s9)(),c=i.t,d=(0,h.Pj)(),v=e,m=n,k=(0,s.KR)("me"===v.owner),w=(0,s.KR)(null),b=(0,s.KR)(!1),x=(0,s.KR)(c("page.qa.message.feedback")),A=(0,s.KR)(c("page.qa.message.feedbackList").split(",")),I=(0,s.KR)(null),R=(0,s.Kh)({value:""}),L=(0,s.KR)(-1),F=(0,s.KR)(-1),T=(0,l.EW)((function(){return d.state.global.canFeedback})),S={knowledgeId:"",knowledgeName:"uncertain",disabled:!1},X=(0,s.Kh)({value:[{required:!0,message:c("page.qa.message.feedbackPlaceholder"),trigger:"blur"}]}),q=(0,l.EW)((function(){for(var e,t=[],n=N.value.map((function(e){return W.value[e-1]||null})),i=function(){var e;if(!n[a])return 0;var i=null===(e=n[a].text)||void 0===e?void 0:e.match(/(!\[.*?\]\(.*\))/g);if(i){var r=(0,M.A)(new Set(i)),o=parseInt(n[a].doc_id,10)||0,l=n[a].doc_id;if(o){var u=r.map((function(e){return"/api/v1/profile/upload/docs/"+o+"/"+l+"/"+e.replaceAll(/!|\[.*?\]|\(|\)/g,"")}));t.push.apply(t,(0,M.A)(u))}if(t.length>=4)return 1}},a=0;a<n.length;a++)if(e=i(),0!==e&&1===e)break;return t.slice(0,4)})),D=(0,l.EW)((function(){var e,t,n=null===(e=v.text)||void 0===e?void 0:e.match(/(\[)ref_\d+(\])/g);if(n)return(0,M.A)(new Set(n));var i=null===(t=v.text)||void 0===t?void 0:t.match(/chunk id \d+/g);return i?(0,M.A)(new Set(i)):[]})),N=(0,l.EW)((function(){var e=D.value.map((function(e){return Number(e.replaceAll(/[^0-9]/gi,""))}));return!v.usedQA||e.length?e:[1]})),O=(0,l.EW)((function(){return v.usedQA&&W.value.length>0?W.value[0]:{}})),W=(0,l.EW)((function(){try{if(v.topk)return Object.values(JSON.parse(v.topk))}catch(e){console.error(e)}return[]})),j=((0,l.EW)((function(){try{if(v.items)return JSON.parse(v.items)}catch(e){console.error(e)}return[]})),(0,l.EW)((function(){if(0===W.value.length)return[];for(var e=N.value.map((function(e){return W.value[e-1]||null})),t={},n=1,i=0;i<N.value.length;i++){var r;if(e[i]){e[i].doc_id=e[i].doc_id||(null===(r=e[i].id)||void 0===r?void 0:r.split("_")[0]);var o=e[i].doc_id,l=e[i].knowledge_base,u=!!e[i].text;t[o]?(t[o].knowledge_base=t[o].knowledge_base.includes(l)?t[o].knowledge_base:t[o].knowledge_base+"/"+l,t[o].ref=t[o].ref+N.value[i]+"|",t[o].chunks.push({index:n,chunk_id:e[i].chunk_id,text:e[i].text}),t[o].enable=u):(t[o]=(0,a.A)((0,a.A)({},e[i]),{},{chunks:[{index:n,chunk_id:e[i].chunk_id,text:e[i].text}],ref:N.value[i]+"|"}),t[o].knowledge_base=l||"",t[o].enable=u),n++}}return Object.values(t)}))),K=(0,l.EW)((function(){var e,t=(null===(e=v.text)||void 0===e?void 0:e.replace(/<br\/>|<br>/g,"\n"))||"";t=t.replaceAll("\\boxed","");for(var n=0;n<j.value.length;n++)for(var i=j.value[n].chunks,a=j.value[n].ref.split("|"),r=(j.value[n].knowledge_base||"")+": "+(j.value[n].doc_name||""),o=0;o<i.length;o++){var l=i[o].index,u=j.value[n].enable;t=u?t.replaceAll("[ref_".concat(a[o],"]"),'<span class="el-index" data-title="'.concat(r,'" data-id="').concat(n,'" data-index-id="').concat(o,'">[ ').concat(l," ]</span>")):t.replaceAll("[ref_".concat(a[o],"]"),'<span class="ql-text">[ '.concat(l," ]</span>"))}return 2===v.status?t+='<span class="stop">'.concat(c("page.qa.main.stopText"),"</span>"):5===v.status&&Number(v.continueNumber||0)<3?t+='<a class="limit">'.concat(c("page.qa.main.limitText"),"</a>"):6===v.status&&(t=c("page.qa.message.error")),t.replace(/\[ref_\d+\]/g,"")||c("page.qa.answer.error")})),z=(0,l.EW)((function(){var e,t=null===(e=v.text)||void 0===e?void 0:e.replace(/<br\/>|<br>/g,"\n");return t.replace(/\[ref_\d+\]/g,"")||c("page.qa.answer.error")})),B=(0,l.EW)((function(){return v.like})),P=(0,l.EW)((function(){return v.unlike})),V=(0,l.EW)((function(){return v.feedback})),H=(0,l.EW)((function(){return!1})),Y=(0,l.EW)((function(){if(null!==v&&void 0!==v&&v.knowledgeName&&(null===v||void 0===v?void 0:v.knowledgeName.length)>0){var e=v.knowledgeName.split(",").filter((function(e){return e}));return e}return[]})),U=(0,l.EW)((function(){if(null!==v&&void 0!==v&&v.knowledges&&v.knowledges.length>0){var e=[];try{e=JSON.parse(v.knowledges)}catch(t){console.error(t)}if(e.length>0)return e.map((function(e){var t;return""===e.knowledge_id?S:{knowledgeId:e.knowledge_id,knowledgeName:e.knowledge_name,disabled:null===(t=v.knowList)||void 0===t||!t.find((function(t){return t.knowledgeId===e.knowledge_id}))}})).filter((function(e){return""!==e.knowledgeId}))}return j.value.length>0||Q.value||Y.value.length?[]:[S]})),Q=(0,l.EW)((function(){return v.docName})),$=function(){var e=(0,o.A)((0,r.A)().mark((function e(t,n){var i,a,o,l,u,s;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.doc_id){e.next=26;break}if(e.prev=1,!v.knowledgeId){e.next=17;break}if(i=Z(t),i){e.next=7;break}return f.nk.error("This document is not available in the knowledge base."),e.abrupt("return");case 7:return e.next=9,(0,_.fb)({id:i});case 9:if(a=e.sent,!a||200!==~~a.code){e.next=17;break}if(l=null===(o=a.data)||void 0===o?void 0:o.knowledgeDocuments,u=!1,l&&l.length>0&&l.forEach((function(e){e.documentId===t.doc_id&&(u=!0)})),u){e.next=17;break}return f.nk.error("This document is not available in the knowledge base."),e.abrupt("return");case 17:return e.next=19,(0,_.P)(t.doc_id);case 19:s=e.sent,s&&200!==~~s.code?f.nk.error(oi):s&&s.data&&d.commit("pk_knowledge/changeUrlState",{docId:t.doc_id,docName:t.doc_name,knowledgeId:Z(t),openPreview:!0,url:s.data.sourceFile,sourceFile:s.data.sourceFile,chunkFile:s.data.chunkFile}),e.next=26;break;case 23:e.prev=23,e.t0=e["catch"](1),console.log(e.t0);case 26:L.value=~~n;case 27:case"end":return e.stop()}}),e,null,[[1,23]])})));return function(t,n){return e.apply(this,arguments)}}(),G=function(){var e=(0,o.A)((0,r.A)().mark((function e(t,n){var i,a,o,l,u,s,c,h;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=j.value[t],a=i.chunks[n],!i.doc_id){e.next=22;break}if(!v.knowledgeId){e.next=18;break}if(o=Z(i),o){e.next=8;break}return f.nk.error("This document is not available in the knowledge base."),e.abrupt("return");case 8:return e.next=10,(0,_.fb)({id:o});case 10:if(l=e.sent,!l||200!==~~l.code){e.next=18;break}if(s=null===(u=l.data)||void 0===u?void 0:u.knowledgeDocuments,c=!1,s&&s.length>0&&s.forEach((function(e){e.documentId===i.doc_id&&(c=!0)})),c){e.next=18;break}return f.nk.error("This document is not available in the knowledge base."),e.abrupt("return");case 18:return e.next=20,(0,_.P)(i.doc_id);case 20:h=e.sent,h&&200!==~~h.code?f.nk.error(oi):h&&h.data&&(d.commit("pk_knowledge/changeUrlState",{docId:i.doc_id,docName:i.doc_name,chunkId:a.chunk_id,knowledgeId:Z(i),openPreview:!0,url:h.data.sourceFile,sourceFile:h.data.sourceFile,chunkFile:h.data.chunkFile}),i.chunk_id=a.chunk_id,i.text=a.text,m("handleChun",i));case 22:L.value=~~t,F.value=~~n;case 24:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),J=function(){var e=(0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:m("continue");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Z=function(e){var t,n,i=null===(t=v.knowledgeName)||void 0===t?void 0:t.split(","),a=null===(n=v.knowledgeId)||void 0===n?void 0:n.split(","),r=e.knowledge_base.split("/")[0],o=null===i||void 0===i?void 0:i.findIndex((function(e){return e===r}));if(void 0!==o&&-1!==o)return a&&a[o]},ee=function(){var e=(0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!v.id||v.like){e.next=5;break}return e.next=3,(0,_.HL)({id:v.id,score:1});case 3:m("like",v.id),f.nk.success(c("page.qa.main.likeSuccess"));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=(0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!v.id||v.unlike){e.next=5;break}return e.next=3,(0,_.Sn)({id:v.id,score:2});case 3:m("unlike",v.id),f.nk.success(c("page.qa.main.globalSuccess"));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=(0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:v.id&&!v.feedback&&(b.value=!0),R.value="";case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var t,n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,n=null===(t=I.value)||void 0===t?void 0:t.validate(),n){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,(0,_.H9)({id:v.id,comment:R.value});case 6:m("feedback",v.id||0,R.value),f.nk.success(c("page.qa.main.submitSuccess")),b.value=!1,e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](0),b.value=!1,console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),ae=function(e){R.value=e},re=function(e){switch(e){case"clipboard":ue();break;case"delete":m("delete");break;case"asText":k.value=!k.value;break}},oe=function(e){console.log(e),m("knowledgeThis",e,v.id)},le=function(){var e;null===(e=w.value)||void 0===e||e.scrollIntoView(),m("regenerate")},ue=function(){var e=(0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,jn.L)(z.value||"");case 3:f.nk.success(c("page.qa.main.copySuccess")),e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),f.nk.error(c("page.qa.main.copyError"));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}();return(0,l.sV)((0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))),(0,l.wB)((function(){return v.docId}),(0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))),function(e,t){var n,i=(0,l.g2)("el-divider"),a=(0,l.g2)("el-tag"),r=(0,l.g2)("el-form-item"),o=(0,l.g2)("el-input"),d=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)(l.FK,null,["me"===v.owner&&-1===e.preConversationId?((0,l.uX)(),(0,l.CE)("div",Kn,[(0,l.bF)(i,{"content-position":"center"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)((0,s.R1)(c)("page.qa.main.divider")),1)]})),_:1})])):(0,l.Q3)("",!0),(0,l.Lk)("div",{class:(0,u.C4)(["chat-message","me"===e.owner?"reverse":""])},[(0,l.Lk)("div",zn,[(0,l.Lk)("img",{src:"me"===v.owner?"/images/GroupQ.png":"/images/GroupA.png",width:"40",height:"40"},null,8,Bn)]),(0,l.Lk)("div",Pn,[(0,l.Lk)("div",{class:(0,u.C4)(["chat-message-body-text","me"!==e.owner?"chat-message-body-pytext":""])},[0===Y.value.length&&O.value.knowledge_base&&v.usedQA?((0,l.uX)(),(0,l.CE)("div",Mn,[(0,l.bF)(a,{type:"primary"},{default:(0,l.k6)((function(){return[(0,l.bF)((0,s.R1)(y.A),{type:"pk-knowQA",class:"qa-icon"}),(0,l.eW)((0,u.v_)(O.value.knowledge_base),1)]})),_:1})])):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[Q.value&&e.docId&&"me"!==e.owner?((0,l.uX)(),(0,l.CE)("div",Vn,[(0,l.bF)(a,{type:"primary"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)(e.docName),1)]})),_:1})])):Y.value.length&&e.id&&"me"!==e.owner?((0,l.uX)(),(0,l.CE)("div",Hn,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Y.value,(function(e){return(0,l.uX)(),(0,l.Wv)(a,{type:"primary",key:e},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)(e),1)]})),_:2},1024)})),128))])):(0,l.Q3)("",!0)],64)),(0,l.bF)(Wn.A,{ref:"textRef",owner:e.owner,error:e.error,text:K.value,loading:e.loading,"as-raw-text":k.value,UUID:e.id,activeIndex:L.value,activeId:F.value,onHandleChunk:G,onHandleLimit:J},null,8,["owner","error","text","loading","as-raw-text","UUID","activeIndex","activeId"]),"me"!==e.owner&&q.value.length?((0,l.uX)(),(0,l.CE)("div",Yn,[(0,l.bF)((0,s.R1)(On),{images:q.value},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(q.value,(function(e){return(0,l.uX)(),(0,l.CE)("img",{key:e,src:e},null,8,Un)})),128))]})),_:1},8,["images"])])):(0,l.Q3)("",!0),(U.value&&0===U.value.length||Q.value)&&j.value.length>0?((0,l.uX)(),(0,l.CE)("div",Qn,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(j.value,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{class:"docs-list",key:t},[!Q.value||Q.value&&v.usedQA?((0,l.uX)(),(0,l.CE)("div",{key:0,class:(0,u.C4)(["doc-refer",{active:L.value===t}])},[e.knowledge_base?((0,l.uX)(),(0,l.CE)("div",$n,(0,u.v_)(e.knowledge_base),1)):(0,l.Q3)("",!0),e.enable?((0,l.uX)(),(0,l.CE)("a",{key:1,href:"javascript:;",onClick:function(n){return $(e,t)},class:"name"},[(0,l.bF)((0,s.R1)(E.A),{content:e.doc_name,placement:"top-start"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)(e.doc_name),1)]})),_:2},1032,["content"])],8,Gn)):((0,l.uX)(),(0,l.CE)("span",Jn,[(0,l.bF)((0,s.R1)(E.A),{content:e.doc_name,placement:"top-start"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)(e.doc_name),1)]})),_:2},1032,["content"])]))],2)):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.chunks,(function(n,i){return(0,l.uX)(),(0,l.CE)(l.FK,{key:n.chunk_id},[e.enable?((0,l.uX)(),(0,l.Wv)(a,{key:0,class:(0,u.C4)(["chunk-index",{active:F.value===i&&L.value===t}]),type:"primary",onClick:function(e){return G(t,i)}},{default:(0,l.k6)((function(){return[(0,l.eW)("[ "+(0,u.v_)(n.index)+" ]",1)]})),_:2},1032,["class","onClick"])):((0,l.uX)(),(0,l.CE)("span",Zn,"[ "+(0,u.v_)(n.index)+" ]",1))],64)})),128))])})),128))])):(0,l.Q3)("",!0),v.usedQA?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)(l.FK,{key:4},[Y.value.length||"me"===e.owner?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",ei,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(U.value,(function(t,n){var i;return(0,l.uX)(),(0,l.CE)("div",{class:"knowledge-list",key:n},[""!==t.knowledgeId?((0,l.uX)(),(0,l.Wv)((0,s.R1)(C.S2),{key:0,type:t.knowledgeId===(null===(i=e.know)||void 0===i?void 0:i.id)?"primary":"default",disabled:t.disabled,onClick:function(e){return oe(t)}},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)(t.knowledgeName),1)]})),_:2},1032,["type","disabled","onClick"])):(0,l.Q3)("",!0)])})),128))]))],64))],2),e.id?((0,l.uX)(),(0,l.CE)("div",ti,["me"===v.owner||""===(null===(n=U.value[0])||void 0===n?void 0:n.knowledgeId)||"All"===e.knowledgeId?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[],64)):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[T.value?((0,l.uX)(),(0,l.Wv)((0,s.R1)(C.S2),{key:0,type:"text",onClick:ee},{default:(0,l.k6)((function(){return[B.value?((0,l.uX)(),(0,l.Wv)((0,s.R1)(y.A),{key:1,type:"pk-liked",class:"wh18 hover"})):((0,l.uX)(),(0,l.Wv)((0,s.R1)(y.A),{key:0,type:"pk-like",class:"wh18 hover"}))]})),_:1})):(0,l.Q3)("",!0),T.value?((0,l.uX)(),(0,l.Wv)((0,s.R1)(C.S2),{key:1,type:"text",onClick:te},{default:(0,l.k6)((function(){return[P.value?((0,l.uX)(),(0,l.Wv)((0,s.R1)(y.A),{key:1,type:"pk-unliked",class:"wh18 hover"})):((0,l.uX)(),(0,l.Wv)((0,s.R1)(y.A),{key:0,type:"pk-unlike",class:"wh18 hover"}))]})),_:1})):(0,l.Q3)("",!0),T.value&&!V.value?((0,l.uX)(),(0,l.Wv)((0,s.R1)(C.S2),{key:2,type:"text",onClick:ne},{default:(0,l.k6)((function(){return[(0,l.bF)((0,s.R1)(y.A),{type:"pk-feedback",class:"wh18 hover"})]})),_:1})):(0,l.Q3)("",!0),(0,l.bF)((0,s.R1)(C.S2),{type:"text",onClick:t[0]||(t[0]=function(e){return re("clipboard")})},{default:(0,l.k6)((function(){return[H.value?((0,l.uX)(),(0,l.Wv)((0,s.R1)(y.A),{key:1,type:"pk-copied",class:"wh18 hover"})):((0,l.uX)(),(0,l.Wv)((0,s.R1)(y.A),{key:0,type:"pk-copy",class:"wh18 hover"}))]})),_:1}),(0,l.Lk)("div",ni,[(0,l.Lk)("div",ii,[(0,l.bF)((0,s.R1)(C.S2),{type:"text",onClick:le},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)((0,s.R1)(c)("page.qa.message.regenerate")),1)]})),_:1})])])],64))])):(0,l.Q3)("",!0)]),(0,l.bF)(d,{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=function(e){return b.value=e}),title:x.value,width:"25rem"},{footer:(0,l.k6)((function(){return[(0,l.Lk)("div",ri,[(0,l.bF)((0,s.R1)(C.S2),{onClick:t[2]||(t[2]=function(e){return b.value=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)((0,s.R1)(c)("page.qa.main.cancelButton")),1)]})),_:1}),(0,l.bF)((0,s.R1)(C.S2),{type:"primary",onClick:ie},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)((0,s.R1)(c)("page.qa.main.submitButton")),1)]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)((0,s.R1)(g.US),{model:R,rules:X,ref_key:"feedbackRef",ref:I},{default:(0,l.k6)((function(){return[(0,l.bF)(r,null,{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(A.value,(function(e){return(0,l.uX)(),(0,l.CE)("span",{class:"span",key:e,onClick:function(t){return ae(e)}},(0,u.v_)(e),9,ai)})),128))]})),_:1}),(0,l.bF)(r,{label:"",props:"value"},{default:(0,l.k6)((function(){return[(0,l.bF)(o,{modelValue:R.value,"onUpdate:modelValue":t[1]||(t[1]=function(e){return R.value=e}),type:"textarea",autosize:{minRows:4,maxRows:4}},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue","title"])],2)],64)}}});const ui=(0,z.A)(li,[["__scopeId","data-v-503cfe52"]]);var si=ui,ci=n(50239),di=n(52582),hi=n(70579),pi=n(76412),vi=n(51832),fi=n(85158),mi=n(81329),gi=n(26497),ki=n(49302),wi=function(e){return(0,l.Qi)("data-v-5fc03f1e"),e=e(),(0,l.jt)(),e},bi={class:"main"},yi={class:"left-chat"},xi={class:"qa"},Ai={class:"qa-header"},Ci={class:"qa-header-title"},Ii={class:"qa-main"},_i={class:"qa-main-create"},Ei={class:"qa-main-list"},Ri={key:0,class:"main-chat-preview"},Li={class:"know-docs-header-title"},Fi={class:"know-docs-header-button"},Ti={class:"know-docs-header-close"},Si={id:"scrollRef",ref:"scrollRef",class:"main-chat"},Xi={class:"main-chat-no-knowledge"},qi={class:"main-chat-no-knowledgeLeft"},Di={class:"main-chat-no-knowledgeRight",style:{gap:"16px"}},Ni={key:0,class:"main-chat-content"},Oi={class:"main-chat-no-knowledge"},Wi=wi((function(){return(0,l.Lk)("div",{class:"main-chat-no-knowledgeLeft"},[(0,l.Lk)("img",{src:"/images/GroupA.png",width:"40",height:"40"})],-1)})),ji={class:"main-chat-no-knowledgeRight"},Ki={class:"main-chat-no-knowledgeTitle"},zi=["innerHTML"],Bi={class:"main-chat-no-knowledgeHint"},Pi={class:"main-chat-no-knowledgeButton"},Mi=wi((function(){return(0,l.Lk)("img",{src:"/images/pk-noknowledge.png",width:"36",height:"36",class:"icon-svg"},null,-1)})),Vi={key:1,class:"main-chat-content"},Hi={class:"main-chat-grow"},Yi={key:0,class:"main-chat-home-knowledge"},Ui=wi((function(){return(0,l.Lk)("div",{class:"main-chat-home-knowledgeLeft"},[(0,l.Lk)("img",{src:"/images/GroupA.png",width:"40",height:"40"})],-1)})),Qi={class:"main-chat-home-knowledgeRight"},$i={class:"main-chat-home-knowledgeTitle"},Gi=["innerHTML"],Ji={class:"main-chat-home-knowledgeHint"},Zi={class:"main-chat-home-knowledgeButton"},ea=["onClick"],ta={class:"flex"},na=wi((function(){return(0,l.Lk)("img",{src:"/images/pk-knowledgeen.png",width:"20",height:"20"},null,-1)})),ia=wi((function(){return(0,l.Lk)("div",{class:"split"},null,-1)})),aa={key:0,class:"main-chat-home-knowledgeUncertain"},ra=wi((function(){return(0,l.Lk)("img",{src:"/images/pk-knowledgeno.png",width:"20",height:"20"},null,-1)})),oa={key:1,id:"chatMessage",class:"main-chat-message"},la={key:0},ua={class:"main-chat-footer mt-24"},sa={class:"main-chat-footer-op"},ca={class:"main-chat-footer-opNormal"},da={class:"normal-datah1"},ha=["onClick"],pa={class:"normal-data-item-operation"},va=["onClick"],fa=["onClick"],ma={class:"normal-data-item addplus"},ga={class:"main-chat-footer-operation"},ka={class:"el-dropdown-link"},wa={class:"main-chat-footer-operation shrink-rudius"},ba={class:"main-chat-footer-operation knowledge"},ya={key:0,class:"docu"},xa={class:"docu-name"},Aa={key:1,class:"know"},Ca={class:"paddle"},Ia={class:"card"},_a={class:"title"},Ea={class:"know-list"},Ra={class:"flex"},La={class:"main-chat-footer-input"},Fa={class:"main-chat-footer-button"},Ta={class:"dialog-footer"},Sa={class:"chunk-content"},Xa="pk_knowledge",qa=2,Da=5,Na=(0,l.pM)({__name:"index",setup:function(e){var t=(0,hi.Y)(Xa),n=t.addChat,k=t.updateChat,x=t.updateChatSome,A=t.getChatByUuidAndIndex,C=(0,pi.A)(),I=C.scrollbarRef,L=C.scrollToBottom,F=C.scrollToBottomIfAtBottom,T=(0,vi.A)(),S=T.getLocaleOutputLang,X=new AbortController,q="",D={conversationType:1,knowledgeId:void 0,docId:void 0,preConversationId:null,regenerate:{isRegenerate:!1},knowledgeScope:{basicAbility:1,privateDatabase:1},config:{maxTokens:2048,temperature:.3,topP:.95,stopSequence:"",repetitionPenalty:0,frequencyPenalty:0}},N=(0,d.rd)(),O=(N.currentRoute,(0,h.Pj)()),W=(0,p.s9)(),j=(W.locale,W.t);O.commit("global/setMenuEnable",!0);var K=(0,l.EW)((function(){return O.state.user.currentUser.roleId<=2})),z=(0,s.KR)({title:j("page.knowledge.main.noKnowledgeTitle"),subtitle:j("page.knowledge.main.noKnowledgeDetail"),hint:j("page.knowledge.main.noKnowledgeHint")}),B=(0,l.EW)((function(){return O.state.global.openUncertain})),M=(0,s.KR)(4e3),V=(0,s.KR)(!0),H=((0,s.KR)(!1),(0,s.KR)("")),Y=((0,s.KR)(!1),(0,s.KR)([])),U=(0,s.KR)(!1),Q=(0,s.Kh)({id:0,content:"",scope:qa}),$=(0,s.KR)(),G=(0,s.KR)(!1),J=(0,s.KR)(!1),Z=(0,s.KR)(14),ee=(0,s.KR)(0),te=(0,s.KR)(""),ne=((0,s.KR)(!1),(0,l.EW)((function(){return O.state.pk_knowledge.urlState.openPreview}))),ie=((0,l.EW)((function(){return O.state.pk_knowledge.pdfState.pdfUrl})),(0,l.EW)((function(){return O.state.pk_knowledge.urlState.url||""}))),ae=(0,s.KR)(""),re=(0,s.KR)(""),oe=((0,s.KR)(""),(0,s.KR)("")),le=(0,s.KR)(!1),ue=(0,s.KR)(!1),se=(0,s.KR)(null),ce=(0,s.Kh)({}),de={knowledgeId:"",knowledgeName:"Uncertain"},he=(0,s.Kh)({id:"",name:de.knowledgeName}),pe=(0,s.KR)([]),ve=(0,l.EW)((function(){return O.state.global.multipleOption})),fe=(0,s.KR)([]),me=(0,s.KR)(de),ge=(0,s.KR)(!1),ke=(0,s.KR)("default"),we=(0,s.KR)(S()),be=(0,s.KR)(""),ye=(0,s.KR)(null),xe=(0,s.KR)("prompt"),Ae=(0,l.EW)((function(){return"prompting"===xe.value||!be.value||0===be.value.length})),Ce=(0,l.EW)((function(){var e=O.state.pk_knowledge.active;return e})),Ie=(0,l.EW)((function(){return O.state.pk_knowledge.history})),_e=(0,l.EW)((function(){var e=O.state.pk_knowledge.history.find((function(e){return e.uuid===Ce.value}));return e?e.chats:O.state.pk_knowledge.chats})),Ee=(0,l.EW)((function(){return O.state.pk_knowledge.urlState})),Re=((0,l.EW)((function(){return"".concat("/preview/pdfjs/web/viewer.html","?file=").concat(encodeURIComponent(te.value),"&pagemode=none")})),(0,s.Kh)({content:[{required:!0,message:j("page.qa.normalData.placeholder"),trigger:"blur"}]})),Le=function(e){e.stopPropagation();var t=e.key;t&&"Enter"===t&&console.log("enter")},Fe=function(){var e=(0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,lt();case 2:O.commit("pk_knowledge/addHistory",{uuid:null,title:"New Chat",isEdit:!1,createdAt:(0,mi.pr)(new Date)}),O.commit("pk_knowledge/saveActive",{uuid:null}),O.commit("pk_knowledge/saveHistory",{uuid:null}),bt(),ee.value=-1;case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var t,n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=$.value)||void 0===t?void 0:t.validate();case 3:if(n=e.sent,n){e.next=6;break}return e.abrupt("return");case 6:if(!Q.id){e.next=11;break}return e.next=9,(0,_.v8)(Q);case 9:e.next=14;break;case 11:return Q.id=0,e.next=14,(0,_.p1)(Q);case 14:return e.next=16,Ct();case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](0),console.log(e.t0);case 21:return e.prev=21,U.value=!1,e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[0,18,21,24]])})));return function(){return e.apply(this,arguments)}}(),Se=function(e){be.value=e.content||"",se.value&&se.value.hide(),nt()},Xe=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:Q.id=t.id,Q.content=t.content||"",U.value=!0;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),qe=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:v.s.confirm(j("page.qa.main.deleteHintDetail"),j("page.qa.main.deleteHint"),{confirmButtonText:j("page.qa.main.confirmButton"),cancelButtonText:j("page.qa.main.cancelButton"),type:j("page.qa.main.deleteType")}).then((0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,_.Tf)(t);case 2:return e.next=4,Ct();case 4:case"end":return e.stop()}}),e)})))).catch((function(){}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),De=function(){Q.id=0,Q.content="",U.value=!0},Ne=function(e){var t=e.event.target,n=t.responseText,i=n.trimEnd().split("\n"),a={},r="",o=!1;try{var l=i.length;if(l<=2&&null===Ce.value){try{var u=JSON.parse(i[0]);u.scope&&Pe(u)}catch(d){console.error(d)}return}if(l>0){r="";for(var s=0;s<l;s++){var c=i[s];if(a=JSON.parse(c),a.stopId)q=a.stopId;else{if("conversationId"in a){a.conversationId,o=!1;break}a.answer&&(r+=a.answer),"sensitive"===a.finish_reason&&(r+=j("page.qa.message.error"))}}r&&(x(Ce.value,_e.value.length-1,{createdAt:(0,mi.pr)(new Date),text:r,owner:"llm",error:!1,loading:o}),Oe=r),F()}}catch(h){console.log(h)}},Oe="",We=0,je=function(e){var t=e.event.target,n=t.responseText,i=n.trimEnd().split("\n"),a={},r=Oe,o=!1;try{var l=i.length;if(l>0){for(var u=0;u<l;u++){var s=i[u];if(a=JSON.parse(s),a.stopId)q=a.stopId;else{if("conversationId"in a){a.conversationId,o=!1;break}a.answer&&(r+=a.answer),"sensitive"===a.finish_reason&&(r+=j("page.qa.message.error"))}}r&&x(Ce.value,We,{text:r,owner:"llm",error:!1,loading:o})}}catch(c){console.log(c)}},Ke=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){var n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=_e.value.findIndex((function(e){return e.id===t})),-1!==n&&x(Ce.value,n,{like:!0,unlike:!1});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ze=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){var n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=_e.value.findIndex((function(e){return e.id===t})),-1!==n&&x(Ce.value,n,{like:!1,unlike:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Be=function(){var e=(0,o.A)((0,r.A)().mark((function e(t,n){var i;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=_e.value.findIndex((function(e){return e.id===t})),-1!==i&&x(Ce.value,i,{feedback:n});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Pe=function(e){O.commit("pk_knowledge/updateHistory",{type:"updateId",uuid:Ce.value,id:e.id,name:e.name}),O.commit("pk_knowledge/saveActive",{uuid:e.id}),Ve=e.id},Me=function(e,t,n){var i=JSON.parse(e.pop()),a=i.id,r=i.docId,o=i.docName,l=i.knowledgeId,u=i.knowledgeName,s=i.items,c=i.knowledges,d=i.conversationId,h=i.usedQA,p=i.topk,v=i.chatStatus,f=i.continueNumber;if(Ve===Ce.value){O.commit("pk_knowledge/saveHistory",{uuid:Ce.value});var m=d;ee.value=d,x(Ce.value,n,{id:a,prompt:t,conversation:m,usedQA:h,docId:r,docName:o,knowledgeId:l,knowledgeName:u,items:s,knowledges:c,topk:p,status:v,continueNumber:f,loading:!1})}},Ve=null,He=function(){var e=(0,o.A)((0,r.A)().mark((function e(t,n,i,o){var l,u,s,c,d;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return Ve=Ce.value,u={knowledgeId:t.knowledgeId},t.docId?(u.conversationType=1,u.docId=t.docId,u.knowledgeId=(0,gi.QV)(t.knowledgeId)):(null===t||void 0===t||null===(l=t.knowledgeId)||void 0===l?void 0:l.length)>10?u.conversationType=2:u.conversationType=3,Oe=t.text,We=i,e.next=7,(0,_.C$)((0,a.A)((0,a.A)((0,a.A)((0,a.A)({},D),u),{},{sessionId:Ce.value,lang:ke.value||"zh-cn",query:n},o),{},{prompt:""}),X.signal,je);case 7:s=e.sent,s&&"string"===typeof s&&(d=s.trimEnd().split("\n"),Me(d,t.prompt,We),null===(c=ye.value)||void 0===c||c.focus());case 9:case"end":return e.stop()}}),e)})));return function(t,n,i,a){return e.apply(this,arguments)}}(),Ye=function(){var e=(0,o.A)((0,r.A)().mark((function e(t,n,i,o){var l,u,s,c,d;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return Ve=Ce.value,l={knowledgeId:he.id},ce.id?(l.conversationType=1,l.docId=ce.id,l.knowledgeId=(0,gi.QV)(ce.knowledgeId)):""===he.id?l.conversationType=3:l.conversationType=2,e.next=5,(0,_.C$)((0,a.A)((0,a.A)((0,a.A)((0,a.A)({},D),l),{},{sessionId:Ce.value,lang:ke.value||"zh-cn",query:n},o),{},{prompt:""}),X.signal,Ne);case 5:if(u=e.sent,!u||"string"!==typeof u){e.next=15;break}return s=u.trimEnd().split("\n"),null===Ce.value&&s.length>0&&(c=JSON.parse(s[0]),c.scope&&Pe(c)),d=o.prompt||n,Me(s,d,_e.value.length-1),Ce.value&&(0,_.aQ)({id:Ce.value}),F(),setTimeout((function(){var e;L(),null===(e=ye.value)||void 0===e||e.focus()}),400),e.abrupt("return");case 15:x(Ce.value,i,{loading:!1});case 16:case"end":return e.stop()}}),e)})));return function(t,n,i,a){return e.apply(this,arguments)}}(),Ue=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var t,i,o,l,u,s,c,d,h,p=arguments;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=p.length>0&&void 0!==p[0]&&p[0],i=p.length>1&&void 0!==p[1]?p[1]:null,o=be.value,t&&(o=null!==(l=null===i||void 0===i?void 0:i.prompt)&&void 0!==l?l:"",o=o||(null===i||void 0===i||null===(u=i.options)||void 0===u?void 0:u.prompt)),[],o&&0!==o.length){e.next=7;break}return e.abrupt("return");case 7:if("prompting"!==xe.value){e.next=9;break}return e.abrupt("return");case 9:return s={},s.preConversationId=null,c=i||_e.value[_e.value.length-1],c&&(s.preConversationId=-1===ee.value||c.knowledgeId===he.id&&ee.value>=0?ee.value:null),n(Ce.value,{id:0,createdAt:(0,mi.pr)(new Date),text:o,owner:"me",error:!1,conversation:null,conversationId:0,preConversationId:ee.value,options:{prompt:o,options:null}}),L(),xe.value="prompting",be.value="",{},n(Ce.value,{id:0,createdAt:(0,mi.pr)(new Date),text:j("page.qa.main.llm.hint"),loading:!0,owner:"llm",error:!1,conversation:null,conversationId:0,preConversationId:ee.value,options:{prompt:o,options:s}}),ee.value=0,L(),s.onContinue=!1,X=new AbortController,t&&(s=(0,a.A)((0,a.A)({},s),{},{regenerate:{isRegenerate:!0}})),e.prev=24,Oe="",0,e.next=29,Ye(Oe,o,_e.value.length-1,s);case 29:e.next=44;break;case 31:if(e.prev=31,e.t0=e["catch"](24),d=null===e.t0||void 0===e.t0?void 0:e.t0.message,"canceled"!==d){e.next=38;break}return x(Ce.value,_e.value.length-1,{loading:!1}),F(),e.abrupt("return");case 38:if(h=A(Ce.value,_e.value.length-1),!(null!==h&&void 0!==h&&h.text&&h.text.length>0)){e.next=42;break}return x(Ce.value,_e.value.length-1,{text:h.text+"\n\n"+d,error:!0,loading:!1}),e.abrupt("return");case 42:k(Ce.value,_e.value.length-1,{createdAt:(0,mi.pr)(new Date),text:d,owner:"llm",error:!0,loading:!1,conversation:null,options:{prompt:o,options:s}}),F();case 44:return e.prev=44,xe.value="prompt",e.finish(44);case 47:case"end":return e.stop()}}),e,null,[[24,31,44,47]])})));return function(){return e.apply(this,arguments)}}(),Qe=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){var n,i,o,l,u,s,c;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("prompting"!==xe.value){e.next=2;break}return e.abrupt("return");case 2:if(i=_e.value[t],o=null!==(n=null===i||void 0===i?void 0:i.prompt)&&void 0!==n?n:"",l=!0,!l){e.next=8;break}return Ue(!0,i),e.abrupt("return");case 8:return u={},i.options&&(u=(0,a.A)({},i.options)),xe.value="prompting",k(Ce.value,t,{createdAt:(0,mi.pr)(new Date),text:"",owner:"llm",error:!1,loading:!0,conversation:null,options:{prompt:o,options:u}}),e.prev=12,Oe="",e.next=16,Ye(Oe,o,t,u);case 16:e.next=25;break;case 18:if(e.prev=18,e.t0=e["catch"](12),"canceled"!==e.t0.message){e.next=23;break}return x(Ce.value,t,{loading:!1}),e.abrupt("return");case 23:c=null!==(s=null===e.t0||void 0===e.t0?void 0:e.t0.message)&&void 0!==s?s:j("page.qa.error"),k(Ce.value,t,{createdAt:(0,mi.pr)(new Date),text:c,owner:"llm",error:!0,loading:!1,conversation:null,options:{prompt:o,options:u}});case 25:return e.prev=25,xe.value="prompt",e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[12,18,25,28]])})));return function(t){return e.apply(this,arguments)}}(),$e=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){var n,i,a,o,l;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("prompting"!==xe.value){e.next=2;break}return e.abrupt("return");case 2:if(a=_e.value[t],o=null!==(n=null===a||void 0===a?void 0:a.prompt)&&void 0!==n?n:"",o=o||(null===a||void 0===a||null===(i=a.options)||void 0===i?void 0:i.prompt),o&&0!==o.length){e.next=7;break}return e.abrupt("return");case 7:return l=[],l.preConversationId=a.preConversationId,xe.value="prompting",be.value="",k(Ce.value,t,{text:a.text,error:!1,loading:!0,options:{prompt:o,options:a.options}}),X=new AbortController,l.onContinue=!0,l.id=a.id,e.prev=15,e.next=18,He(a,o,t,l);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e["catch"](15),k(Ce.value,t,{loading:!1});case 23:return e.prev=23,xe.value="prompt",e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[15,20,23,26]])})));return function(t){return e.apply(this,arguments)}}(),Ge=function(){K.value?N.push({path:"/organize/knowledge"}):f.nk.warning("Please contact the administrator to create the  knowledge base")},Je=function(){nt(),Ue()},Ze=function(){(0,R.OV)()},et=function(){(0,R.Zr)()},tt=function(e){O.commit("pk_knowledge/deleteChat",e)},nt=function(){setTimeout((function(){return at()}))},it=function(e){if(e.shiftKey&&"Enter"===e.key){e.preventDefault();var t=e.target,n=t.selectionStart,i=t.selectionEnd;be.value=be.value.substring(0,n)+"\n"+be.value.substring(i),setTimeout((function(){t.selectionStart=t.selectionEnd=n+1,at()}))}},at=function(){(0,R.cY)(60),(0,R.bj)(60)},rt=function(){Je()},ot=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){var n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.uuid,"prompting"!==xe.value){e.next=6;break}return xe.value="prompt",e.next=5,(0,_.iO)({sessionId:n,stopId:q});case 5:setTimeout(_t,100);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),lt=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var t;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("prompting"!==xe.value){e.next=6;break}return xe.value="prompt",e.next=4,(0,_.iO)({sessionId:Ce.value,stopId:q});case 4:setTimeout(_t,100),null===(t=ye.value)||void 0===t||t.focus();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ut=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var t,n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=null===(t=Ie.value)||void 0===t?void 0:t.map((function(e){return e.uuid})),!n||0!==n.length){e.next=4;break}return f.nk.error(j("page.qa.main.operation.notEmpty")),e.abrupt("return");case 4:v.s.confirm(j("page.qa.main.operation.clearHintDetail"),j("page.qa.main.operation.clearHint"),{confirmButtonText:j("page.qa.main.confirmButton"),cancelButtonText:j("page.qa.main.cancelButton"),type:"warning"}).then((0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,ot({uuid:Ce.value});case 2:return e.next=4,(0,_.O8)({ids:n.join(","),scope:2});case 4:return ee.value=-1,O.commit("pk_knowledge/clearAll"),f.nk.success(j("page.qa.main.operation.successMessageLogs")),e.next=9,(0,l.dY)();case 9:(0,R.cY)();case 10:case"end":return e.stop()}}),e)})))).catch((function(){}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),st=function(){var e=(0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!==Ce.value){e.next=3;break}return f.nk.error(j("page.qa.main.operation.notEmpty")),e.abrupt("return");case 3:v.s.confirm(j("page.qa.main.operation.deleteLogs"),j("page.qa.main.operation.hint"),{confirmButtonText:j("page.qa.main.confirmButton"),cancelButtonText:j("page.qa.main.cancelButton"),type:j("page.qa.main.deleteType")}).then((0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,_.b5)({id:Ce.value});case 2:return ee.value=-1,O.commit("pk_knowledge/clearChatByUuid",{uuid:Ce.value}),f.nk.success(j("page.qa.main.operation.successMessageLogs")),e.next=7,(0,l.dY)();case 7:(0,R.cY)(60);case 8:case"end":return e.stop()}}),e)})))).catch((function(){}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ct=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:Z.value=t,"number"===typeof t&&(document.documentElement.style.getPropertyValue("--text-preview"),document.documentElement.style.setProperty("--text-preview",t+"px"),f.nk.success(j("page.qa.main.operation.successMessageFont")));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),dt=function(){var e=(0,o.A)((0,r.A)().mark((function e(){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!ue.value){e.next=2;break}return e.abrupt("return");case 2:v.s.confirm(j("page.knowledge.download.hintDetail"),j("page.knowledge.download.hint"),{confirmButtonText:j("page.qa.main.confirmButton"),cancelButtonText:j("page.qa.main.cancelButton"),type:j("page.qa.main.deleteType")}).then((0,o.A)((0,r.A)().mark((function e(){var t,n,i,a;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,ue.value=!0,t=document.getElementById("chatMessage"),e.next=5,w()(t,{useCORS:!0,scrollX:0,scrollY:0,width:716,height:1e3});case 5:n=e.sent,i=n.toDataURL("image/png"),a=document.createElement("a"),a.style.display="none",a.href=i,a.setAttribute("download","chat.png"),"undefined"===typeof a.download&&a.setAttribute("target","_blank"),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(a.href),ue.value=!1,f.nk.success(j("page.qa.main.exportSuccess")),e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](0),ue.value=!1,f.nk.error(j("page.qa.main.exportError"));case 24:case"end":return e.stop()}}),e,null,[[0,20]])})))).catch((function(){ue.value=!1}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ht=function(){},pt=function(){ee.value=-1,L()},vt=function(){ge.value=!ge.value},ft=function(e){if(ve.value){if(e.knowledgeId===de.knowledgeId)pe.value=[],he.id=e.knowledgeId,he.name=e.knowledgeName;else{var t=pe.value.find((function(t){return t.id===e.knowledgeId}));if(t)pe.value=pe.value.filter((function(t){return t.id!==e.knowledgeId}));else{if(pe.value.length>=Da)return void f.nk.warning(j("page.knowledge.multiple.knowLimit",{count:Da}));pe.value.push({id:e.knowledgeId,name:e.knowledgeName})}he.id=pe.value.map((function(e){return e.id})).join(","),he.name=pe.value.map((function(e){return e.name})).join("、")}O.commit("pk_knowledge/storeSelectKnowledges",pe.value)}else he.id=e.knowledgeId,he.name=e.knowledgeName,ge.value=!1,O.commit("pk_knowledge/storeSelectKnowledges",[{id:e.knowledgeId,name:e.knowledgeName,enable:!0}])},mt=(0,l.EW)((function(){return ve.value?0===pe.value.length?B.value?[{id:de.knowledgeId,name:de.knowledgeName}]:[]:pe.value:[(0,a.A)({},he)]})),gt=function(e){if(ve.value){if(e.knowledgeId===de.knowledgeId)return 0===pe.value.length;var t=pe.value.find((function(t){return t.id===e.knowledgeId}));return!!t}return he.id===e.knowledgeId},kt=function(e,t){ve.value&&(pe.value=[{id:e.knowledgeId,name:e.knowledgeName}]),he.id=e.knowledgeId,he.name=e.knowledgeName,O.commit("pk_knowledge/storeSelectKnowledges",[{id:e.knowledgeId,name:e.knowledgeName,enable:!0}]);var n=_e.value.find((function(e){return e.id===t}));n&&Ue(!0,n)},wt=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:ae.value=t.doc_id,oe.value=t.text,re.value=t.text,le.value=!0;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),bt=function(){ce.id="",ce.name="",O.commit("pk_knowledge/changeUrlState",{openPreview:!1,url:"",docId:""})},yt=function(){ce.id=O.state.pk_knowledge.urlState.docId,ce.name=O.state.pk_knowledge.urlState.docName,ce.knowledgeId=O.state.pk_knowledge.urlState.knowledgeId},xt=function(){ce.id=0,ce.name="",ce.knowledgeId=""},At=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var t,n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,_.rL)({scope:2});case 2:t=e.sent,t&&t.data&&t.data.length>0&&(n=t.data.map((function(e){return{uuid:e.id,docId:e.docId,docName:e.docName,title:e.name,isEdit:!1,createdAt:e.updateTime,chats:[]}})),O.commit("pk_knowledge/loadHistory",n));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ct=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var t;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,_.WK)({scope:qa});case 2:t=e.sent,t&&t.data&&t.data.length>=0&&(Y.value=t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),It=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){var n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return G.value=!1,V.value=!0,e.next=4,lt();case 4:return O.commit("pk_knowledge/saveActive",t),G.value=!1,e.next=8,_t("add");case 8:return V.value=!1,Xt(),St(),O.commit("pk_knowledge/changeUrlState",{openPreview:!1,url:"",docId:""}),xt(),e.next=15,(0,l.dY)();case 15:(0,R.cY)(60),L(),null===(n=ye.value)||void 0===n||n.focus();case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_t=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var t,n,a,o,l,u,s,c,d=arguments;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=d.length>0&&void 0!==d[0]?d[0]:"add",null!==Ce.value){e.next=3;break}return e.abrupt("return");case 3:if(!J.value){e.next=5;break}return e.abrupt("return");case 5:return J.value=!0,n="update"===t&&_e.value.length>0?_e.value[0].createdAt:"",e.next=9,(0,_.O7)({sessionId:Ce.value,page:5,createTime:n});case 9:if(a=e.sent,a&&a.data.length>0){o=[],l=(0,i.A)(a.data);try{for(l.s();!(u=l.n()).done;)s=u.value,c=s.knowledges,o.push({createdAt:s.createTime,id:0,text:s.query,owner:"me",error:!1,loading:!1,like:1===s.score,unlike:2===s.score,feedback:s.comment,prompt:"",usedQA:s.usedQA,preConversationId:s.preConversationId}),o.push({createdAt:s.createTime,id:s.id,text:s.answer,owner:"llm",error:!1,loading:!1,like:1===s.score,unlike:2===s.score,feedback:s.comment,prompt:s.query,conversation:s.conversationId,preConversationId:s.preConversationId,usedQA:s.usedQA,topk:s.topk,docId:s.docId,docName:s.docName,knowledgeId:s.knowledgeId,knowledgeName:s.knowledgeName,items:s.items,knowledges:c,status:s.chatStatus,continueNumber:s.continueNumber})}catch(r){l.e(r)}finally{l.f()}"update"===t?O.commit("pk_knowledge/updateChatsByUuid",{uuid:Ce.value,data:o}):(O.commit("pk_knowledge/addChatsByUuid",{uuid:Ce.value,data:o}),ee.value=a.data.length>0?a.data[a.data.length-1].conversationId:0)}a&&a.data.length<5&&(G.value=!0),J.value=!1,L();case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Et=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){var n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,ki.Ju)({scope:4,language:t});case 2:n=e.sent,n&&n.data&&n.data.length>0?(z.value=n.data[0],z.value.hint=z.value.hint||j("page.knowledge.main.noKnowledgeHint")):z.value={title:j("page.knowledge.main.noKnowledgeTitle"),subtitle:j("page.knowledge.main.noKnowledgeDetail"),hint:j("page.knowledge.main.noKnowledgeHint")};case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Rt=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var t,n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=N.currentRoute.value.query,e.next=3,(0,_.YG)();case 3:n=e.sent,n&&n.data&&n.data.map((function(e){if(fe.value.push({knowledgeId:e.knowledgeId,knowledgeName:e.knowledgeName,enable:e.documentCount>0}),O.commit("pk_knowledge/saveKnowledge",fe.value),!he.id&&!B.value&&e.documentCount>0&&(he.id=e.knowledgeId,he.name=e.knowledgeName,he.enable=e.documentCount>0,ve.value&&(pe.value=[],pe.value.push({id:e.knowledgeId,name:e.knowledgeName,enable:e.documentCount>0})),O.commit("pk_knowledge/storeSelectKnowledgs",pe.value)),t&&t.knowledgeId===e.knowledgeId)he.id=e.knowledgeId,he.name=e.knowledgeName,he.enable=e.documentCount>0,ve.value&&(pe.value=[],pe.value.push({id:e.knowledgeId,name:e.knowledgeName,enable:e.documentCount>0}));else if(O.state.pk_knowledge.activeKnowledges.length>0){var n=O.state.pk_knowledge.activeKnowledges.filter((function(e){return fe.value.find((function(t){return t.knowledgeId===e.id}))&&fe.value.find((function(t){return t.knowledgeId===e.id})).enable})).map((function(e){var t;return e.name=null===(t=fe.value.find((function(t){return t.knowledgeId===e.id})))||void 0===t?void 0:t.knowledgeName,e}));n.length>0&&(he.id=n[0].id,he.name=n[0].name,ve.value&&(pe.value=n,he.id=n.map((function(e){return e.id})).join(","),he.name=n.map((function(e){return e.name})).join(",")))}})),console.error(he);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Lt=function(){var e=(0,o.A)((0,r.A)().mark((function e(){var t;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,_.G6)();case 2:t=e.sent,t&&t.data&&t.data.length>0&&(we.value=t.data.map((function(e){return{label:e.dictLabel,value:e.dictValue}})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ft=function e(t){var n=t.target.scrollTop||t.target.scrollingElement.scrollTop||t.target.documentElement.scrollTop;n<=40&&!G.value&&(_t("update"),window.document.removeEventListener("scroll",e))},Tt=function(){var e=(0,o.A)((0,r.A)().mark((function e(t){var n;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.target.scrollTop,t.target.scrollHeight,t.target.clientHeight,!(n<20&&n<20)||G.value){e.next=6;break}return e.next=6,_t("update");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),St=function(){window.document.addEventListener("scroll",Ft),setTimeout((function(){var e;return null===(e=I.value)||void 0===e?void 0:e.wrapRef.addEventListener("scroll",Tt)}),1e3)},Xt=function(){var e;window.document.addEventListener("scroll",Ft),null===(e=I.value)||void 0===e||e.wrapRef.addEventListener("scroll",Tt)},qt=(0,fi.W4)(Et),Dt=qt.defaultLang;(0,l.sV)((0,o.A)((0,r.A)().mark((function e(){var t,n,i,a;return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,At();case 2:return e.next=4,Ct();case 4:if(!Ce.value){e.next=7;break}return e.next=7,_t("add");case 7:return e.next=9,Et(Dt.value);case 9:return e.next=11,Rt();case 11:return e.next=13,Lt();case 13:V.value=!1,St(),L(),(0,R.cY)(60),(0,R.bj)(60),null===(t=ye.value)||void 0===t||t.focus(),n=document.createElement("script"),n.src="/preview/editormd/lib/marked.min.js",document.body.appendChild(n),i=document.createElement("script"),i.src="/preview/editormd/lib/prettify.min.js",document.body.appendChild(i),a=document.createElement("script"),a.src="/preview/editormd/lib/flowchart.min.js",document.body.appendChild(a);case 28:case"end":return e.stop()}}),e)})))),(0,l.hi)((function(){(0,R.fO)(60),Xt(),"prompting"===xe.value&&X.abort(),bt()})),(0,l.wB)((function(){return O.state.pk_knowledge.pdfState.openPreview}),function(){var e=(0,o.A)((0,r.A)().mark((function e(t,n){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t&&console.log(t);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());return(0,l.wB)((function(){return ie.value}),function(){var e=(0,o.A)((0,r.A)().mark((function e(t,n){return(0,r.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(ne.value){e.next=2;break}return e.abrupt("return");case 2:(0,R.cY)(60);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),function(e,t){var n,i=(0,l.g2)("el-input"),a=(0,l.g2)("el-button"),r=(0,l.g2)("el-skeleton-item"),o=(0,l.g2)("el-skeleton"),d=(0,l.g2)("el-divider"),h=(0,l.g2)("ElScrollbar"),p=(0,l.g2)("el-dropdown-item"),v=(0,l.g2)("el-dropdown-menu"),f=(0,l.g2)("el-dropdown"),k=((0,l.g2)("el-option"),(0,l.g2)("el-select"),(0,l.g2)("el-tag")),w=(0,l.g2)("el-form-item"),x=(0,l.g2)("el-dialog"),A=(0,l.g2)("el-scrollbar");return(0,l.uX)(),(0,l.CE)("div",bi,[(0,l.Lk)("div",yi,[(0,l.Lk)("div",xi,[(0,l.Lk)("div",Ai,[(0,l.Lk)("h1",Ci,(0,u.v_)((0,s.R1)(j)("page.knowledge.header.title")),1),(0,l.bF)(i,{modelValue:H.value,"onUpdate:modelValue":t[0]||(t[0]=function(e){return H.value=e}),class:"qa-header-input",placeholder:(0,s.R1)(j)("page.knowledge.header.input"),onKeydown:(0,c.jR)(Le,["enter"]),"suffix-icon":(0,s.R1)(b.vji)},null,8,["modelValue","placeholder","suffix-icon"])])]),(0,l.Lk)("div",Ii,[(0,l.Lk)("div",_i,[(0,l.bF)(a,{type:"primary",class:"qa-main-create-button",onClick:Fe},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)((0,s.R1)(j)("page.knowledge.main.create")),1)]})),_:1})]),(0,l.Lk)("div",Ei,[(0,l.bF)(P,{filter:H.value,onCloseDocu:bt,onLoadData:It,onStopLLM:ot},null,8,["filter"])]),(0,l.Lk)("div",{class:"qa-main-clear",onClick:ut},[(0,l.bF)((0,s.R1)(y.A),{type:"pk-delete"})])])]),ne.value?((0,l.uX)(),(0,l.CE)("div",Ri,[(0,l.Lk)("div",{class:(0,u.C4)(["know-docs-header",ce.id?"ing":""])},[(0,l.Lk)("div",Li,(0,u.v_)(null===(n=Ee.value)||void 0===n?void 0:n.docName),1),(0,l.Lk)("div",Fi,[ce.id?((0,l.uX)(),(0,l.Wv)(a,{key:1,type:"primary",onClick:xt},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)((0,s.R1)(j)("page.knowledge.pdfViewerExitButton")),1)]})),_:1})):((0,l.uX)(),(0,l.Wv)(a,{key:0,type:"primary",onClick:yt},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)((0,s.R1)(j)("page.knowledge.pdfViewerQAButton")),1)]})),_:1}))]),(0,l.Lk)("div",Ti,[(0,l.bF)(a,{type:"primary",text:"",title:(0,s.R1)(j)("page.knowledge.pdfViewerCloseButton"),onClick:bt},{icon:(0,l.k6)((function(){return[(0,l.bF)((0,s.R1)(y.A),{type:"pk-knowclose",class:"wh20"})]})),_:1},8,["title"])])],2),(0,l.bF)(di.A,{uuid:Ce.value,history:Ie.value,sourceUrl:ie.value},null,8,["uuid","history","sourceUrl"])])):(0,l.Q3)("",!0),(0,l.Lk)("div",Si,[V.value?((0,l.uX)(),(0,l.Wv)(o,{key:0,class:"main-chat-content",animated:""},{template:(0,l.k6)((function(){return[(0,l.Lk)("div",Xi,[(0,l.Lk)("div",qi,[(0,l.bF)(r,{variant:"image",style:{width:"72px",height:"72px"}})]),(0,l.Lk)("div",Di,[(0,l.bF)(r,{variant:"text"}),(0,l.bF)(r,{variant:"text"}),(0,l.bF)(r,{variant:"text"}),(0,l.bF)(r,{variant:"text"})])])]})),_:1})):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[!fe.value||0===fe.value.length&&0===_e.value.length?((0,l.uX)(),(0,l.CE)("div",Ni,[(0,l.Lk)("div",Oi,[Wi,(0,l.Lk)("div",ji,[(0,l.Lk)("div",Ki,(0,u.v_)(z.value.title),1),(0,l.Lk)("div",{class:"main-chat-no-knowledgeDetail",innerHTML:z.value.subtitle},null,8,zi),(0,l.Lk)("div",Bi,(0,u.v_)(z.value.hint),1),(0,l.Lk)("div",Pi,[Mi,(0,l.Lk)("a",{class:"font",onClick:Ge},[(0,l.Lk)("p",null,(0,u.v_)((0,s.R1)(j)("page.knowledge.main.noKnowledgeHintDetail")),1)])])])])])):((0,l.uX)(),(0,l.CE)("div",Vi,[(0,l.Lk)("div",Hi,[0===_e.value.length?((0,l.uX)(),(0,l.CE)("div",Yi,[Ui,(0,l.Lk)("div",Qi,[(0,l.Lk)("div",$i,(0,u.v_)(z.value.title),1),(0,l.Lk)("div",{class:"main-chat-home-knowledgeDetail",innerHTML:z.value.subtitle},null,8,Gi),(0,l.Lk)("div",Ji,(0,u.v_)((0,s.R1)(j)("page.knowledge.main.knowledgeSelect")),1),(0,l.Lk)("div",Zi,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(fe.value,(function(e){return(0,l.uX)(),(0,l.CE)("div",{class:(0,u.C4)(["knowledge-list",{active:gt(e),enable:e.enable}]),key:e,onClick:function(t){return!!e.enable&&ft(e)}},[(0,l.Lk)("div",ta,[na,(0,l.Lk)("span",null,[(0,l.bF)(E.A,{content:e.enable?e.knowledgeName:(0,s.R1)(j)("page.knowledge.nodocs.hint"),placement:"top-start","show-arrow":!1},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)(e.knowledgeName),1)]})),_:2},1032,["content"])])])],10,ea)})),128))]),ia,B.value?((0,l.uX)(),(0,l.CE)("div",aa,(0,u.v_)((0,s.R1)(j)("page.knowledge.main.noknowledge")),1)):(0,l.Q3)("",!0),B.value?((0,l.uX)(),(0,l.CE)("div",{key:1,class:(0,u.C4)(["main-chat-home-knowledgeUncertainButton",{active:gt(de)}]),onClick:t[1]||(t[1]=function(e){return ft(de)})},[ra,(0,l.Lk)("span",null,[(0,l.bF)(E.A,{content:de.knowledgeName,placement:"top-start","show-arrow":!1},null,8,["content"])])],2)):(0,l.Q3)("",!0)])])):((0,l.uX)(),(0,l.CE)("div",oa,[(0,l.bF)(h,{ref_key:"scrollbarRef",ref:I},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(_e.value,(function(e,t){return(0,l.uX)(),(0,l.Wv)(si,{key:t,text:e.text,"created-at":e.createdAt,id:e.id,like:e.like,unlike:e.unlike,feedback:e.feedback,prompt:e.prompt,docId:e.docId,docName:e.docName,topk:e.topk,items:e.items,knowledgeId:e.knowledgeId,knowledgeName:e.knowledgeName,knowledges:e.knowledges,know:he,usedQA:e.usedQA,knowList:fe.value,owner:e.owner,error:e.error,status:e.status,"pre-conversation-id":0===t?void 0:e.preConversationId,"continue-number":e.continueNumber,loading:e.loading,onHandleChun:wt,onKnowledgeThis:kt,onRegenerate:function(e){return Qe(t)},onDelete:function(e){return tt(t)},onLike:Ke,onUnlike:ze,onFeedback:Be,onContinue:function(e){return $e(t)}},null,8,["text","created-at","id","like","unlike","feedback","prompt","docId","docName","topk","items","knowledgeId","knowledgeName","knowledges","know","usedQA","knowList","owner","error","status","pre-conversation-id","continue-number","loading","onRegenerate","onDelete","onContinue"])})),128)),_e.value.length>0&&-1===ee.value?((0,l.uX)(),(0,l.CE)("div",la,[(0,l.bF)(d,{"content-position":"center"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)((0,s.R1)(j)("page.qa.main.divider")),1)]})),_:1})])):(0,l.Q3)("",!0)]})),_:1},512)]))]),(0,l.Lk)("div",ua,[(0,l.Lk)("div",sa,[(0,l.Lk)("div",ca,[(0,l.bF)((0,s.R1)(m.Vc),{placement:"top",width:790,trigger:"hover",ref_key:"popRef",ref:se,modelValue:e.popnor,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.popnor=t})},{reference:(0,l.k6)((function(){return[(0,l.bF)((0,s.R1)(y.A),{type:"pk-normaldata",class:"w20 h20"})]})),default:(0,l.k6)((function(){return[(0,l.Lk)("h1",da,(0,u.v_)((0,s.R1)(j)("page.qa.main.footer.normalData")),1),(0,l.bF)(h,{class:"normal-data"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(Y.value,(function(e,t){return(0,l.uX)(),(0,l.CE)("div",{class:"normal-data-item",key:"normal"+t},[(0,l.Lk)("div",{class:"normal-data-item-title",onClick:function(t){return Se(e)}},[(0,l.bF)(E.A,{content:e.content,placement:"top-start","show-arrow":!1},null,8,["content"])],8,ha),(0,l.Lk)("div",pa,[(0,l.Lk)("div",{class:"normal-data-operation-edit",onClick:function(t){return Xe(e)}},[(0,l.bF)((0,s.R1)(y.A),{type:"pk-editnormal",class:"w20 h20"})],8,va),(0,l.Lk)("div",{class:"normal-data-operation-delete",onClick:function(t){return qe(e)}},[(0,l.bF)((0,s.R1)(y.A),{type:"pk-deletenormal",class:"w20 h20"})],8,fa)])])})),128))]})),_:1}),(0,l.Lk)("div",ma,[(0,l.Lk)("a",{class:"normal-data-item-add",onClick:De},[(0,l.bF)((0,s.R1)(y.A),{type:"pk-addplus"}),(0,l.Lk)("span",null,(0,u.v_)((0,s.R1)(j)("page.qa.main.footer.createNormalData")),1)])])]})),_:1},8,["modelValue"])]),(0,l.Lk)("div",{class:"main-chat-footer-operation",onClick:st},[(0,l.bF)((0,s.R1)(y.A),{type:"pk-deletelogs",class:"iconsvg wh20"})]),(0,l.Lk)("div",ga,[(0,l.bF)(f,{class:"footer-font",trigger:"click",placement:"top"},{dropdown:(0,l.k6)((function(){return[(0,l.bF)(v,null,{default:(0,l.k6)((function(){return[(0,l.bF)(p,{class:(0,u.C4)({"is-active":18===Z.value}),onClick:t[3]||(t[3]=function(e){return ct(18)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" Maximum 18 ")]})),_:1},8,["class"]),(0,l.bF)(p,{class:(0,u.C4)({"is-active":16===Z.value}),onClick:t[4]||(t[4]=function(e){return ct(16)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" Large 16 ")]})),_:1},8,["class"]),(0,l.bF)(p,{class:(0,u.C4)({"is-active":14===Z.value}),onClick:t[5]||(t[5]=function(e){return ct(14)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" Default 14 ")]})),_:1},8,["class"]),(0,l.bF)(p,{class:(0,u.C4)({"is-active":12===Z.value}),onClick:t[6]||(t[6]=function(e){return ct(12)})},{default:(0,l.k6)((function(){return[(0,l.eW)(" Minimum 12 ")]})),_:1},8,["class"])]})),_:1})]})),default:(0,l.k6)((function(){return[(0,l.Lk)("span",ka,[(0,l.bF)((0,s.R1)(y.A),{type:"pk-fontselect",class:"iconsvg wh20"})])]})),_:1})]),(0,l.Lk)("div",{class:"main-chat-footer-operation hide",onClick:dt},[(0,l.bF)((0,s.R1)(y.A),{type:"pk-downloadlogs",class:"iconsvg wh20"})]),(0,l.Lk)("div",{class:"main-chat-footer-operation hide",onClick:ht},[(0,l.bF)((0,s.R1)(y.A),{type:"pk-sharelogs",class:"iconsvg wh20"})]),(0,l.Q3)("",!0),(0,l.Lk)("div",wa,[(0,l.bF)(a,{class:"flex-text",disabled:-1===ee.value||0===_e.value.length,onClick:pt},{default:(0,l.k6)((function(){return[(0,l.bF)((0,s.R1)(y.A),{class:"mr6",type:"pk-documentupload"}),(0,l.eW)(" "+(0,u.v_)((0,s.R1)(j)("page.qa.main.operation.newText")),1)]})),_:1},8,["disabled"])]),(0,l.Lk)("div",ba,[ce.id?((0,l.uX)(),(0,l.CE)("div",ya,[(0,l.Lk)("div",xa,[(0,l.bF)(E.A,{content:ce.name,placement:"top-start"},null,8,["content"])]),(0,l.Lk)("div",{class:"docu-close",onClick:xt},[(0,l.bF)((0,s.R1)(y.A),{type:"pk-knowclose",class:"wh20"})])])):((0,l.uX)(),(0,l.CE)("div",Aa,[(0,l.bF)((0,s.R1)(m.Vc),{width:"400","popper-class":"know-flag",placement:"top-end",trigger:"click",ref:"cardPopRef",onBlur:t[9]||(t[9]=function(e){return ge.value=!1}),onHide:t[10]||(t[10]=function(e){return ge.value=!1})},{reference:(0,l.k6)((function(){return[(0,l.Lk)("div",Ra,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(mt.value,(function(e){return(0,l.uX)(),(0,l.Wv)(k,{class:"active-know",type:"primary",key:e.id,onClick:vt},{default:(0,l.k6)((function(){return[(0,l.bF)((0,s.R1)(y.A),{type:"pk-knowth"}),(0,l.bF)(E.A,{content:e.name,placement:"top-start"},null,8,["content"])]})),_:2},1024)})),128)),(0,l.Lk)("div",{class:"know-card",onClick:vt},[(0,l.bo)((0,l.bF)((0,s.R1)(y.A),{type:"pk-knowcard",class:"wh20"},null,512),[[c.aG,!ge.value]]),(0,l.bo)((0,l.bF)((0,s.R1)(y.A),{type:"pk-knowup",class:"wh20"},null,512),[[c.aG,ge.value]])])])]})),default:(0,l.k6)((function(){return[(0,l.Lk)("div",Ca,[(0,l.Lk)("div",Ia,[(0,l.Lk)("div",_a,(0,u.v_)((0,s.R1)(j)("page.knowledge.knowcard.title")),1),B.value?((0,l.uX)(),(0,l.Wv)(k,{key:0,type:gt(me.value)?"primary":"success",onClick:t[8]||(t[8]=function(e){return ft(me.value)})},{default:(0,l.k6)((function(){return[gt(me.value)?((0,l.uX)(),(0,l.Wv)((0,s.R1)(y.A),{key:0,type:"pk-knowth"})):(0,l.Q3)("",!0),(0,l.bF)(E.A,{content:me.value.knowledgeName,placement:"top-start"},null,8,["content"])]})),_:1},8,["type"])):(0,l.Q3)("",!0),B.value?((0,l.uX)(),(0,l.Wv)(d,{key:1,style:{margin:"0"}})):(0,l.Q3)("",!0),(0,l.Lk)("div",Ea,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(fe.value,(function(e){return(0,l.uX)(),(0,l.Wv)(k,{type:gt(e)?"primary":e.enable?"success":"info",onClick:function(t){return!!e.enable&&ft(e)},key:e.knowledgeId},{default:(0,l.k6)((function(){return[gt(e)?((0,l.uX)(),(0,l.Wv)((0,s.R1)(y.A),{key:0,type:"pk-knowth"})):(0,l.Q3)("",!0),(0,l.bF)(E.A,{content:e.enable?e.knowledgeName:(0,s.R1)(j)("page.knowledge.nodocs.hint"),placement:"top-start"},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)(e.knowledgeName),1)]})),_:2},1032,["content"])]})),_:2},1032,["type","onClick"])})),128))])])])]})),_:1},512)]))])]),(0,l.Lk)("div",La,[(0,l.bF)(i,{maxlength:"4000",ref_key:"inputRef",ref:ye,modelValue:be.value,"onUpdate:modelValue":t[11]||(t[11]=function(e){return be.value=e}),type:"textarea","input-style":"height: 3.375rem",disabled:"prompting"===xe.value,placeholder:(0,s.R1)(j)("page.qa.main.footer.inputplaceholder",{limit:M.value}),autosize:{minRows:1,maxRows:10},onInput:at,onPaste:nt,onKeydown:it,onKeypress:(0,c.jR)(rt,["enter"]),onFocus:Ze,onBlur:et},null,8,["modelValue","disabled","placeholder"]),(0,l.Lk)("div",Fa,["prompt"===xe.value?((0,l.uX)(),(0,l.Wv)(a,{key:0,type:"primary",disabled:Ae.value,onClick:Je},{icon:(0,l.k6)((function(){return[Ae.value?((0,l.uX)(),(0,l.Wv)((0,s.R1)(y.A),{key:0,type:"pk-prompt",class:"main-chat-footer-promptwh"})):((0,l.uX)(),(0,l.Wv)((0,s.R1)(y.A),{key:1,type:"pk-prompting",class:"main-chat-footer-promptwh"}))]})),_:1},8,["disabled"])):"prompting"===xe.value?((0,l.uX)(),(0,l.Wv)(a,{key:1,type:"primary",onClick:lt},{icon:(0,l.k6)((function(){return[(0,l.bF)((0,s.R1)(y.A),{type:"pk-stopre",class:"main-chat-footer-promptwh"})]})),_:1})):(0,l.Q3)("",!0)])])])]))],64))],512),(0,l.bF)(x,{modelValue:U.value,"onUpdate:modelValue":t[14]||(t[14]=function(e){return U.value=e}),title:Q.id?(0,s.R1)(j)("page.qa.main.footer.modifyNormalDataHint"):(0,s.R1)(j)("page.qa.main.footer.createNormalDataHint"),width:"600"},{footer:(0,l.k6)((function(){return[(0,l.Lk)("div",Ta,[(0,l.bF)(a,{onClick:t[13]||(t[13]=function(e){return U.value=!1})},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)((0,s.R1)(j)("page.qa.main.cancelButton")),1)]})),_:1}),(0,l.bF)(a,{type:"primary",onClick:Te},{default:(0,l.k6)((function(){return[(0,l.eW)((0,u.v_)((0,s.R1)(j)("page.qa.main.confirmButton")),1)]})),_:1})])]})),default:(0,l.k6)((function(){return[(0,l.bF)((0,s.R1)(g.US),{model:Q,rules:Re,ref_key:"normalForm",ref:$,class:"normalForm","label-width":"10"},{default:(0,l.k6)((function(){return[(0,l.bF)(w,{label:"",prop:"content"},{default:(0,l.k6)((function(){return[(0,l.bF)(i,{class:"normal",maxlength:"500",type:"textarea",modelValue:Q.content,"onUpdate:modelValue":t[12]||(t[12]=function(e){return Q.content=e}),placeholder:(0,s.R1)(j)("page.qa.normalData.placeholder")},null,8,["modelValue","placeholder"])]})),_:1})]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue","title"]),(0,l.bF)(x,{modelValue:le.value,"onUpdate:modelValue":t[15]||(t[15]=function(e){return le.value=e}),title:Ee.value.docName},{default:(0,l.k6)((function(){return[(0,l.bF)(A,{style:{height:"60vh"}},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Sa,[(0,l.bF)(ci.A,{docId:ae.value,text:re.value},null,8,["docId","text"])])]})),_:1})]})),_:1},8,["modelValue","title"])])}}});const Oa=(0,z.A)(Na,[["__scopeId","data-v-5fc03f1e"]]);var Wa=Oa}}]);