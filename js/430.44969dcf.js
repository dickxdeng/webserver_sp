"use strict";(self["webpackChunkSensepedia"]=self["webpackChunkSensepedia"]||[]).push([[430],{1075:function(e,a,l){l.d(a,{Ho:function(){return s},TF:function(){return d},WQ:function(){return u},YG:function(){return n},hc:function(){return i},n_:function(){return o}});var t=l(2324);const r="/api/v1";async function o(e){return(0,t.A)({url:r+"/system/role/list",method:"GET",params:{...e,pageNum:e.page,pageSize:e.perPage}})}async function n(){return(0,t.A)({url:r+"/system/role/all",method:"GET"})}async function s(e){return(0,t.A)({url:r+"/system/role/"+e,method:"GET"})}async function u(e){return(0,t.A)({url:r+"/system/role/add",method:"POST",data:e})}async function i(e){return(0,t.A)({url:r+"/system/role/edit",method:"PUT",data:e})}async function d(e){return(0,t.A)({url:r+"/system/role/"+e,method:"DELETE"})}},36981:function(e,a,l){l.d(a,{A:function(){return m}});var t=l(28694);const r={class:"main-content-screen"},o={class:"screen-header"},n={class:"header-search"},s={class:"screen-content",ref:"conentRef"},u={class:"content-data",style:{gap:"16px"}},i={class:"screen-footer"},d={class:"footer-pagination"};function c(e,a,l,c,p,g){const h=(0,t.g2)("el-skeleton-item"),m=(0,t.g2)("el-skeleton");return(0,t.uX)(),(0,t.CE)("div",r,[(0,t.Lk)("div",o,[(0,t.bF)(m,{animated:""},{template:(0,t.k6)((()=>[(0,t.Lk)("div",n,[(0,t.bF)(h,{variant:"text",style:{height:"28px"}}),(0,t.bF)(h,{variant:"text",style:{height:"28px"}}),(0,t.bF)(h,{variant:"text",style:{height:"28px"}}),(0,t.bF)(h,{variant:"text",style:{height:"28px"}})])])),_:1})]),(0,t.Lk)("div",s,[(0,t.bF)(m,{animated:""},{template:(0,t.k6)((()=>[(0,t.Lk)("div",u,[(0,t.bF)(h,{variant:"text",style:{height:"28px"}}),(0,t.bF)(h,{variant:"text",style:{height:"28px"}}),(0,t.bF)(h,{variant:"text",style:{height:"28px"}}),(0,t.bF)(h,{variant:"text",style:{height:"28px"}})])])),_:1})],512),(0,t.Lk)("div",i,[(0,t.bF)(m,{animated:""},{template:(0,t.k6)((()=>[(0,t.Lk)("div",d,[(0,t.bF)(h,{variant:"text",style:{height:"28px",width:"128px"}}),(0,t.bF)(h,{variant:"text",style:{height:"28px",width:"128px"}})])])),_:1})])])}var p=(0,t.pM)({name:"SkeleteTable",setup(e,a){}}),g=l(83940);const h=(0,g.A)(p,[["render",c],["__scopeId","data-v-60855484"]]);var m=h},90684:function(e,a,l){l.r(a),l.d(a,{default:function(){return V}});l(14898);var t=l(28694),r=l(83487),o=l(38118),n=l(97913),s=l(19477),u=l(74560),i=l(12567),d=l(59531),c=l(36981),p=l(94102),g=l(35733),h=l(81329),m=l(1075),b=l(56012),v=l(32228),k=l(98836),f=l(74913);const y={class:"main"},F={class:"main-top"},_={class:"main-top-nav"},R={class:"main-top-batch"},z={class:"th-s-label"},x={class:"th-s-label"},K={class:"th-s"},w={key:0,class:"operations"},C={class:"dialog"},I={class:"dialog-footer"};var T=(0,t.pM)({__name:"index",setup(e){const{t:a}=(0,v.s9)(),l=(0,f.Pj)(),T=((0,k.rd)(),(0,o.Kh)({reload:!0,loading:!1,list:[],pagination:{total:0,current:1,pageSize:10,sizeChange:()=>{},onChange:e=>{}}})),E=(0,o.KR)([]),{pushQuery:S,queryParams:V}=(0,p.A)("/organize/system/role",(async(e,a)=>{T.loading=!0;const l=await(0,m.n_)(e),{rows:t,data:r}=l,o=t||r;T.list=o.map((e=>e)),T.pagination={total:l.total||0,current:e.page,pageSize:e.perPage,sizeChange:async e=>{T.reload=!1,await $({perPage:e,page:1}),setTimeout((()=>T.reload=!0),400)},onChange:e=>$({page:e})},T.loading=!1})),{ROLE_KEY:A,ROLE_OPTIONS:L,validRole:W,STATES:N,STATE_OPTIONS:X}=(0,g.A)(),P=e=>{E.value=e},U=(0,t.EW)((()=>0===E.value.length)),D=(0,o.KR)(!1),O=(0,o.KR)(!1),q=(0,o.KR)({roleId:"",roleName:"",roleKey:"",status:0,remark:""}),H=(0,o.Kh)({roleName:[{required:!0,trigger:"blur"}],roleKey:[{required:!0,trigger:"blur"}],status:[{required:!0,trigger:"blur"}],menuIds:[{required:!0,trigger:"blur"}]}),B=(0,o.KR)(!1),G={0:"success",1:"danger","-1":"info"},Q=(0,o.KR)(null),j=(0,o.KR)(null),M=(0,o.KR)([]),Y=(0,o.Kh)({roleName:"",status:""}),$=async e=>{const a={...Y};S({...a,page:T.pagination.current,perPage:T.pagination.pageSize,...e})},J=async()=>{Y.roleName="",Y.roleKey="",T.reload=!1,await $({page:1}),setTimeout((()=>T.reload=!0),400)},Z=e=>!0,ee=async()=>{if(0===E.value.length)return;const e=E.value.map((e=>e.roleId)).join(",");s.s.confirm(a("page.organizes.role.deleteHintDetail"),a("page.organizes.docus.hint"),{confirmButtonText:a("page.organizes.docus.buttonSubmit"),cancelButtonText:a("page.organizes.docus.buttonCancel"),type:"warning"}).then((async()=>{D.value=!0,await(0,m.TF)(e),u.nk.success(a("page.organizes.docus.deleteSuccess")),D.value=!1,S({refresh:(0,h.pr)(new Date)})})).catch((()=>{D.value=!1}))},ae=async(e,a,l)=>{const t=await(0,m.Ho)(e.roleId),r=re(t.data.menuIds);q.value=e,q.value.status=~~e.status,j.value?.setCheckedKeys([]),q.value.defaultExpandedKeys=r,q.value.defaultCheckedKeys=r,O.value=!0},le=async()=>{O.value=!0,q.value={roleId:"",roleName:"",roleKey:"",status:0,remark:""}},te=e=>{const a=[...e];return M.value.filter((e=>e.children&&e.children.length>0)).forEach((l=>{l.children.forEach((t=>{e.includes(t.menuId)&&a.push(l.menuId)}))})),[...new Set(a)]},re=e=>{const a=[...e];return M.value.filter((e=>e.children&&e.children.length>0)).forEach((l=>{let t=0;if(e.forEach((e=>{l.children.includes(e)&&t++})),t!==l.children.length){const e=a.findIndex((e=>e===l.menuId));-1!==e&&a.splice(e,1)}})),[...new Set(a)]},oe=async()=>{if(B.value=!0,Q.value){let l=j.value.getCheckedKeys();if(0===l.length)return u.nk.error(a("page.organizes.role.menuEmpty")),void(B.value=!1);l=te(l),q.value.menuIds=l;try{const e=await Q.value.validate();if(!e)return void(B.value=!1)}catch(e){return void(B.value=!1)}""===q.value.roleId?(await(0,m.WQ)(q.value),u.nk.success(a("page.organizes.role.addSuccess"))):(await(0,m.hc)(q.value),u.nk.success(a("page.organizes.role.submitSuccess"))),S({refresh:(0,h.pr)(new Date)})}O.value=!1,B.value=!1},ne=async(e,l,t)=>{s.s.confirm(a("page.organizes.role.deleteHintDetail"),a("page.organizes.docus.hint"),{confirmButtonText:a("page.organizes.docus.buttonSubmit"),cancelButtonText:a("page.organizes.docus.buttonCancel"),type:"warning"}).then((async()=>{const l=await(0,m.TF)(e.roleId+"");200===l.code?u.nk.success(a("page.organizes.role.deleteSuccess")):u.nk.error(l.msg),setTimeout((()=>{S({refresh:(0,h.pr)(new Date)})}),400)})).catch((e=>{u.nk.error("Allocated, cannot be deleted.")}))},se=async()=>{const e=await(0,b.vm)(),a=e=>e.map((e=>({menuId:e.menuId,label:e.menuName,children:a(e.children)})));M.value=a(e.data)},ue=e=>{const a=N.find((a=>a.value===~~e.status));return a?a.label:N[1]?.label},ie=e=>"superadmin"!==e.roleKey&&"admin"!==e.roleKey;return(0,t.sV)((async()=>{l.commit("global/setLefter",!0),await se()})),(0,t.hi)((()=>{l.commit("global/setLefter",!1)})),(e,l)=>{const s=(0,t.g2)("el-button"),u=(0,t.g2)("el-input"),p=(0,t.g2)("el-col"),g=(0,t.g2)("el-row"),h=(0,t.g2)("el-table-column"),m=(0,t.g2)("el-tag"),b=(0,t.g2)("el-form-item"),v=(0,t.g2)("el-option"),k=(0,t.g2)("el-select"),f=(0,t.g2)("el-radio"),E=(0,t.g2)("el-radio-group"),S=(0,t.g2)("el-tree"),V=(0,t.g2)("el-scrollbar"),A=(0,t.g2)("el-form"),W=(0,t.g2)("el-dialog"),N=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",y,[(0,t.Lk)("div",F,[(0,t.Lk)("div",_,(0,r.v_)((0,o.R1)(a)("page.organizes.role.topNav")),1),(0,t.Lk)("div",R,[(0,t.bF)(s,{type:"primary",onClick:le},{icon:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(i.A),{type:"pk-plus"})])),default:(0,t.k6)((()=>[(0,t.eW)(" "+(0,r.v_)((0,o.R1)(a)("page.organizes.role.add")),1)])),_:1}),(0,t.bo)(((0,t.uX)(),(0,t.Wv)(s,{disabled:U.value,onClick:ee},{icon:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(i.A),{type:"pk-batchdelete"})])),default:(0,t.k6)((()=>[(0,t.eW)(" "+(0,r.v_)((0,o.R1)(a)("page.organizes.role.del")),1)])),_:1},8,["disabled"])),[[N,D.value]])])]),T.reload?((0,t.uX)(),(0,t.Wv)(d.A,{key:0,"row-key":"roleId",data:T.list,loading:T.loading,pagination:T.pagination,onHandleSelection:P},{header:(0,t.k6)((()=>[(0,t.bF)(g,{onKeydown:(0,n.jR)($,["enter"])},{default:(0,t.k6)((()=>[(0,t.bF)(p,{span:5},{default:(0,t.k6)((()=>[(0,t.Lk)("span",z,(0,r.v_)((0,o.R1)(a)("page.organizes.role.th-s-role-name")),1),(0,t.bF)(u,{class:"th-s-input",modelValue:Y.roleName,"onUpdate:modelValue":l[0]||(l[0]=e=>Y.roleName=e),placeholder:(0,o.R1)(a)("page.organizes.role.th-s-role-name-holder")},null,8,["modelValue","placeholder"])])),_:1}),(0,t.bF)(p,{span:5},{default:(0,t.k6)((()=>[(0,t.Lk)("span",x,(0,r.v_)((0,o.R1)(a)("page.organizes.role.th-s-role-key")),1),(0,t.bF)(u,{class:"th-s-input",modelValue:Y.roleKey,"onUpdate:modelValue":l[1]||(l[1]=e=>Y.roleKey=e),placeholder:(0,o.R1)(a)("page.organizes.role.th-s-role-key-holder")},null,8,["modelValue","placeholder"])])),_:1}),(0,t.bF)(p,{span:14},{default:(0,t.k6)((()=>[(0,t.Lk)("div",K,[(0,t.bF)(s,{class:"th-s-button color-huge border-huge",onClick:J},{icon:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(i.A),{type:"pk-refresh"})])),default:(0,t.k6)((()=>[(0,t.eW)(" "+(0,r.v_)((0,o.R1)(a)("page.organizes.role.reset")),1)])),_:1}),(0,t.bF)(s,{class:"th-s-button",type:"primary",onClick:$},{icon:(0,t.k6)((()=>[(0,t.bF)((0,o.R1)(i.A),{type:"pk-search"})])),default:(0,t.k6)((()=>[(0,t.eW)(" "+(0,r.v_)((0,o.R1)(a)("page.organizes.role.search")),1)])),_:1})])])),_:1})])),_:1})])),default:(0,t.k6)((()=>[(0,t.bF)(h,{type:"selection",width:"46",selectable:Z}),(0,t.bF)(h,{fixed:"",label:(0,o.R1)(a)("page.organizes.role.th-b-role-id"),prop:"roleId",width:"100"},null,8,["label"]),(0,t.bF)(h,{label:(0,o.R1)(a)("page.organizes.role.th-b-role-name"),prop:"roleName"},null,8,["label"]),(0,t.bF)(h,{label:(0,o.R1)(a)("page.organizes.role.th-b-role-key"),prop:"roleKey"},null,8,["label"]),(0,t.bF)(h,{label:(0,o.R1)(a)("page.organizes.role.th-b-role-state"),prop:"status"},{default:(0,t.k6)((({row:e})=>[(0,t.bF)(m,{type:G[e.status]},{default:(0,t.k6)((()=>[(0,t.eW)((0,r.v_)(ue(e)),1)])),_:2},1032,["type"])])),_:1},8,["label"]),(0,t.bF)(h,{label:(0,o.R1)(a)("page.organizes.role.th-b-role-createTime"),prop:"createTime"},null,8,["label"]),(0,t.bF)(h,{fixed:"right",label:(0,o.R1)(a)("page.organizes.role.th-b-operate")},{default:(0,t.k6)((({row:e,$index:l})=>[ie(e)?((0,t.uX)(),(0,t.CE)("div",w,[(0,t.bF)(s,{type:"primary",text:"",onClick:a=>ae(e,l,a)},{default:(0,t.k6)((()=>[(0,t.eW)((0,r.v_)((0,o.R1)(a)("page.organizes.role.edit")),1)])),_:2},1032,["onClick"]),(0,t.bF)(s,{type:"info",text:"",onClick:a=>ne(e,l,a)},{default:(0,t.k6)((()=>[(0,t.eW)((0,r.v_)((0,o.R1)(a)("page.organizes.role.del")),1)])),_:2},1032,["onClick"])])):(0,t.Q3)("",!0)])),_:1},8,["label"])])),_:1},8,["data","loading","pagination"])):((0,t.uX)(),(0,t.Wv)(c.A,{key:1})),(0,t.bF)(W,{modelValue:O.value,"onUpdate:modelValue":l[7]||(l[7]=e=>O.value=e),title:(0,o.R1)(a)("page.organizes.role.dialog-title"),"close-on-click":!1},{footer:(0,t.k6)((()=>[(0,t.Lk)("div",I,[(0,t.bF)(s,{onClick:l[6]||(l[6]=e=>O.value=!1)},{default:(0,t.k6)((()=>[(0,t.eW)((0,r.v_)((0,o.R1)(a)("page.organizes.role.cancel")),1)])),_:1}),(0,t.bo)(((0,t.uX)(),(0,t.Wv)(s,{type:"primary",onClick:oe},{default:(0,t.k6)((()=>[(0,t.eW)((0,r.v_)((0,o.R1)(a)("page.organizes.role.submit")),1)])),_:1})),[[N,B.value]])])])),default:(0,t.k6)((()=>[(0,t.bF)(A,{model:q.value,rules:H,ref_key:"roleFormRef",ref:Q,"label-width":"100px"},{default:(0,t.k6)((()=>[(0,t.Lk)("div",C,[(0,t.bF)(b,{label:(0,o.R1)(a)("page.organizes.role.dialog-role-name"),prop:"roleName"},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:q.value.roleName,"onUpdate:modelValue":l[2]||(l[2]=e=>q.value.roleName=e),placeholder:(0,o.R1)(a)("page.organizes.role.dialog-placeholder-prefix",{holder:(0,o.R1)(a)("page.organizes.role.dialog-role-name")})},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,t.bF)(b,{label:(0,o.R1)(a)("page.organizes.role.dialog-role-key"),prop:"roleKey"},{default:(0,t.k6)((()=>[(0,t.bF)(k,{modelValue:q.value.roleKey,"onUpdate:modelValue":l[3]||(l[3]=e=>q.value.roleKey=e)},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)((0,o.R1)(L),(e=>((0,t.uX)(),(0,t.Wv)(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"]),(0,t.bF)(b,{label:(0,o.R1)(a)("page.organizes.role.dialog-role-state"),prop:"status"},{default:(0,t.k6)((()=>[(0,t.bF)(E,{modelValue:q.value.status,"onUpdate:modelValue":l[4]||(l[4]=e=>q.value.status=e)},{default:(0,t.k6)((()=>[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)((0,o.R1)(X),(e=>((0,t.uX)(),(0,t.Wv)(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"]),(0,t.bF)(b,{label:(0,o.R1)(a)("page.organizes.role.dialog-role-remark")},{default:(0,t.k6)((()=>[(0,t.bF)(u,{modelValue:q.value.remark,"onUpdate:modelValue":l[5]||(l[5]=e=>q.value.remark=e),placeholder:(0,o.R1)(a)("page.organizes.role.dialog-placeholder-prefix",{holder:(0,o.R1)(a)("page.organizes.role.dialog-role-remark")})},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,t.bF)(b,{label:(0,o.R1)(a)("page.organizes.role.dialog-role-menu"),prop:"menuIds"},{default:(0,t.k6)((()=>[(0,t.bF)(V,{height:"200"},{default:(0,t.k6)((()=>[(0,t.bF)(S,{ref_key:"treeDataRef",ref:j,data:M.value,"show-checkbox":"","node-key":"menuId","default-expanded-keys":q.value.defaultExpandedKeys,"default-checked-keys":q.value.defaultCheckedKeys},null,8,["data","default-expanded-keys","default-checked-keys"])])),_:1})])),_:1},8,["label"])])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),E=l(83940);const S=(0,E.A)(T,[["__scopeId","data-v-318a07ad"]]);var V=S}}]);