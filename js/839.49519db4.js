(self["webpackChunkSensepedia"]=self["webpackChunkSensepedia"]||[]).push([[839],{50783:function(){!function(e){const a=e["zh-cn"]=e["zh-cn"]||{};a.dictionary=Object.assign(a.dictionary||{},{"%0 of %1":"第 %0 步，共 %1 步","Align center":"居中","Align left":"左对齐","Align right":"右对齐",Aquamarine:"海蓝色",Big:"大",Black:"黑色","Block quote":"块引用",Blue:"蓝色",Bold:"加粗","Bulleted List":"项目符号列表","Bulleted list styles toolbar":"项目符号列表样式工具条",Cancel:"取消","Cannot upload file:":"无法上传的文件：","Centered image":"图片居中","Change image text alternative":"更改图片替换文本","Choose heading":"标题类型",Circle:"空心圆点",Column:"列","Could not insert image at the current position.":"无法在当前位置插入图片","Could not obtain resized image URL.":"无法获取重设大小的图片URL",Decimal:"阿拉伯数字","Decimal with leading zero":"前导零阿拉伯数字","Decrease indent":"减少缩进",Default:"默认","Delete column":"删除本列","Delete row":"删除本行","Dim grey":"暗灰色",Disc:"实心圆点","Document colors":"文档中的颜色",Downloadable:"可下载","Dropdown toolbar":"下拉工具栏","Edit link":"修改链接","Editor toolbar":"编辑器工具栏","Enter image caption":"输入图片标题","Font Background Color":"字体背景色","Font Color":"字体颜色","Font Family":"字体","Font Size":"字体大小","Full size image":"图片通栏显示",Green:"绿色",Grey:"灰色","Header column":"标题列","Header row":"标题行",Heading:"标题","Heading 1":"标题 1","Heading 2":"标题 2","Heading 3":"标题 3","Heading 4":"标题 4","Heading 5":"标题 5","Heading 6":"标题 6",Huge:"极大","Image toolbar":"图片工具栏","image widget":"图像小部件","Increase indent":"增加缩进","Insert column left":"左侧插入列","Insert column right":"右侧插入列","Insert image":"插入图像","Insert image or file":"插入图片或文件","Insert media":"插入媒体","Insert paragraph after block":"在后面插入段落","Insert paragraph before block":"在前面插入段落","Insert row above":"在上面插入一行","Insert row below":"在下面插入一行","Insert table":"插入表格","Inserting image failed":"插入图片失败",Italic:"倾斜",Justify:"两端对齐","Left aligned image":"图片左侧对齐","Light blue":"浅蓝色","Light green":"浅绿色","Light grey":"浅灰色",Link:"超链接","Link URL":"链接网址","Lower-latin":"小写拉丁字母","Lower–roman":"小写罗马数字","Media URL":"媒体URL","media widget":"媒体小部件","Merge cell down":"向下合并单元格","Merge cell left":"向左合并单元格","Merge cell right":"向右合并单元格","Merge cell up":"向上合并单元格","Merge cells":"合并单元格",Next:"下一步","Numbered List":"项目编号列表","Numbered list styles toolbar":"项目编号列表样式工具条","Open in a new tab":"在新标签页中打开","Open link in new tab":"在新标签页中打开链接",Orange:"橙色",Paragraph:"段落","Paste the media URL in the input.":"在输入中粘贴媒体URL",Previous:"上一步",Purple:"紫色",Red:"红色",Redo:"重做","Remove color":"移除颜色","Rich Text Editor, %0":"富文本编辑器， %0","Right aligned image":"图片右侧对齐",Row:"行",Save:"保存","Select all":"全选","Select column":"选择列","Select row":"选择行","Selecting resized image failed":"选择重设大小的图片失败","Show more items":"显示更多","Side image":"图片侧边显示",Small:"小","Split cell horizontally":"水平分割单元格","Split cell vertically":"垂直拆分单元格",Square:"实心方块",Strikethrough:"删除线","Table toolbar":"表格工具栏","Text alignment":"对齐","Text alignment toolbar":"对齐工具栏","Text alternative":"替换文本","The URL must not be empty.":"URL不可以为空。","This link has no URL":"此链接没有设置网址","This media URL is not supported.":"不支持此媒体URL。",Tiny:"极小","Tip: Paste the URL into the content to embed faster.":"提示：将URL粘贴到内容中可更快地嵌入","Toggle the circle list style":"切换空心原点列表样式","Toggle the decimal list style":"切换阿拉伯数字列表样式","Toggle the decimal with leading zero list style":"切换前导零阿拉伯数字列表样式","Toggle the disc list style":"切换实心原点列表样式","Toggle the lower–latin list style":"切换小写拉丁字母列表样式","Toggle the lower–roman list style":"切换小写罗马数字列表样式","Toggle the square list style":"切换实心方块列表样式","Toggle the upper–latin list style":"切换大写拉丁字母列表样式","Toggle the upper–roman list style":"切换大写罗马数字列表样式",Turquoise:"青色",Underline:"下划线",Undo:"撤销",Unlink:"取消超链接","Upload failed":"上传失败","Upload in progress":"正在上传","Upper-latin":"大写拉丁字母","Upper-roman":"大写罗马数字",White:"白色","Widget toolbar":"小部件工具栏",Yellow:"黄色"}),a.getPluralForm=function(e){return 0}}(window.CKEDITOR_TRANSLATIONS||(window.CKEDITOR_TRANSLATIONS={}))},28086:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return wt}});t(14898),t(63307),t(43854),t(34817);var o=t(28694),l=t(83487),n=t(38118),i=t(97913),s=t(98836),c=t(74913),r=t(32228),d=t(19477),u=t(74560),p=t(87591),m=t(47531),v=t(35153),k=t.n(v),g=t(18232),h=t(12567),y=t(47307),f=t(52379),b=t(92301);const w={class:"main-chat-abstract"},R={key:0,class:"expand"},_={class:"abtitle"},C={class:"abname"},E={class:"abstra"},L=["textContent"],x=["textContent"],I={class:"operations"},T={class:"operation"},F={class:"operation"},A={class:"operation"},q={class:"operation"},S={class:"operation regenerate"},W={key:0,class:"inpand-hide"};var K=(0,o.pM)({__name:"DocumentAbstract",props:{id:{},history:{},historyAbstract:{},abExpand:{type:Boolean}},emits:["regenerateAb","showAbExpand","refreshAbstract"],setup(e,{emit:a}){const{t:t}=(0,r.s9)(),i=t("page.document.abstract.empty"),s=(0,o.EW)((()=>v.historyAbstract.loading?t("page.document.abstract.loading"):void 0)),c=(0,o.EW)((()=>1===v.historyAbstract.score)),d=(0,o.EW)((()=>2===v.historyAbstract.score)),p=(0,o.EW)((()=>v.historyAbstract.comment||"")),m=(0,n.KR)(!1),v=e,k=a,g=(0,n.KR)(!1),y=(0,n.KR)({comment:""}),K=()=>{k("regenerateAb")},X=async()=>{try{await(0,f.L)(`${v.historyAbstract.abstract}`||""),m.value=!0,u.nk.success(t("page.qa.main.copySuccess"))}catch(e){u.nk.error(t("page.qa.main.copyError"))}},U=async()=>{const e=await(0,b.lr)({id:v.historyAbstract.id,docId:v.history.docId,score:1});e&&e.data&&k("refreshAbstract",e.data),u.nk.success(t("page.qa.main.likeSuccess"))},N=async()=>{const e=await(0,b.lr)({id:v.historyAbstract.id,docId:v.history.docId,score:2});e&&e.data&&k("refreshAbstract",e.data),u.nk.success(t("page.qa.main.globalSuccess"))},D=async()=>{const e=await(0,b.lr)({id:v.historyAbstract.id,docId:v.history.docId,comment:y.value.comment});e&&e.data&&k("refreshAbstract",e.data),u.nk.success(t("page.qa.main.globalSuccess"))},B=()=>{g.value=!0};return(e,a)=>{const r=(0,o.g2)("el-input"),u=(0,o.g2)("el-form-item"),v=(0,o.g2)("el-form"),k=(0,o.g2)("el-button"),f=(0,o.g2)("el-dialog"),b=(0,o.gN)("loading");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.Lk)("div",w,[e.abExpand?((0,o.uX)(),(0,o.CE)("div",R,[(0,o.Lk)("div",_,[(0,o.eW)((0,l.v_)((0,n.R1)(t)("page.document.abstract.prefix")),1),(0,o.Lk)("span",C,(0,l.v_)(e.history?.docName||e.history?.name),1),(0,o.eW)((0,l.v_)((0,n.R1)(t)("page.document.abstract.suffix")),1)]),(0,o.bo)(((0,o.uX)(),(0,o.CE)("div",E,[(0,o.Lk)("div",{class:"abstract",textContent:(0,l.v_)(e.historyAbstract.abstract||s.value||(0,n.R1)(i))},null,8,L),(0,o.Lk)("div",{class:"summary",textContent:(0,l.v_)(e.historyAbstract.summary)},null,8,x)])),[[b,e.historyAbstract.loading]]),(0,o.Lk)("div",I,[(0,o.Lk)("div",T,[c.value?((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:1,type:"pk-liked",class:"operation-icon",onClick:U})):((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:0,type:"pk-like",class:"operation-icon",onClick:U}))]),(0,o.Lk)("div",F,[d.value?((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:1,type:"pk-unliked",class:"operation-icon",onClick:N})):((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:0,type:"pk-unlike",class:"operation-icon",onClick:N}))]),(0,o.Lk)("div",A,[p.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:0,type:"pk-feedback",class:"operation-icon",onClick:B}))]),(0,o.Lk)("div",q,[m.value?((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:1,type:"pk-copy",class:"operation-icon",onClick:X})):((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:0,type:"pk-copy",class:"operation-icon",onClick:X}))]),(0,o.Lk)("div",S,[(0,o.Lk)("a",{onClick:K},(0,l.v_)((0,n.R1)(t)("page.qa.message.regenerate")),1)])])])):(0,o.Q3)("",!0),(0,o.bF)(f,{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=e=>g.value=e)},{footer:(0,o.k6)((()=>[(0,o.bF)(k,{onClick:a[1]||(a[1]=e=>g.value=!1)},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)((0,n.R1)(t)("page.qa.main.cancelButton")),1)])),_:1}),(0,o.bF)(k,{type:"primary",onClick:D},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)((0,n.R1)(t)("page.qa.main.confirmButton")),1)])),_:1})])),default:(0,o.k6)((()=>[(0,o.bF)(v,{model:y.value,ref:"feedbackFormRef"},{default:(0,o.k6)((()=>[(0,o.bF)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(r,{modelValue:y.value.comment,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value.comment=e),type:"textarea",placeholder:"Enter your feedback"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])]),e.abExpand?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",W))],64)}}}),X=t(83940);const U=(0,X.A)(K,[["__scopeId","data-v-4b12d5c1"]]);var N=U,D=t(69989),B=t(97053),V=t(49284),H=t(57668),O=t(18684),M=t(51832),Q=t(17299);const j={class:"list-chat"},P={key:0,class:"list-chat-nodata"},z=["src"],G=["onClick"],$={key:0,class:"list-chat-item-desc"},Y={class:"list-chat-item-icon"},J={class:"list-chat-item-onlineT"},Z={key:0,class:"list-chat-item-onlineD"},ee={key:1,class:"list-chat-item-onlineD"},ae={key:1,class:"list-chat-item-title"},te={class:"list-chat-item-icon"},oe={class:"list-chat-item-onlineT"},le={key:0,class:"list-chat-item-onlineD"},ne={key:1,class:"list-chat-item-onlineD"},ie={key:2,class:"list-chat-item-op"};var se=(0,o.pM)({__name:"DocumentList",props:{filter:{}},emits:["loadData","stopLLM"],setup(e,{emit:a}){const{t:t}=(0,r.s9)(),s=(0,c.Pj)(),p=(0,o.EW)((()=>s.state.global.maxToken)),m=e,{STATE_NEXT:v}=(0,M.A)(),k=a,g=(0,o.EW)((()=>"/")),f=(0,o.EW)((()=>{const e=s.state.pk_document.history;if(m.filter){const a=e.filter((e=>e?.name.includes(m.filter)));return a}return e})),w=(0,o.EW)((()=>s.state.pk_document.active)),R=async({uuid:e})=>{K(e)||(w.value&&s.commit("pk_document/updateHistory",{uuid:w.value,type:"update",isEdit:!1}),k("loadData",{uuid:e}))},_=async({uuid:e,name:a,conversationType:o},l,n)=>{if(n?.stopPropagation(),e){const n="compare"===o?b.LE:b.lU;await n({id:e,docId:e,name:a});s.commit("pk_document/updateHistory",{uuid:e,type:"update",docName:a,isEdit:l}),u.nk.success(t("page.qa.main.modifySuccess"))}else{const e="compare"===o?b.IO:b.W5,n=await e({name:a}),i=n.data.id;s.commit("pk_document/updateHistory",{uuid:i,type:"add",isEdit:l}),u.nk.success(t("page.qa.main.createSuccess"))}},C=({uuid:e},a,t)=>{e&&s.commit("pk_document/updateHistory",{uuid:e,type:"update",isEdit:a})},E=async({uuid:e,conversationType:a},o)=>{o?.stopPropagation();let l=[];"compare"!==a&&f.value.forEach((a=>{a.docIds&&a.docIds.includes(e)&&l.push(a.uuid)}));let n=t("page.qa.main.deleteHintDetail");l.length>0&&(n=t("page.qa.main.deleteHintDocsDetail")),d.s.confirm(n,t("page.qa.main.deleteHint"),{confirmButtonText:t("page.qa.main.confirmButton"),cancelButtonText:t("page.qa.main.cancelButton"),type:t("page.qa.main.deleteType")}).then((async()=>{const t="compare"===a?b.dy:b.Nn;await t({docIds:e,ids:e}),k("stopLLM",{uuid:e}),s.commit("pk_document/deleteHistory",{uuid:e}),"compare"!==a&&(l&&l.length>0&&await(0,b.dy)({ids:l.join(",")}),l.forEach((e=>{s.commit("pk_document/deleteHistory",{uuid:e})})))})).catch((()=>{}))},L=e=>"compare"===e.conversationType?"pk-compareh":(0,y.$)(e.sourceUrl||e.name),x=(0,H.s)(E,600);let I=!1,T=!1;const F=async({uuid:e,name:a,conversationType:t},o)=>{I?I=!1:T||(T=!0,await _({uuid:e,name:a,conversationType:t},o),T=!1)},A=({uuid:e},a)=>{I=!0,e&&s.commit("pk_document/updateHistory",{uuid:e,type:"update",isEdit:a})},q=e=>e.parserState===v.TOKEN_EXCEED?t("page.document.preview.error-exceed",{maxToken:p.value}):e.parserState===v.TOKEN_LIMIT?t("page.document.preview.error-zero"):t("page.document.preview.error-parser"),S=e=>e.parserState===v.ERROR||e.parserState===v.TOKEN_EXCEED||e.parserState===v.TOKEN_LIMIT,W=e=>e.parserState===v.NOT_READY||e.parserState===v.START||e.parserState===v.RUNNING,K=e=>w.value===e;return(0,o.sV)((()=>{setTimeout((()=>(0,Q.eo)())),(0,Q.Ru)()})),(0,o.hi)((()=>{(0,Q.zg)()})),(e,a)=>{const s=(0,o.g2)("el-tooltip");return(0,o.uX)(),(0,o.Wv)((0,n.R1)(D.kA),null,{default:(0,o.k6)((()=>[(0,o.Lk)("div",j,[f.value.length?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:1},(0,o.pI)(f.value,((e,a)=>((0,o.uX)(),(0,o.CE)("div",{key:a},[(0,o.Lk)("a",{class:(0,l.C4)(["list-chat-item",K(e.uuid)&&"active"]),onClick:a=>R(e)},[e.isEdit?((0,o.uX)(),(0,o.CE)("div",ae,[(0,o.Lk)("div",te,[(0,o.bF)((0,n.R1)(h.A),{type:L(e),class:"w24 h24"},null,8,["type"])]),(0,o.Lk)("div",{class:(0,l.C4)(["list-chat-item-online",W(e)?"loading":""])},[(0,o.Lk)("div",oe,[(0,o.bF)((0,n.R1)(B.WK),{class:"input",modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,onBlur:a=>F(e,!1),onKeypress:(0,i.jR)((a=>F(e,!1)),["enter"]),onKeydown:(0,i.jR)((a=>A(e,!1)),["esc"]),placeholder:(0,n.R1)(t)("page.document.list.inputHolder")},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeypress","onKeydown","placeholder"])]),S(e)?((0,o.uX)(),(0,o.CE)("div",ne,[(0,o.bF)(s,{content:e.name,effect:"light",placement:"bottom-start","show-arrow":!1},{default:(0,o.k6)((()=>[(0,o.bF)((0,n.R1)(h.A),{type:"pk-docerror",class:"wh20"})])),_:2},1032,["content"]),(0,o.eW)(" "+(0,l.v_)((0,n.R1)(t)("page.document.error.parser-hint")),1)])):((0,o.uX)(),(0,o.CE)("div",le,(0,l.v_)(e.createdAt),1))],2)])):((0,o.uX)(),(0,o.CE)("div",$,[(0,o.Lk)("div",Y,[(0,o.bF)((0,n.R1)(h.A),{type:L(e),class:"w24 h24"},null,8,["type"])]),(0,o.Lk)("div",{class:(0,l.C4)(["list-chat-item-online",S(e)?"loading":""])},[(0,o.Lk)("div",J,[(0,o.bF)(O.A,{content:e.name,placement:"bottom-start","show-arrow":!1},null,8,["content"])]),S(e)?((0,o.uX)(),(0,o.CE)("div",ee,[(0,o.bF)(s,{content:q(e),effect:"light",placement:"bottom-start","show-arrow":!1},{default:(0,o.k6)((()=>[(0,o.bF)((0,n.R1)(h.A),{type:"pk-docerror",class:"wh"})])),_:2},1032,["content"]),(0,o.eW)(" "+(0,l.v_)((0,n.R1)(t)("page.document.error.parser-hint")),1)])):((0,o.uX)(),(0,o.CE)("div",Z,(0,l.v_)(e.createdAt),1))],2)])),K(e.uuid)?((0,o.uX)(),(0,o.CE)("div",ie,[e.isEdit?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bF)((0,n.R1)(V.S2),{class:"list-chat-item-opU",onClick:a=>C(e,!0,a)},{default:(0,o.k6)((()=>[(0,o.bF)((0,n.R1)(h.A),{type:"pk-edit",class:"wh20"})])),_:2},1032,["onClick"]),(0,o.bF)((0,n.R1)(V.S2),{class:"list-chat-item-opD",onClick:a=>(0,n.R1)(x)(e,a)},{default:(0,o.k6)((()=>[(0,o.bF)((0,n.R1)(h.A),{type:"pk-delete",class:"wh20"})])),_:2},1032,["onClick"])],64))])):(0,o.Q3)("",!0)],10,G)])))),128)):((0,o.uX)(),(0,o.CE)("div",P,[(0,o.Lk)("img",{src:g.value+"images/nodata.svg",width:"176px",height:"115px"},null,8,z),(0,o.eW)(" "+(0,l.v_)((0,n.R1)(t)("page.document.list.nodata")),1)]))])])),_:1})}}});const ce=(0,X.A)(se,[["__scopeId","data-v-bbc887f4"]]);var re=ce,de=t(13722);const ue={key:0,class:"chat-message-divider"},pe={class:"chat-message-header"},me=["src"],ve={class:"chat-message-body"},ke={class:"chat-message-body-text"},ge={key:0,class:"chat-message-chunks"},he={key:0,class:"chat-message-footer"},ye={class:"chat-message-footer-right"},fe={class:"chat-message-footer-rightr"},be=["onClick"],we={class:"dialog-footer"};var Re=(0,o.pM)({__name:"DocumentMessage",props:{id:{},createdAt:{},text:{},conversationType:{},owner:{},error:{type:Boolean},loading:{type:Boolean},like:{type:Boolean},unlike:{type:Boolean},feedback:{type:Boolean},topk:{},status:{},continueNumber:{},preConversationId:{}},emits:["regenerate","handleClick","delete","like","unlike","feedback","continue"],setup(e,{emit:a}){const{t:t}=(0,r.s9)(),i=(0,c.Pj)(),s=e,d=a,p=(0,n.KR)("me"===s.owner),v=(0,n.KR)(null),k=(0,n.KR)(!1),g=(0,n.KR)(t("page.qa.message.feedback")),y=(0,n.KR)(t("page.qa.message.feedbackList").split(",")),w=(0,n.KR)(null),R=(0,n.Kh)({value:""}),_=(0,n.Kh)({value:[{required:!0,message:t("page.qa.message.feedbackPlaceholder"),trigger:"blur"}]}),C=(0,o.EW)((()=>i.state.global.canFeedback)),E=(0,o.EW)((()=>{const e=s.text?.match(/(\[)ref_\d+(\])/g);if(e)return[...new Set(e)];const a=s.text?.match(/chunk id \d+/g);return a?[...new Set(a)]:[]})),L=(0,o.EW)((()=>E.value.map((e=>Number(e.replaceAll(/[^0-9]/gi,"")))))),x=(0,o.EW)((()=>{try{return Object.values(JSON.parse(s.topk))}catch(e){console.log(e)}return[]})),I=(0,o.EW)((()=>{const e=[];for(let a=0;a<L.value.length;a++){const t=Number(L.value[a]);x.value[t-1]&&e.push({id:a+1,nu:t,...x.value[t-1]})}return e})),T=(0,o.EW)((()=>{let e=s.text?.replace(/<br\/>|<br>/g,"\n")||"";e=e.replaceAll("\\boxed","");for(let a=0;a<I.value.length;a++){const t="";e=e.replaceAll(`[ref_${I.value[a].nu}]`,`<span class="el-index" data-title="${t}" data-id="${a}">${I.value[a].id}</span>`)}return 2===s.status?e+=`<span class="stop">${t("page.qa.main.stopText")}</span>`:5===s.status&&Number(s.continueNumber||0)<3?e+=`<a class="limit">${t("page.qa.main.limitText")}</a>`:6===s.status&&(e=t("page.qa.message.error")),e.replace(/\[ref_\d+\]/g,"")||t("page.qa.answer.error")})),F=(0,o.EW)((()=>{let e=s.text?.replaceAll("<br/>","\n");return e.replace(/\[ref_\d+\]/g,"")||t("page.qa.answer.error")})),A=(0,o.EW)((()=>s.like)),q=(0,o.EW)((()=>s.unlike)),S=(0,o.EW)((()=>s.feedback)),W=(0,o.EW)((()=>!1)),K=async e=>{const a=I.value.find((a=>a.id=e));d("handleClick",a)},X=async()=>{if(s.id&&!s.like){const e="compare"===s.conversationType?b.kk:b.HL;await e({id:s.id,score:1}),d("like",s.id),u.nk.success(t("page.qa.main.likeSuccess"))}},U=async()=>{if(s.id&&!s.unlike){const e="compare"===s.conversationType?b.kk:b.Sn;await e({id:s.id,score:2}),d("unlike",s.id),u.nk.success(t("page.qa.main.globalSuccess"))}},N=async()=>{s.id&&!s.feedback&&(k.value=!0),R.value=""},D=async()=>{try{const e=w.value?.validate();if(!e)return;const a="compare"===s.conversationType?b.kk:b.H9;await a({id:s.id,comment:R.value}),d("feedback",s.id||0,R.value),u.nk.success(t("page.qa.main.submitSuccess")),k.value=!1}catch(e){k.value=!1,console.log(e)}},B=e=>{R.value=e},H=e=>{switch(e){case"clipboard":j();break;case"delete":d("delete");break;case"asText":p.value=!p.value;break}},O=()=>{v.value?.scrollIntoView(),d("regenerate")},M=async(e,a)=>{const t=I.value[e];d("handleClick",t)},Q=async()=>{d("continue")},j=async()=>{try{await(0,f.L)(F.value||""),u.nk.success(t("page.qa.main.copySuccess"))}catch(e){u.nk.error(t("page.qa.main.copyError"))}};return console.log(s),(0,o.sV)((async()=>{})),(e,a)=>{const i=(0,o.g2)("el-divider"),c=(0,o.g2)("el-tag"),r=(0,o.g2)("el-form-item"),d=(0,o.g2)("el-input"),u=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.CE)(o.FK,null,["me"===s.owner&&-1===e.preConversationId?((0,o.uX)(),(0,o.CE)("div",ue,[(0,o.bF)(i,{"content-position":"center"},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)((0,n.R1)(t)("page.qa.main.divider")),1)])),_:1})])):(0,o.Q3)("",!0),(0,o.Lk)("div",{ref_key:"messageRef",ref:v,class:(0,l.C4)(["chat-message","me"===s.owner?"reverse":""])},[(0,o.Lk)("div",pe,[(0,o.Lk)("img",{src:"me"===s.owner?"/images/GroupQ.png":"/images/GroupA.png",width:"40",height:"40"},null,8,me)]),(0,o.Lk)("div",ve,[(0,o.Lk)("div",ke,[(0,o.bF)(de.A,{ref:"textRef",owner:e.owner,error:e.error,text:T.value,loading:e.loading,"as-raw-text":p.value,UUID:e.id,onHandleChunk:M,onHandleLimit:Q},null,8,["owner","error","text","loading","as-raw-text","UUID"]),I.value&&I.value.length?((0,o.uX)(),(0,o.CE)("div",ge,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(I.value,((e,a)=>((0,o.uX)(),(0,o.CE)("div",{class:"chunks-list",key:a},[(0,o.bF)(c,{class:"chunk-index",type:"primary",onClick:a=>K(e.id)},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)(e.id),1)])),_:2},1032,["onClick"])])))),128))])):(0,o.Q3)("",!0)]),e.id?((0,o.uX)(),(0,o.CE)("div",he,["me"===s.owner?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[C.value?((0,o.uX)(),(0,o.Wv)((0,n.R1)(V.S2),{key:0,type:"text",onClick:X},{default:(0,o.k6)((()=>[A.value?((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:1,type:"pk-liked",class:"wh18"})):((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:0,type:"pk-like",class:"wh18 hover"}))])),_:1})):(0,o.Q3)("",!0),C.value?((0,o.uX)(),(0,o.Wv)((0,n.R1)(V.S2),{key:1,type:"text",onClick:U},{default:(0,o.k6)((()=>[q.value?((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:1,type:"pk-unliked",class:"wh18 hover"})):((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:0,type:"pk-unlike",class:"wh18 hover"}))])),_:1})):(0,o.Q3)("",!0),C.value&&!S.value?((0,o.uX)(),(0,o.Wv)((0,n.R1)(V.S2),{key:2,type:"text",onClick:N},{default:(0,o.k6)((()=>[(0,o.bF)((0,n.R1)(h.A),{type:"pk-feedback",class:"wh18 hover"})])),_:1})):(0,o.Q3)("",!0),(0,o.bF)((0,n.R1)(V.S2),{type:"text",onClick:a[0]||(a[0]=e=>H("clipboard"))},{default:(0,o.k6)((()=>[W.value?((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:1,type:"pk-copied",class:"wh18 hover"})):((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:0,type:"pk-copy",class:"wh18 hover"}))])),_:1}),(0,o.Lk)("div",ye,[(0,o.Lk)("div",fe,[(0,o.bF)((0,n.R1)(V.S2),{type:"text",onClick:O},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)((0,n.R1)(t)("page.qa.message.regenerate")),1)])),_:1})])])],64))])):(0,o.Q3)("",!0)]),(0,o.bF)(u,{modelValue:k.value,"onUpdate:modelValue":a[3]||(a[3]=e=>k.value=e),title:g.value,width:"25rem"},{footer:(0,o.k6)((()=>[(0,o.Lk)("div",we,[(0,o.bF)((0,n.R1)(V.S2),{onClick:a[2]||(a[2]=e=>k.value=!1)},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)((0,n.R1)(t)("page.qa.main.cancelButton")),1)])),_:1}),(0,o.bF)((0,n.R1)(V.S2),{type:"primary",onClick:D},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)((0,n.R1)(t)("page.qa.main.submitButton")),1)])),_:1})])])),default:(0,o.k6)((()=>[(0,o.bF)((0,n.R1)(m.US),{model:R,rules:_,ref_key:"feedbackRef",ref:w},{default:(0,o.k6)((()=>[(0,o.bF)(r,null,{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(y.value,(e=>((0,o.uX)(),(0,o.CE)("span",{class:"span",key:e,onClick:a=>B(e)},(0,l.v_)(e),9,be)))),128))])),_:1}),(0,o.bF)(r,{label:"",props:"value"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{modelValue:R.value,"onUpdate:modelValue":a[1]||(a[1]=e=>R.value=e),type:"textarea",autosize:{minRows:4,maxRows:4}},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])],2)],64)}}});const _e=(0,X.A)(Re,[["__scopeId","data-v-566ff54e"]]);var Ce=_e,Ee=t(50239);t(50783);const Le=e=>((0,o.Qi)("data-v-a34d67c0"),e=e(),(0,o.jt)(),e),xe={class:"dialog-header"},Ie={class:"error-hint"},Te=Le((()=>(0,o.Lk)("span",null,"/",-1))),Fe={class:"dialog-footer"},Ae="The total token count of the two documents must not exceed";var qe=(0,o.pM)({__name:"CompareDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","handleCreateCompare"],setup(e,{emit:a}){(0,s.rd)();const t=(0,c.Pj)(),{t:i}=(0,r.s9)(),{STATE_NEXT:d}=(0,M.A)(),p=(0,o.EW)((()=>t.state.global.maxToken)),m=(0,o.EW)((()=>y.value.reduce(((e,a)=>e+a.tokenNum),0))),v=e,k=a,g=(0,n.KR)([]),y=(0,n.KR)([]),f=(0,n.KR)(null),w=(0,n.KR)(v.modelValue),R=e=>e.sourceFile.includes(".md")?"pk-md":e.sourceFile.includes(".xlsx")?"pk-xlsx":e.sourceFile.includes(".ppt")?"pk-ppt":e.sourceFile.includes(".docx")?"pk-docx":e.sourceFile.includes(".txt")?"pk-txt":"pk-pdf",_=(e,a)=>{const t=e.length;if(t>2)return u.nk.error(i("page.document.compare.error")),void f.value.toggleRowSelection(a);y.value=e},C=e=>!(y.value.length>2),E=()=>{w.value=!1},L=()=>{if(2!==y.value.length)return void u.nk.error(i("page.document.compare.error"));const e=y.value[0].tokenNum+y.value[1].tokenNum;e>p.value?u.nk.error(i("page.document.compare.tokenNumError",{maxToken:p.value,currentToken:e})):(k("handleCreateCompare",y.value),f.value.clearSelection())},x=async()=>{const e=await(0,b.ME)();e&&e.data&&(g.value=e.data.filter((e=>e.parserState===d.READY)))};return(0,o.wB)((()=>v.modelValue),(async e=>{e&&await x(),w.value=v.modelValue})),(0,o.wB)((()=>w.value),(e=>{k("update:modelValue",w.value)})),(0,o.sV)((async()=>{await x()})),(e,a)=>{const t=(0,o.g2)("el-table-column"),s=(0,o.g2)("el-table"),c=(0,o.g2)("el-button"),r=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.Wv)(r,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=e=>w.value=e),title:(0,n.R1)(i)("page.document.compare.dialogTitle")},{default:(0,o.k6)((()=>[(0,o.Lk)("div",xe,(0,l.v_)((0,n.R1)(i)("page.document.compare.dialogHeader")),1),(0,o.bF)(s,{ref_key:"table",ref:f,data:g.value,border:"",stripe:!0,onSelect:_},{default:(0,o.k6)((()=>[(0,o.bF)(t,{type:"selection",selectable:C}),(0,o.bF)(t,{prop:"docName",label:(0,n.R1)(i)("page.organizes.docus.tb-label-name"),"min-width":"240"},{default:(0,o.k6)((({row:e})=>[(0,o.bF)((0,n.R1)(h.A),{type:R(e),class:"icon-svg"},null,8,["type"]),(0,o.eW)(" "+(0,l.v_)(e.docName),1)])),_:1},8,["label"]),(0,o.bF)(t,{prop:"tokenNum",label:(0,n.R1)(i)("page.document.compare.tokenNum"),width:"120"},null,8,["label"])])),_:1},8,["data"]),(0,o.Lk)("div",Ie,[(0,o.Lk)("span",null,(0,l.v_)(Ae)),(0,o.Lk)("span",null,(0,l.v_)(p.value),1),(0,o.Lk)("span",{class:(0,l.C4)({red:m.value>p.value})},"("+(0,l.v_)(m.value),3),Te,(0,o.Lk)("span",null,(0,l.v_)(p.value)+")",1)]),(0,o.Lk)("div",Fe,[(0,o.bF)(c,{onClick:E},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)((0,n.R1)(i)("page.organizes.docus.buttonCancel")),1)])),_:1}),(0,o.bF)(c,{disabled:m.value>p.value||m.value<10,type:"primary",onClick:L},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)((0,n.R1)(i)("page.document.compare.buttonChat")),1)])),_:1},8,["disabled"])])])),_:1},8,["modelValue","title"])}}});const Se=(0,X.A)(qe,[["__scopeId","data-v-a34d67c0"]]);var We=Se,Ke=t(52582),Xe=t(70579),Ue=t(76412),Ne=t(53775);function De(e,a){const{t:t}=(0,r.s9)(),o=(0,c.Pj)();let l,n=0;const i=async()=>{n&&(clearInterval(n),n=0),n=setInterval((async()=>{const t=o.state.pk_document.urlState.status,l=o.state.pk_document.active;if(t<=2&&l)try{let t=await(0,b.S5)({docId:l});t&&t.data&&t.data.parserState>2&&(o.commit("pk_document/changeUrlState",{url:t.data.sourceFile,status:t.data.parserState,docId:t.data.docId}),o.commit("pk_document/changePdfState",{pdfUrl:t.data.pdfFile,status:t.data.state}),o.commit("pk_document/updateHistory",{uuid:l,state:t.data.parserState,sourceUrl:t.data.sourceFile,type:"update",createdAt:t.data.createTime}),clearInterval(n),a(),t=await(0,b.z)({docId:t.data.docId}),e(t))}catch(i){clearInterval(n),console.log(i)}else clearInterval(n)}),5e3)},s=async n=>{const s=n.file,c=new FormData;c.append("file",s);const r=await(0,b.W5)(c);if(r&&r.data){if(1===r.data.code||5===r.data.code)u.nk.error(t("page.document.upload.dupl"));else{if(o.commit("pk_document/addHistory",{uuid:r.data.docId,name:s.name,docId:r.data.docId,sourceUrl:r.data.sourceFile,pdfUrl:r.data.pdfFile,state:1,isEdit:!1,createdAt:r.data.updateTime}),o.commit("pk_document/changeUrlState",{openPreview:!0,url:r.data.sourceFile,status:r.data.parserState,docId:r.data.docId}),o.commit("pk_document/changePdfState",{openPreview:!0,pdfUrl:"",status:r.data.parserState}),o.commit("pk_document/saveActive",{uuid:r.data.docId,status:r.data.parserState}),3===r.data.parserState){a(),e({loading:!0,data:{id:0,digest:"",summarize:"",question:""}});const t=await(0,b.z)({docId:r.data.docId});e(t),l.close()}else r.data.parserState<=2&&(i(),e({loading:!0,data:{id:0,digest:"",summarize:"",question:""}}));u.nk.success(t("app.global.upload.success"))}return l.close(),r.data.doc_id}return l.close(),u.nk.error(t("app.global.upload.fail")+r.msg),null},d=e=>{const a=104857600,o=e.size,n=e.name,i=e.name.split(".").pop();return o>a?(u.nk.error(t("app.global.upload.limit")),!1):["docx","pdf","md","txt"].includes(i)?n.match(/\[|\]|\^|\$|￥/g)?(u.nk.error("The file name contains special characters, please try again"),!1):void(l=Ne.Ks.service({target:".upload-loading"})):(u.nk.error("Error Type"),!1)},p=()=>{u.nk.error(t("app.global.upload.exceed"))};return{interval:i,httpRequest:s,beforeUpload:d,handleExceed:p}}var Be=t(85158),Ve=t(81329),He=t(49302);const Oe=e=>((0,o.Qi)("data-v-398431dc"),e=e(),(0,o.jt)(),e),Me={class:"main"},Qe={class:"left-chat"},je={class:"qa"},Pe={class:"qa-header"},ze={class:"qa-header-title"},Ge={class:"qa-main"},$e={class:"qa-main-create"},Ye={class:"qa-main-create-one"},Je={class:"icon"},Ze={class:"iconsvg"},ea={class:"text"},aa={class:"desc"},ta={class:"qa-main-create-know hide"},oa={class:"icon"},la=Oe((()=>(0,o.Lk)("span",{class:"icon"},[(0,o.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"17",height:"17",viewBox:"0 0 17 17",fill:"none"},[(0,o.Lk)("path",{d:"M1.77075 2.83333C1.77075 2.44213 2.08788 2.125 2.47909 2.125H6.72909L8.49992 4.25H14.5208C14.912 4.25 15.2291 4.56712 15.2291 4.95833V14.1667C15.2291 14.5579 14.912 14.875 14.5208 14.875H2.47909C2.08788 14.875 1.77075 14.5579 1.77075 14.1667V2.83333Z",stroke:"#4E5969","stroke-width":"1.2","stroke-linejoin":"round"}),(0,o.Lk)("path",{d:"M8.5001 7.08301L9.29449 8.82296L11.1948 9.04081L9.78544 10.334L10.1655 12.2085L8.5001 11.2678L6.8347 12.2085L7.21476 10.334L5.80542 9.04081L7.7057 8.82296L8.5001 7.08301Z",stroke:"#4E5969","stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))),na={class:"text"},ia={key:0,class:"qa-main-create-compare qa-main-create"},sa={class:"icon"},ca={class:"iconsvg"},ra={class:"text"},da={class:"desc"},ua={class:"qa-main-list"},pa={key:0,class:"main-chat main-chat-empty"},ma={class:"main-chat-empty-nodata"},va=Oe((()=>(0,o.Lk)("div",{class:"main-chat-empty-left"},[(0,o.Lk)("img",{src:"/images/GroupA.png",width:"40",height:"40"})],-1))),ka={class:"main-chat-empty-right"},ga={class:"main-chat-empty-title"},ha={class:"main-chat-empty-desc"},ya={class:"main-chat-empty-hint"},fa={class:"main-chat-empty-uploadList"},ba={class:"icon"},wa=["src"],Ra={class:"title"},_a={class:"text"},Ca={class:"desc"},Ea={key:1,class:"main-chat-loading"},La={key:0,class:"icon"},xa={key:1,class:"text"},Ia={key:2,class:"desc"},Ta={key:3,class:"desc"},Fa={key:4,class:"desc"},Aa={key:5,class:"desc"},qa={key:6,class:"desc"},Sa={key:7,class:"desc"},Wa={key:8,class:"desc"},Ka={key:2,class:"main-chat-preview"},Xa={id:"scrollRef",ref:"scrollRef",class:"main-chat"},Ua={class:"main-chat-grow"},Na={class:"main-chat-message main-chat-no-message"},Da={class:"main-chat-no-messageLeft"},Ba={class:"main-chat-no-messageRight",style:{gap:"16px"}},Va={class:"main-chat-content"},Ha={class:"main-chat-grow"},Oa={id:"chatMessage",class:"main-chat-message"},Ma={key:0,class:"expand"},Qa={key:1,class:"inpand"},ja={key:1},Pa={key:2,class:"main-chat-no-message"},za=Oe((()=>(0,o.Lk)("div",{class:"main-chat-no-messageLeft"},[(0,o.Lk)("img",{src:"/images/GroupA.png",width:"40",height:"40"})],-1))),Ga={class:"main-chat-no-messageRight"},$a={class:"main-chat-no-messageTitle"},Ya={class:"main-chat-no-messageDesc"},Ja={class:"main-chat-footer mt-24"},Za={key:0,class:"question hide"},et={class:"label"},at=["title","onClick"],tt={class:"main-chat-footer-op"},ot={class:"main-chat-footer-opNormal"},lt={class:"normal-datah1"},nt=["onClick"],it={class:"normal-data-item-operation"},st=["onClick"],ct=["onClick"],rt={class:"normal-data-item addplus"},dt={class:"main-chat-footer-operation"},ut={class:"el-dropdown-link"},pt={class:"main-chat-footer-operation flex-grow"},mt={class:"main-chat-footer-input"},vt={class:"main-chat-footer-button"},kt={class:"dialog-footer"},gt={class:"chunk-content"},ht="pk_document",yt=3;var ft=(0,o.pM)({__name:"index",setup(e){const a=(0,n.Kh)({id:"",abstract:"",summary:"",question:"",score:-1,comment:"",loading:!1}),t=e=>{"loading"in e?a.loading=e.loading:e&&ye.value!==e.data.docId||(e&&e.data&&(a.id=e.data.id,a.abstract=e.data.digest,a.summary=e.data.summarize,a.question=e.data.question,a.score=e.data.score,a.comment=e.data.comment),ae.value=!1,a.loading=!1)},v=(0,n.KR)(!1),f=()=>{v.value=!1},{addChat:w,updateChat:R,updateChatSome:_,getChatByUuidAndIndex:C}=(0,Xe.Y)(ht),{scrollbarRef:E,scrollToBottom:L,scrollToBottomIfAtBottom:x}=(0,Ue.A)(),{interval:I,httpRequest:T,beforeUpload:F,handleExceed:A}=De(t,f),{STATE_NEXT:q}=(0,M.A)(),S=(0,n.KR)(),W=(0,n.KR)();let K=new AbortController,X="",U=0;const D={docId:"",preConversationId:null,maxNewTokens:2048,temperature:.3,regenerate:{isRegenerate:!1},knowledgeScope:{basicAbility:1,privateDatabase:1},config:{topP:.95,stopSequence:"",repetitionPenalty:0,frequencyPenalty:0}},B=(0,s.rd)(),{currentRoute:V}=B,H=(0,c.Pj)(),{t:j}=(0,r.s9)();H.commit("global/setMenuEnable",!0);const P=(0,o.EW)((()=>H.state.global.maxToken)),z=((0,n.KR)(!1),(0,n.KR)("")),G=((0,n.KR)(!1),(0,n.KR)([{icon:"/images/docx.png",iconsvg:"pk-documentupload",text:"page.document.main.create",description:"page.document.main.createDesc",enable:!0}])),$=(0,n.KR)([]),Y=(0,n.KR)(!1),J=(0,n.Kh)({id:0,content:"",scope:yt}),Z=(0,o.EW)((()=>H.state.global.openDocumentCompare)),ee=(0,n.KR)(4e3),ae=(0,n.KR)(!0),te=(0,n.KR)(),oe=(0,n.KR)(!1),le=(0,n.KR)(!1),ne=(0,n.KR)(14),ie=(0,n.KR)(0),se=(0,n.KR)(!1),ce=(0,n.KR)(0),de=(0,n.KR)(!0),ue=(0,n.KR)(null),pe=(0,n.KR)(!1),me=(0,n.KR)(!1),ve=((0,n.KR)([]),(0,n.KR)("")),ke=(0,n.KR)(null),ge=(0,n.KR)("prompt"),he=(0,o.EW)((()=>"prompting"===ge.value||!ve.value||0===ve.value.length||$t(ve.value)>ee.value)),ye=(0,o.EW)((()=>{const e=H.state.pk_document.active;return e})),fe=(0,o.EW)((()=>H.state.pk_document.history.find((e=>e.uuid===ye.value)))),be=(0,o.EW)((()=>{const e=H.state.pk_document.history.find((e=>e.uuid===ye.value));return e?e.chats:[]})),we=(0,o.EW)((()=>H.state.pk_document.history)),Re=(0,n.KR)({title:j("page.document.empty.title"),subtitle:j("page.document.empty.desc"),hint:j("page.document.empty.hint")}),_e=(0,n.KR)({title:j("page.document.start.title"),subtitle:j("page.document.start.desc")}),Le=(0,n.KR)(H.state.pk_document.urlState.urlWithRes||""),xe=(0,o.EW)((()=>H.state.pk_document.urlState.openPreview)),Ie=(0,o.EW)((()=>H.state.pk_document.urlState.status<=q.RUNNING||H.state.pk_document.urlState.status===q.ERROR||H.state.pk_document.urlState.status===q.TOKEN_EXCEED||H.state.pk_document.urlState.status===q.TOKEN_LIMIT)),Te=(0,o.EW)((()=>H.state.pk_document.urlState.url||"")),Fe=(0,o.EW)((()=>H.state.pk_document.urlState.docId)),Ae=((0,o.EW)((()=>(0,y.C)(H.state.pk_document.urlState.url))),(0,n.KR)(H.state.pk_document.pdfState.pdfUrlWithRes||"")),qe=((0,n.KR)(!1),(0,o.EW)((()=>H.state.pk_document.pdfState.pdfUrl)),(0,n.KR)("")),Se=(0,n.KR)(""),Ne=(0,n.KR)(!1),Oe=((0,o.EW)((()=>"/preview/pdfjs/web/viewer.html?file="+encodeURIComponent(Le.value)+"&pagemode=none")),(0,o.EW)((()=>{const e=a.question?.split("\n");return e}))),ft=(0,n.Kh)({content:[{required:!0,message:j("page.qa.normalData.placeholder"),trigger:"blur"}]}),bt=e=>{a.score=e.score,a.comment=e.comment},wt=async()=>{a.loading=!0;try{let e={};e=a.id?await(0,b.Pz)({id:a.id,docId:Fe.value}):await(0,b.z)({docId:Fe.value}),e&&e.data&&(a.id=e.data.id,a.abstract=e.data.digest,a.summary=e.data.summarize,a.question=e.data.question,a.score=e.data.score,a.comment=e.data.comment)}catch(e){console.error(e)}a.loading=!1},Rt=()=>{de.value=!0,E.value.wrapRef.scrollTop=0},_t=async e=>{v.value=!0;try{(0,Q.cY)(0,40),await T(e),ie.value=-1,setTimeout((()=>(0,Q.cY)(0,40)),0)}catch(a){console.error(a)}S.value?.clearFiles(),W.value?.clearFiles()},Ct=e=>{e.stopPropagation();const a=e.key;a&&"Enter"===a&&console.log("enter")},Et=async e=>{const a=e.map((e=>e.docId)).join(","),t=e.map((e=>e.docName)).join("/"),o=await(0,b.RL)({docIds:a,name:t});H.commit("pk_document/addHistory",{uuid:o.data.id,name:o.data.name,conversationType:"compare",docIds:o.data.docIds,docs:e,state:4,createdAt:o.data.updateTime}),H.commit("pk_document/changeUrlState",{openPreview:!0,url:e[0].sourceFile,status:e[0].parserState,docId:e[0].docId}),H.commit("pk_document/saveActive",{uuid:o.data.id,status:q.READY}),me.value=!1},Lt=()=>{me.value=!0},xt=async e=>{ve.value=e,Ot(!1),ve.value=""},It=async()=>{try{const e=await(te.value?.validate());if(!e)return;J.id?await(0,b.v8)(J):(J.id=0,await(0,b.p1)(J)),await fo()}catch(e){console.log(e)}finally{Y.value=!1}},Tt=e=>{ve.value=e.content||"",ue.value&&ue.value.hide(),Jt()},Ft=async e=>{J.id=e.id,J.content=e.content||"",Y.value=!0},At=async e=>{d.s.confirm(j("page.qa.main.deleteHintDetail"),j("page.qa.main.deleteHint"),{confirmButtonText:j("page.qa.main.confirmButton"),cancelButtonText:j("page.qa.main.cancelButton"),type:j("page.qa.main.deleteType")}).then((async()=>{await(0,b.Tf)(e),await fo()})).catch((()=>{}))},qt=()=>{J.id=0,J.content="",J.scope=3,Y.value=!0};let St="",Wt=0;const Kt=e=>{const a=e.event.target,{responseText:t}=a,o=t.trimEnd().split("\n");let l={},n=St,i=!1;try{const e=o.length;if(e>0){for(let a=0;a<e;a++){const e=o[a];if(l=JSON.parse(e),l.stopId)X=l.stopId;else{if("freetalkId"in l){U=l.freetalkId,i=!1;break}l.answer&&(n+=l.answer),"sensitive"===l.finish_reason&&(n+=j("page.qa.message.error"))}}n&&_(ye.value,Wt,{text:n,owner:"llm",error:!1,loading:i})}}catch(s){console.log(s)}},Xt=e=>{const a=e.event.target,{responseText:t}=a,o=t.trimEnd().split("\n");let l={},n="",i=!1;try{const e=o.length;if(e>0){n="";for(let a=0;a<e;a++){const e=o[a];if(l=JSON.parse(e),l.stopId)X=l.stopId;else{if("freetalkId"in l){U=l.freetalkId,i=!1;break}l.answer&&(n+=l.answer),"sensitive"===l.finish_reason&&(n+=j("page.qa.message.error"))}}n&&(_(ye.value,be.value.length-1,{createdAt:(0,Ve.pr)(new Date),text:n,owner:"llm",error:!1,loading:i}),St=n),x()}}catch(s){console.log(s)}},Ut=async e=>{const a=be.value.findIndex((a=>a.id===e));-1!==a&&_(ye.value,a,{like:!0,unlike:!1})},Nt=async e=>{const a=be.value.findIndex((a=>a.id===e));-1!==a&&_(ye.value,a,{like:!1,unlike:!0})},Dt=async(e,a)=>{const t=be.value.findIndex((a=>a.id===e));-1!==t&&_(ye.value,t,{feedback:a})},Bt=(e,a,t,o)=>{const l=JSON.parse(a.pop()),{id:n,topk:i,freetalkId:s,chatStatus:c,continueNumber:r}=l;if(e!==ye.value)return;H.commit("saveHistory",{uuid:ye.value});const d=s;ie.value=s,_(ye.value,o,{id:n,prompt:t,conversationId:d,topk:i,status:c,continueNumber:r,loading:!1})},Vt=async(e,a,t,o)=>{const l=ye.value,n="compare"===fe.value?.conversationType?b.bL:b.C$;St=e.text,Wt=t;const i=await n({...D,docId:fe.value.docId,documentCompareId:fe.value.uuid,query:a,...o},K.signal,Kt);if(i&&"string"===typeof i){const a=i.trimEnd().split("\n");if(Bt(l,a,e.prompt,Wt),ye.value&&ye.value===fe.value?.uuid){const e="compare"===fe.value?.conversationType?b.LE:b.lU;await e({id:ye.value,docId:ye.value,name:fe.value.name})}ke.value?.focus()}ge.value="prompt"},Ht=async(e,a,t,o)=>{const l=ye.value,n="compare"===fe.value?.conversationType?b.bL:b.C$,i=await n({...D,docId:fe.value.docId,documentCompareId:fe.value.uuid,query:a,...o},K.signal,Xt);if(i&&"string"===typeof i){const e=i.trimEnd().split("\n");if(Bt(l,e,a,be.value.length-1),ye.value&&ye.value===fe.value?.uuid){const e="compare"===fe.value?.conversationType?b.LE:b.lU;await e({id:ye.value,docId:ye.value,name:fe.value.name})}return x(),void setTimeout((()=>{L(),ke.value?.focus()}),400)}ge.value="prompt",_(ye.value,t,{loading:!1})},Ot=async(e=!1,a=null)=>{let t=ve.value;e&&(t=a?.prompt??"",t=t||a?.options?.prompt);if(!t||0===t.length)return;if("prompting"===ge.value)return;let o={};o.preFreetalkId=0!==ie.value?ie.value:null,o.onContinue=!1,w(ye.value,{id:0,createdAt:(0,Ve.pr)(new Date),text:t,owner:"me",error:!1,conversation:null,conversationId:0,preConversationId:ie.value,options:{prompt:t,options:null}}),L(),ge.value="prompting",ve.value="";w(ye.value,{id:0,createdAt:(0,Ve.pr)(new Date),text:j("page.qa.main.llm.hint"),loading:!0,owner:"llm",error:!1,conversation:null,conversationId:0,preConversationId:ie.value,options:{prompt:t,options:o}}),ie.value=0,L(),K=new AbortController;try{St="",U=0,await Ht(St,t,be.value.length-1,o)}catch(l){const e=l?.message;if("canceled"===e)return _(ye.value,be.value.length-1,{loading:!1}),void x();const a=C(ye.value,be.value.length-1);if(a?.text&&a.text.length>0)return void _(ye.value,be.value.length-1,{text:a.text+"\n\n"+e,error:!0,loading:!1});R(ye.value,be.value.length-1,{createdAt:(0,Ve.pr)(new Date),text:e,owner:"llm",error:!0,loading:!1,conversation:null,options:{prompt:t,options:o}}),x()}finally{ge.value="prompt"}},Mt=async e=>{if("prompting"===ge.value)return;const a=be.value[e],t=a?.prompt??"",o=!0;if(o)return void Ot(!0,a);let l={};a.options&&(l={...a.options}),ge.value="prompting",R(ye.value,e,{createdAt:(0,Ve.pr)(new Date),text:"",owner:"llm",error:!1,loading:!0,conversation:null,options:{prompt:t,options:l}});try{St="",await Ht(St,t,e,l)}catch(n){if("canceled"===n.message)return void _(ye.value,e,{loading:!1});const a=n?.message??j("page.qa.error");R(ye.value,e,{createdAt:(0,Ve.pr)(new Date),text:a,owner:"llm",error:!0,loading:!1,conversation:null,options:{prompt:t,options:l}})}finally{ge.value="prompt"}},Qt=async e=>{if("prompting"===ge.value)return;const a=be.value[e];let t=a?.prompt??"";if(t=t||a?.options?.prompt,!t||0===t.length)return;let o=[];o.preFreetalkId=a.preConversationId,ge.value="prompting",ve.value="",R(ye.value,e,{text:a.text,error:!1,loading:!0,options:{prompt:t,options:a.options}}),K=new AbortController,o.onContinue=!0,o.id=a.id;try{await Vt(a,t,e,o)}catch(l){R(ye.value,e,{loading:!1})}finally{ge.value="prompt"}},jt=()=>{v.value||(Jt(),Ot())},Pt=()=>{(0,Q.OV)()},zt=()=>{(0,Q.Zr)()},Gt=e=>{H.commit("pk_document/deleteChat",e)},$t=e=>{const a=/[\u4e00-\u9fff\u0e00-\u0e7f\u1000-\u109f\u1780-\u17ff\u1e00-\u1eff\u3040-\u30ff\uac00-\ud7af]|[a-zA-Z]+|\d+|[^\s\w]/g,t=e.match(a);return t?t.length:0},Yt=()=>{const e=$t(ve.value);e>ee.value&&u.nk.error(j("page.qa.main.footer.inputplaceholder",{limit:ee.value})),Jt()},Jt=()=>{setTimeout((()=>eo()))},Zt=e=>{if(e.shiftKey&&"Enter"===e.key){e.preventDefault();const a=e.target,t=a.selectionStart,o=a.selectionEnd;ve.value=ve.value.substring(0,t)+"\n"+ve.value.substring(o),setTimeout((()=>{a.selectionStart=a.selectionEnd=t+1,eo()}))}},eo=()=>{(0,Q.cY)(0,40),(0,Q.bj)(0,40)},ao=()=>{jt()},to=async e=>{const{uuid:a}=e;if("prompting"===ge.value){ge.value="prompt";const e="compare"===fe.value?.conversationType?b.$M:b.iO;await e({sessionId:a,stopId:X}),setTimeout(wo,100)}},oo=async()=>{if("prompting"===ge.value){ge.value="prompt";const e="compare"===fe.value?.conversationType?b.$M:b.iO;await e({sessionId:ye.value,stopId:X}),setTimeout(wo,100),ke.value?.focus()}},lo=async()=>{const e=we.value?.map((e=>e.uuid));e&&0===e.length?u.nk.error(j("page.qa.main.operation.notEmpty")):d.s.confirm(j("page.qa.main.operation.clearHintDetail"),j("page.qa.main.operation.clearHint"),{confirmButtonText:j("page.qa.main.confirmButton"),cancelButtonText:j("page.qa.main.cancelButton"),type:"warning"}).then((async()=>{await to({uuid:ye.value});const e=we.value?.filter((e=>"compare"!==e.conversationType)).map((e=>e.uuid))||"0",a=we.value?.filter((e=>"compare"===e.conversationType)).map((e=>e.uuid))||[];await(0,b.Nn)({docIds:e.join(",")}),a.length&&await(0,b.dy)({ids:a.join(",")}),ie.value=-1,H.commit("pk_document/clearAll"),u.nk.success(j("page.qa.main.operation.successMessageLogs")),(0,Q.cY)(0,40)})).catch((()=>{}))},no=async()=>{null!==ye.value?v.value||d.s.confirm(j("page.qa.main.operation.deleteLogs"),j("page.qa.main.operation.hint"),{confirmButtonText:j("page.qa.main.confirmButton"),cancelButtonText:j("page.qa.main.cancelButton"),type:j("page.qa.main.deleteType")}).then((async()=>{const e="compare"===fe.value?.conversationType?b.Kq:b.b5;await e({docId:fe.value.docId,documentCompareId:fe.value.uuid}),ie.value=-1,H.commit("pk_document/clearChatByUuid",{uuid:ye.value}),u.nk.success(j("page.qa.main.deleteSuccess"))})).catch((()=>{})):u.nk.error(j("page.qa.main.operation.notEmpty"))},io=e=>{if(!v.value&&(ne.value=e,"number"===typeof e)){document.documentElement.style.getPropertyValue("--text-preview");document.documentElement.style.setProperty("--text-preview",e+"px"),u.nk.success(j("page.qa.main.operation.successMessageFont"))}},so=async()=>{v.value||pe.value||d.s.confirm(j("page.qa.main.operation.deleteLogs"),j("page.qa.main.operation.hint"),{confirmButtonText:j("page.qa.main.confirmButton"),cancelButtonText:j("page.qa.main.cancelButton"),type:j("page.qa.main.deleteType")}).then((async()=>{try{pe.value=!0;const e=document.getElementById("chatMessage"),a=await k()(e,{useCORS:!0,scrollX:0,scrollY:0,width:716,height:1e3}),t=a.toDataURL("image/png"),o=document.createElement("a");o.style.display="none",o.href=t,o.setAttribute("download","chat.png"),"undefined"===typeof o.download&&o.setAttribute("target","_blank"),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(o.href),pe.value=!1,u.nk.success(j("page.qa.main.exportSuccess"))}catch(e){pe.value=!1,u.nk.error(j("page.qa.main.exportError"))}})).catch((()=>{}))},co=()=>{v.value},ro=()=>{ie.value=-1,L()},uo=async e=>{try{qe.value=e.doc_id,Se.value=e.text.replace(/<!--\{.*\}-->/g,""),Ne.value=!0,Ne.value=!0}catch(a){console.log(a)}},po=async e=>{let a=fe.value?.docs?.find((a=>a.docId===e.docId));a&&H.commit("pk_document/changeUrlState",e)},mo=async()=>{a.id="",a.abstract="",a.summary="",a.question="";const e=Fe.value,t=await(0,b.lQ)({docId:e});return Fe.value===e&&(!t||!t.data||(a.id=t.data.id,a.abstract=t.data.digest,a.summary=t.data.summarize,a.question=t.data.question,a.score=t.data.score,a.comment=t.data.comment,!1))},vo=async e=>{const a=await(0,He.Ju)({scope:2,language:e});a&&a.data&&a.data.length>0?(Re.value=a.data[0],Re.value.hint=Re.value.hint||j("page.document.empty.hint")):Re.value={title:j("page.document.empty.title"),subtitle:j("page.document.empty.desc"),hint:j("page.document.empty.hint")}},ko=async e=>{let a=null;a="compare"===fe.value?.conversationType?await(0,He.Ju)({scope:5,language:e}):await(0,He.Ju)({scope:3,language:e}),a&&a.data&&a.data.length>0?_e.value=a.data[0]:_e.value={title:j("page.document.start.title"),subtitle:j("page.document.start.desc")}},go=async()=>{const e=[],a=await(0,b.M2)();return a&&a.data&&a.data.length>0&&a.data.forEach((a=>{a.docs&&a.docs.length>0&&e.push({uuid:a.id,conversationType:"compare",name:a.name,docs:a.docs,docIds:a.docIds,parserState:a.docs[0].parserState,sourceUrl:a.docs[0].sourceFile,isEdit:!1,createdAt:a.updateTime||a.createTime,chats:[]})})),e},ho=async()=>{const e=await(0,b.ME)();return e&&e.data&&e.data.length?e.data.map((e=>({uuid:e.docId,docId:e.docId,name:e.docName,conversationType:"doc",state:e.state,parserState:e.parserState,sourceUrl:e.sourceFile,pdfUrl:e.pdfFile,chunkFile:e.chunkFile,isEdit:!1,createdAt:e.updateTime||e.createTime,chats:[]}))):[]},yo=async()=>{const e=await go(),a=await ho(),t=[...e,...a].sort(((e,a)=>a.createdAt>e.createdAt?1:-1));H.commit("pk_document/loadHistory",t)},fo=async()=>{const e=await(0,b.WK)({scope:yt});e&&e.data&&e.data.length>=0&&($.value=e.data)},bo=async e=>{oe.value=!1,a.loading=!0,de.value=!0,ae.value=!0,Ae.value="",await oo(),H.commit("pk_document/saveActive",e),f();const o=await mo();t({loading:o}),ae.value=!1,oe.value=!1,(0,Q.cY)(0,40),Eo(),Co(),await wo("add"),ke.value?.focus()},wo=async(e="add")=>{if(le.value)return;le.value=!0;const a="update"===e&&be.value.length>0?be.value[0].createdAt:"",t="compare"===fe.value?.conversationType?b.h6:b.O7,o=await t({documentCompareId:fe.value?.uuid,docId:fe.value?.docId,page:5,createTime:a});if(o&&o.data){const a=[];for(const e of o.data)a.push({createdAt:e.createTime,id:0,text:e.query,owner:"me",error:!1,loading:!1,like:1===e.score,unlike:2===e.score,prompt:"",conversationId:e.freetalkId,preConversationId:e.preFreetalkId}),a.push({createdAt:e.createTime,id:e.id,text:e.answer,owner:"llm",error:!1,loading:!1,like:1===e.score,unlike:2===e.score,feedback:e.comment,prompt:e.query,conversationId:e.freetalkId,preConversationId:e.preFreetalkId,topk:e.topk,status:e.chatStatus,continueNumber:e.continueNumber});"update"===e?H.commit("pk_document/updateChatsByUuid",{uuid:ye.value,data:a}):(H.commit("pk_document/addChatsByUuid",{uuid:ye.value,data:a}),ie.value=o.data.length>0?o.data[o.data.length-1].freetalkId:0)}o.data&&o.data.length<5&&(oe.value=!0),L(),le.value=!1},Ro=async e=>{const a=e.target.scrollTop||e.target.scrollingElement.scrollTop||e.target.documentElement.scrollTop;e.target.scrollHeight,e.target.clientHeight;a<=40&&!oe.value&&(await wo("update"),window.document.removeEventListener("scroll",Ro))},_o=async e=>{const a=e.target.scrollTop,t=(e.target.scrollHeight,e.target.clientHeight,window.document.querySelector(".main-chat-abstract")),o=t?.scrollHeight+20;a>Math.abs(o)&&(de.value=!1),a<20&&a<20&&!oe.value&&await wo("update")},Co=()=>{window.document.addEventListener("scroll",Ro),setTimeout((()=>E.value?.wrapRef.addEventListener("scroll",_o)),1e3)},Eo=()=>{window.document.addEventListener("scroll",Ro),E.value?.wrapRef.addEventListener("scroll",_o)},{defaultLang:Lo}=(0,Be.W4)(vo),{defaultLang:xo}=(0,Be.W4)(ko);(0,o.sV)((async()=>{await yo(),await fo(),ae.value=!1,ye.value&&(await mo(),await wo()),await vo(Lo.value),await ko(xo.value),Co(),(0,Q.cY)(0,40),(0,Q.bj)(0,40),ke.value?.focus();const e=document.createElement("script");e.src="/preview/editormd/lib/marked.min.js",document.body.appendChild(e);const a=document.createElement("script");a.src="/preview/editormd/lib/prettify.min.js",document.body.appendChild(a);const t=document.createElement("script");t.src="/preview/editormd/lib/flowchart.min.js",document.body.appendChild(t)})),(0,o.hi)((()=>{(0,Q.fO)(),Eo(),"prompting"===ge.value&&K.abort()}));return(0,o.wB)((()=>Te.value),(async(e,a)=>{e&&e!==a&&mo()})),(0,o.wB)((()=>ye.value),(async()=>{"compare"!==fe.value?.conversationType&&ye.value&&Ie.value&&I()})),(0,o.wB)((()=>fe.value?.conversationType),(async()=>{fe.value&&await ko(xo.value)})),(e,t)=>{const s=(0,o.g2)("el-input"),c=(0,o.g2)("el-upload"),r=(0,o.g2)("el-skeleton-item"),d=(0,o.g2)("el-skeleton"),u=(0,o.g2)("el-divider"),k=(0,o.g2)("el-scrollbar"),y=(0,o.g2)("ElScrollbar"),f=(0,o.g2)("el-dropdown-item"),b=(0,o.g2)("el-dropdown-menu"),w=(0,o.g2)("el-dropdown"),R=(0,o.g2)("el-button"),_=(0,o.g2)("el-form-item"),C=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.CE)("div",Me,[(0,o.Lk)("div",Qe,[(0,o.Lk)("div",je,[(0,o.Lk)("div",Pe,[(0,o.Lk)("h1",ze,(0,l.v_)((0,n.R1)(j)("page.document.header.title")),1),(0,o.bF)(s,{modelValue:z.value,"onUpdate:modelValue":t[0]||(t[0]=e=>z.value=e),class:"qa-header-input",placeholder:(0,n.R1)(j)("page.document.header.input"),onKeyup:(0,i.jR)(Ct,["enter"]),"suffix-icon":(0,n.R1)(g.vji)},null,8,["modelValue","placeholder","suffix-icon"])])]),(0,o.Lk)("div",Ge,[(0,o.Lk)("div",$e,[(0,o.bF)(c,{ref_key:"uploadRef",ref:S,accept:".pdf,.xlsx,.docx,.md,.txt","show-file-list":!1,drag:"",limit:1,"before-upload":(0,n.R1)(F),"http-request":_t,"on-exceed":(0,n.R1)(A),class:"upload-loading"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",Ye,[(0,o.Lk)("div",Je,[(0,o.Lk)("span",Ze,[(0,o.bF)((0,n.R1)(h.A),{type:"pk-plus"})]),(0,o.Lk)("span",ea,(0,l.v_)((0,n.R1)(j)("page.document.main.create")),1)]),(0,o.Lk)("div",aa,(0,l.v_)((0,n.R1)(j)("page.document.main.createDesc",{maxToken:P.value})),1)])])),_:1},8,["accept","before-upload","on-exceed"]),(0,o.Lk)("div",ta,[(0,o.Lk)("div",oa,[la,(0,o.Lk)("span",na,(0,l.v_)((0,n.R1)(j)("page.document.main.knowledge")),1)])])]),Z.value?((0,o.uX)(),(0,o.CE)("div",ia,[(0,o.Lk)("div",{class:"qa-main-create-one flex",onClick:Lt},[(0,o.Lk)("div",sa,[(0,o.Lk)("span",ca,[(0,o.bF)((0,n.R1)(h.A),{type:"pk-compare"})]),(0,o.Lk)("span",ra,(0,l.v_)((0,n.R1)(j)("page.document.main.compare")),1)]),(0,o.Lk)("div",da,(0,l.v_)((0,n.R1)(j)("page.document.main.compareDesc")),1)])])):(0,o.Q3)("",!0),(0,o.Lk)("div",ua,[(0,o.bF)(re,{filter:z.value,onLoadData:bo,onStopLLM:to},null,8,["filter"])]),(0,o.Lk)("div",{class:"qa-main-clear",onClick:lo},[(0,o.bF)((0,n.R1)(h.A),{type:"pk-delete"})])])]),xe.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",pa,[(0,o.Lk)("div",ma,[va,(0,o.Lk)("div",ka,[(0,o.Lk)("div",ga,(0,l.v_)(Re.value.title),1),(0,o.Lk)("div",ha,(0,l.v_)(Re.value.subtitle),1),(0,o.Lk)("div",ya,(0,l.v_)(Re.value.hint),1),(0,o.Lk)("div",fa,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(G.value,(e=>((0,o.uX)(),(0,o.CE)("div",{class:"main-chat-empty-document",key:e.icon},[(0,o.bF)(c,{ref_for:!0,ref_key:"uploadReffer",ref:W,accept:".pdf,.xlsx,.docx,.md","show-file-list":!1,drag:"",limit:1,"before-upload":(0,n.R1)(F),"http-request":_t,"on-exceed":(0,n.R1)(A),class:"upload-loading"},{default:(0,o.k6)((()=>[(0,o.Lk)("div",ba,[(0,o.Lk)("img",{src:e.icon},null,8,wa)]),(0,o.Lk)("div",Ra,[(0,o.Lk)("p",_a,(0,l.v_)((0,n.R1)(j)(e.text)),1),(0,o.Lk)("p",Ca,(0,l.v_)((0,n.R1)(j)(e.description,{maxToken:P.value})),1)])])),_:2},1032,["accept","before-upload","on-exceed"])])))),128))])])])])),xe.value&&Ie.value?((0,o.uX)(),(0,o.CE)("div",Ea,[fe.value?.parserState<=(0,n.R1)(q).RUNNING?((0,o.uX)(),(0,o.CE)("div",La,[(0,o.bF)((0,n.R1)(h.A),{type:"pk-loading"})])):(0,o.Q3)("",!0),fe.value?.parserState<=(0,n.R1)(q).RUNNING?((0,o.uX)(),(0,o.CE)("div",xa,(0,l.v_)((0,n.R1)(j)("page.document.preview.parserLoading")),1)):(0,o.Q3)("",!0),fe.value?.parserState<=(0,n.R1)(q).RUNNING?((0,o.uX)(),(0,o.CE)("div",Ia,(0,l.v_)((0,n.R1)(j)("page.document.preview.parserDesc")),1)):(0,o.Q3)("",!0),fe.value?.parserState===(0,n.R1)(q).TOKEN_EXCEED?((0,o.uX)(),(0,o.CE)("div",Ta,(0,l.v_)((0,n.R1)(j)("page.document.preview.error-parser")),1)):(0,o.Q3)("",!0),fe.value?.parserState===(0,n.R1)(q).TOKEN_EXCEED?((0,o.uX)(),(0,o.CE)("div",Fa,(0,l.v_)((0,n.R1)(j)("page.document.preview.error-exceed",{maxToken:P.value})),1)):(0,o.Q3)("",!0),fe.value?.parserState===(0,n.R1)(q).TOKEN_LIMIT?((0,o.uX)(),(0,o.CE)("div",Aa,(0,l.v_)((0,n.R1)(j)("page.document.preview.error-parser")),1)):(0,o.Q3)("",!0),fe.value?.parserState===(0,n.R1)(q).TOKEN_LIMIT?((0,o.uX)(),(0,o.CE)("div",qa,(0,l.v_)((0,n.R1)(j)("page.document.preview.error-zero")),1)):(0,o.Q3)("",!0),fe.value?.parserState===(0,n.R1)(q).ERROR?((0,o.uX)(),(0,o.CE)("div",Sa,(0,l.v_)((0,n.R1)(j)("page.document.preview.error-parser")),1)):(0,o.Q3)("",!0),fe.value?.parserState===(0,n.R1)(q).ERROR?((0,o.uX)(),(0,o.CE)("div",Wa,(0,l.v_)((0,n.R1)(j)("page.document.preview.error-parser")),1)):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0),xe.value&&!Ie.value?((0,o.uX)(),(0,o.CE)("div",Ka,[(0,o.bF)(Ke.A,{uuid:ye.value,history:fe.value,sourceUrl:Te.value,urlStateDocId:Fe.value,onHandleCompareDocsChange:po},null,8,["uuid","history","sourceUrl","urlStateDocId"])])):(0,o.Q3)("",!0),(0,o.bo)((0,o.Lk)("div",Xa,[ae.value?((0,o.uX)(),(0,o.Wv)(d,{key:0,class:"main-chat-content",animated:""},{template:(0,o.k6)((()=>[(0,o.Lk)("div",Ua,[(0,o.Lk)("div",Na,[(0,o.Lk)("div",Da,[(0,o.bF)(r,{variant:"image",style:{width:"72px",height:"72px"}})]),(0,o.Lk)("div",Ba,[(0,o.bF)(r,{variant:"text"}),(0,o.bF)(r,{variant:"text"}),(0,o.bF)(r,{variant:"text"}),(0,o.bF)(r,{variant:"text"})])])])])),_:1})):(0,o.Q3)("",!0),(0,o.bo)((0,o.Lk)("div",Va,[(0,o.Lk)("div",Ha,[(0,o.Lk)("div",Oa,[de.value?((0,o.uX)(),(0,o.CE)("div",Ma)):((0,o.uX)(),(0,o.CE)("div",Qa,[(0,o.Lk)("div",{class:"iconabtext",style:{background:"url(/images/hide.svg) no-repeat top center"},onClick:Rt},[(0,o.eW)((0,l.v_)((0,n.R1)(j)("page.document.abstract.hide")),1),(0,o.bF)((0,n.R1)(h.A),{type:"pk-inpand"})])])),(0,o.bF)(k,{ref_key:"scrollbarRef",ref:E},{default:(0,o.k6)((()=>[ye.value?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},["compare"!==fe.value.conversationType?((0,o.uX)(),(0,o.Wv)(N,{key:0,id:ce.value,history:fe.value,historyAbstract:a,abExpand:de.value,onRefreshAbstract:bt,onRegenerateAb:wt,onShowAbExpand:Rt},null,8,["id","history","historyAbstract","abExpand"])):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(be.value,((e,a)=>((0,o.uX)(),(0,o.Wv)(Ce,{key:a,text:e.text,"created-at":e.createdAt,conversationType:fe.value.conversationType,id:e.id,topk:e.topk,like:e.like,unlike:e.unlike,feedback:e.feedback,owner:e.owner,error:e.error,status:e.status,"continue-number":e.continueNumber,loading:e.loading,"pre-conversation-id":0===a?void 0:e.preConversationId,onHandleClick:uo,onRegenerate:e=>Mt(a),onDelete:e=>Gt(a),onLike:Ut,onUnlike:Nt,onFeedback:Dt,onContinue:e=>Qt(a)},null,8,["text","created-at","conversationType","id","topk","like","unlike","feedback","owner","error","status","continue-number","loading","pre-conversation-id","onRegenerate","onDelete","onContinue"])))),128)),be.value.length>0&&-1===ie.value?((0,o.uX)(),(0,o.CE)("div",ja,[(0,o.bF)(u,{"content-position":"center"},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)((0,n.R1)(j)("page.qa.main.divider")),1)])),_:1})])):(0,o.Q3)("",!0),0===be.value.length?((0,o.uX)(),(0,o.CE)("div",Pa,[za,(0,o.Lk)("div",Ga,[(0,o.Lk)("div",$a,(0,l.v_)(_e.value.title),1),(0,o.Lk)("div",Ya,(0,l.v_)(_e.value.subtitle),1)])])):(0,o.Q3)("",!0)],64)):(0,o.Q3)("",!0)])),_:1},512)])]),(0,o.Lk)("div",Ja,[Oe.value&&Oe.value.length>0?((0,o.uX)(),(0,o.CE)("div",Za,[(0,o.Lk)("div",et,(0,l.v_)((0,n.R1)(j)("page.document.abstract.question")),1),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(Oe.value,(e=>((0,o.uX)(),(0,o.CE)("div",{class:"question-list",title:e,key:e,onClick:a=>xt(e)},(0,l.v_)(e),9,at)))),128))])):(0,o.Q3)("",!0),(0,o.Lk)("div",tt,[(0,o.Lk)("div",ot,[(0,o.bF)((0,n.R1)(p.Vc),{placement:"top",width:790,trigger:"hover",ref_key:"popRef",ref:ue,modelValue:se.value,"onUpdate:modelValue":t[1]||(t[1]=e=>se.value=e)},{reference:(0,o.k6)((()=>[(0,o.bF)((0,n.R1)(h.A),{type:"pk-normaldata",class:"iconsvg w20 h20"})])),default:(0,o.k6)((()=>[(0,o.Lk)("h1",lt,(0,l.v_)((0,n.R1)(j)("page.qa.main.footer.normalData")),1),(0,o.bF)(y,{class:"normal-data"},{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)($.value,((e,a)=>((0,o.uX)(),(0,o.CE)("div",{class:"normal-data-item",key:"normal"+a},[(0,o.Lk)("div",{class:"normal-data-item-title",onClick:a=>Tt(e)},[(0,o.bF)(O.A,{content:e.content,placement:"top-start","show-arrow":!1},null,8,["content"])],8,nt),(0,o.Lk)("div",it,[(0,o.Lk)("div",{class:"normal-data-operation-edit",onClick:a=>Ft(e)},[(0,o.bF)((0,n.R1)(h.A),{type:"pk-editnormal",class:"iconsvg"})],8,st),(0,o.Lk)("div",{class:"normal-data-operation-delete",onClick:a=>At(e)},[(0,o.bF)((0,n.R1)(h.A),{type:"pk-deletenormal",class:"iconsvg"})],8,ct)])])))),128))])),_:1}),(0,o.Lk)("div",rt,[(0,o.Lk)("a",{class:"normal-data-item-add",onClick:qt},[(0,o.bF)((0,n.R1)(h.A),{type:"pk-addplus"}),(0,o.Lk)("span",null,(0,l.v_)((0,n.R1)(j)("page.qa.main.footer.createNormalData")),1)])])])),_:1},8,["modelValue"])]),(0,o.Lk)("div",{class:"main-chat-footer-operation",onClick:no},[(0,o.bF)((0,n.R1)(h.A),{type:"pk-deletelogs",class:"iconsvg w20 h20"})]),(0,o.Lk)("div",dt,[(0,o.bF)(w,{class:"footer-font",trigger:"click",placement:"top"},{dropdown:(0,o.k6)((()=>[(0,o.bF)(b,null,{default:(0,o.k6)((()=>[(0,o.bF)(f,{class:(0,l.C4)({"is-active":18===ne.value}),onClick:t[2]||(t[2]=e=>io(18))},{default:(0,o.k6)((()=>[(0,o.eW)(" Maximum 18 ")])),_:1},8,["class"]),(0,o.bF)(f,{class:(0,l.C4)({"is-active":16===ne.value}),onClick:t[3]||(t[3]=e=>io(16))},{default:(0,o.k6)((()=>[(0,o.eW)(" Large 16 ")])),_:1},8,["class"]),(0,o.bF)(f,{class:(0,l.C4)({"is-active":14===ne.value}),onClick:t[4]||(t[4]=e=>io(14))},{default:(0,o.k6)((()=>[(0,o.eW)(" Defaut 14 ")])),_:1},8,["class"]),(0,o.bF)(f,{class:(0,l.C4)({"is-active":12===ne.value}),onClick:t[5]||(t[5]=e=>io(12))},{default:(0,o.k6)((()=>[(0,o.eW)(" Minimum 12 ")])),_:1},8,["class"])])),_:1})])),default:(0,o.k6)((()=>[(0,o.Lk)("span",ut,[(0,o.bF)((0,n.R1)(h.A),{type:"pk-fontselect",class:"iconsvg w20 h20"})])])),_:1})]),(0,o.Lk)("div",{class:"main-chat-footer-operation hide",onClick:so},[(0,o.bF)((0,n.R1)(h.A),{type:"pk-downloadlogs",class:"iconsvg w20 h20"})]),(0,o.Lk)("div",{class:"main-chat-footer-operation hide",onClick:co},[(0,o.bF)((0,n.R1)(h.A),{type:"pk-sharelogs",class:"iconsvg w20 h20"})]),(0,o.Lk)("div",pt,[(0,o.bF)(R,{class:"flex-text",disabled:-1===ie.value||0===be.value.length,onClick:ro},{default:(0,o.k6)((()=>[(0,o.bF)((0,n.R1)(h.A),{class:"mr6",type:"pk-documentupload"}),(0,o.eW)(" "+(0,l.v_)((0,n.R1)(j)("page.qa.main.operation.newText")),1)])),_:1},8,["disabled"])])]),(0,o.Lk)("div",mt,[(0,o.bF)(s,{ref_key:"inputRef",ref:ke,modelValue:ve.value,"onUpdate:modelValue":t[6]||(t[6]=e=>ve.value=e),type:"textarea","input-style":"height: 3.375rem",disabled:v.value||"prompting"===ge.value,placeholder:(0,n.R1)(j)("page.qa.main.footer.inputplaceholder",{limit:ee.value}),autosize:{minRows:1,maxRows:10},onInput:Yt,onPaste:Jt,onKeydown:Zt,onKeypress:(0,i.jR)(ao,["enter"]),onFocus:Pt,onBlur:zt},null,8,["modelValue","disabled","placeholder"]),(0,o.Lk)("div",vt,["prompt"===ge.value?((0,o.uX)(),(0,o.Wv)(R,{key:0,type:"primary",disabled:he.value,onClick:jt},{icon:(0,o.k6)((()=>[he.value?((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:0,type:"pk-prompt",class:"main-chat-footer-promptwh"})):((0,o.uX)(),(0,o.Wv)((0,n.R1)(h.A),{key:1,type:"pk-prompting",class:"main-chat-footer-promptwh"}))])),_:1},8,["disabled"])):"prompting"===ge.value?((0,o.uX)(),(0,o.Wv)(R,{key:1,type:"primary",onClick:oo},{icon:(0,o.k6)((()=>[(0,o.bF)((0,n.R1)(h.A),{type:"pk-stopre",class:"main-chat-footer-promptwh"})])),_:1})):(0,o.Q3)("",!0)])])])],512),[[i.aG,!ae.value]])],512),[[i.aG,ye.value&&!Ie.value]]),(0,o.bF)(C,{modelValue:Y.value,"onUpdate:modelValue":t[9]||(t[9]=e=>Y.value=e),title:(J.id,(0,n.R1)(j)("page.qa.main.footer.modifyNormalDataHint")),width:"600"},{footer:(0,o.k6)((()=>[(0,o.Lk)("div",kt,[(0,o.bF)(R,{onClick:t[8]||(t[8]=e=>Y.value=!1)},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)((0,n.R1)(j)("page.qa.main.cancelButton")),1)])),_:1}),(0,o.bF)(R,{type:"primary",onClick:It},{default:(0,o.k6)((()=>[(0,o.eW)((0,l.v_)((0,n.R1)(j)("page.qa.main.confirmButton")),1)])),_:1})])])),default:(0,o.k6)((()=>[(0,o.bF)((0,n.R1)(m.US),{model:J,rules:ft,ref_key:"normalForm",ref:te,class:"normalForm","label-width":"10"},{default:(0,o.k6)((()=>[(0,o.bF)(_,{label:"",prop:"content"},{default:(0,o.k6)((()=>[(0,o.bF)(s,{class:"normal",maxlength:"500",type:"textarea",modelValue:J.content,"onUpdate:modelValue":t[7]||(t[7]=e=>J.content=e),placeholder:(0,n.R1)(j)("page.qa.normalData.placeholder")},null,8,["modelValue","placeholder"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,o.bF)(C,{modelValue:Ne.value,"onUpdate:modelValue":t[10]||(t[10]=e=>Ne.value=e),title:fe.value?.docName},{default:(0,o.k6)((()=>[(0,o.bF)(k,{style:{height:"60vh"}},{default:(0,o.k6)((()=>[(0,o.Lk)("div",gt,[(0,o.bF)(Ee.A,{docId:qe.value,text:Se.value},null,8,["docId","text"])])])),_:1})])),_:1},8,["modelValue","title"]),(0,o.bF)(We,{modelValue:me.value,"onUpdate:modelValue":t[11]||(t[11]=e=>me.value=e),onHandleCreateCompare:Et},null,8,["modelValue"])])}}});const bt=(0,X.A)(ft,[["__scopeId","data-v-398431dc"]]);var wt=bt}}]);