"use strict";(self["webpackChunkSensepedia"]=self["webpackChunkSensepedia"]||[]).push([[140],{18684:function(e,t,n){n.d(t,{A:function(){return s}});var a=n(28694),r=n(83487),u=n(38118),i={key:1},o=(0,a.pM)({__name:"Tooltip",props:{content:{},placement:{},className:{},showArrow:{type:Boolean,default:!0},offset:{default:0}},setup:function(e){var t=(0,a.Ht)(),n=(0,u.KR)(!0),o=(0,u.KR)(null),l=function(){if(o.value){var e,t=null===(e=o.value)||void 0===e||null===(e=e.parentNode)||void 0===e||null===(e=e.parentNode)||void 0===e?void 0:e.offsetWidth,a=o.value.offsetWidth;n.value=!(a>t)}};return function(e,c){var s=(0,a.g2)("el-tooltip");return(0,a.uX)(),(0,a.Wv)(s,{class:"el-tooltip",effect:"light",disabled:n.value,content:e.content,placement:e.placement,"show-arrow":e.showArrow,offset:e.offset},{default:(0,a.k6)((function(){return[(0,a.Lk)("span",{class:"over-flow",onMouseover:l},[(0,a.Lk)("span",{ref_key:"refName",ref:o,class:(0,r.C4)(e.className)},[(0,u.R1)(t).default?(0,a.RG)(e.$slots,"default",{key:0}):((0,a.uX)(),(0,a.CE)("span",i,(0,r.v_)(e.content||"-"),1))],2)],32)]})),_:3},8,["disabled","content","placement","show-arrow","offset"])}}}),l=n(83940);const c=(0,l.A)(o,[["__scopeId","data-v-7d8873d0"]]);var s=c},87069:function(e,t,n){n.r(t),n.d(t,{default:function(){return st}});var a=n(94470),r=n(28724),u=n(30882),i=n(79266),o=(n(71171),n(96919),n(20897),n(4500),n(19382),n(58926),n(14898),n(29306),n(78952),n(81619),n(27015),n(50641),n(65218),n(28694)),l=n(83487),c=n(38118),s=n(97913),p=n(98836),d=n(74913),v=n(32228),f=n(19477),m=n(74560),k=n(87591),h=n(47531),g=n(18232),w=n(12567),b=(n(64536),n(77111),n(47715),n(69989)),x=n(97053),y=n(49284),A=n(57668),_=n(18684),q=n(49302),R=n(17299),C={class:"list-chat"},L={key:0,class:"list-chat-nodata"},F=["src"],E=["onClick"],I={key:0,class:"list-chat-item-online"},W={class:"list-chat-item-onlineT"},K={class:"list-chat-item-onlineD"},X={key:1,class:"list-chat-item-title"},T={class:"list-chat-item-onlineT"},S={class:"list-chat-item-onlineD"},B={key:2,class:"list-chat-item-op"},V=(0,o.pM)({__name:"List",props:{filter:{}},emits:["loadData","stopLLM"],setup:function(e,t){var n=t.emit,a=(0,v.s9)(),r=a.t,p=(0,d.Pj)(),k=e,h=n,g=(0,o.EW)((function(){return"/"})),V=(0,o.EW)((function(){var e=p.state.pk_qa.history;if(k.filter){var t=e.filter((function(e){return e.title.includes(k.filter)}));return t.filter((function(e){return e.uuid}))}return e.filter((function(e){return e.uuid}))})),D=(0,o.EW)((function(){return p.state.pk_qa.active})),H=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){var n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.uuid,!P(n)){e.next=3;break}return e.abrupt("return");case 3:D.value&&p.commit("pk_qa/updateHistory",{uuid:D.value,type:"update",isEdit:!1}),h("loadData",{uuid:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=(0,i.A)((0,u.A)().mark((function e(t,n,a){var i,o,l,c;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t.uuid,o=t.title,null===a||void 0===a||a.stopPropagation(),!i){e.next=10;break}return e.next=5,(0,q.aQ)({id:i,name:o});case 5:e.sent,p.commit("pk_qa/updateHistory",{uuid:i,type:"update",title:o,isEdit:n}),m.nk.success(r("page.qa.main.modifySuccess")),e.next=17;break;case 10:return e.next=12,(0,q.xU)({name:o,scope:1});case 12:l=e.sent,c=~~l.data.id,p.commit("pk_qa/updateHistory",{uuid:c,type:"add",isEdit:n,createdAt:l.data.createTime}),p.commit("pk_qa/saveActive",{uuid:c}),m.nk.success(r("page.qa.main.submitSuccess"));case 17:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),U=function(e,t,n){var a=e.uuid;a&&p.commit("pk_qa/updateHistory",{uuid:a,type:"update",isEdit:t})},M=function(){var e=(0,i.A)((0,u.A)().mark((function e(t,n){var a;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=t.uuid,null===n||void 0===n||n.stopPropagation(),f.s.confirm(r("page.qa.main.deleteHintDetail"),r("page.qa.main.deleteHint"),{confirmButtonText:r("page.qa.main.confirmButton"),cancelButtonText:r("page.qa.main.cancelButton"),type:r("page.qa.main.deleteType")}).then((0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,q.O8)({ids:""+a,scope:1});case 2:h("stopLLM",{uuid:a}),p.commit("pk_qa/deleteHistory",{uuid:a}),m.nk.success(r("page.qa.main.deleteSuccess"));case 5:case"end":return e.stop()}}),e)})))).catch((function(){}));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),O=(0,A.s)(M,600),Q=!1,j=!1,Y=function(){var e=(0,i.A)((0,u.A)().mark((function e(t,n,a){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!Q){e.next=3;break}return Q=!1,e.abrupt("return");case 3:if(!j){e.next=5;break}return e.abrupt("return");case 5:return j=!0,e.next=8,N(t,n,a);case 8:j=!1;case 9:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),J=function(e,t){var n=e.uuid;Q=!0,n&&p.commit("pk_qa/updateHistory",{uuid:n,type:"update",isEdit:t})},P=function(e){return D.value===e};return(0,o.sV)((function(){(0,R.eo)(),(0,R.Ru)()})),(0,o.hi)((function(){(0,R.zg)()})),function(e,t){return(0,o.uX)(),(0,o.Wv)((0,c.R1)(b.kA),null,{default:(0,o.k6)((function(){return[(0,o.Lk)("div",C,[V.value.length?((0,o.uX)(!0),(0,o.CE)(o.FK,{key:1},(0,o.pI)(V.value,(function(e,t){return(0,o.uX)(),(0,o.CE)("div",{key:t},[(0,o.Lk)("a",{class:(0,l.C4)(["list-chat-item",P(e.uuid)&&"active"]),onClick:function(t){return H(e)}},[e.isEdit?((0,o.uX)(),(0,o.CE)("div",X,[(0,o.Lk)("div",T,[(0,o.bF)((0,c.R1)(x.WK),{class:"input",modelValue:e.title,"onUpdate:modelValue":function(t){return e.title=t},onBlur:function(t){return Y(e,!1,t)},onKeydown:[(0,s.jR)((function(t){return Y(e,!1,t)}),["enter"]),(0,s.jR)((function(t){return J(e,!1)}),["esc"])],placeholder:(0,c.R1)(r)("page.qa.list.inputHolder")},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeydown","placeholder"])]),(0,o.Lk)("div",S,(0,l.v_)(e.createdAt),1)])):((0,o.uX)(),(0,o.CE)("div",I,[(0,o.Lk)("div",W,[(0,o.bF)(_.A,{content:e.title.substring(0,99),placement:"bottom-start","show-arrow":!1},null,8,["content"])]),(0,o.Lk)("div",K,(0,l.v_)(e.createdAt),1)])),P(e.uuid)&&e.uuid?((0,o.uX)(),(0,o.CE)("div",B,[e.isEdit?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[(0,o.bF)((0,c.R1)(y.S2),{class:"list-chat-item-opU",onClick:function(t){return U(e,!0,t)}},{default:(0,o.k6)((function(){return[(0,o.bF)((0,c.R1)(w.A),{type:"pk-edit",class:"wh20"})]})),_:2},1032,["onClick"]),(0,o.bF)((0,c.R1)(y.S2),{class:"list-chat-item-opD",onClick:function(t){return(0,c.R1)(O)(e,t)}},{default:(0,o.k6)((function(){return[(0,o.bF)((0,c.R1)(w.A),{type:"pk-delete",class:"wh20"})]})),_:2},1032,["onClick"])],64))])):(0,o.Q3)("",!0)],10,E)])})),128)):((0,o.uX)(),(0,o.CE)("div",L,[(0,o.Lk)("img",{src:g.value+"images/nodata.svg",width:"176px",height:"115px"},null,8,F),(0,o.eW)(" "+(0,l.v_)((0,c.R1)(r)("page.qa.list.nodata")),1)]))])]})),_:1})}}}),D=n(83940);const H=(0,D.A)(V,[["__scopeId","data-v-4b1b508c"]]);var N=H,U={class:"chat-hint-icon"},M={class:"chat-hint-box"},O={class:"chat-hint-box-title"},Q={class:"chat-hint-box-desc"},j=(0,o.pM)({__name:"Hint",props:{id:{},title:{},desc:{}},setup:function(e){var t=e,n=function(e){};return function(e,a){return(0,o.uX)(),(0,o.CE)("div",{class:"chat-hint",onClick:a[0]||(a[0]=function(e){return n(t.title)})},[(0,o.Lk)("div",U,[(0,o.RG)(e.$slots,"icon")]),(0,o.Lk)("div",M,[(0,o.Lk)("div",O,(0,l.v_)(t.title),1),(0,o.Lk)("div",Q,(0,l.v_)(t.desc),1)])])}}});const Y=(0,D.A)(j,[["__scopeId","data-v-10048ac3"]]);var J=Y,P=(n(10348),n(44480),n(87434),n(64996)),G=n(52379),z={key:0,class:"chat-message-divider"},$={class:"chat-message-header"},Z=["src"],ee={class:"chat-message-body"},te={class:"chat-message-body-text"},ne={key:0,class:"chat-message-footer"},ae={class:"chat-message-footer-right"},re={class:"chat-message-footer-rightr"},ue={key:1,class:"chat-message-weburl"},ie={class:"index"},oe={class:"url"},le=["href"],ce=["onClick"],se={class:"dialog-footer"},pe=(0,o.pM)({__name:"Message",props:{id:{},createdAt:{},text:{},owner:{},error:{type:Boolean},loading:{type:Boolean},like:{type:Boolean},unlike:{type:Boolean},feedback:{type:Boolean},urls:{},status:{},continueNumber:{},preConversationId:{}},emits:["regenerate","delete","like","unlike","feedback","continue"],setup:function(e,t){var n=t.emit,a=(0,v.s9)(),r=a.t,s=(0,d.Pj)(),p=e,f=n,k=(0,c.KR)("me"===p.owner),g=(0,c.KR)(null),b=(0,c.KR)(!1),x=(0,c.KR)(r("page.qa.message.feedback")),A=(0,c.KR)(r("page.qa.message.feedbackList").split(",")),R=(0,c.KR)(null),C=(0,c.Kh)({value:""}),L=(0,c.Kh)({value:[{required:!0,message:r("page.qa.message.feedbackPlaceholder"),trigger:"blur"}]}),F=(0,o.EW)((function(){return s.state.global.canFeedback})),E=(0,o.EW)((function(){var e,t=(null===(e=p.text)||void 0===e?void 0:e.replace(/<br\/>|<br>/g,"\n"))||"";return t=t.replaceAll("\\boxed",""),2===p.status?t+='<span class="stop">'.concat(r("page.qa.main.stopText"),"</span>"):5===p.status&&Number(p.continueNumber||0)<3?t+='<a class="limit">'.concat(r("page.qa.main.limitText"),"</a>"):6===p.status&&(t=r("page.qa.message.error")),t||r("page.qa.answer.error")})),I=(0,o.EW)((function(){return p.like})),W=(0,o.EW)((function(){return p.unlike})),K=(0,o.EW)((function(){return p.feedback})),X=(0,o.EW)((function(){return!1})),T=function(){var e=(0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!p.id||p.like){e.next=5;break}return e.next=3,(0,q.HL)({id:p.id,score:1});case 3:f("like",p.id),m.nk.success(r("page.qa.main.likeSuccess"));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=(0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!p.id||p.unlike){e.next=5;break}return e.next=3,(0,q.Sn)({id:p.id,score:2});case 3:f("unlike",p.id),m.nk.success(r("page.qa.main.globalSuccess"));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=(0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:p.id&&!p.feedback&&(b.value=!0),C.value="";case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=(0,i.A)((0,u.A)().mark((function e(){var t,n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,n=null===(t=R.value)||void 0===t?void 0:t.validate(),n){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,(0,q.H9)({id:p.id,comment:C.value});case 6:f("feedback",p.id||0,C.value),m.nk.success(r("page.qa.main.submitSuccess")),b.value=!1,e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](0),b.value=!1,console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=(0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:f("continue");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H=function(e){C.value=e},N=function(e){switch(e){case"clipboard":M();break;case"delete":f("delete");break;case"asText":k.value=!k.value;break}},U=function(){var e;null===(e=g.value)||void 0===e||e.scrollIntoView(),f("regenerate")},M=function(){var e=(0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,G.L)(E.value||"");case 3:m.nk.success(r("page.qa.main.copySuccess")),e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),m.nk.error(r("page.qa.main.copyError"));case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}();return function(e,t){var n=(0,o.g2)("el-divider"),a=(0,o.g2)("el-form-item"),u=(0,o.g2)("el-input"),i=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.CE)(o.FK,null,["me"===p.owner&&-1===e.preConversationId?((0,o.uX)(),(0,o.CE)("div",z,[(0,o.bF)(n,{"content-position":"center"},{default:(0,o.k6)((function(){return[(0,o.eW)((0,l.v_)((0,c.R1)(r)("page.qa.main.divider")),1)]})),_:1})])):(0,o.Q3)("",!0),(0,o.Lk)("div",{ref_key:"messageRef",ref:g,class:(0,l.C4)(["chat-message","me"===p.owner?"reverse":""])},[(0,o.Lk)("div",$,[(0,o.Lk)("img",{src:"me"===p.owner?"/images/GroupQ.png":"/images/GroupA.png",width:"40",height:"40"},null,8,Z)]),(0,o.Lk)("div",ee,[(0,o.Lk)("div",te,[(0,o.bF)(P.A,{ref:"textRef",owner:e.owner,error:e.error,text:E.value,loading:e.loading,UUID:e.id,"as-raw-text":k.value,onHandleLimit:D},null,8,["owner","error","text","loading","UUID","as-raw-text"])]),e.id?((0,o.uX)(),(0,o.CE)("div",ne,["me"===p.owner?((0,o.uX)(),(0,o.CE)(o.FK,{key:0},[],64)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[F.value?((0,o.uX)(),(0,o.Wv)((0,c.R1)(y.S2),{key:0,type:"text",onClick:T},{default:(0,o.k6)((function(){return[I.value?((0,o.uX)(),(0,o.Wv)((0,c.R1)(w.A),{key:1,type:"pk-liked",class:"wh18 hover"})):((0,o.uX)(),(0,o.Wv)((0,c.R1)(w.A),{key:0,type:"pk-like",class:"wh18 hover"}))]})),_:1})):(0,o.Q3)("",!0),F.value?((0,o.uX)(),(0,o.Wv)((0,c.R1)(y.S2),{key:1,type:"text",onClick:S},{default:(0,o.k6)((function(){return[W.value?((0,o.uX)(),(0,o.Wv)((0,c.R1)(w.A),{key:1,type:"pk-unliked",class:"wh18 hover"})):((0,o.uX)(),(0,o.Wv)((0,c.R1)(w.A),{key:0,type:"pk-unlike",class:"wh18 hover"}))]})),_:1})):(0,o.Q3)("",!0),F.value&&!K.value?((0,o.uX)(),(0,o.Wv)((0,c.R1)(y.S2),{key:2,type:"text",onClick:B},{default:(0,o.k6)((function(){return[(0,o.bF)((0,c.R1)(w.A),{type:"pk-feedback",class:"wh18 hover"})]})),_:1})):(0,o.Q3)("",!0),(0,o.bF)((0,c.R1)(y.S2),{type:"text",onClick:t[0]||(t[0]=function(e){return N("clipboard")})},{default:(0,o.k6)((function(){return[X.value?((0,o.uX)(),(0,o.Wv)((0,c.R1)(w.A),{key:1,type:"pk-copied",class:"wh18"})):((0,o.uX)(),(0,o.Wv)((0,c.R1)(w.A),{key:0,type:"pk-copy",class:"wh18 hover"}))]})),_:1}),(0,o.Lk)("div",ae,[(0,o.Lk)("div",re,[(0,o.bF)((0,c.R1)(y.S2),{type:"text",onClick:U},{default:(0,o.k6)((function(){return[(0,o.eW)((0,l.v_)((0,c.R1)(r)("page.qa.message.regenerate")),1)]})),_:1})])])],64))])):(0,o.Q3)("",!0),e.urls&&e.urls.length?((0,o.uX)(),(0,o.CE)("div",ue,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.urls,(function(e,t){return(0,o.uX)(),(0,o.CE)("div",{class:"url-list",key:"weburl"+t},[(0,o.Lk)("div",ie,(0,l.v_)(t+1),1),(0,o.Lk)("div",oe,[(0,o.bF)(_.A,{content:e.title,placement:"bottom",offset:-12},{default:(0,o.k6)((function(){return[(0,o.Lk)("a",{href:e.url,target:"_blank"},(0,l.v_)(e.title),9,le)]})),_:2},1032,["content"])])])})),128))])):(0,o.Q3)("",!0)]),(0,o.bF)(i,{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=function(e){return b.value=e}),title:x.value,width:"25rem"},{footer:(0,o.k6)((function(){return[(0,o.Lk)("div",se,[(0,o.bF)((0,c.R1)(y.S2),{onClick:t[2]||(t[2]=function(e){return b.value=!1})},{default:(0,o.k6)((function(){return[(0,o.eW)((0,l.v_)((0,c.R1)(r)("page.qa.main.cancelButton")),1)]})),_:1}),(0,o.bF)((0,c.R1)(y.S2),{type:"primary",onClick:V},{default:(0,o.k6)((function(){return[(0,o.eW)((0,l.v_)((0,c.R1)(r)("page.qa.main.submitButton")),1)]})),_:1})])]})),default:(0,o.k6)((function(){return[(0,o.bF)((0,c.R1)(h.US),{model:C,rules:L,ref_key:"feedbackRef",ref:R},{default:(0,o.k6)((function(){return[(0,o.bF)(a,null,{default:(0,o.k6)((function(){return[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(A.value,(function(e){return(0,o.uX)(),(0,o.CE)("span",{class:"span",key:e,onClick:function(t){return H(e)}},(0,l.v_)(e),9,ce)})),128))]})),_:1}),(0,o.bF)(a,{label:"",props:"value"},{default:(0,o.k6)((function(){return[(0,o.bF)(u,{modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=function(e){return C.value=e}),type:"textarea",autosize:{minRows:4,maxRows:4}},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue","title"])],2)],64)}}});const de=(0,D.A)(pe,[["__scopeId","data-v-78a2d172"]]);var ve=de,fe=n(70579),me=n(76412),ke=n(85158),he=n(81329),ge=function(e){return(0,o.Qi)("data-v-043cdf65"),e=e(),(0,o.jt)(),e},we={class:"main"},be={class:"left-chat"},xe={class:"qa"},ye={class:"qa-header"},Ae={class:"qa-header-title"},_e={class:"qa-main"},qe={class:"qa-main-create"},Re={class:"qa-main-list"},Ce={class:"qa-main-clear"},Le={id:"scrollRef",ref:"scrollRef",class:"main-chat"},Fe={class:"main-chat-grow"},Ee={class:"main-chat-nodata"},Ie={class:"main-chat-nodata-left"},We={class:"main-chat-nodata-right",style:{width:"100%",gap:"16px"}},Ke={key:1,class:"main-chat-content"},Xe={class:"main-chat-grow"},Te={key:0,class:"main-chat-nodata"},Se=ge((function(){return(0,o.Lk)("div",{class:"main-chat-nodata-left"},[(0,o.Lk)("span",null,[(0,o.Lk)("img",{src:"/images/GroupA.png",width:"40",height:"40"})])],-1)})),Be={class:"main-chat-nodata-right"},Ve={class:"main-chat-nodata-title"},De=["innerHTML"],He={class:"main-chat-nodata-hint"},Ne=["onClick"],Ue=["src"],Me={key:1,id:"chatMessage",class:"main-chat-message"},Oe={key:0},Qe={class:"main-chat-footer mt-24"},je={class:"main-chat-footer-op"},Ye={class:"main-chat-footer-opNormal"},Je={class:"normal-datah1"},Pe=["onClick"],Ge={class:"normal-data-item-operation"},ze=["onClick"],$e=["onClick"],Ze={class:"normal-data-item addplus"},et={class:"main-chat-footer-operation"},tt={class:"el-dropdown-link"},nt={class:"main-chat-footer-opWeb"},at={class:"main-chat-footer-operation flex-grow"},rt={class:"main-chat-footer-input"},ut={class:"main-chat-footer-button"},it={class:"dialog-footer"},ot=1,lt=(0,o.pM)({__name:"index",setup:function(e){var t=(0,fe.Y)(),n=t.addChat,b=t.updateChat,x=t.updateChatSome,y=t.getChatByUuidAndIndex,A=(0,me.A)(),C=A.scrollbarRef,L=A.scrollToBottom,F=A.scrollToBottomIfAtBottom,E=new AbortController,I="",W=(0,p.rd)(),K=(W.currentRoute,(0,d.Pj)()),X=(0,v.s9)(),T=(X.locale,X.t);K.commit("global/setMenuEnable",!0);var S=(0,c.KR)(4e3),B=(0,c.KR)(!0),V=(0,c.KR)(!1),D=(0,c.KR)(""),H=(0,c.KR)(!1),U=(0,c.KR)([]),M=(0,c.KR)({title:T("page.qa.main.nodata.title"),subtitle:T("page.qa.main.nodata.detail"),hint:T("page.qa.main.nodata.hint")}),O=(0,c.KR)([]),Q=(0,c.KR)(!1),j=(0,c.Kh)({id:0,content:"",scope:ot}),Y=(0,c.KR)(),P=(0,c.KR)(!1),G=(0,c.KR)(!1),z=(0,c.KR)(14),$=(0,c.KR)(0),Z=(0,c.KR)(null),ee=(0,c.KR)(""),te=(0,c.KR)(null),ne=(0,c.KR)("prompt"),ae=(0,o.EW)((function(){return"prompting"===ne.value||!ee.value||0===ee.value.length||Ft(ee.value)>S.value})),re=(0,o.EW)((function(){var e=K.state.pk_qa.active;return e})),ue=(0,o.EW)((function(){return K.state.pk_qa.history})),ie=(0,o.EW)((function(){var e=K.state.pk_qa.history.find((function(e){return e.uuid===re.value}));return e?e.chats:K.state.pk_qa.chats})),oe=(0,c.Kh)({content:[{required:!0,message:T("page.qa.normalData.placeholder"),trigger:"blur"}]}),le=function(e){e.stopPropagation();var t=e.key;t&&"Enter"===t&&console.log("enter")},ce=function(){var e=(0,i.A)((0,u.A)().mark((function e(){var t;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=K.state.pk_document.history.find((function(e){return null===e.uuid})),!t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,St();case 5:return K.commit("pk_qa/addHistory",{uuid:null,title:"New Chat",isEdit:!1,createdAt:(0,he.pr)(new Date)}),K.commit("pk_qa/saveActive",{uuid:null}),K.commit("pk_qa/saveHistory",{uuid:null}),e.next=10,(0,o.dY)();case 10:$.value=-1,(0,R.cY)();case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=function(){var e=(0,i.A)((0,u.A)().mark((function e(t,n){var a;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:ee.value=t.prompt,null===(a=te.value)||void 0===a||a.focus(),n&&(yt(!1,{},!0),ee.value="");case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),pe=function(){var e=(0,i.A)((0,u.A)().mark((function e(){var t,n,a;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,null===(t=Y.value)||void 0===t?void 0:t.validate();case 3:if(n=e.sent,n){e.next=6;break}return e.abrupt("return");case 6:if(a=j.id,!a){e.next=12;break}return e.next=10,(0,q.v8)(j);case 10:e.next=15;break;case 12:return j.id=0,e.next=15,(0,q.p1)(j);case 15:return e.next=17,jt();case 17:e.next=22;break;case 19:e.prev=19,e.t0=e["catch"](0),console.log(e.t0);case 22:return e.prev=22,Q.value=!1,e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[0,19,22,25]])})));return function(){return e.apply(this,arguments)}}(),de=function(e){ee.value=e.content||"",Z.value&&Z.value.hide(),It()},ge=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:j.id=t.id,j.content=t.content||"",Q.value=!0;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),lt=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:f.s.confirm(T("page.qa.main.deleteHintDetail"),T("page.qa.main.deleteHint"),{confirmButtonText:T("page.qa.main.confirmButton"),cancelButtonText:T("page.qa.main.cancelButton"),type:T("page.qa.main.deleteType")}).then((0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,q.Tf)(t);case 2:return e.next=4,jt();case 4:case"end":return e.stop()}}),e)})))).catch((function(){}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ct=function(){j.id=0,j.content="",Q.value=!0},st="",pt=0,dt=function(e){var t=e.event.target,n=t.responseText,a=n.trimEnd().split("\n"),r={},u=st,i=!1;try{var o=a.length;if(o>0){for(var l=0;l<o;l++){var c=a[l];if(r=JSON.parse(c),r.stopId)I=r.stopId;else{if("conversationId"in r){r.conversationId,i=!1;break}r.answer&&(u+=r.answer),"sensitive"===r.finish_reason&&(u+=T("page.qa.message.error"))}}u&&x(re.value,pt,{text:u,owner:"llm",error:!1,loading:i})}}catch(s){console.log(s)}},vt=function(e){var t=e.event.target,n=t.responseText,a=n.trimEnd().split("\n"),r={},u="",i=!1;try{var o=a.length;if(o<=2&&null===re.value){try{var l=JSON.parse(a[0]);l.scope&&ht(l)}catch(p){console.error(p)}return}if(o>0){u="";for(var c=0;c<o;c++){var s=a[c];if(r=JSON.parse(s),r.stopId)I=r.stopId;else{if("conversationId"in r){r.conversationId,i=!1;break}r.answer&&(u+=r.answer),"sensitive"===r.finish_reason&&(u+=T("page.qa.message.error"))}}u&&(x(re.value,ie.value.length-1,{createdAt:(0,he.pr)(new Date),text:u,owner:"llm",error:!1,loading:i}),st=u),F()}}catch(d){console.log(d)}},ft=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){var n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=ie.value.findIndex((function(e){return e.id===t})),-1!==n&&x(re.value,n,{like:!0,unlike:!1});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),mt=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){var n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=ie.value.findIndex((function(e){return e.id===t})),-1!==n&&x(re.value,n,{like:!1,unlike:!0});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),kt=function(){var e=(0,i.A)((0,u.A)().mark((function e(t,n){var a;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=ie.value.findIndex((function(e){return e.id===t})),-1!==a&&x(re.value,a,{feedback:n});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ht=function(e){K.commit("pk_qa/updateHistory",{type:"updateId",uuid:re.value,id:e.id,name:e.name}),K.commit("pk_qa/saveActive",{uuid:e.id}),wt=e.id},gt=function(e,t,n){var a=JSON.parse(e.pop()),r=a.id,u=a.conversationId,i=a.urls,o=a.chatStatus,l=a.continueNumber,c=[];try{i&&V.value&&(c=JSON.parse(i))}catch(s){console.error(s)}re.value===wt&&(K.commit("pk_qa/saveHistory",{uuid:re.value}),$.value=u,x(re.value,n,{id:r,prompt:t,conversationId:u,urls:c,status:o,continueNumber:l,loading:!1}))},wt=null,bt=function(){var e=(0,i.A)((0,u.A)().mark((function e(t,n,a,i){var o,l,c,s;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return wt=re.value,st=t.text,pt=a,e.next=5,(0,q.C$)((0,r.A)({sessionId:re.value,query:n,webSearch:V.value,webCounts:8,maxNewTokens:2048,prompt:""},i),E.signal,dt);case 5:o=e.sent,o&&"string"===typeof o&&(c=o.trimEnd().split("\n"),null===re.value&&c.length>0&&(s=JSON.parse(c[0]),s.scope&&ht(s)),gt(c,n,pt),null===(l=te.value)||void 0===l||l.focus()),ne.value="prompt";case 8:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),xt=function(){var e=(0,i.A)((0,u.A)().mark((function e(t,n,a,i){var o,l,c;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return wt=re.value,e.next=3,(0,q.C$)((0,r.A)({sessionId:re.value,query:n,webSearch:V.value,webCounts:8,maxNewTokens:2048,prompt:""},i),E.signal,vt);case 3:if(o=e.sent,!o||"string"!==typeof o){e.next=13;break}return l=o.trimEnd().split("\n"),null===re.value&&l.length>0&&(c=JSON.parse(l[0]),c.scope&&ht(c)),i.prompt||n,gt(l,n,ie.value.length-1),re.value&&(0,q.aQ)({id:re.value}),F(),setTimeout((function(){var e;L(),null===(e=te.value)||void 0===e||e.focus()}),400),e.abrupt("return");case 13:F(),ne.value="prompt",x(re.value,a,{loading:!1});case 16:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),yt=function(){var e=(0,i.A)((0,u.A)().mark((function e(){var t,a,r,i,o,l,c,s,p,d,v,f=arguments;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=f.length>0&&void 0!==f[0]&&f[0],a=f.length>1&&void 0!==f[1]?f[1]:null,r=f.length>2&&void 0!==f[2]&&f[2],i=ee.value,t&&(i=null!==(o=null===a||void 0===a?void 0:a.prompt)&&void 0!==o?o:"",i=i||(null===a||void 0===a||null===(l=a.options)||void 0===l?void 0:l.prompt)),c=[],H.value)for(s=0;s<ie.value.length;s+=2)c.push([ie.value[s].text,ie.value[s+1].text.split("\n\n数据来源：\n\n")[0]]);if(i&&0!==i.length){e.next=9;break}return e.abrupt("return");case 9:if("prompting"!==ne.value){e.next=11;break}return e.abrupt("return");case 11:return p={},p.preFreetalkId=0!==$.value?$.value:null,p.onContinue=!1,n(re.value,{id:0,createdAt:(0,he.pr)(new Date),text:i,owner:"me",error:!1,conversation:null,conversationId:0,preConversationId:$.value,options:{prompt:i,options:null}}),L(),ne.value="prompting",ee.value="",{},n(re.value,{id:0,createdAt:(0,he.pr)(new Date),text:T("page.qa.main.llm.hint"),loading:!0,owner:"llm",error:!1,conversation:null,conversationId:0,preConversationId:$.value,options:{prompt:i,options:p}}),$.value=0,L(),E=new AbortController,p.temperature=.7,e.prev=24,st="",0,r&&(p.prompt=i,i=""),e.next=30,xt(st,i,ie.value.length-1,p);case 30:e.next=45;break;case 32:if(e.prev=32,e.t0=e["catch"](24),d=null===e.t0||void 0===e.t0?void 0:e.t0.message,"canceled"!==d){e.next=39;break}return x(re.value,ie.value.length-1,{loading:!1}),F(),e.abrupt("return");case 39:if(v=y(re.value,ie.value.length-1),!(null!==v&&void 0!==v&&v.text&&v.text.length>0)){e.next=43;break}return x(re.value,ie.value.length-1,{text:v.text+"\n\n"+d,error:!0,loading:!1}),e.abrupt("return");case 43:b(re.value,ie.value.length-1,{createdAt:(0,he.pr)(new Date),text:d,owner:"llm",error:!0,loading:!1,conversation:null,options:{prompt:i,options:p}}),F();case 45:return e.prev=45,ne.value="prompt",e.finish(45);case 48:case"end":return e.stop()}}),e,null,[[24,32,45,48]])})));return function(){return e.apply(this,arguments)}}(),At=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){var n,a,i,o,l,c,s,p,d;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("prompting"!==ne.value){e.next=2;break}return e.abrupt("return");case 2:if(i=ie.value[t],o=null!==(n=null===i||void 0===i?void 0:i.prompt)&&void 0!==n?n:"",l=null!==(a=null===i||void 0===i?void 0:i.prompted)&&void 0!==a&&a,!l){e.next=8;break}return se(i,!0),e.abrupt("return");case 8:if(c=!0,!c){e.next=12;break}return yt(!0,i),e.abrupt("return");case 12:return s={},i.options&&(s=(0,r.A)({},i.options)),ne.value="prompting",b(re.value,t,{createdAt:(0,he.pr)(new Date),text:"",owner:"llm",error:!1,loading:!0,conversation:null,options:{prompt:o,options:s}}),s.temperature=.7,e.prev=17,st="",e.next=21,xt(st,o,t,s);case 21:e.next=30;break;case 23:if(e.prev=23,e.t0=e["catch"](17),"canceled"!==e.t0.message){e.next=28;break}return x(re.value,t,{loading:!1}),e.abrupt("return");case 28:d=null!==(p=null===e.t0||void 0===e.t0?void 0:e.t0.message)&&void 0!==p?p:T("page.qa.error"),b(re.value,t,{createdAt:(0,he.pr)(new Date),text:d,owner:"llm",error:!0,loading:!1,conversation:null,options:{prompt:o,options:s}});case 30:return e.prev=30,ne.value="prompt",e.finish(30);case 33:case"end":return e.stop()}}),e,null,[[17,23,30,33]])})));return function(t){return e.apply(this,arguments)}}(),_t=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){var n,a,r,i,o;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("prompting"!==ne.value){e.next=2;break}return e.abrupt("return");case 2:if(r=ie.value[t],i=null!==(n=null===r||void 0===r?void 0:r.prompt)&&void 0!==n?n:"",i=i||(null===r||void 0===r||null===(a=r.options)||void 0===a?void 0:a.prompt),i&&0!==i.length){e.next=7;break}return e.abrupt("return");case 7:return o=[],o.preFreetalkId=r.preConversationId,ne.value="prompting",ee.value="",b(re.value,t,{text:r.text,error:!1,loading:!0,options:{prompt:i,options:r.options}}),E=new AbortController,o.onContinue=!0,o.id=r.id,e.prev=15,e.next=18,bt(r,i,t,o);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e["catch"](15),b(re.value,t,{loading:!1});case 23:return e.prev=23,ne.value="prompt",e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[15,20,23,26]])})));return function(t){return e.apply(this,arguments)}}(),qt=function(){It(),yt()},Rt=function(){(0,R.OV)()},Ct=function(){(0,R.Zr)()},Lt=function(e){K.commit("pk_qa/deleteChat",e)},Ft=function(e){var t=/[\u4e00-\u9fff\u0e00-\u0e7f\u1000-\u109f\u1780-\u17ff\u1e00-\u1eff\u3040-\u30ff\uac00-\ud7af]|[a-zA-Z]+|\d+|[^\s\w]/g,n=e.match(t);return n?n.length:0},Et=function(){var e=Ft(ee.value);e>S.value&&m.nk.error(T("page.qa.main.footer.inputplaceholder",{limit:S.value})),It()},It=function(){setTimeout((function(){return Kt()}))},Wt=function(e){if(e.shiftKey&&"Enter"===e.key){e.preventDefault();var t=e.target,n=t.selectionStart,a=t.selectionEnd;ee.value=ee.value.substring(0,n)+"\n"+ee.value.substring(a),setTimeout((function(){t.selectionStart=t.selectionEnd=n+1,Kt()}))}},Kt=function(){(0,R.cY)(),(0,R.bj)()},Xt=function(){qt()},Tt=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){var n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.uuid,setTimeout((function(){return(0,R.cY)()}),0),"prompting"!==ne.value){e.next=7;break}return ne.value="prompt",e.next=6,(0,q.iO)({sessionId:n,stopId:I});case 6:setTimeout(Jt,100);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),St=function(){var e=(0,i.A)((0,u.A)().mark((function e(){var t;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("prompting"!==ne.value){e.next=6;break}return ne.value="prompt",e.next=4,(0,q.iO)({sessionId:re.value,stopId:I});case 4:setTimeout(Jt,100),null===(t=te.value)||void 0===t||t.focus();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Bt=function(){var e=(0,i.A)((0,u.A)().mark((function e(){var t,n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=null===(t=ue.value)||void 0===t?void 0:t.map((function(e){return e.uuid})),!n||0!==n.length){e.next=4;break}return m.nk.error(T("page.qa.main.operation.notEmpty")),e.abrupt("return");case 4:f.s.confirm(T("page.qa.main.operation.clearHintDetail"),T("page.qa.main.operation.clearHint"),{confirmButtonText:T("page.qa.main.confirmButton"),cancelButtonText:T("page.qa.main.cancelButton"),type:"warning"}).then((0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Tt({uuid:re.value});case 2:return e.next=4,(0,q.O8)({ids:n.join(","),scope:1});case 4:return $.value=-1,K.commit("pk_qa/clearAll"),m.nk.success(T("page.qa.main.operation.successMessageLogs")),e.next=9,(0,o.dY)();case 9:(0,R.cY)();case 10:case"end":return e.stop()}}),e)})))).catch((function(){}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Vt=function(){var e=(0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null!==re.value){e.next=3;break}return m.nk.error(T("page.qa.main.operation.notEmpty")),e.abrupt("return");case 3:f.s.confirm(T("page.qa.main.operation.deleteLogs"),T("page.qa.main.operation.hint"),{confirmButtonText:T("page.qa.main.confirmButton"),cancelButtonText:T("page.qa.main.cancelButton"),type:T("page.qa.main.deleteType")}).then((0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,q.b5)({id:re.value});case 2:return $.value=-1,K.commit("pk_qa/clearChatByUuid",{uuid:re.value}),m.nk.success(T("page.qa.main.operation.successMessageLogs")),e.next=7,(0,o.dY)();case 7:(0,R.cY)();case 8:case"end":return e.stop()}}),e)})))).catch((function(){}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Dt=function(e){z.value=e,"number"===typeof e&&(document.documentElement.style.setProperty("--text-preview",e+"px"),m.nk.success(T("page.qa.main.operation.successMessageFont")))},Ht=function(){var e=(0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Nt=function(){var e=(0,i.A)((0,u.A)().mark((function e(){return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ut=function(){$.value=-1,L()},Mt=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){var n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,q.Vh)({language:t});case 2:n=e.sent,n&&n.data&&n.data.length>0&&(U.value=n.data.map((function(e){return e.prompt=e.content,e})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ot=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){var n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,q.Ju)({scope:1,language:t});case 2:n=e.sent,n&&n.data.length>0?(M.value=n.data[0],M.value.hint=M.value.hint||T("page.qa.main.nodata.hint")):M.value={title:T("page.qa.main.nodata.title"),subtitle:T("page.qa.main.nodata.detail"),hint:T("page.qa.main.nodata.hint")};case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Qt=function(){var e=(0,i.A)((0,u.A)().mark((function e(){var t,n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,q.rL)({scope:1});case 2:t=e.sent,t&&t.data&&t.data.length>0&&(n=t.data.map((function(e){return{uuid:e.id,title:e.name,isEdit:!1,createdAt:e.updateTime,chats:[]}})),K.commit("pk_qa/loadHistory",n));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),jt=function(){var e=(0,i.A)((0,u.A)().mark((function e(){var t;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,q.WK)({scope:ot});case 2:t=e.sent,t&&t.data&&t.data.length>=0&&(O.value=t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Yt=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){var n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return B.value=!0,e.next=3,St();case 3:return K.commit("pk_qa/saveActive",t),P.value=!1,e.next=7,Jt();case 7:return B.value=!1,e.next=10,(0,o.dY)();case 10:(0,R.cY)(),$t(),zt(),L(),null===(n=te.value)||void 0===n||n.focus();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Jt=function(){var e=(0,i.A)((0,u.A)().mark((function e(){var t,n,r,i,o,l,c,s,p=arguments;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=p.length>0&&void 0!==p[0]?p[0]:"add",null!==re.value){e.next=3;break}return e.abrupt("return");case 3:if(!G.value){e.next=5;break}return e.abrupt("return");case 5:return G.value=!0,n="update"===t&&ie.value.length>0?ie.value[0].createdAt:"",e.next=9,(0,q.O7)({sessionId:re.value,page:5,createTime:n});case 9:if(r=e.sent,r&&r.data.length>0){i=[],o=(0,a.A)(r.data);try{for(o.s();!(l=o.n()).done;){c=l.value,s=[];try{s=JSON.parse(c.urls)}catch(u){console.error(u)}i.push({createdAt:c.createTime,id:0,text:c.query||c.prompt,owner:"me",error:!1,loading:!1,like:1===c.score,unlike:2===c.score,feedback:c.comment,prompt:c.prompt,conversationId:c.conversationId,preConversationId:c.preConversationId}),i.push({createdAt:c.createTime,id:c.id,text:c.answer,owner:"llm",error:!1,loading:!1,like:1===c.score,unlike:2===c.score,feedback:c.comment,prompt:c.query||c.prompt,urls:s,conversationId:c.conversationId,preConversationId:c.preConversationId,status:c.chatStatus,continueNumber:c.continueNumber})}}catch(d){o.e(d)}finally{o.f()}"update"===t?K.commit("pk_qa/updateChatsByUuid",{uuid:re.value,data:i}):(K.commit("pk_qa/addChatsByUuid",{uuid:re.value,data:i}),$.value=r.data.length>0?r.data[r.data.length-1].conversationId:-1)}r&&r.data.length<5&&(P.value=!0),G.value=!1,L();case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Pt=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){var n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.target.scrollTop||t.target.documentElement.scrollTop||t.target.body.scrollTop,!(n<=40)||P.value){e.next=5;break}return e.next=4,Jt("update");case 4:window.document.removeEventListener("scroll",Pt);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Gt=function(){var e=(0,i.A)((0,u.A)().mark((function e(t){var n;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.target.scrollTop,t.target.scrollHeight,t.target.clientHeight,!(n<20&&n<20)||P.value){e.next=6;break}return e.next=6,Jt("update");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),zt=function(){window.document.addEventListener("scroll",Pt),setTimeout((function(){var e;return null===(e=C.value)||void 0===e?void 0:e.wrapRef.addEventListener("scroll",Gt)}),1e3)},$t=function(){var e;window.document.removeEventListener("scroll",Pt),null===(e=C.value)||void 0===e||e.wrapRef.removeEventListener("scroll",Gt)},Zt=(0,ke.Ay)(Mt),en=Zt.defaultLang,tn=(0,ke.W4)(Ot),nn=tn.defaultLang;return(0,o.sV)((0,i.A)((0,u.A)().mark((function e(){var t;return(0,u.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Qt();case 2:return e.next=4,jt();case 4:if(B.value=!1,!re.value){e.next=8;break}return e.next=8,Jt("add");case 8:return e.next=10,Mt(en.value);case 10:return e.next=12,Ot(nn.value);case 12:zt(),L(),(0,R.cY)(),(0,R.bj)(),null===(t=te.value)||void 0===t||t.focus();case 17:case"end":return e.stop()}}),e)})))),(0,o.hi)((function(){(0,R.fO)(),$t(),"prompting"===ne.value&&E.abort()})),(0,o.wB)((function(){return V.value}),(function(e,t){V.value&&e?S.value=1800:S.value=4e3})),function(e,t){var n=(0,o.g2)("el-input"),a=(0,o.g2)("el-button"),r=(0,o.g2)("el-skeleton-item"),u=(0,o.g2)("el-skeleton"),i=(0,o.g2)("el-col"),p=(0,o.g2)("el-row"),d=(0,o.g2)("el-divider"),v=(0,o.g2)("ElScrollbar"),f=(0,o.g2)("el-dropdown-item"),m=(0,o.g2)("el-dropdown-menu"),b=(0,o.g2)("el-dropdown"),x=(0,o.g2)("el-switch"),y=(0,o.g2)("el-form-item"),A=(0,o.g2)("el-dialog");return(0,o.uX)(),(0,o.CE)("div",we,[(0,o.Lk)("div",be,[(0,o.Lk)("div",xe,[(0,o.Lk)("div",ye,[(0,o.Lk)("h1",Ae,(0,l.v_)((0,c.R1)(T)("page.qa.header.title")),1),(0,o.bF)(n,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=function(e){return D.value=e}),class:"qa-header-input",placeholder:(0,c.R1)(T)("page.qa.header.input"),onKeydown:(0,s.jR)(le,["enter"]),"suffix-icon":(0,c.R1)(g.vji)},null,8,["modelValue","placeholder","suffix-icon"])])]),(0,o.Lk)("div",_e,[(0,o.Lk)("div",qe,[(0,o.bF)(a,{type:"primary",class:"qa-main-create-button",onClick:ce},{default:(0,o.k6)((function(){return[(0,o.eW)((0,l.v_)((0,c.R1)(T)("page.qa.main.create")),1)]})),_:1})]),(0,o.Lk)("div",Re,[(0,o.bF)(N,{filter:D.value,onLoadData:Yt,onStopLLM:Tt},null,8,["filter"])]),(0,o.Lk)("div",Ce,[(0,o.bF)((0,c.R1)(w.A),{type:"pk-delete",onClick:Bt})])])]),(0,o.Lk)("div",Le,[B.value?((0,o.uX)(),(0,o.Wv)(u,{key:0,class:"main-chat-content",animated:""},{template:(0,o.k6)((function(){return[(0,o.Lk)("div",Fe,[(0,o.Lk)("div",Ee,[(0,o.Lk)("div",Ie,[(0,o.bF)(r,{variant:"image",width:"72",height:"72",style:{width:"72px",height:"72px"}})]),(0,o.Lk)("div",We,[(0,o.bF)(r,{variant:"text"}),(0,o.bF)(r,{variant:"text"}),(0,o.bF)(r,{variant:"text"}),(0,o.bF)(r,{variant:"text"})])])])]})),_:1})):((0,o.uX)(),(0,o.CE)("div",Ke,[(0,o.Lk)("div",Xe,[0===ie.value.length?((0,o.uX)(),(0,o.CE)("div",Te,[Se,(0,o.Lk)("div",Be,[(0,o.Lk)("div",Ve,(0,l.v_)(M.value.title),1),(0,o.Lk)("div",{class:"main-chat-nodata-detail",innerHTML:M.value.subtitle},null,8,De),(0,o.Lk)("div",He,[(0,o.Lk)("div",null,(0,l.v_)(M.value.hint),1),(0,o.bF)(p,{class:"mt-8"},{default:(0,o.k6)((function(){return[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(U.value,(function(e,t){return(0,o.uX)(),(0,o.Wv)(i,{class:(0,l.C4)({"mb-16":t<1}),span:12,key:"r"+t},{default:(0,o.k6)((function(){return[(0,o.Lk)("a",{class:"full",onClick:function(t){return se(e,!1)}},[(0,o.bF)(J,{class:(0,l.C4)("chat-hint".concat(t%2)),title:e.title,desc:e.description,prompt:""},{icon:(0,o.k6)((function(){return[(0,o.Lk)("img",{src:e.icon,width:"24",height:"24"},null,8,Ue)]})),_:2},1032,["class","title","desc"])],8,Ne)]})),_:2},1032,["class"])})),128))]})),_:1})])])])):((0,o.uX)(),(0,o.CE)("div",Me,[(0,o.bF)(v,{ref_key:"scrollbarRef",ref:C},{default:(0,o.k6)((function(){return[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(ie.value,(function(e,t){return(0,o.uX)(),(0,o.Wv)(ve,{key:t,text:e.text,"created-at":e.createdAt,id:e.id,like:e.like,unlike:e.unlike,feedback:e.feedback,owner:e.owner,urls:e.urls,error:e.error,status:e.status,"continue-number":e.continueNumber,loading:e.loading,"pre-conversation-id":0===t?void 0:e.preConversationId,onRegenerate:function(e){return At(t)},onDelete:function(e){return Lt(t)},onLike:ft,onUnlike:mt,onFeedback:kt,onContinue:function(e){return _t(t)}},null,8,["text","created-at","id","like","unlike","feedback","owner","urls","error","status","continue-number","loading","pre-conversation-id","onRegenerate","onDelete","onContinue"])})),128)),ie.value.length>0&&-1===$.value?((0,o.uX)(),(0,o.CE)("div",Oe,[(0,o.bF)(d,{"content-position":"center"},{default:(0,o.k6)((function(){return[(0,o.eW)((0,l.v_)((0,c.R1)(T)("page.qa.main.divider")),1)]})),_:1})])):(0,o.Q3)("",!0)]})),_:1},512)]))]),(0,o.Lk)("div",Qe,[(0,o.Lk)("div",je,[(0,o.Lk)("div",Ye,[(0,o.bF)((0,c.R1)(k.Vc),{placement:"top-start",width:790,trigger:"hover",ref_key:"popRef",ref:Z,modelValue:e.popnor,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.popnor=t})},{reference:(0,o.k6)((function(){return[(0,o.bF)((0,c.R1)(w.A),{type:"pk-normaldata",class:"w20 h20"})]})),default:(0,o.k6)((function(){return[(0,o.Lk)("h1",Je,(0,l.v_)((0,c.R1)(T)("page.qa.main.footer.normalData")),1),(0,o.bF)(v,{class:"normal-data"},{default:(0,o.k6)((function(){return[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(O.value,(function(e,t){return(0,o.uX)(),(0,o.CE)("div",{class:"normal-data-item",key:"normal"+t},[(0,o.Lk)("div",{class:"normal-data-item-title",onClick:function(t){return de(e)}},[(0,o.bF)(_.A,{content:e.content,placement:"top-start","show-arrow":!1},null,8,["content"])],8,Pe),(0,o.Lk)("div",Ge,[(0,o.Lk)("div",{class:"normal-data-operation-edit",onClick:function(t){return ge(e)}},[(0,o.bF)((0,c.R1)(w.A),{type:"pk-editnormal",class:"w20 h20"})],8,ze),(0,o.Lk)("div",{class:"normal-data-operation-delete",onClick:function(t){return lt(e)}},[(0,o.bF)((0,c.R1)(w.A),{type:"pk-deletenormal",class:"w20 h20"})],8,$e)])])})),128))]})),_:1}),(0,o.Lk)("div",Ze,[(0,o.Lk)("a",{class:"normal-data-item-add",onClick:ct},[(0,o.bF)((0,c.R1)(w.A),{type:"pk-addplus"}),(0,o.Lk)("span",null,(0,l.v_)((0,c.R1)(T)("page.qa.main.footer.createNormalData")),1)])])]})),_:1},8,["modelValue"])]),(0,o.Lk)("div",{class:"main-chat-footer-operation",onClick:Vt},[(0,o.bF)((0,c.R1)(w.A),{type:"pk-deletelogs",class:"iconsvg w20 h20"})]),(0,o.Lk)("div",et,[(0,o.bF)(b,{class:"footer-font","popper-class":"dropDownStyle",trigger:"click",placement:"top"},{dropdown:(0,o.k6)((function(){return[(0,o.bF)(m,null,{default:(0,o.k6)((function(){return[(0,o.bF)(f,{class:(0,l.C4)({"is-active":18===z.value}),onClick:t[2]||(t[2]=function(e){return Dt(18)})},{default:(0,o.k6)((function(){return[(0,o.eW)(" Maximum 18 ")]})),_:1},8,["class"]),(0,o.bF)(f,{class:(0,l.C4)({"is-active":16===z.value}),onClick:t[3]||(t[3]=function(e){return Dt(16)})},{default:(0,o.k6)((function(){return[(0,o.eW)(" Large 16 ")]})),_:1},8,["class"]),(0,o.bF)(f,{class:(0,l.C4)({"is-active":14===z.value}),onClick:t[4]||(t[4]=function(e){return Dt(14)})},{default:(0,o.k6)((function(){return[(0,o.eW)(" Default 14 ")]})),_:1},8,["class"]),(0,o.bF)(f,{class:(0,l.C4)({"is-active":12===z.value}),onClick:t[5]||(t[5]=function(e){return Dt(12)})},{default:(0,o.k6)((function(){return[(0,o.eW)(" Minimum 12 ")]})),_:1},8,["class"])]})),_:1})]})),default:(0,o.k6)((function(){return[(0,o.Lk)("span",tt,[(0,o.bF)((0,c.R1)(w.A),{type:"pk-fontselect",class:"iconsvg w20 h20"})])]})),_:1})]),(0,o.Lk)("div",{class:"main-chat-footer-operation hide",onClick:Ht},[(0,o.bF)((0,c.R1)(w.A),{type:"pk-downloadlogs",class:"iconsvg w20 h20"})]),(0,o.Lk)("div",{class:"main-chat-footer-operation hide",onClick:Nt},[(0,o.bF)((0,c.R1)(w.A),{type:"pk-sharelogs",class:"iconsvg w20 h20"})]),(0,o.Lk)("div",nt,[(0,o.eW)((0,l.v_)((0,c.R1)(T)("page.qa.main.footer.web"))+" ",1),(0,o.bF)(x,{modelValue:V.value,"onUpdate:modelValue":t[6]||(t[6]=function(e){return V.value=e})},null,8,["modelValue"])]),(0,o.Lk)("div",at,[(0,o.bF)(a,{class:"flex-text",disabled:-1===$.value||0===ie.value.length,onClick:Ut},{default:(0,o.k6)((function(){return[(0,o.bF)((0,c.R1)(w.A),{class:"mr6",type:"pk-documentupload"}),(0,o.eW)(" "+(0,l.v_)((0,c.R1)(T)("page.qa.main.operation.newText")),1)]})),_:1},8,["disabled"])])]),(0,o.Lk)("div",rt,[(0,o.bF)(n,{ref_key:"inputRef",ref:te,modelValue:ee.value,"onUpdate:modelValue":t[7]||(t[7]=function(e){return ee.value=e}),type:"textarea","input-style":"height: 3.375rem",disabled:"prompting"===ne.value,placeholder:(0,c.R1)(T)("page.qa.main.footer.inputplaceholder",{limit:S.value}),autosize:{minRows:1,maxRows:10},onInput:Et,onPaste:It,onKeydown:Wt,onKeypress:(0,s.jR)(Xt,["enter"]),onFocus:Rt,onBlur:Ct},null,8,["modelValue","disabled","placeholder"]),(0,o.Lk)("div",ut,["prompt"===ne.value?((0,o.uX)(),(0,o.Wv)(a,{key:0,type:"primary",disabled:ae.value,onClick:qt},{icon:(0,o.k6)((function(){return[ae.value?((0,o.uX)(),(0,o.Wv)((0,c.R1)(w.A),{key:0,type:"pk-prompt",class:"main-chat-footer-promptwh"})):((0,o.uX)(),(0,o.Wv)((0,c.R1)(w.A),{key:1,type:"pk-prompting",class:"main-chat-footer-promptwh"}))]})),_:1},8,["disabled"])):"prompting"===ne.value?((0,o.uX)(),(0,o.Wv)(a,{key:1,type:"primary",onClick:St},{icon:(0,o.k6)((function(){return[(0,o.bF)((0,c.R1)(w.A),{type:"pk-stopre",class:"main-chat-footer-promptwh"})]})),_:1})):(0,o.Q3)("",!0)])])])]))],512),(0,o.bF)(A,{modelValue:Q.value,"onUpdate:modelValue":t[10]||(t[10]=function(e){return Q.value=e}),title:j.id?(0,c.R1)(T)("page.qa.main.footer.modifyNormalDataHint"):(0,c.R1)(T)("page.qa.main.footer.createNormalDataHint"),width:"600"},{footer:(0,o.k6)((function(){return[(0,o.Lk)("div",it,[(0,o.bF)(a,{onClick:t[9]||(t[9]=function(e){return Q.value=!1})},{default:(0,o.k6)((function(){return[(0,o.eW)((0,l.v_)((0,c.R1)(T)("page.qa.main.cancelButton")),1)]})),_:1}),(0,o.bF)(a,{type:"primary",onClick:pe},{default:(0,o.k6)((function(){return[(0,o.eW)((0,l.v_)((0,c.R1)(T)("page.qa.main.confirmButton")),1)]})),_:1})])]})),default:(0,o.k6)((function(){return[(0,o.bF)((0,c.R1)(h.US),{model:j,rules:oe,ref_key:"normalForm",ref:Y,class:"normalForm","label-width":"10"},{default:(0,o.k6)((function(){return[(0,o.bF)(y,{label:"",prop:"content"},{default:(0,o.k6)((function(){return[(0,o.bF)(n,{class:"normal",maxlength:"500",type:"textarea",modelValue:j.content,"onUpdate:modelValue":t[8]||(t[8]=function(e){return j.content=e}),placeholder:(0,c.R1)(T)("page.qa.normalData.placeholder")},null,8,["modelValue","placeholder"])]})),_:1})]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue","title"])])}}});const ct=(0,D.A)(lt,[["__scopeId","data-v-043cdf65"]]);var st=ct}}]);